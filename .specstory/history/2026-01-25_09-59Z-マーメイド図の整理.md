<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session fe0c8ce1-acc0-422e-a8d7-9254cb75e0e3 (2026-01-25 09:59Z) -->

# ãƒãƒ¼ãƒ¡ã‚¤ãƒ‰å›³ã®æ•´ç† (2026-01-25 09:59Z)

_**User**_

@storage/toon_files/flow_md.md ã“ã®ãƒãƒ¼ãƒ¡ã‚¤ãƒ‰å›³ã‚’æ•´ç†ã—ã¦ãã ã•ã„ã€‚
ä¸æ˜ãªç‚¹ãŒã‚ã‚Œã°ç§ã«èã„ã¦ãã ã•ã„

---

_**Agent (model default, mode Agent)**_



---


ãƒãƒ¼ãƒ¡ã‚¤ãƒ‰å›³ã®æ•´ç†ã«å‘ã‘ã¦ã€ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ã‚’ç¢ºèªä¸­ã§ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: storage/toon_files/flow_md.md</summary>

</details>
</tool-use>

---



---


ãƒãƒ¼ãƒ¡ã‚¤ãƒ‰å›³ã«å¤‰æ›ã™ã‚‹å‰ã«ã€ã„ãã¤ã‹ç¢ºèªã•ã›ã¦ãã ã•ã„ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: flow.md</summary>

</details>
</tool-use>

---



---


`storage/toon_files/flow_md.md`ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚`flow.md`ã¨æ¯”è¼ƒã—ã€æ•´ç†å‰ã«ç¢ºèªã—ãŸã„ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚

## ç¢ºèªäº‹é …

1. **task9ã®å‡¦ç†**: ã€Œå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸã€ã¯ç¾åœ¨ã€decision2ã‹ã‚‰ç›´æ¥çµ‚äº†ã—ã¦ã„ã¾ã™ãŒã€`flow.md`ã«ã¯æ®µéšçš„ãªå¯¾å¿œãƒ•ãƒ­ãƒ¼ãŒã‚ã‚Šã¾ã™ã€‚ã©ã¡ã‚‰ã‚’æ¡ç”¨ã—ã¾ã™ã‹ï¼Ÿ

2. **ãƒã‚§ãƒƒã‚¯åˆ¤å®šã®æœ‰ç„¡**: `flow.md`ã«ã¯å„åŸºæ¿ã®ã€Œãƒã‚§ãƒƒã‚¯â†’åˆ¤å®šã§ãã‚‹ã‹â†’æ­£å¸¸ã‹ã€ã®åˆ†å²ãŒã‚ã‚Šã¾ã™ãŒã€`storage/toon_files/flow_md.md`ã«ã¯ç›´æ¥äº¤æ›å‡¦ç†ã®ã¿ã§ã™ã€‚ãƒã‚§ãƒƒã‚¯åˆ¤å®šã‚’å«ã‚ã¾ã™ã‹ï¼Ÿ

3. **å†ç™ºæ™‚ã®å‡¦ç†**: `flow.md`ã«ã¯ã€Œæµå‹•ã«æˆ»ã™ã€å¾Œã®å†ç™ºåˆ¤å®šãŒã‚ã‚Šã¾ã™ãŒã€`storage/toon_files/flow_md.md`ã«ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å†ç™ºåˆ¤å®šã‚’å«ã‚ã¾ã™ã‹ï¼Ÿ

4. **ãã®ä»–ã®ç—‡çŠ¶**: `flow.md`ã«ã¯ã€Œãã®ä»–ã®ç—‡çŠ¶ã€ã®ãƒ•ãƒ­ãƒ¼ãŒã‚ã‚Šã¾ã™ãŒã€`storage/toon_files/flow_md.md`ã«ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è¿½åŠ ã—ã¾ã™ã‹ï¼Ÿ

5. **ãƒ¡ãƒ¼ã‚«ãƒ¼é€£çµ¡**: `flow.md`ã«ã¯ã€Œãƒ¡ãƒ¼ã‚«ãƒ¼ãƒ»æ‹…å½“è€…ã«é€£çµ¡ã€ãŒã‚ã‚Šã¾ã™ãŒã€`storage/toon_files/flow_md.md`ã«ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è¿½åŠ ã—ã¾ã™ã‹ï¼Ÿ

å›ç­”ã‚’ã„ãŸã ã‘ã‚Œã°ã€ãã‚Œã«åˆã‚ã›ã¦æ•´ç†ã—ã¾ã™ã€‚ç‰¹ã«æŒ‡å®šãŒãªã‘ã‚Œã°ã€`storage/toon_files/flow_md.md`ã®æ§‹é€ ã‚’åŸºã«ã€ãƒãƒ¼ãƒ¡ã‚¤ãƒ‰å›³ã¨ã—ã¦æ•´ç†ã—ã¾ã™ã€‚

---

_**User**_

task9ã®å‡¦ç†: ã€Œå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸã€ã¯ç¾åœ¨ã€decision2ã‹ã‚‰ç›´æ¥çµ‚äº†ã—ã¦ã„ã¾ã™ãŒã€flow.mdã«ã¯æ®µéšçš„ãªå¯¾å¿œãƒ•ãƒ­ãƒ¼ãŒã‚ã‚Šã¾ã™ã€‚ã©ã¡ã‚‰ã‚’æ¡ç”¨ã—ã¾ã™ã‹ï¼Ÿ
ã“ã‚Œæ„å‘³ãŒè§£ã‚‰ãªã„ã€‚èª¬æ˜ã—ã¦

---

_**Agent (model default, mode Agent)**_



---


`storage/toon_files/flow_md.md`ã¨`flow.md`ã®task9ã®æ‰±ã„ã‚’æ¯”è¼ƒã—ã¦èª¬æ˜ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: storage/toon_files/flow_md.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "task9",
  "path": "flow.md",
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "task9",
    "path": "flow.md",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain": {
        "content": {
          "matches": [
            {
              "file": "flow.md",
              "matches": [
                {
                  "lineNumber": 15,
                  "content": "    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]"
                },
                {
                  "lineNumber": 45,
                  "content": "    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9"
                },
                {
                  "lineNumber": 56,
                  "content": "        task9_1[\"PGåŸºæ¿ã‚’äº¤æ›\"]"
                },
                {
                  "lineNumber": 57,
                  "content": "        task9_2[\"æµå‹•ã«æˆ»ã™\"]"
                },
                {
                  "lineNumber": 62,
                  "content": "        task9_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›\"]"
                },
                {
                  "lineNumber": 63,
                  "content": "        task9_4[\"æµå‹•ã«æˆ»ã™\"]"
                },
                {
                  "lineNumber": 68,
                  "content": "        task9_5[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›\"]"
                },
                {
                  "lineNumber": 69,
                  "content": "        task9_6[\"æµå‹•ã«æˆ»ã™\"]"
                },
                {
                  "lineNumber": 74,
                  "content": "        task9_7[\"å†…éƒ¨ã®FFCã‚’äº¤æ›\"]"
                },
                {
                  "lineNumber": 75,
                  "content": "        task9_8[\"æµå‹•ã«æˆ»ã™\"]"
                },
                {
                  "lineNumber": 77,
                  "content": "        task9_9[\"æ‹…å½“ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã«é€£çµ¡\"]"
                },
                {
                  "lineNumber": 79,
                  "content": "        task9--&gt;check9_1"
                },
                {
                  "lineNumber": 82,
                  "content": "        decision_check9_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_1"
                },
                {
                  "lineNumber": 83,
                  "content": "        decision_check9_1_1--&gt;|\"æ­£å¸¸\"|task9_2"
                },
                {
                  "lineNumber": 84,
                  "content": "        decision_check9_1_1--&gt;|\"ç•°å¸¸\"|task9_1"
                },
                {
                  "lineNumber": 85,
                  "content": "        task9_1--&gt;task9_2"
                },
                {
                  "lineNumber": 86,
                  "content": "        task9_2--&gt;decision9_1"
                },
                {
                  "lineNumber": 92,
                  "content": "        decision_check9_3--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_3"
                },
                {
                  "lineNumber": 93,
                  "content": "        decision_check9_3_1--&gt;|\"æ­£å¸¸\"|task9_4"
                },
                {
                  "lineNumber": 94,
                  "content": "        decision_check9_3_1--&gt;|\"ç•°å¸¸\"|task9_3"
                },
                {
                  "lineNumber": 95,
                  "content": "        task9_3--&gt;task9_4"
                },
                {
                  "lineNumber": 96,
                  "content": "        task9_4--&gt;decision9_2"
                },
                {
                  "lineNumber": 102,
                  "content": "        decision_check9_5--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_5"
                },
                {
                  "lineNumber": 103,
                  "content": "        decision_check9_5_1--&gt;|\"æ­£å¸¸\"|task9_6"
                },
                {
                  "lineNumber": 104,
                  "content": "        decision_check9_5_1--&gt;|\"ç•°å¸¸\"|task9_5"
                },
                {
                  "lineNumber": 105,
                  "content": "        task9_5--&gt;task9_6"
                },
                {
                  "lineNumber": 106,
                  "content": "        task9_6--&gt;decision9_3"
                },
                {
                  "lineNumber": 112,
                  "content": "        decision_check9_7--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_7"
                },
                {
                  "lineNumber": 113,
                  "content": "        decision_check9_7_1--&gt;|\"æ­£å¸¸\"|task9_8"
                },
                {
                  "lineNumber": 114,
                  "content": "        decision_check9_7_1--&gt;|\"ç•°å¸¸\"|task9_7"
                },
                {
                  "lineNumber": 115,
                  "content": "        task9_7--&gt;task9_8"
                },
                {
                  "lineNumber": 116,
                  "content": "        task9_8--&gt;decision9_4"
                },
                {
                  "lineNumber": 117,
                  "content": "        decision9_4--&gt;|\"å‡ºã¦ããŸ\"|task9_9"
                },
                {
                  "lineNumber": 120,
                  "content": "        task9_9--&gt;contact_manufacturer"
                },
                {
                  "lineNumber": 318,
                  "content": "    style task9 fill:#90EE90"
                },
                {
                  "lineNumber": 339,
                  "content": "    style task9_1 fill:#90EE90"
                },
                {
                  "lineNumber": 340,
                  "content": "    style task9_2 fill:#90EE90"
                },
                {
                  "lineNumber": 345,
                  "content": "    style task9_3 fill:#90EE90"
                },
                {
                  "lineNumber": 346,
                  "content": "    style task9_4 fill:#90EE90"
                },
                {
                  "lineNumber": 351,
                  "content": "    style task9_5 fill:#90EE90"
                },
                {
                  "lineNumber": 352,
                  "content": "    style task9_6 fill:#90EE90"
                },
                {
                  "lineNumber": 357,
                  "content": "    style task9_7 fill:#90EE90"
                },
                {
                  "lineNumber": 358,
                  "content": "    style task9_8 fill:#90EE90"
                },
                {
                  "lineNumber": 360,
                  "content": "    style task9_9 fill:#90EE90"
                }
              ]
            }
          ],
          "totalLines": 44,
          "totalMatchedLines": 44
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "task9",
  "path": "storage/toon_files/flow_md.md",
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "task9",
    "path": "storage/toon_files/flow_md.md",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain": {
        "content": {
          "matches": [
            {
              "file": "storage\\toon_files\\flow_md.md",
              "matches": [
                {
                  "lineNumber": 62,
                  "content": "id: task9"
                },
                {
                  "lineNumber": 198,
                  "content": "target: task9"
                },
                {
                  "lineNumber": 202,
                  "content": "source: task9"
                }
              ]
            }
          ],
          "totalLines": 3,
          "totalMatchedLines": 3
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---



---


task9ã®å‡¦ç†ã®é•ã„ã‚’èª¬æ˜ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: flow.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: storage/toon_files/flow_md.md</summary>

</details>
</tool-use>

---



---


## task9ã®å‡¦ç†ã®é•ã„

### `storage/toon_files/flow_md.md`ã®ç¾çŠ¶
- task9ï¼ˆã€Œå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸã€ï¼‰ã‹ã‚‰ç›´æ¥çµ‚äº†ï¼ˆ`node_end`ï¼‰ã«æ¥ç¶š
- ã¤ã¾ã‚Šã€ã“ã®çŠ¶æ³ã§ä½•ã‚‚å¯¾å¿œã›ãšã«çµ‚äº†

### `flow.md`ã®å‡¦ç†
- task9ã®å¾Œã«æ®µéšçš„ãªå¯¾å¿œãƒ•ãƒ­ãƒ¼ï¼ˆflow5ï¼‰ãŒã‚ã‚‹
- æ‰‹é †:
  1. PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯ â†’ äº¤æ› â†’ æµå‹•ã«æˆ»ã™ â†’ å†ç™ºãƒã‚§ãƒƒã‚¯
  2. å†ç™ºã—ãŸã‚‰ â†’ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯ â†’ äº¤æ› â†’ æµå‹•ã«æˆ»ã™ â†’ å†ç™ºãƒã‚§ãƒƒã‚¯
  3. å†ç™ºã—ãŸã‚‰ â†’ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯ â†’ äº¤æ› â†’ æµå‹•ã«æˆ»ã™ â†’ å†ç™ºãƒã‚§ãƒƒã‚¯
  4. å†ç™ºã—ãŸã‚‰ â†’ å†…éƒ¨FFCã‚’ãƒã‚§ãƒƒã‚¯ â†’ äº¤æ› â†’ æµå‹•ã«æˆ»ã™ â†’ å†ç™ºãƒã‚§ãƒƒã‚¯
  5. ãã‚Œã§ã‚‚å†ç™ºã—ãŸã‚‰ â†’ ãƒ¡ãƒ¼ã‚«ãƒ¼ãƒ»æ‹…å½“è€…ã«é€£çµ¡

### é•ã„ã®è¦ç‚¹
- `storage/toon_files/flow_md.md`: å†ç™ºæ™‚ã«ä½•ã‚‚å¯¾å¿œã›ãšçµ‚äº†
- `flow.md`: å†ç™ºæ™‚ã«æ®µéšçš„ãªå¯¾å¿œæ‰‹é †ã‚’å®Ÿè¡Œ

è³ªå•: `storage/toon_files/flow_md.md`ã‚’æ•´ç†ã™ã‚‹éš›ã€task9ã®å¾Œã«`flow.md`ã®ã‚ˆã†ãªæ®µéšçš„å¯¾å¿œãƒ•ãƒ­ãƒ¼ã‚’å«ã‚ã¾ã™ã‹ï¼Ÿãã‚Œã¨ã‚‚ã€ç¾çŠ¶ã®ã¾ã¾ï¼ˆç›´æ¥çµ‚äº†ï¼‰ã«ã—ã¾ã™ã‹ï¼Ÿ

---

_**User**_

flow.mdã®å†…å®¹ã‚’ãƒ™ãƒ¼ã‚¹ã«å¯¾è±¡ã‚’ä¿®æ­£ã—ã¦

---

_**Agent (model default, mode Agent)**_



---


`flow.md`ã®å†…å®¹ã‚’ãƒ™ãƒ¼ã‚¹ã«`storage/toon_files/flow_md.md`ã‚’ä¿®æ­£ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: flow.md</summary>

</details>
</tool-use>

---



---


`flow.md`ã®å†…å®¹ã‚’`storage/toon_files/flow_md.md`ã«åæ˜ ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: storage/toon_files/flow_md.md</summary>

</details>

</tool-use>

---



---


ä¿®æ­£ã‚’å®Œäº†ã—ã¾ã—ãŸã€‚`flow.md`ã®å†…å®¹ã‚’ãƒ™ãƒ¼ã‚¹ã«`storage/toon_files/flow_md.md`ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚

## ä¸»ãªå¤‰æ›´ç‚¹

1. **task9ã®æ®µéšçš„å¯¾å¿œãƒ•ãƒ­ãƒ¼ã‚’è¿½åŠ **: ã€Œå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸã€å ´åˆã®æ®µéšçš„ãªå¯¾å¿œæ‰‹é †ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

2. **ãƒã‚§ãƒƒã‚¯åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ **: å„åŸºæ¿ã®ã€Œãƒã‚§ãƒƒã‚¯â†’åˆ¤å®šã§ãã‚‹ã‹â†’æ­£å¸¸ã‹ã€ã®åˆ†å²ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

3. **å†ç™ºæ™‚ã®å‡¦ç†ã‚’è¿½åŠ **: ã€Œæµå‹•ã«æˆ»ã™ã€å¾Œã®å†ç™ºåˆ¤å®šã¨ã€å„ãƒ•ãƒ­ãƒ¼ã‹ã‚‰ã®å†ç™ºæ™‚ã®å‡¦ç†ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

4. **ãã®ä»–ã®ç—‡çŠ¶ãƒ•ãƒ­ãƒ¼ã‚’è¿½åŠ **: ã€Œã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„ã€å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

5. **ãƒ¡ãƒ¼ã‚«ãƒ¼é€£çµ¡ã‚’è¿½åŠ **: å…¨ãƒ¢ãƒ¼ãƒ‰å…±é€šã®ã€Œãƒ¡ãƒ¼ã‚«ãƒ¼ãƒ»æ‹…å½“è€…ã«é€£çµ¡ã€å‡¦ç†ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

6. **ãƒãƒ¼ãƒ¡ã‚¤ãƒ‰å›³å½¢å¼ã«çµ±ä¸€**: ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã®å½¢å¼ã‹ã‚‰ã€æ¨™æº–çš„ãªãƒãƒ¼ãƒ¡ã‚¤ãƒ‰å›³å½¢å¼ã«å¤‰æ›ã—ã¾ã—ãŸã€‚

ã“ã‚Œã§`storage/toon_files/flow_md.md`ã¯`flow.md`ã¨åŒã˜å†…å®¹ã«ãªã‚Šã€ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆãŒæ•´ç†ã•ã‚Œã¾ã—ãŸã€‚

---

_**User**_

Streamlitã®ã»ã†ã§ã¯ã†ã¾ãmdã«ã§ããªã‹ã£ãŸã®ã§,LLMã®å‡ºåŠ›ã‚’ãã¡ã‚“ã¨åˆ¶é™ã™ã¹ãã‹ãªã¨æ€ã†ã€‚
å…¨ãƒ«ãƒ¼ãƒˆè¦‹ã•ã›ã‚‹ã®ã¯è‰¯ããªã„

---

_**Agent (model default, mode Agent)**_



---


Streamlitã‚¢ãƒ—ãƒªã®ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã€ãƒãƒ¼ãƒ¡ã‚¤ãƒ‰å›³ã®è¡¨ç¤ºã¨LLMå‡ºåŠ›ã®åˆ¶å¾¡æ–¹æ³•ã‚’æŠŠæ¡ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: app.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "How is mermaid diagram displayed in Streamlit app?",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 420,
            "column": 62
          },
          "endPosition": {
            "line": 467,
            "column": 25
          }
        },
        "contents": "with col_flow:\n    st.subheader(\"ğŸ“Š ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ\")\n    # Mermaidæç”»å‡¦ç†\n    mermaid_code = current_flow.to_mermaid()\n    b64_mermaid = base64.b64encode(mermaid_code.encode('utf-8')).decode('utf-8')\n\n    html_path = Path(\"frontend/index.html\")\n    if html_path.exists():\n        html_content = html_path.read_text(encoding='utf-8')\n        components.html(\n            f\"\"\"\n            {html_content}\n            &lt;script&gt;\n                window.onload = () =&gt; {{\n                    window.postMessage({{ \n                        type: \"render\", \n                        base64Code: \"{b64_mermaid}\" \n                    }}, \"*\");\n                }};\n            &lt;/script&gt;\n            \"\"\",\n            height=800,\n            scrolling=True,\n        )\n    else:\n        st.error(\"frontend/index.html ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\")\n\nwith col_source:\n    st.subheader(\"ğŸ“„ TOONå½¢å¼ï¼ˆSourceï¼‰\")\n    \n    # TOONå½¢å¼ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ\n    toon_text = current_flow.to_toon_format()\n    \n    with st.expander(\"TOONå½¢å¼ã‚’è¡¨ç¤º\", expanded=True):\n        st.code(toon_text, language=\"markdown\")\n    \n    # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³\n    st.download_button(\n        label=\"ğŸ“¥ TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\",\n        data=toon_text,\n        file_name=f\"{session_name}_toon.md\",\n        mime=\"text/markdown\"\n    )\n\nwith st.sidebar.expander(\"ç¾åœ¨ã®Mermaidã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤º\"):\n    st.code(mermaid_code)",
        "signatures": {},
        "detailedLines": [
          {
            "text": "with col_flow:",
            "lineNumber": 423
          },
          {
            "text": "    st.subheader(\"ğŸ“Š ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ\")",
            "lineNumber": 424
          },
          {
            "text": "    # Mermaidæç”»å‡¦ç†",
            "lineNumber": 425
          },
          {
            "text": "    mermaid_code = current_flow.to_mermaid()",
            "lineNumber": 426
          },
          {
            "text": "    b64_mermaid = base64.b64encode(mermaid_code.encode('utf-8')).decode('utf-8')",
            "lineNumber": 427
          },
          {
            "lineNumber": 428
          },
          {
            "text": "    html_path = Path(\"frontend/index.html\")",
            "lineNumber": 429
          },
          {
            "text": "    if html_path.exists():",
            "lineNumber": 430
          },
          {
            "text": "        html_content = html_path.read_text(encoding='utf-8')",
            "lineNumber": 431
          },
          {
            "text": "        components.html(",
            "lineNumber": 432
          },
          {
            "text": "            f\"\"\"",
            "lineNumber": 433
          },
          {
            "text": "            {html_content}",
            "lineNumber": 434
          },
          {
            "text": "            &lt;script&gt;",
            "lineNumber": 435
          },
          {
            "text": "                window.onload = () =&gt; {{",
            "lineNumber": 436
          },
          {
            "text": "                    window.postMessage({{ ",
            "lineNumber": 437
          },
          {
            "text": "                        type: \"render\", ",
            "lineNumber": 438
          },
          {
            "text": "                        base64Code: \"{b64_mermaid}\" ",
            "lineNumber": 439
          },
          {
            "text": "                    }}, \"*\");",
            "lineNumber": 440
          },
          {
            "text": "                }};",
            "lineNumber": 441
          },
          {
            "text": "            &lt;/script&gt;",
            "lineNumber": 442
          },
          {
            "text": "            \"\"\",",
            "lineNumber": 443
          },
          {
            "text": "            height=800,",
            "lineNumber": 444
          },
          {
            "text": "            scrolling=True,",
            "lineNumber": 445
          },
          {
            "text": "        )",
            "lineNumber": 446
          },
          {
            "text": "    else:",
            "lineNumber": 447
          },
          {
            "text": "        st.error(\"frontend/index.html ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\")",
            "lineNumber": 448
          },
          {
            "lineNumber": 449
          },
          {
            "text": "with col_source:",
            "lineNumber": 450
          },
          {
            "text": "    st.subheader(\"ğŸ“„ TOONå½¢å¼ï¼ˆSourceï¼‰\")",
            "lineNumber": 451
          },
          {
            "text": "    ",
            "lineNumber": 452
          },
          {
            "text": "    # TOONå½¢å¼ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ",
            "lineNumber": 453
          },
          {
            "text": "    toon_text = current_flow.to_toon_format()",
            "lineNumber": 454
          },
          {
            "text": "    ",
            "lineNumber": 455
          },
          {
            "text": "    with st.expander(\"TOONå½¢å¼ã‚’è¡¨ç¤º\", expanded=True):",
            "lineNumber": 456
          },
          {
            "text": "        st.code(toon_text, language=\"markdown\")",
            "lineNumber": 457
          },
          {
            "text": "    ",
            "lineNumber": 458
          },
          {
            "text": "    # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³",
            "lineNumber": 459
          },
          {
            "text": "    st.download_button(",
            "lineNumber": 460
          },
          {
            "text": "        label=\"ğŸ“¥ TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\",",
            "lineNumber": 461
          },
          {
            "text": "        data=toon_text,",
            "lineNumber": 462
          },
          {
            "text": "        file_name=f\"{session_name}_toon.md\",",
            "lineNumber": 463
          },
          {
            "text": "        mime=\"text/markdown\"",
            "lineNumber": 464
          },
          {
            "text": "    )",
            "lineNumber": 465
          },
          {
            "lineNumber": 466
          },
          {
            "text": "with st.sidebar.expander(\"ç¾åœ¨ã®Mermaidã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤º\"):",
            "lineNumber": 467
          },
          {
            "text": "    st.code(mermaid_code)",
            "lineNumber": 468
          }
        ]
      },
      "score": 0.5547053217887878
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\frontend\\index.html",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 40,
            "column": 7
          }
        },
        "contents": "&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/npm/mermaid@10.9.5/dist/mermaid.min.js\"&gt;&lt;/script&gt;\n    &lt;style&gt;\n        body { margin: 0; background: white; overflow: auto; }\n        #container { display: flex; justify-content: center; padding: 20px; min-height: 100%; }\n        #graph { width: 100%; overflow: auto; }\n        svg { max-width: 100%; height: auto; display: block; }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"container\"&gt;\n        &lt;div id=\"graph\"&gt;&lt;/div&gt;\n    &lt;/div&gt;\n    &lt;script&gt;\n        mermaid.initialize({ startOnLoad: false, theme: 'default' });\n\n        async function render(b64) {\n            const container = document.getElementById('graph');\n            try {\n                // Base64ã‚’UTF-8æ–‡å­—åˆ—ã«å¾©å·\n                const code = decodeURIComponent(escape(window.atob(b64)));\n                container.innerHTML = \"\";\n                \n                const id = \"m\" + Math.random().toString(36).substr(2, 9);\n                const { svg } = await mermaid.render(id, code);\n                container.innerHTML = svg;\n            } catch (e) {\n                container.innerHTML = &#96;&lt;pre style='color:red'&gt;Render Error: ${e.message}&lt;/pre&gt;&#96;;\n            }\n        }\n\n        window.addEventListener(\"message\", (event) =&gt; {\n            if (event.data.type === \"render\") {\n                render(event.data.base64Code);\n            }\n        });\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "&lt;!DOCTYPE html&gt;",
            "lineNumber": 1
          },
          {
            "text": "&lt;html&gt;",
            "lineNumber": 2
          },
          {
            "text": "&lt;head&gt;",
            "lineNumber": 3
          },
          {
            "text": "    &lt;script src=\"https://cdn.jsdelivr.net/npm/mermaid@10.9.5/dist/mermaid.min.js\"&gt;&lt;/script&gt;",
            "lineNumber": 4
          },
          {
            "text": "    &lt;style&gt;",
            "lineNumber": 5
          },
          {
            "text": "        body { margin: 0; background: white; overflow: auto; }",
            "lineNumber": 6
          },
          {
            "text": "        #container { display: flex; justify-content: center; padding: 20px; min-height: 100%; }",
            "lineNumber": 7
          },
          {
            "text": "        #graph { width: 100%; overflow: auto; }",
            "lineNumber": 8
          },
          {
            "text": "        svg { max-width: 100%; height: auto; display: block; }",
            "lineNumber": 9
          },
          {
            "text": "    &lt;/style&gt;",
            "lineNumber": 10
          },
          {
            "text": "&lt;/head&gt;",
            "lineNumber": 11
          },
          {
            "text": "&lt;body&gt;",
            "lineNumber": 12
          },
          {
            "text": "    &lt;div id=\"container\"&gt;",
            "lineNumber": 13
          },
          {
            "text": "        &lt;div id=\"graph\"&gt;&lt;/div&gt;",
            "lineNumber": 14
          },
          {
            "text": "    &lt;/div&gt;",
            "lineNumber": 15
          },
          {
            "text": "    &lt;script&gt;",
            "lineNumber": 16
          },
          {
            "text": "        mermaid.initialize({ startOnLoad: false, theme: 'default' });",
            "lineNumber": 17
          },
          {
            "lineNumber": 18
          },
          {
            "text": "        async function render(b64) {",
            "lineNumber": 19
          },
          {
            "text": "            const container = document.getElementById('graph');",
            "lineNumber": 20
          },
          {
            "text": "            try {",
            "lineNumber": 21
          },
          {
            "text": "                // Base64ã‚’UTF-8æ–‡å­—åˆ—ã«å¾©å·",
            "lineNumber": 22
          },
          {
            "text": "                const code = decodeURIComponent(escape(window.atob(b64)));",
            "lineNumber": 23
          },
          {
            "text": "                container.innerHTML = \"\";",
            "lineNumber": 24
          },
          {
            "text": "                ",
            "lineNumber": 25
          },
          {
            "text": "                const id = \"m\" + Math.random().toString(36).substr(2, 9);",
            "lineNumber": 26
          },
          {
            "text": "                const { svg } = await mermaid.render(id, code);",
            "lineNumber": 27
          },
          {
            "text": "                container.innerHTML = svg;",
            "lineNumber": 28
          },
          {
            "text": "            } catch (e) {",
            "lineNumber": 29
          },
          {
            "text": "                container.innerHTML = &#96;&lt;pre style='color:red'&gt;Render Error: ${e.message}&lt;/pre&gt;&#96;;",
            "lineNumber": 30
          },
          {
            "text": "            }",
            "lineNumber": 31
          },
          {
            "text": "        }",
            "lineNumber": 32
          },
          {
            "lineNumber": 33
          },
          {
            "text": "        window.addEventListener(\"message\", (event) =&gt; {",
            "lineNumber": 34
          },
          {
            "text": "            if (event.data.type === \"render\") {",
            "lineNumber": 35
          },
          {
            "text": "                render(event.data.base64Code);",
            "lineNumber": 36
          },
          {
            "text": "            }",
            "lineNumber": 37
          },
          {
            "text": "        });",
            "lineNumber": 38
          },
          {
            "text": "    &lt;/script&gt;",
            "lineNumber": 39
          },
          {
            "text": "&lt;/body&gt;",
            "lineNumber": 40
          },
          {
            "text": "&lt;/html&gt;",
            "lineNumber": 41
          }
        ]
      },
      "score": 0.5050829648971558
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 23
          },
          "endPosition": {
            "line": 271
          }
        },
        "contents": "class Flowchart(BaseModel):\n@staticmethod\ndef _get_node_shape(node_type: str) -&gt; str:\n  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯MISSING\n\n    @staticmethod\n    def _get_status_color(status: NodeStatus) -&gt; str:\n        \"\"\"ãƒãƒ¼ãƒ‰çŠ¶æ…‹ã«å¿œã˜ãŸè‰²ã‚’è¿”ã™\"\"\"\n        color_map = {\n            NodeStatus.ACTIVE: \"#90EE90\",      # ãƒ©ã‚¤ãƒˆã‚°ãƒªãƒ¼ãƒ³\n            NodeStatus.COMPLETED: \"#87CEEB\",   # ã‚¹ã‚«ã‚¤ãƒ–ãƒ«ãƒ¼\n            NodeStatus.MISSING: \"#FF6B6B\"       # èµ¤\n        }\n        return color_map.get(status, \"#D3D3D3\")  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã‚°ãƒ¬ãƒ¼\n\n    def to_mermaid(self) -&gt; str:\n        \"\"\"Flowchartã‚’Mermaidæ§‹æ–‡ã«å¤‰æ›\"\"\"\n        lines = [\"graph TD\"]\n        style_lines = []\n        \n        # ãƒãƒ¼ãƒ‰å®šç¾©\n        for n in self.nodes:\n            # IDãŒ 'end' ã ã¨äºˆç´„èªè¡çªã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ãŸã‚ã€å®‰å…¨ã«å¤‰æ›\n            safe_id = f\"n_{n.id}\" if n.id == \"end\" else n.id\n            \n            # ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸå½¢çŠ¶ã‚’å–å¾—\n            shape = self._get_node_shape(n.type)\n            \n            # æ—¥æœ¬èªãƒ©ãƒ™ãƒ«ã¯å¿…ãšãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§å›²ã‚€\n            # å½¢çŠ¶æ§‹æ–‡ã«ãƒ©ãƒ™ãƒ«ã‚’åŸ‹ã‚è¾¼ã‚€\n            if shape == \"([ ])\":  # START/END\n                lines.append(f'{safe_id}[\"{n.label}\"]')\n            elif shape == \"[ ]\":  # PROCESS\n                lines.append(f'{safe_id}[\"{n.label}\"]')\n            elif shape == \"{ }\":  # DECISION\n                lines.append(f'{safe_id}{{\"{n.label}\"}}')\n            elif shape == \"[/ /]\":  # IO_DATA (å¹³è¡Œå››è¾ºå½¢)\n                lines.append(f'{safe_id}[/\"{n.label}\"/]')\n            elif shape == \"[( )]\":  # STORAGE (å††ç­’å½¢)\n                lines.append(f'{safe_id}[(\"{n.label}\")]')\n            elif shape == \"{{ }}\":  # MISSING\n                lines.append(f'{safe_id}{{\"{n.label}\"}}')\n            \n            # çŠ¶æ…‹ã«å¿œã˜ãŸã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ \n            color = self._get_status_color(n.status)\n            style_lines.append(f'    style {safe_id} fill:{color}')\n        \n        # ã‚¨ãƒƒã‚¸å®šç¾©\n        for e in self.edges:",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 24,
                "column": 1
              },
              "endPosition": {
                "line": 25,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 24,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 175
          },
          {
            "text": "def _get_node_shape(node_type: str) -&gt; str:",
            "lineNumber": 176
          },
          {
            "text": "  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯MISSING",
            "lineNumber": 187
          },
          {
            "lineNumber": 188
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 189
          },
          {
            "text": "    def _get_status_color(status: NodeStatus) -&gt; str:",
            "lineNumber": 190
          },
          {
            "text": "        \"\"\"ãƒãƒ¼ãƒ‰çŠ¶æ…‹ã«å¿œã˜ãŸè‰²ã‚’è¿”ã™\"\"\"",
            "lineNumber": 191
          },
          {
            "text": "        color_map = {",
            "lineNumber": 192
          },
          {
            "text": "            NodeStatus.ACTIVE: \"#90EE90\",      # ãƒ©ã‚¤ãƒˆã‚°ãƒªãƒ¼ãƒ³",
            "lineNumber": 193
          },
          {
            "text": "            NodeStatus.COMPLETED: \"#87CEEB\",   # ã‚¹ã‚«ã‚¤ãƒ–ãƒ«ãƒ¼",
            "lineNumber": 194
          },
          {
            "text": "            NodeStatus.MISSING: \"#FF6B6B\"       # èµ¤",
            "lineNumber": 195
          },
          {
            "text": "        }",
            "lineNumber": 196
          },
          {
            "text": "        return color_map.get(status, \"#D3D3D3\")  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã‚°ãƒ¬ãƒ¼",
            "lineNumber": 197
          },
          {
            "lineNumber": 198
          },
          {
            "text": "    def to_mermaid(self) -&gt; str:",
            "lineNumber": 199
          },
          {
            "text": "        \"\"\"Flowchartã‚’Mermaidæ§‹æ–‡ã«å¤‰æ›\"\"\"",
            "lineNumber": 200
          },
          {
            "text": "        lines = [\"graph TD\"]",
            "lineNumber": 201
          },
          {
            "text": "        style_lines = []",
            "lineNumber": 202
          },
          {
            "text": "        ",
            "lineNumber": 203
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰å®šç¾©",
            "lineNumber": 204
          },
          {
            "text": "        for n in self.nodes:",
            "lineNumber": 205
          },
          {
            "text": "            # IDãŒ 'end' ã ã¨äºˆç´„èªè¡çªã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ãŸã‚ã€å®‰å…¨ã«å¤‰æ›",
            "lineNumber": 206
          },
          {
            "text": "            safe_id = f\"n_{n.id}\" if n.id == \"end\" else n.id",
            "lineNumber": 207
          },
          {
            "text": "            ",
            "lineNumber": 208
          },
          {
            "text": "            # ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸå½¢çŠ¶ã‚’å–å¾—",
            "lineNumber": 209
          },
          {
            "text": "            shape = self._get_node_shape(n.type)",
            "lineNumber": 210
          },
          {
            "text": "            ",
            "lineNumber": 211
          },
          {
            "text": "            # æ—¥æœ¬èªãƒ©ãƒ™ãƒ«ã¯å¿…ãšãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§å›²ã‚€",
            "lineNumber": 212
          },
          {
            "text": "            # å½¢çŠ¶æ§‹æ–‡ã«ãƒ©ãƒ™ãƒ«ã‚’åŸ‹ã‚è¾¼ã‚€",
            "lineNumber": 213
          },
          {
            "text": "            if shape == \"([ ])\":  # START/END",
            "lineNumber": 214
          },
          {
            "text": "                lines.append(f'{safe_id}[\"{n.label}\"]')",
            "lineNumber": 215
          },
          {
            "text": "            elif shape == \"[ ]\":  # PROCESS",
            "lineNumber": 216
          },
          {
            "text": "                lines.append(f'{safe_id}[\"{n.label}\"]')",
            "lineNumber": 217
          },
          {
            "text": "            elif shape == \"{ }\":  # DECISION",
            "lineNumber": 218
          },
          {
            "text": "                lines.append(f'{safe_id}{{\"{n.label}\"}}')",
            "lineNumber": 219
          },
          {
            "text": "            elif shape == \"[/ /]\":  # IO_DATA (å¹³è¡Œå››è¾ºå½¢)",
            "lineNumber": 220
          },
          {
            "text": "                lines.append(f'{safe_id}[/\"{n.label}\"/]')",
            "lineNumber": 221
          },
          {
            "text": "            elif shape == \"[( )]\":  # STORAGE (å††ç­’å½¢)",
            "lineNumber": 222
          },
          {
            "text": "                lines.append(f'{safe_id}[(\"{n.label}\")]')",
            "lineNumber": 223
          },
          {
            "text": "            elif shape == \"{{ }}\":  # MISSING",
            "lineNumber": 224
          },
          {
            "text": "                lines.append(f'{safe_id}{{\"{n.label}\"}}')",
            "lineNumber": 225
          },
          {
            "text": "            ",
            "lineNumber": 226
          },
          {
            "text": "            # çŠ¶æ…‹ã«å¿œã˜ãŸã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ ",
            "lineNumber": 227
          },
          {
            "text": "            color = self._get_status_color(n.status)",
            "lineNumber": 228
          },
          {
            "text": "            style_lines.append(f'    style {safe_id} fill:{color}')",
            "lineNumber": 229
          },
          {
            "text": "        ",
            "lineNumber": 230
          },
          {
            "text": "        # ã‚¨ãƒƒã‚¸å®šç¾©",
            "lineNumber": 231
          },
          {
            "text": "        for e in self.edges:",
            "lineNumber": 232
          }
        ]
      },
      "score": 0.3792295455932617
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\program_base.md",
        "range": {
          "startPosition": {
            "line": 40
          },
          "endPosition": {
            "line": 93
          }
        },
        "contents": "* Markdownå½¢å¼ã®TOONã‚’æ­£è¦è¡¨ç¾ï¼ˆRegexï¼‰ãªã©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã€&#96;models.py&#96; ã§å®šç¾©ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚¹ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚\n* **ã€Œå·®åˆ†ï¼ˆLOGï¼‰ã€ã®åæ˜ ãƒ­ã‚¸ãƒƒã‚¯**ã‚‚ã“ã“ã«æŒã¡ã¾ã™ã€‚å¤ã„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«LOGã®å†…å®¹ã‚’ä¸Šæ›¸ãã—ã¦ã€æœ€æ–°ã®çŠ¶æ…‹ã‚’ä½œã‚‹è²¬ä»»è€…ã§ã™ã€‚\n\n### â‘¢ &#96;generator/mermaid_gen.py&#96;\n\n**è²¬ä»»ï¼šè¦–è¦šåŒ–ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰**\n\n* &#96;models.py&#96; ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å—ã‘å–ã‚Šã€è¦å®šã—ãŸå¯¾å¿œè¡¨ã«åŸºã¥ã„ã¦ Mermaid æ§‹æ–‡ï¼ˆ&#96;([ ])&#96;, &#96;{ }&#96;ãªã©ï¼‰ã®æ–‡å­—åˆ—ã‚’çµ„ã¿ç«‹ã¦ã¾ã™ã€‚\n* ãƒãƒ¼ãƒ‰ã®è‰²ä»˜ã‘ï¼ˆ&#96;style&#96; æ§‹æ–‡ï¼‰ã®æ³¨å…¥ã‚‚ã“ã“ã§è¡Œã„ã¾ã™ã€‚\n\n### â‘£ &#96;llm/agent.py&#96;\n\n**è²¬ä»»ï¼šAIã¨ã®æ„æ€ç–é€š**\n\n* å¤§å‹LLMï¼ˆGPT-4oç­‰ï¼‰ã«å¯¾ã—ã€ç¾åœ¨ã®TOONã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’æ¸¡ã—ã€**ã€Œæ–°ã—ã„TOONã®å·®åˆ†è¡Œã€**ã‚’ç”Ÿæˆã•ã›ã¾ã™ã€‚\n* ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ç®¡ç†ã‚‚ã“ã“ã§è¡Œã„ã¾ã™ã€‚\n\n### â‘¤ &#96;app.py&#96;\n\n**è²¬ä»»ï¼šUIè¡¨ç¤ºã¨çŠ¶æ…‹ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**\n\n* Streamlitã®ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€‚\n* &#96;st.session_state&#96; ã‚’ä½¿ã„ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’å—ã‘ã¦ &#96;agent&#96; â†’ &#96;parser&#96; â†’ &#96;generator&#96; ã®é †ã«å‘¼ã³å‡ºã™å¸ä»¤å¡”ã§ã™ã€‚\n\n---\n\n## 3. ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å‹•ä½œãƒ•ãƒ­ãƒ¼ï¼ˆå›³è§£ï¼‰\n\n1ãƒ•ã‚¡ã‚¤ãƒ«1è²¬ä»»ã‚’å¾¹åº•ã™ã‚‹ã“ã¨ã§ã€æƒ…å ±ã®æµã‚ŒãŒä¸€æœ¬é“ã«ãªã‚Šã€ãƒ‡ãƒãƒƒã‚°ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚\n\n&#96;&#96;&#96;mermaid\ngraph LR\n    User([ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›]) --&gt; App[app.py]\n    App --&gt; Agent[llm/agent.py]\n    Agent --&gt;|TOONå·®åˆ†| Parser[parser/toon_parser.py]\n    Parser --&gt;|æœ€æ–°ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«| App\n    App --&gt; Gen[generator/mermaid_gen.py]\n    Gen --&gt;|Mermaidæ–‡å­—åˆ—| App\n    App --&gt; UI[ğŸ–¥ï¸ Streamlitè¡¨ç¤º]\n\n    subgraph Data\n        Parser -.-&gt; Snapshot[(TOON.md)]\n    end\n\n&#96;&#96;&#96;\n\n---\n\n## 4. ã“ã®æ§‹é€ ã®ãƒ¡ãƒªãƒƒãƒˆ\n\n* **äº¤æ›å¯èƒ½æ€§:** ã€ŒMermaidã§ã¯ãªãåˆ¥ã®å›³è§£ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã„ãŸã„ã€ã¨æ€ã£ãŸã‚‰ã€&#96;mermaid_gen.py&#96; ã ã‘ã‚’æ›¸ãæ›ãˆã‚Œã°æ¸ˆã¿ã¾ã™ã€‚\n* **ãƒ†ã‚¹ãƒˆã®å®¹æ˜“ã•:** AIãŒã„ãªãã¦ã‚‚ã€&#96;template.md&#96; ã‚’ &#96;toon_parser.py&#96; ã«èª­ã¿è¾¼ã¾ã›ã‚‹ã ã‘ã§ã€å›³è§£ãƒ­ã‚¸ãƒƒã‚¯ãŒæ­£ã—ã„ã‹ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚",
        "signatures": {},
        "detailedLines": [
          {
            "text": "* Markdownå½¢å¼ã®TOONã‚’æ­£è¦è¡¨ç¾ï¼ˆRegexï¼‰ãªã©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã€&#96;models.py&#96; ã§å®šç¾©ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚¹ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚",
            "lineNumber": 42
          },
          {
            "text": "* **ã€Œå·®åˆ†ï¼ˆLOGï¼‰ã€ã®åæ˜ ãƒ­ã‚¸ãƒƒã‚¯**ã‚‚ã“ã“ã«æŒã¡ã¾ã™ã€‚å¤ã„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«LOGã®å†…å®¹ã‚’ä¸Šæ›¸ãã—ã¦ã€æœ€æ–°ã®çŠ¶æ…‹ã‚’ä½œã‚‹è²¬ä»»è€…ã§ã™ã€‚",
            "lineNumber": 43
          },
          {
            "lineNumber": 44
          },
          {
            "text": "### â‘¢ &#96;generator/mermaid_gen.py&#96;",
            "lineNumber": 45
          },
          {
            "lineNumber": 46
          },
          {
            "text": "**è²¬ä»»ï¼šè¦–è¦šåŒ–ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰**",
            "lineNumber": 47
          },
          {
            "lineNumber": 48
          },
          {
            "text": "* &#96;models.py&#96; ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å—ã‘å–ã‚Šã€è¦å®šã—ãŸå¯¾å¿œè¡¨ã«åŸºã¥ã„ã¦ Mermaid æ§‹æ–‡ï¼ˆ&#96;([ ])&#96;, &#96;{ }&#96;ãªã©ï¼‰ã®æ–‡å­—åˆ—ã‚’çµ„ã¿ç«‹ã¦ã¾ã™ã€‚",
            "lineNumber": 49
          },
          {
            "text": "* ãƒãƒ¼ãƒ‰ã®è‰²ä»˜ã‘ï¼ˆ&#96;style&#96; æ§‹æ–‡ï¼‰ã®æ³¨å…¥ã‚‚ã“ã“ã§è¡Œã„ã¾ã™ã€‚",
            "lineNumber": 50
          },
          {
            "lineNumber": 51
          },
          {
            "text": "### â‘£ &#96;llm/agent.py&#96;",
            "lineNumber": 52
          },
          {
            "lineNumber": 53
          },
          {
            "text": "**è²¬ä»»ï¼šAIã¨ã®æ„æ€ç–é€š**",
            "lineNumber": 54
          },
          {
            "lineNumber": 55
          },
          {
            "text": "* å¤§å‹LLMï¼ˆGPT-4oç­‰ï¼‰ã«å¯¾ã—ã€ç¾åœ¨ã®TOONã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’æ¸¡ã—ã€**ã€Œæ–°ã—ã„TOONã®å·®åˆ†è¡Œã€**ã‚’ç”Ÿæˆã•ã›ã¾ã™ã€‚",
            "lineNumber": 56
          },
          {
            "text": "* ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ç®¡ç†ã‚‚ã“ã“ã§è¡Œã„ã¾ã™ã€‚",
            "lineNumber": 57
          },
          {
            "lineNumber": 58
          },
          {
            "text": "### â‘¤ &#96;app.py&#96;",
            "lineNumber": 59
          },
          {
            "lineNumber": 60
          },
          {
            "text": "**è²¬ä»»ï¼šUIè¡¨ç¤ºã¨çŠ¶æ…‹ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**",
            "lineNumber": 61
          },
          {
            "lineNumber": 62
          },
          {
            "text": "* Streamlitã®ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€‚",
            "lineNumber": 63
          },
          {
            "text": "* &#96;st.session_state&#96; ã‚’ä½¿ã„ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’å—ã‘ã¦ &#96;agent&#96; â†’ &#96;parser&#96; â†’ &#96;generator&#96; ã®é †ã«å‘¼ã³å‡ºã™å¸ä»¤å¡”ã§ã™ã€‚",
            "lineNumber": 64
          },
          {
            "lineNumber": 65
          },
          {
            "text": "---",
            "lineNumber": 66
          },
          {
            "lineNumber": 67
          },
          {
            "text": "## 3. ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å‹•ä½œãƒ•ãƒ­ãƒ¼ï¼ˆå›³è§£ï¼‰",
            "lineNumber": 68
          },
          {
            "lineNumber": 69
          },
          {
            "text": "1ãƒ•ã‚¡ã‚¤ãƒ«1è²¬ä»»ã‚’å¾¹åº•ã™ã‚‹ã“ã¨ã§ã€æƒ…å ±ã®æµã‚ŒãŒä¸€æœ¬é“ã«ãªã‚Šã€ãƒ‡ãƒãƒƒã‚°ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚",
            "lineNumber": 70
          },
          {
            "lineNumber": 71
          },
          {
            "text": "&#96;&#96;&#96;mermaid",
            "lineNumber": 72
          },
          {
            "text": "graph LR",
            "lineNumber": 73
          },
          {
            "text": "    User([ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›]) --&gt; App[app.py]",
            "lineNumber": 74
          },
          {
            "text": "    App --&gt; Agent[llm/agent.py]",
            "lineNumber": 75
          },
          {
            "text": "    Agent --&gt;|TOONå·®åˆ†| Parser[parser/toon_parser.py]",
            "lineNumber": 76
          },
          {
            "text": "    Parser --&gt;|æœ€æ–°ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«| App",
            "lineNumber": 77
          },
          {
            "text": "    App --&gt; Gen[generator/mermaid_gen.py]",
            "lineNumber": 78
          },
          {
            "text": "    Gen --&gt;|Mermaidæ–‡å­—åˆ—| App",
            "lineNumber": 79
          },
          {
            "text": "    App --&gt; UI[ğŸ–¥ï¸ Streamlitè¡¨ç¤º]",
            "lineNumber": 80
          },
          {
            "lineNumber": 81
          },
          {
            "text": "    subgraph Data",
            "lineNumber": 82
          },
          {
            "text": "        Parser -.-&gt; Snapshot[(TOON.md)]",
            "lineNumber": 83
          },
          {
            "text": "    end",
            "lineNumber": 84
          },
          {
            "lineNumber": 85
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 86
          },
          {
            "lineNumber": 87
          },
          {
            "text": "---",
            "lineNumber": 88
          },
          {
            "lineNumber": 89
          },
          {
            "text": "## 4. ã“ã®æ§‹é€ ã®ãƒ¡ãƒªãƒƒãƒˆ",
            "lineNumber": 90
          },
          {
            "lineNumber": 91
          },
          {
            "text": "* **äº¤æ›å¯èƒ½æ€§:** ã€ŒMermaidã§ã¯ãªãåˆ¥ã®å›³è§£ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã„ãŸã„ã€ã¨æ€ã£ãŸã‚‰ã€&#96;mermaid_gen.py&#96; ã ã‘ã‚’æ›¸ãæ›ãˆã‚Œã°æ¸ˆã¿ã¾ã™ã€‚",
            "lineNumber": 92
          },
          {
            "text": "* **ãƒ†ã‚¹ãƒˆã®å®¹æ˜“ã•:** AIãŒã„ãªãã¦ã‚‚ã€&#96;template.md&#96; ã‚’ &#96;toon_parser.py&#96; ã«èª­ã¿è¾¼ã¾ã›ã‚‹ã ã‘ã§ã€å›³è§£ãƒ­ã‚¸ãƒƒã‚¯ãŒæ­£ã—ã„ã‹ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚",
            "lineNumber": 93
          }
        ]
      },
      "score": 0.3695634603500366
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\Project.md",
        "range": {
          "startPosition": {
            "line": 28
          },
          "endPosition": {
            "line": 71
          }
        },
        "contents": "### 3.2 è¦–è¦šçš„æ‹¡å¼µï¼ˆå›³è§£ï¼‰æ©Ÿèƒ½\n\n* **Mermaid.jsã«ã‚ˆã‚‹æç”»:** TOONã®å„ã‚¿ã‚¤ãƒ—ã‚’ç‰¹å®šã®å½¢çŠ¶ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦è¡¨ç¤ºã™ã‚‹ã€‚\n* **ã€Œè«–ç†ã®ç©´ã€ã®æ¤œçŸ¥:** å‡ºå£ã®ãªã„åˆ†å²ã‚„ã€æ¥ç¶šå…ˆãŒæœªå®šç¾©ã®ãƒãƒ¼ãƒ‰ã‚’ &#96;MISSING&#96;ï¼ˆå…­è§’å½¢ãƒ»èµ¤è‰²ï¼‰ã¨ã—ã¦å¼·èª¿è¡¨ç¤ºã™ã‚‹ã€‚\n* **ã‚¹ã‚¿ã‚¤ãƒ«åˆ¶å¾¡:** ç¾åœ¨é€²è¡Œä¸­ã®ãƒãƒ¼ãƒ‰ã‚„å®Œäº†ã—ãŸå·¥ç¨‹ã‚’è‰²åˆ†ã‘ã—ã¦è¦–è¦šçš„ã«å¼·èª¿ã™ã‚‹ã€‚\n\n### 3.3 çŠ¶æ…‹ç®¡ç†æ©Ÿèƒ½\n\n* Streamlitã® &#96;session_state&#96; ã‚’åˆ©ç”¨ã—ã€å¯¾è©±ã®é€²æ—ã¨TOONã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’åŒæœŸã™ã‚‹ã€‚\n\n---\n\n## 4. ãƒ‡ãƒ¼ã‚¿å®šç¾©ï¼ˆTOON-Mermaid ãƒãƒƒãƒ”ãƒ³ã‚°ï¼‰\n\nç¾å ´ä½œæ¥­ã§ã®ã€Œè¦‹ã‚„ã™ã•ã€ã¨ã€Œç›´æ„Ÿæ€§ã€ã‚’é‡è¦–ã—ãŸå®šç¾©ã‚’æ¡ç”¨ã™ã‚‹ã€‚\n\n| ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ— | Mermaidå½¢çŠ¶ | è¨˜æ³• | æ„å‘³ãƒ»å½¹å‰² |\n| --- | --- | --- | --- |\n| **START/END** | ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ | &#96;([ ])&#96; | ãƒ•ãƒ­ãƒ¼ã®èµ·ç‚¹ãƒ»çµ‚ç€ç‚¹ã€‚ |\n| **PROCESS** | é•·æ–¹å½¢ | &#96;[ ]&#96; | å…·ä½“çš„ãªä½œæ¥­å†…å®¹ã‚„å‘½ä»¤ã€‚ |\n| **DECISION** | è±å½¢ | &#96;{ }&#96; | æ¡ä»¶åˆ†å²ã€‚Yes/Noãªã©ã®ãƒ«ãƒ¼ãƒˆåˆ†ã‘ã€‚ |\n| **IO_DATA** | å¹³è¡Œå››è¾ºå½¢ | &#96;[/ /]&#96; | ç”»é¢å…¥åŠ›ã‚„æ‰‹å‹•æ“ä½œã€‚ |\n| **STORAGE** | å††ç­’å½¢ | &#96;[( )]&#96; | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ“ä½œã€‚ |\n| **MISSING** | å…­è§’å½¢ï¼ˆèµ¤ï¼‰ | &#96;{{ }}&#96; | **æœªå®Ÿè£…ãƒ»è¦æ¤œè¨ç®‡æ‰€ã€‚** |\n\n---\n\n## 5. UI/UX è¨­è¨ˆæ¡ˆ\n\nç¾å ´ã§ã®ä½œæ¥­åŠ¹ç‡ã‚’æœ€å¤§åŒ–ã™ã‚‹ã€Œ3ãƒšã‚¤ãƒ³æ§‹æˆã€ã‚’æƒ³å®šã™ã‚‹ã€‚\n\n1. **å·¦ãƒšã‚¤ãƒ³ï¼ˆChatï¼‰:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒAIã¨å¯¾è©±ã™ã‚‹ã‚¨ãƒªã‚¢ã€‚\n2. **ä¸­å¤®ãƒšã‚¤ãƒ³ï¼ˆFlowchartï¼‰:** Mermaid.jsã«ã‚ˆã£ã¦æç”»ã•ã‚Œã‚‹å‹•çš„ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã€‚\n3. **å³ãƒšã‚¤ãƒ³ï¼ˆSourceï¼‰:** ç¾åœ¨ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã€‚\n\n---\n\n## 6. éæ©Ÿèƒ½è¦ä»¶\n\n* **æ‹¡å¼µæ€§:** TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…±é€šè¨€èªã¨ã™ã‚‹ã“ã¨ã§ã€å°†æ¥çš„ã«Pythonã‚³ãƒ¼ãƒ‰ã®è‡ªå‹•ç”Ÿæˆæ©Ÿèƒ½ãªã©ã‚’è¿½åŠ å¯èƒ½ã«ã™ã‚‹ã€‚\n* **å …ç‰¢æ€§:** è»½é‡LLMãŒãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ãŸå ´åˆã§ã‚‚ã€ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ã«ã‚ˆã£ã¦å›³è§£ãŒå´©ã‚Œã‚‹ã®ã‚’é˜²æ­¢ã™ã‚‹ã€‚\n* **è»½é‡åŒ–:** 2æ®µéšç›®ã®è§£æã«Gemma:4bç­‰ã®å°å‹ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®é«˜é€ŸåŒ–ã‚’å›³ã‚‹ã€‚",
        "signatures": {},
        "detailedLines": [
          {
            "text": "### 3.2 è¦–è¦šçš„æ‹¡å¼µï¼ˆå›³è§£ï¼‰æ©Ÿèƒ½",
            "lineNumber": 30
          },
          {
            "lineNumber": 31
          },
          {
            "text": "* **Mermaid.jsã«ã‚ˆã‚‹æç”»:** TOONã®å„ã‚¿ã‚¤ãƒ—ã‚’ç‰¹å®šã®å½¢çŠ¶ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦è¡¨ç¤ºã™ã‚‹ã€‚",
            "lineNumber": 32
          },
          {
            "text": "* **ã€Œè«–ç†ã®ç©´ã€ã®æ¤œçŸ¥:** å‡ºå£ã®ãªã„åˆ†å²ã‚„ã€æ¥ç¶šå…ˆãŒæœªå®šç¾©ã®ãƒãƒ¼ãƒ‰ã‚’ &#96;MISSING&#96;ï¼ˆå…­è§’å½¢ãƒ»èµ¤è‰²ï¼‰ã¨ã—ã¦å¼·èª¿è¡¨ç¤ºã™ã‚‹ã€‚",
            "lineNumber": 33
          },
          {
            "text": "* **ã‚¹ã‚¿ã‚¤ãƒ«åˆ¶å¾¡:** ç¾åœ¨é€²è¡Œä¸­ã®ãƒãƒ¼ãƒ‰ã‚„å®Œäº†ã—ãŸå·¥ç¨‹ã‚’è‰²åˆ†ã‘ã—ã¦è¦–è¦šçš„ã«å¼·èª¿ã™ã‚‹ã€‚",
            "lineNumber": 34
          },
          {
            "lineNumber": 35
          },
          {
            "text": "### 3.3 çŠ¶æ…‹ç®¡ç†æ©Ÿèƒ½",
            "lineNumber": 36
          },
          {
            "lineNumber": 37
          },
          {
            "text": "* Streamlitã® &#96;session_state&#96; ã‚’åˆ©ç”¨ã—ã€å¯¾è©±ã®é€²æ—ã¨TOONã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’åŒæœŸã™ã‚‹ã€‚",
            "lineNumber": 38
          },
          {
            "lineNumber": 39
          },
          {
            "text": "---",
            "lineNumber": 40
          },
          {
            "lineNumber": 41
          },
          {
            "text": "## 4. ãƒ‡ãƒ¼ã‚¿å®šç¾©ï¼ˆTOON-Mermaid ãƒãƒƒãƒ”ãƒ³ã‚°ï¼‰",
            "lineNumber": 42
          },
          {
            "lineNumber": 43
          },
          {
            "text": "ç¾å ´ä½œæ¥­ã§ã®ã€Œè¦‹ã‚„ã™ã•ã€ã¨ã€Œç›´æ„Ÿæ€§ã€ã‚’é‡è¦–ã—ãŸå®šç¾©ã‚’æ¡ç”¨ã™ã‚‹ã€‚",
            "lineNumber": 44
          },
          {
            "lineNumber": 45
          },
          {
            "text": "| ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ— | Mermaidå½¢çŠ¶ | è¨˜æ³• | æ„å‘³ãƒ»å½¹å‰² |",
            "lineNumber": 46
          },
          {
            "text": "| --- | --- | --- | --- |",
            "lineNumber": 47
          },
          {
            "text": "| **START/END** | ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ | &#96;([ ])&#96; | ãƒ•ãƒ­ãƒ¼ã®èµ·ç‚¹ãƒ»çµ‚ç€ç‚¹ã€‚ |",
            "lineNumber": 48
          },
          {
            "text": "| **PROCESS** | é•·æ–¹å½¢ | &#96;[ ]&#96; | å…·ä½“çš„ãªä½œæ¥­å†…å®¹ã‚„å‘½ä»¤ã€‚ |",
            "lineNumber": 49
          },
          {
            "text": "| **DECISION** | è±å½¢ | &#96;{ }&#96; | æ¡ä»¶åˆ†å²ã€‚Yes/Noãªã©ã®ãƒ«ãƒ¼ãƒˆåˆ†ã‘ã€‚ |",
            "lineNumber": 50
          },
          {
            "text": "| **IO_DATA** | å¹³è¡Œå››è¾ºå½¢ | &#96;[/ /]&#96; | ç”»é¢å…¥åŠ›ã‚„æ‰‹å‹•æ“ä½œã€‚ |",
            "lineNumber": 51
          },
          {
            "text": "| **STORAGE** | å††ç­’å½¢ | &#96;[( )]&#96; | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ“ä½œã€‚ |",
            "lineNumber": 52
          },
          {
            "text": "| **MISSING** | å…­è§’å½¢ï¼ˆèµ¤ï¼‰ | &#96;{{ }}&#96; | **æœªå®Ÿè£…ãƒ»è¦æ¤œè¨ç®‡æ‰€ã€‚** |",
            "lineNumber": 53
          },
          {
            "lineNumber": 54
          },
          {
            "text": "---",
            "lineNumber": 55
          },
          {
            "lineNumber": 56
          },
          {
            "text": "## 5. UI/UX è¨­è¨ˆæ¡ˆ",
            "lineNumber": 57
          },
          {
            "lineNumber": 58
          },
          {
            "text": "ç¾å ´ã§ã®ä½œæ¥­åŠ¹ç‡ã‚’æœ€å¤§åŒ–ã™ã‚‹ã€Œ3ãƒšã‚¤ãƒ³æ§‹æˆã€ã‚’æƒ³å®šã™ã‚‹ã€‚",
            "lineNumber": 59
          },
          {
            "lineNumber": 60
          },
          {
            "text": "1. **å·¦ãƒšã‚¤ãƒ³ï¼ˆChatï¼‰:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒAIã¨å¯¾è©±ã™ã‚‹ã‚¨ãƒªã‚¢ã€‚",
            "lineNumber": 61
          },
          {
            "text": "2. **ä¸­å¤®ãƒšã‚¤ãƒ³ï¼ˆFlowchartï¼‰:** Mermaid.jsã«ã‚ˆã£ã¦æç”»ã•ã‚Œã‚‹å‹•çš„ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã€‚",
            "lineNumber": 62
          },
          {
            "text": "3. **å³ãƒšã‚¤ãƒ³ï¼ˆSourceï¼‰:** ç¾åœ¨ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã€‚",
            "lineNumber": 63
          },
          {
            "lineNumber": 64
          },
          {
            "text": "---",
            "lineNumber": 65
          },
          {
            "lineNumber": 66
          },
          {
            "text": "## 6. éæ©Ÿèƒ½è¦ä»¶",
            "lineNumber": 67
          },
          {
            "lineNumber": 68
          },
          {
            "text": "* **æ‹¡å¼µæ€§:** TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…±é€šè¨€èªã¨ã™ã‚‹ã“ã¨ã§ã€å°†æ¥çš„ã«Pythonã‚³ãƒ¼ãƒ‰ã®è‡ªå‹•ç”Ÿæˆæ©Ÿèƒ½ãªã©ã‚’è¿½åŠ å¯èƒ½ã«ã™ã‚‹ã€‚",
            "lineNumber": 69
          },
          {
            "text": "* **å …ç‰¢æ€§:** è»½é‡LLMãŒãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ãŸå ´åˆã§ã‚‚ã€ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ã«ã‚ˆã£ã¦å›³è§£ãŒå´©ã‚Œã‚‹ã®ã‚’é˜²æ­¢ã™ã‚‹ã€‚",
            "lineNumber": 70
          },
          {
            "text": "* **è»½é‡åŒ–:** 2æ®µéšç›®ã®è§£æã«Gemma:4bç­‰ã®å°å‹ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®é«˜é€ŸåŒ–ã‚’å›³ã‚‹ã€‚",
            "lineNumber": 71
          }
        ]
      },
      "score": 0.3613440990447998
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 23
          },
          "endPosition": {
            "line": 271,
            "column": 31
          }
        },
        "contents": "class Flowchart(BaseModel):\ndef to_mermaid(self) -&gt; str:\n\n        \n        # ã‚¨ãƒƒã‚¸å®šç¾©\n        for e in self.edges:\n            # ã‚¨ãƒƒã‚¸ï¼ˆæ¥ç¶šç·šï¼‰ã®IDã‚‚åŒæ§˜ã«å¤‰æ›\n            src = f\"n_{e.source}\" if e.source == \"end\" else e.source\n            tgt = f\"n_{e.target}\" if e.target == \"end\" else e.target\n            \n            if e.label:\n                lines.append(f'{src}--&gt;|\"{e.label}\"|{tgt}')\n            else:\n                lines.append(f'{src}--&gt;{tgt}')\n        \n        # ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©ã‚’è¿½åŠ \n        if style_lines:\n            lines.append(\"\")\n            lines.extend(style_lines)\n            \n        return \"\\n\".join(lines)\n\n    def to_toon_format(self) -&gt; str:\n        \"\"\"Flowchartã‚’TOONå½¢å¼ï¼ˆMarkdownï¼‰ã«å¤‰æ›\"\"\"\n        lines = []\n        \n        # ãƒãƒ¼ãƒ‰å®šç¾©\n        for node in self.nodes:\n            lines.append(\"[Node]\")\n            lines.append(f\"id: {node.id}\")\n            lines.append(f\"label: {node.label}\")\n            lines.append(f\"type: {node.type}\")\n            if node.status != NodeStatus.ACTIVE:\n                lines.append(f\"status: {node.status.value}\")\n            lines.append(\"\")\n        \n        # ã‚¨ãƒƒã‚¸å®šç¾©\n        for edge in self.edges:\n            lines.append(\"[Edge]\")\n            lines.append(f\"source: {edge.source}\")\n            lines.append(f\"target: {edge.target}\")\n            if edge.label:\n                lines.append(f\"label: {edge.label}\")\n            lines.append(\"\")\n        \n        return \"\\n\".join(lines)",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 24,
                "column": 1
              },
              "endPosition": {
                "line": 25,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 199,
                "column": 5
              },
              "endPosition": {
                "line": 200,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 24,
            "isSignature": true
          },
          {
            "text": "def to_mermaid(self) -&gt; str:",
            "lineNumber": 199
          },
          {
            "lineNumber": 229
          },
          {
            "text": "        ",
            "lineNumber": 230
          },
          {
            "text": "        # ã‚¨ãƒƒã‚¸å®šç¾©",
            "lineNumber": 231
          },
          {
            "text": "        for e in self.edges:",
            "lineNumber": 232
          },
          {
            "text": "            # ã‚¨ãƒƒã‚¸ï¼ˆæ¥ç¶šç·šï¼‰ã®IDã‚‚åŒæ§˜ã«å¤‰æ›",
            "lineNumber": 233
          },
          {
            "text": "            src = f\"n_{e.source}\" if e.source == \"end\" else e.source",
            "lineNumber": 234
          },
          {
            "text": "            tgt = f\"n_{e.target}\" if e.target == \"end\" else e.target",
            "lineNumber": 235
          },
          {
            "text": "            ",
            "lineNumber": 236
          },
          {
            "text": "            if e.label:",
            "lineNumber": 237
          },
          {
            "text": "                lines.append(f'{src}--&gt;|\"{e.label}\"|{tgt}')",
            "lineNumber": 238
          },
          {
            "text": "            else:",
            "lineNumber": 239
          },
          {
            "text": "                lines.append(f'{src}--&gt;{tgt}')",
            "lineNumber": 240
          },
          {
            "text": "        ",
            "lineNumber": 241
          },
          {
            "text": "        # ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©ã‚’è¿½åŠ ",
            "lineNumber": 242
          },
          {
            "text": "        if style_lines:",
            "lineNumber": 243
          },
          {
            "text": "            lines.append(\"\")",
            "lineNumber": 244
          },
          {
            "text": "            lines.extend(style_lines)",
            "lineNumber": 245
          },
          {
            "text": "            ",
            "lineNumber": 246
          },
          {
            "text": "        return \"\\n\".join(lines)",
            "lineNumber": 247
          },
          {
            "lineNumber": 248
          },
          {
            "text": "    def to_toon_format(self) -&gt; str:",
            "lineNumber": 249
          },
          {
            "text": "        \"\"\"Flowchartã‚’TOONå½¢å¼ï¼ˆMarkdownï¼‰ã«å¤‰æ›\"\"\"",
            "lineNumber": 250
          },
          {
            "text": "        lines = []",
            "lineNumber": 251
          },
          {
            "text": "        ",
            "lineNumber": 252
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰å®šç¾©",
            "lineNumber": 253
          },
          {
            "text": "        for node in self.nodes:",
            "lineNumber": 254
          },
          {
            "text": "            lines.append(\"[Node]\")",
            "lineNumber": 255
          },
          {
            "text": "            lines.append(f\"id: {node.id}\")",
            "lineNumber": 256
          },
          {
            "text": "            lines.append(f\"label: {node.label}\")",
            "lineNumber": 257
          },
          {
            "text": "            lines.append(f\"type: {node.type}\")",
            "lineNumber": 258
          },
          {
            "text": "            if node.status != NodeStatus.ACTIVE:",
            "lineNumber": 259
          },
          {
            "text": "                lines.append(f\"status: {node.status.value}\")",
            "lineNumber": 260
          },
          {
            "text": "            lines.append(\"\")",
            "lineNumber": 261
          },
          {
            "text": "        ",
            "lineNumber": 262
          },
          {
            "text": "        # ã‚¨ãƒƒã‚¸å®šç¾©",
            "lineNumber": 263
          },
          {
            "text": "        for edge in self.edges:",
            "lineNumber": 264
          },
          {
            "text": "            lines.append(\"[Edge]\")",
            "lineNumber": 265
          },
          {
            "text": "            lines.append(f\"source: {edge.source}\")",
            "lineNumber": 266
          },
          {
            "text": "            lines.append(f\"target: {edge.target}\")",
            "lineNumber": 267
          },
          {
            "text": "            if edge.label:",
            "lineNumber": 268
          },
          {
            "text": "                lines.append(f\"label: {edge.label}\")",
            "lineNumber": 269
          },
          {
            "text": "            lines.append(\"\")",
            "lineNumber": 270
          },
          {
            "text": "        ",
            "lineNumber": 271
          },
          {
            "text": "        return \"\\n\".join(lines)",
            "lineNumber": 272,
            "isSignature": true
          }
        ]
      },
      "score": 0.3395653963088989
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\convert_flow_to_json.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 52,
            "column": 26
          }
        },
        "contents": "#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\"\"\"\nflow.mdã‚’èª­ã¿è¾¼ã‚“ã§JSONå½¢å¼ã«å¤‰æ›ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ\n\"\"\"\nimport json\nimport sys\nfrom pathlib import Path\nfrom core.mermaid_parser import MermaidParser\nfrom core.history_mgr import HistoryManager\n\ndef convert_flow_to_json():\n    \"\"\"flow.mdã‚’èª­ã¿è¾¼ã‚“ã§JSONå½¢å¼ã«å¤‰æ›\"\"\"\n    # flow.mdã‚’èª­ã¿è¾¼ã‚€\n    flow_path = Path(\"flow.md\")\n    if not flow_path.exists():\n        print(f\"Error: {flow_path} not found\", file=sys.stderr)\n        return\n    \n    # Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚€\n    mermaid_text = flow_path.read_text(encoding=\"utf-8\")\n    \n    # Mermaidå½¢å¼ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›\n    try:\n        flowchart = MermaidParser.parse(mermaid_text)\n        print(\"OK: Mermaid parsing succeeded\")\n        print(f\"  Nodes: {len(flowchart.nodes)}\")\n        print(f\"  Edges: {len(flowchart.edges)}\")\n    except Exception as e:\n        print(f\"Error: Mermaid parsing failed: {e}\", file=sys.stderr)\n        import traceback\n        traceback.print_exc()\n        return\n    \n    # JSONå½¢å¼ã§ä¿å­˜\n    history_mgr = HistoryManager()\n    session_name = \"flow_md\"\n    \n    # ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ã—ã¦ä¿å­˜\n    history_mgr.save_session(session_name, [flowchart])\n    print(f\"OK: Saved as JSON: storage/sessions/{session_name}.json\")\n    \n    # TOONå½¢å¼ã§ã‚‚ä¿å­˜\n    history_mgr.save_toon_file(session_name, flowchart)\n    print(f\"OK: Saved as TOON: storage/toon_files/{session_name}.md\")\n    \n    # JSONãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’è¡¨ç¤º\n    json_path = history_mgr.storage_dir / f\"{session_name}.json\"\n    print(f\"\\nTo load:\")\n    print(f\"  Use session name '{session_name}' in Streamlit app\")\n\nif __name__ == \"__main__\":\n    convert_flow_to_json()",
        "signatures": {},
        "detailedLines": [
          {
            "text": "#!/usr/bin/env python3",
            "lineNumber": 1
          },
          {
            "text": "# -*- coding: utf-8 -*-",
            "lineNumber": 2
          },
          {
            "text": "\"\"\"",
            "lineNumber": 3
          },
          {
            "text": "flow.mdã‚’èª­ã¿è¾¼ã‚“ã§JSONå½¢å¼ã«å¤‰æ›ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ",
            "lineNumber": 4
          },
          {
            "text": "\"\"\"",
            "lineNumber": 5
          },
          {
            "text": "import json",
            "lineNumber": 6
          },
          {
            "text": "import sys",
            "lineNumber": 7
          },
          {
            "text": "from pathlib import Path",
            "lineNumber": 8
          },
          {
            "text": "from core.mermaid_parser import MermaidParser",
            "lineNumber": 9
          },
          {
            "text": "from core.history_mgr import HistoryManager",
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "text": "def convert_flow_to_json():",
            "lineNumber": 12,
            "isSignature": true
          },
          {
            "text": "    \"\"\"flow.mdã‚’èª­ã¿è¾¼ã‚“ã§JSONå½¢å¼ã«å¤‰æ›\"\"\"",
            "lineNumber": 13
          },
          {
            "text": "    # flow.mdã‚’èª­ã¿è¾¼ã‚€",
            "lineNumber": 14
          },
          {
            "text": "    flow_path = Path(\"flow.md\")",
            "lineNumber": 15
          },
          {
            "text": "    if not flow_path.exists():",
            "lineNumber": 16
          },
          {
            "text": "        print(f\"Error: {flow_path} not found\", file=sys.stderr)",
            "lineNumber": 17
          },
          {
            "text": "        return",
            "lineNumber": 18
          },
          {
            "text": "    ",
            "lineNumber": 19
          },
          {
            "text": "    # Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚€",
            "lineNumber": 20
          },
          {
            "text": "    mermaid_text = flow_path.read_text(encoding=\"utf-8\")",
            "lineNumber": 21
          },
          {
            "text": "    ",
            "lineNumber": 22
          },
          {
            "text": "    # Mermaidå½¢å¼ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›",
            "lineNumber": 23
          },
          {
            "text": "    try:",
            "lineNumber": 24
          },
          {
            "text": "        flowchart = MermaidParser.parse(mermaid_text)",
            "lineNumber": 25
          },
          {
            "text": "        print(\"OK: Mermaid parsing succeeded\")",
            "lineNumber": 26
          },
          {
            "text": "        print(f\"  Nodes: {len(flowchart.nodes)}\")",
            "lineNumber": 27
          },
          {
            "text": "        print(f\"  Edges: {len(flowchart.edges)}\")",
            "lineNumber": 28
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 29
          },
          {
            "text": "        print(f\"Error: Mermaid parsing failed: {e}\", file=sys.stderr)",
            "lineNumber": 30
          },
          {
            "text": "        import traceback",
            "lineNumber": 31
          },
          {
            "text": "        traceback.print_exc()",
            "lineNumber": 32
          },
          {
            "text": "        return",
            "lineNumber": 33
          },
          {
            "text": "    ",
            "lineNumber": 34
          },
          {
            "text": "    # JSONå½¢å¼ã§ä¿å­˜",
            "lineNumber": 35
          },
          {
            "text": "    history_mgr = HistoryManager()",
            "lineNumber": 36
          },
          {
            "text": "    session_name = \"flow_md\"",
            "lineNumber": 37
          },
          {
            "text": "    ",
            "lineNumber": 38
          },
          {
            "text": "    # ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ã—ã¦ä¿å­˜",
            "lineNumber": 39
          },
          {
            "text": "    history_mgr.save_session(session_name, [flowchart])",
            "lineNumber": 40
          },
          {
            "text": "    print(f\"OK: Saved as JSON: storage/sessions/{session_name}.json\")",
            "lineNumber": 41
          },
          {
            "text": "    ",
            "lineNumber": 42
          },
          {
            "text": "    # TOONå½¢å¼ã§ã‚‚ä¿å­˜",
            "lineNumber": 43
          },
          {
            "text": "    history_mgr.save_toon_file(session_name, flowchart)",
            "lineNumber": 44
          },
          {
            "text": "    print(f\"OK: Saved as TOON: storage/toon_files/{session_name}.md\")",
            "lineNumber": 45
          },
          {
            "text": "    ",
            "lineNumber": 46
          },
          {
            "text": "    # JSONãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’è¡¨ç¤º",
            "lineNumber": 47
          },
          {
            "text": "    json_path = history_mgr.storage_dir / f\"{session_name}.json\"",
            "lineNumber": 48
          },
          {
            "text": "    print(f\"\\nTo load:\")",
            "lineNumber": 49
          },
          {
            "text": "    print(f\"  Use session name '{session_name}' in Streamlit app\")",
            "lineNumber": 50,
            "isSignature": true
          },
          {
            "lineNumber": 51
          },
          {
            "text": "if __name__ == \"__main__\":",
            "lineNumber": 52
          },
          {
            "text": "    convert_flow_to_json()",
            "lineNumber": 53
          }
        ]
      },
      "score": 0.33879080414772034
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\mermaid_parser.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 178
          }
        },
        "contents": "import re\nfrom typing import List, Dict, Tuple\nfrom core.schemas import Node, Edge, Flowchart, NodeStatus\nfrom core.exceptions import TOONParseError\n\nclass MermaidParser:\n    \"\"\"Mermaidå½¢å¼ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹ãƒ‘ãƒ¼ã‚µãƒ¼\"\"\"\n    \n    @staticmethod\n    def parse(mermaid_text: str) -&gt; Flowchart:\n        \"\"\"\n        Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚\n        \n        Args:\n            mermaid_text: Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆ\n            \n        Returns:\n            Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ\n        \"\"\"\n        # Markdownã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’é™¤å»\n        clean_text = re.sub(r'&#96;&#96;&#96;mermaid\\s*\\n?', '', mermaid_text)\n        clean_text = clean_text.replace('&#96;&#96;&#96;', '').strip()\n        \n        lines = [line.strip() for line in clean_text.split('\\n') if line.strip()]\n        \n        nodes = []\n        edges = []\n        node_map = {}  # ID -&gt; Node ã®ãƒãƒƒãƒ”ãƒ³ã‚°\n        \n        # ãƒãƒ¼ãƒ‰å®šç¾©ã¨ã‚¨ãƒƒã‚¸å®šç¾©ã‚’æŠ½å‡º\n        in_subgraph = False\n        for line in lines:\n            # ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—\n            if line.startswith('%%'):\n                continue",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import re",
            "lineNumber": 1
          },
          {
            "text": "from typing import List, Dict, Tuple",
            "lineNumber": 2
          },
          {
            "text": "from core.schemas import Node, Edge, Flowchart, NodeStatus",
            "lineNumber": 3
          },
          {
            "text": "from core.exceptions import TOONParseError",
            "lineNumber": 4
          },
          {
            "lineNumber": 5
          },
          {
            "text": "class MermaidParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "    \"\"\"Mermaidå½¢å¼ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹ãƒ‘ãƒ¼ã‚µãƒ¼\"\"\"",
            "lineNumber": 7
          },
          {
            "text": "    ",
            "lineNumber": 8
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 9
          },
          {
            "text": "    def parse(mermaid_text: str) -&gt; Flowchart:",
            "lineNumber": 10
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 11
          },
          {
            "text": "        Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚",
            "lineNumber": 12
          },
          {
            "text": "        ",
            "lineNumber": 13
          },
          {
            "text": "        Args:",
            "lineNumber": 14
          },
          {
            "text": "            mermaid_text: Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆ",
            "lineNumber": 15
          },
          {
            "text": "            ",
            "lineNumber": 16
          },
          {
            "text": "        Returns:",
            "lineNumber": 17
          },
          {
            "text": "            Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ",
            "lineNumber": 18
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 19
          },
          {
            "text": "        # Markdownã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’é™¤å»",
            "lineNumber": 20
          },
          {
            "text": "        clean_text = re.sub(r'&#96;&#96;&#96;mermaid\\s*\\n?', '', mermaid_text)",
            "lineNumber": 21
          },
          {
            "text": "        clean_text = clean_text.replace('&#96;&#96;&#96;', '').strip()",
            "lineNumber": 22
          },
          {
            "text": "        ",
            "lineNumber": 23
          },
          {
            "text": "        lines = [line.strip() for line in clean_text.split('\\n') if line.strip()]",
            "lineNumber": 24
          },
          {
            "text": "        ",
            "lineNumber": 25
          },
          {
            "text": "        nodes = []",
            "lineNumber": 26
          },
          {
            "text": "        edges = []",
            "lineNumber": 27
          },
          {
            "text": "        node_map = {}  # ID -&gt; Node ã®ãƒãƒƒãƒ”ãƒ³ã‚°",
            "lineNumber": 28
          },
          {
            "text": "        ",
            "lineNumber": 29
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰å®šç¾©ã¨ã‚¨ãƒƒã‚¸å®šç¾©ã‚’æŠ½å‡º",
            "lineNumber": 30
          },
          {
            "text": "        in_subgraph = False",
            "lineNumber": 31
          },
          {
            "text": "        for line in lines:",
            "lineNumber": 32
          },
          {
            "text": "            # ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—",
            "lineNumber": 33
          },
          {
            "text": "            if line.startswith('%%'):",
            "lineNumber": 34
          },
          {
            "text": "                continue",
            "lineNumber": 35
          }
        ]
      },
      "score": 0.3377387523651123
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 49,
            "column": 53
          }
        },
        "contents": "import streamlit as st\nimport streamlit.components.v1 as components\nimport base64\nfrom core.schemas import Node, Edge, Flowchart\nfrom core.llm_client import LLMClient\nfrom core.toon_parser import TOONParser\nfrom core.history_mgr import HistoryManager\nfrom core.exceptions import LLMAPIError, TOONParseError, FlowchartValidationError\nfrom pathlib import Path\n\nst.set_page_config(layout=\"wide\")\nst.title(\"Flowchart Generator &amp; History Manager\")\n\n# 1. ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–\nhistory_mgr = HistoryManager()\n\n# 2. ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´ã®åˆæœŸåŒ–\nif 'history' not in st.session_state:\n    # åˆæœŸçŠ¶æ…‹ï¼šé–‹å§‹ã¨çµ‚äº†ã®ã¿ã®æ§‹æˆ\n    initial_flow = Flowchart(\n        nodes=[\n            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),\n            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")\n        ],\n        edges=[Edge(source=\"start\", target=\"node_end\")]\n    )\n    st.session_state.history = [initial_flow]\n\n# 3. è³ªå•å¿œç­”ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®åˆæœŸåŒ–\nif 'conversation_context' not in st.session_state:\n    st.session_state.conversation_context = None  # å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\nif 'pending_questions' not in st.session_state:\n    st.session_state.pending_questions = None  # ç¾åœ¨ã®è³ªå•ãƒ†ã‚­ã‚¹ãƒˆ\nif 'question_responses' not in st.session_state:\n    st.session_state.question_responses = []  # å›ç­”ã®ãƒªã‚¹ãƒˆ\nif 'append_mode_for_question' not in st.session_state:\n    st.session_state.append_mode_for_question = False  # è³ªå•æ™‚ã®å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®š\n\n# --- ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼šã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† ---\nst.sidebar.header(\"ğŸ’¾ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†\")\n\n# ä¿å­˜æ¸ˆã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä¸€è¦§ã‚’å–å¾—\nsaved_sessions = history_mgr.list_sessions()\n\n# ã‚»ãƒƒã‚·ãƒ§ãƒ³åã®å…¥åŠ›ï¼ˆæ–°è¦ä½œæˆç”¨ï¼‰\nsession_name = st.sidebar.text_input(\"ã‚»ãƒƒã‚·ãƒ§ãƒ³åï¼ˆæ–°è¦ä½œæˆ/ä¿å­˜ç”¨ï¼‰\", value=\"default_session\")\n\ncol_save, col_load = st.sidebar.columns(2)\nwith col_save:\n    if st.button(\"ä¿å­˜\", use_container_width=True):",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import streamlit as st",
            "lineNumber": 1
          },
          {
            "text": "import streamlit.components.v1 as components",
            "lineNumber": 2
          },
          {
            "text": "import base64",
            "lineNumber": 3
          },
          {
            "text": "from core.schemas import Node, Edge, Flowchart",
            "lineNumber": 4
          },
          {
            "text": "from core.llm_client import LLMClient",
            "lineNumber": 5
          },
          {
            "text": "from core.toon_parser import TOONParser",
            "lineNumber": 6
          },
          {
            "text": "from core.history_mgr import HistoryManager",
            "lineNumber": 7
          },
          {
            "text": "from core.exceptions import LLMAPIError, TOONParseError, FlowchartValidationError",
            "lineNumber": 8
          },
          {
            "text": "from pathlib import Path",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "text": "st.set_page_config(layout=\"wide\")",
            "lineNumber": 11
          },
          {
            "text": "st.title(\"Flowchart Generator &amp; History Manager\")",
            "lineNumber": 12
          },
          {
            "lineNumber": 13
          },
          {
            "text": "# 1. ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–",
            "lineNumber": 14
          },
          {
            "text": "history_mgr = HistoryManager()",
            "lineNumber": 15
          },
          {
            "lineNumber": 16
          },
          {
            "text": "# 2. ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´ã®åˆæœŸåŒ–",
            "lineNumber": 17
          },
          {
            "text": "if 'history' not in st.session_state:",
            "lineNumber": 18
          },
          {
            "text": "    # åˆæœŸçŠ¶æ…‹ï¼šé–‹å§‹ã¨çµ‚äº†ã®ã¿ã®æ§‹æˆ",
            "lineNumber": 19
          },
          {
            "text": "    initial_flow = Flowchart(",
            "lineNumber": 20
          },
          {
            "text": "        nodes=[",
            "lineNumber": 21
          },
          {
            "text": "            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),",
            "lineNumber": 22
          },
          {
            "text": "            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")",
            "lineNumber": 23
          },
          {
            "text": "        ],",
            "lineNumber": 24
          },
          {
            "text": "        edges=[Edge(source=\"start\", target=\"node_end\")]",
            "lineNumber": 25
          },
          {
            "text": "    )",
            "lineNumber": 26
          },
          {
            "text": "    st.session_state.history = [initial_flow]",
            "lineNumber": 27
          },
          {
            "lineNumber": 28
          },
          {
            "text": "# 3. è³ªå•å¿œç­”ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®åˆæœŸåŒ–",
            "lineNumber": 29
          },
          {
            "text": "if 'conversation_context' not in st.session_state:",
            "lineNumber": 30
          },
          {
            "text": "    st.session_state.conversation_context = None  # å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ",
            "lineNumber": 31
          },
          {
            "text": "if 'pending_questions' not in st.session_state:",
            "lineNumber": 32
          },
          {
            "text": "    st.session_state.pending_questions = None  # ç¾åœ¨ã®è³ªå•ãƒ†ã‚­ã‚¹ãƒˆ",
            "lineNumber": 33
          },
          {
            "text": "if 'question_responses' not in st.session_state:",
            "lineNumber": 34
          },
          {
            "text": "    st.session_state.question_responses = []  # å›ç­”ã®ãƒªã‚¹ãƒˆ",
            "lineNumber": 35
          },
          {
            "text": "if 'append_mode_for_question' not in st.session_state:",
            "lineNumber": 36
          },
          {
            "text": "    st.session_state.append_mode_for_question = False  # è³ªå•æ™‚ã®å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®š",
            "lineNumber": 37
          },
          {
            "lineNumber": 38
          },
          {
            "text": "# --- ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼šã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† ---",
            "lineNumber": 39
          },
          {
            "text": "st.sidebar.header(\"ğŸ’¾ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†\")",
            "lineNumber": 40
          },
          {
            "lineNumber": 41
          },
          {
            "text": "# ä¿å­˜æ¸ˆã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä¸€è¦§ã‚’å–å¾—",
            "lineNumber": 42
          },
          {
            "text": "saved_sessions = history_mgr.list_sessions()",
            "lineNumber": 43
          },
          {
            "lineNumber": 44
          },
          {
            "text": "# ã‚»ãƒƒã‚·ãƒ§ãƒ³åã®å…¥åŠ›ï¼ˆæ–°è¦ä½œæˆç”¨ï¼‰",
            "lineNumber": 45
          },
          {
            "text": "session_name = st.sidebar.text_input(\"ã‚»ãƒƒã‚·ãƒ§ãƒ³åï¼ˆæ–°è¦ä½œæˆ/ä¿å­˜ç”¨ï¼‰\", value=\"default_session\")",
            "lineNumber": 46
          },
          {
            "lineNumber": 47
          },
          {
            "text": "col_save, col_load = st.sidebar.columns(2)",
            "lineNumber": 48
          },
          {
            "text": "with col_save:",
            "lineNumber": 49
          },
          {
            "text": "    if st.button(\"ä¿å­˜\", use_container_width=True):",
            "lineNumber": 50
          }
        ]
      },
      "score": 0.33641359210014343
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 119,
            "column": 43
          },
          "endPosition": {
            "line": 156,
            "column": 37
          }
        },
        "contents": "try:\n    ollama_config = st.secrets.get(\"ollama\", {})\n    base_url = ollama_config.get(\"base_url\", \"http://localhost:11434\")\n    model = ollama_config.get(\"model\", \"llama3.2\")\n    config_source = \"secrets.toml\"\nexcept (AttributeError, FileNotFoundError, ImportError, RuntimeError):\n    import os\n    base_url = os.getenv(\"OLLAMA_BASE_URL\", \"http://localhost:11434\")\n    model = os.getenv(\"OLLAMA_MODEL\", \"llama3.2\")\n    config_source = \"ç’°å¢ƒå¤‰æ•°\"\n\nst.sidebar.text(f\"è¨­å®šå…ƒ: {config_source}\")\nst.sidebar.text(f\"ãƒ™ãƒ¼ã‚¹URL: {base_url}\")\nst.sidebar.text(f\"ãƒ¢ãƒ‡ãƒ«: {model}\")\n\n# --- æç”»ã¨å±¥æ­´ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ ---\nst.divider()\n\n# å±¥æ­´ã‚’é¡ã‚‹ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼\nif len(st.session_state.history) &gt; 1:\n    history_index = st.sidebar.slider(\n        \"å±¥æ­´ã‚’é¡ã‚‹\", \n        min_value=0, \n        max_value=len(st.session_state.history) - 1, \n        value=len(st.session_state.history) - 1\n    )\nelse:\n    history_index = 0\n    st.sidebar.info(\"ç¾åœ¨ã¯åˆæœŸçŠ¶æ…‹ã§ã™ã€‚\")\n\ncurrent_flow = st.session_state.history[history_index]\n\n# 3ãƒšã‚¤ãƒ³æ§‹æˆ: å·¦ï¼ˆChat/Inputï¼‰ã€ä¸­å¤®ï¼ˆFlowchartï¼‰ã€å³ï¼ˆSourceï¼‰\ncol_chat, col_flow, col_source = st.columns([1, 2, 1])\n\nwith col_chat:\n    st.subheader(\"ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ\")",
        "signatures": {},
        "detailedLines": [
          {
            "text": "try:",
            "lineNumber": 121
          },
          {
            "text": "    ollama_config = st.secrets.get(\"ollama\", {})",
            "lineNumber": 122
          },
          {
            "text": "    base_url = ollama_config.get(\"base_url\", \"http://localhost:11434\")",
            "lineNumber": 123
          },
          {
            "text": "    model = ollama_config.get(\"model\", \"llama3.2\")",
            "lineNumber": 124
          },
          {
            "text": "    config_source = \"secrets.toml\"",
            "lineNumber": 125
          },
          {
            "text": "except (AttributeError, FileNotFoundError, ImportError, RuntimeError):",
            "lineNumber": 126
          },
          {
            "text": "    import os",
            "lineNumber": 127
          },
          {
            "text": "    base_url = os.getenv(\"OLLAMA_BASE_URL\", \"http://localhost:11434\")",
            "lineNumber": 128
          },
          {
            "text": "    model = os.getenv(\"OLLAMA_MODEL\", \"llama3.2\")",
            "lineNumber": 129
          },
          {
            "text": "    config_source = \"ç’°å¢ƒå¤‰æ•°\"",
            "lineNumber": 130
          },
          {
            "lineNumber": 131
          },
          {
            "text": "st.sidebar.text(f\"è¨­å®šå…ƒ: {config_source}\")",
            "lineNumber": 132
          },
          {
            "text": "st.sidebar.text(f\"ãƒ™ãƒ¼ã‚¹URL: {base_url}\")",
            "lineNumber": 133
          },
          {
            "text": "st.sidebar.text(f\"ãƒ¢ãƒ‡ãƒ«: {model}\")",
            "lineNumber": 134
          },
          {
            "lineNumber": 135
          },
          {
            "text": "# --- æç”»ã¨å±¥æ­´ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ ---",
            "lineNumber": 136
          },
          {
            "text": "st.divider()",
            "lineNumber": 137
          },
          {
            "lineNumber": 138
          },
          {
            "text": "# å±¥æ­´ã‚’é¡ã‚‹ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼",
            "lineNumber": 139
          },
          {
            "text": "if len(st.session_state.history) &gt; 1:",
            "lineNumber": 140
          },
          {
            "text": "    history_index = st.sidebar.slider(",
            "lineNumber": 141
          },
          {
            "text": "        \"å±¥æ­´ã‚’é¡ã‚‹\", ",
            "lineNumber": 142
          },
          {
            "text": "        min_value=0, ",
            "lineNumber": 143
          },
          {
            "text": "        max_value=len(st.session_state.history) - 1, ",
            "lineNumber": 144
          },
          {
            "text": "        value=len(st.session_state.history) - 1",
            "lineNumber": 145
          },
          {
            "text": "    )",
            "lineNumber": 146
          },
          {
            "text": "else:",
            "lineNumber": 147
          },
          {
            "text": "    history_index = 0",
            "lineNumber": 148
          },
          {
            "text": "    st.sidebar.info(\"ç¾åœ¨ã¯åˆæœŸçŠ¶æ…‹ã§ã™ã€‚\")",
            "lineNumber": 149
          },
          {
            "lineNumber": 150
          },
          {
            "text": "current_flow = st.session_state.history[history_index]",
            "lineNumber": 151
          },
          {
            "lineNumber": 152
          },
          {
            "text": "# 3ãƒšã‚¤ãƒ³æ§‹æˆ: å·¦ï¼ˆChat/Inputï¼‰ã€ä¸­å¤®ï¼ˆFlowchartï¼‰ã€å³ï¼ˆSourceï¼‰",
            "lineNumber": 153
          },
          {
            "text": "col_chat, col_flow, col_source = st.columns([1, 2, 1])",
            "lineNumber": 154
          },
          {
            "lineNumber": 155
          },
          {
            "text": "with col_chat:",
            "lineNumber": 156
          },
          {
            "text": "    st.subheader(\"ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ\")",
            "lineNumber": 157
          }
        ]
      },
      "score": 0.3362315893173218
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\flow.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 47
          }
        },
        "contents": "&#96;&#96;&#96;mermaid\ngraph TD\n    start[\"é–‹å§‹\"]\n    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]\n    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]\n    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]\n    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}\n    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}\n    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]\n    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]\n    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]\n    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]\n    task10[\"æµå‹•ã«æˆ»ã™\"]\n    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}\n    node_end[\"çµ‚äº†\"]\n    \n    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼\n    start--&gt;task1\n    task1--&gt;task2\n    task2--&gt;decision1\n    \n    %% å†ç¾ã—ãªã„å ´åˆ\n    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10\n    task10--&gt;decision_recurrence\n    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1\n    \n    %% å†ç¾ã™ã‚‹å ´åˆ\n    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3\n    task3--&gt;decision2\n    \n    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²\n    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4\n    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8\n    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9\n    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other\n    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "&#96;&#96;&#96;mermaid",
            "lineNumber": 1
          },
          {
            "text": "graph TD",
            "lineNumber": 2
          },
          {
            "text": "    start[\"é–‹å§‹\"]",
            "lineNumber": 3
          },
          {
            "text": "    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]",
            "lineNumber": 4
          },
          {
            "text": "    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]",
            "lineNumber": 5
          },
          {
            "text": "    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 6
          },
          {
            "text": "    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]",
            "lineNumber": 7
          },
          {
            "text": "    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}",
            "lineNumber": 8
          },
          {
            "text": "    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 9
          },
          {
            "text": "    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}",
            "lineNumber": 10
          },
          {
            "text": "    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 11
          },
          {
            "text": "    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 12
          },
          {
            "text": "    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]",
            "lineNumber": 13
          },
          {
            "text": "    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]",
            "lineNumber": 14
          },
          {
            "text": "    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]",
            "lineNumber": 15
          },
          {
            "text": "    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]",
            "lineNumber": 16
          },
          {
            "text": "    task10[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 17
          },
          {
            "text": "    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}",
            "lineNumber": 18
          },
          {
            "text": "    node_end[\"çµ‚äº†\"]",
            "lineNumber": 19
          },
          {
            "text": "    ",
            "lineNumber": 20
          },
          {
            "text": "    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 21
          },
          {
            "text": "    start--&gt;task1",
            "lineNumber": 22
          },
          {
            "text": "    task1--&gt;task2",
            "lineNumber": 23
          },
          {
            "text": "    task2--&gt;decision1",
            "lineNumber": 24
          },
          {
            "text": "    ",
            "lineNumber": 25
          },
          {
            "text": "    %% å†ç¾ã—ãªã„å ´åˆ",
            "lineNumber": 26
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 27
          },
          {
            "text": "    task10--&gt;decision_recurrence",
            "lineNumber": 28
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end",
            "lineNumber": 29
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1",
            "lineNumber": 30
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2",
            "lineNumber": 31
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3",
            "lineNumber": 32
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4",
            "lineNumber": 33
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1",
            "lineNumber": 34
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1",
            "lineNumber": 35
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1",
            "lineNumber": 36
          },
          {
            "text": "    ",
            "lineNumber": 37
          },
          {
            "text": "    %% å†ç¾ã™ã‚‹å ´åˆ",
            "lineNumber": 38
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3",
            "lineNumber": 39
          },
          {
            "text": "    task3--&gt;decision2",
            "lineNumber": 40
          },
          {
            "text": "    ",
            "lineNumber": 41
          },
          {
            "text": "    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²",
            "lineNumber": 42
          },
          {
            "text": "    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4",
            "lineNumber": 43
          },
          {
            "text": "    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8",
            "lineNumber": 44
          },
          {
            "text": "    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9",
            "lineNumber": 45
          },
          {
            "text": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other",
            "lineNumber": 46
          },
          {
            "text": "    ",
            "lineNumber": 47
          }
        ]
      },
      "score": 0.3157772123813629
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\storage\\toon_files\\flow_md.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 47
          }
        },
        "contents": "&#96;&#96;&#96;mermaid\ngraph TD\n    start[\"é–‹å§‹\"]\n    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]\n    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]\n    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]\n    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}\n    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}\n    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]\n    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]\n    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]\n    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]\n    task10[\"æµå‹•ã«æˆ»ã™\"]\n    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}\n    node_end[\"çµ‚äº†\"]\n    \n    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼\n    start--&gt;task1\n    task1--&gt;task2\n    task2--&gt;decision1\n    \n    %% å†ç¾ã—ãªã„å ´åˆ\n    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10\n    task10--&gt;decision_recurrence\n    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1\n    \n    %% å†ç¾ã™ã‚‹å ´åˆ\n    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3\n    task3--&gt;decision2\n    \n    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²\n    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4\n    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8\n    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9\n    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other\n    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "&#96;&#96;&#96;mermaid",
            "lineNumber": 1
          },
          {
            "text": "graph TD",
            "lineNumber": 2
          },
          {
            "text": "    start[\"é–‹å§‹\"]",
            "lineNumber": 3
          },
          {
            "text": "    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]",
            "lineNumber": 4
          },
          {
            "text": "    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]",
            "lineNumber": 5
          },
          {
            "text": "    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 6
          },
          {
            "text": "    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]",
            "lineNumber": 7
          },
          {
            "text": "    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}",
            "lineNumber": 8
          },
          {
            "text": "    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 9
          },
          {
            "text": "    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}",
            "lineNumber": 10
          },
          {
            "text": "    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 11
          },
          {
            "text": "    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 12
          },
          {
            "text": "    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]",
            "lineNumber": 13
          },
          {
            "text": "    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]",
            "lineNumber": 14
          },
          {
            "text": "    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]",
            "lineNumber": 15
          },
          {
            "text": "    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]",
            "lineNumber": 16
          },
          {
            "text": "    task10[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 17
          },
          {
            "text": "    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}",
            "lineNumber": 18
          },
          {
            "text": "    node_end[\"çµ‚äº†\"]",
            "lineNumber": 19
          },
          {
            "text": "    ",
            "lineNumber": 20
          },
          {
            "text": "    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 21
          },
          {
            "text": "    start--&gt;task1",
            "lineNumber": 22
          },
          {
            "text": "    task1--&gt;task2",
            "lineNumber": 23
          },
          {
            "text": "    task2--&gt;decision1",
            "lineNumber": 24
          },
          {
            "text": "    ",
            "lineNumber": 25
          },
          {
            "text": "    %% å†ç¾ã—ãªã„å ´åˆ",
            "lineNumber": 26
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 27
          },
          {
            "text": "    task10--&gt;decision_recurrence",
            "lineNumber": 28
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end",
            "lineNumber": 29
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1",
            "lineNumber": 30
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2",
            "lineNumber": 31
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3",
            "lineNumber": 32
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4",
            "lineNumber": 33
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1",
            "lineNumber": 34
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1",
            "lineNumber": 35
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1",
            "lineNumber": 36
          },
          {
            "text": "    ",
            "lineNumber": 37
          },
          {
            "text": "    %% å†ç¾ã™ã‚‹å ´åˆ",
            "lineNumber": 38
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3",
            "lineNumber": 39
          },
          {
            "text": "    task3--&gt;decision2",
            "lineNumber": 40
          },
          {
            "text": "    ",
            "lineNumber": 41
          },
          {
            "text": "    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²",
            "lineNumber": 42
          },
          {
            "text": "    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4",
            "lineNumber": 43
          },
          {
            "text": "    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8",
            "lineNumber": 44
          },
          {
            "text": "    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9",
            "lineNumber": 45
          },
          {
            "text": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other",
            "lineNumber": 46
          },
          {
            "text": "    ",
            "lineNumber": 47
          }
        ]
      },
      "score": 0.3028106987476349
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 323,
            "column": 62
          },
          "endPosition": {
            "line": 360,
            "column": 54
          }
        },
        "contents": "                raw_toon_text = \"\"\n                try:\n                    # LLMã¨ã®é€šä¿¡\n                    client = LLMClient()\n                    # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯æ—¢å­˜ã®Flowchartã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦æ¸¡ã™\n                    context_flowchart = current_flow if append_mode else None\n                    raw_toon_text = client.generate_flow(user_prompt, context_flowchart)\n                    \n                    # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯\n                    if client.is_question_response(raw_toon_text):\n                        # è³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜\n                        st.session_state.conversation_context = user_prompt\n                        st.session_state.pending_questions = raw_toon_text\n                        st.session_state.question_responses = []\n                        st.session_state.append_mode_for_question = append_mode  # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜\n                        st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n                        st.rerun()\n                    else:\n                        # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹\n                        new_flow = TOONParser.parse(raw_toon_text)\n                        \n                        # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨\n                        new_flow = new_flow.apply_logic_gap_detection()\n                        \n                        # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ\n                        if append_mode:\n                            merged_flow = history_mgr.append_toon_log(session_name, new_flow)\n                            st.session_state.history.append(merged_flow)\n                            st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")\n                        else:\n                            # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ \n                            st.session_state.history.append(new_flow)\n                        \n                        st.rerun()\n                except LLMAPIError as e:\n                    # LLM APIã‚¨ãƒ©ãƒ¼\n                    st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {e}\")",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                raw_toon_text = \"\"",
            "lineNumber": 325
          },
          {
            "text": "                try:",
            "lineNumber": 326
          },
          {
            "text": "                    # LLMã¨ã®é€šä¿¡",
            "lineNumber": 327
          },
          {
            "text": "                    client = LLMClient()",
            "lineNumber": 328
          },
          {
            "text": "                    # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯æ—¢å­˜ã®Flowchartã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦æ¸¡ã™",
            "lineNumber": 329
          },
          {
            "text": "                    context_flowchart = current_flow if append_mode else None",
            "lineNumber": 330
          },
          {
            "text": "                    raw_toon_text = client.generate_flow(user_prompt, context_flowchart)",
            "lineNumber": 331
          },
          {
            "text": "                    ",
            "lineNumber": 332
          },
          {
            "text": "                    # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 333
          },
          {
            "text": "                    if client.is_question_response(raw_toon_text):",
            "lineNumber": 334
          },
          {
            "text": "                        # è³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜",
            "lineNumber": 335
          },
          {
            "text": "                        st.session_state.conversation_context = user_prompt",
            "lineNumber": 336
          },
          {
            "text": "                        st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 337
          },
          {
            "text": "                        st.session_state.question_responses = []",
            "lineNumber": 338
          },
          {
            "text": "                        st.session_state.append_mode_for_question = append_mode  # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜",
            "lineNumber": 339
          },
          {
            "text": "                        st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 340
          },
          {
            "text": "                        st.rerun()",
            "lineNumber": 341
          },
          {
            "text": "                    else:",
            "lineNumber": 342
          },
          {
            "text": "                        # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹",
            "lineNumber": 343
          },
          {
            "text": "                        new_flow = TOONParser.parse(raw_toon_text)",
            "lineNumber": 344
          },
          {
            "text": "                        ",
            "lineNumber": 345
          },
          {
            "text": "                        # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨",
            "lineNumber": 346
          },
          {
            "text": "                        new_flow = new_flow.apply_logic_gap_detection()",
            "lineNumber": 347
          },
          {
            "text": "                        ",
            "lineNumber": 348
          },
          {
            "text": "                        # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ",
            "lineNumber": 349
          },
          {
            "text": "                        if append_mode:",
            "lineNumber": 350
          },
          {
            "text": "                            merged_flow = history_mgr.append_toon_log(session_name, new_flow)",
            "lineNumber": 351
          },
          {
            "text": "                            st.session_state.history.append(merged_flow)",
            "lineNumber": 352
          },
          {
            "text": "                            st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")",
            "lineNumber": 353
          },
          {
            "text": "                        else:",
            "lineNumber": 354
          },
          {
            "text": "                            # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ ",
            "lineNumber": 355
          },
          {
            "text": "                            st.session_state.history.append(new_flow)",
            "lineNumber": 356
          },
          {
            "text": "                        ",
            "lineNumber": 357
          },
          {
            "text": "                        st.rerun()",
            "lineNumber": 358
          },
          {
            "text": "                except LLMAPIError as e:",
            "lineNumber": 359
          },
          {
            "text": "                    # LLM APIã‚¨ãƒ©ãƒ¼",
            "lineNumber": 360
          },
          {
            "text": "                    st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {e}\")",
            "lineNumber": 361
          }
        ]
      },
      "score": 0.29094505310058594
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 23
          },
          "endPosition": {
            "line": 271
          }
        },
        "contents": "class Flowchart(BaseModel):\ndef detect_logic_gaps(self) -&gt; List[Node]:\n\n        \n        return gaps\n\n    def apply_logic_gap_detection(self) -&gt; 'Flowchart':\n        \"\"\"è«–ç†ã®ç©´ã‚’æ¤œå‡ºã—ã€MISSINGãƒãƒ¼ãƒ‰ã¨ã—ã¦è¿½åŠ \"\"\"\n        gaps = self.detect_logic_gaps()\n        \n        if not gaps:\n            return self\n        \n        # æ—¢å­˜ã®ãƒãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼\n        new_nodes = [Node(**node.model_dump()) for node in self.nodes]\n        new_edges = [Edge(**edge.model_dump()) for edge in self.edges]\n        \n        # ã‚®ãƒ£ãƒƒãƒ—ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã¾ãŸã¯æ›´æ–°\n        existing_ids = {node.id for node in new_nodes}\n        for gap in gaps:\n            if gap.id not in existing_ids:\n                new_nodes.append(gap)\n            else:\n                # æ—¢å­˜ãƒãƒ¼ãƒ‰ã‚’MISSINGã¨ã—ã¦æ›´æ–°\n                for i, node in enumerate(new_nodes):\n                    if node.id == gap.id:\n                        new_nodes[i] = Node(\n                            id=node.id,\n                            label=node.label,\n                            type=\"missing\",\n                            status=NodeStatus.MISSING\n                        )\n                        break\n        \n        return Flowchart(nodes=new_nodes, edges=new_edges)\n\n    @staticmethod\n    def _get_node_shape(node_type: str) -&gt; str:\n        \"\"\"ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸMermaidå½¢çŠ¶ã‚’è¿”ã™\"\"\"\n        shape_map = {\n            \"start\": \"([ ])\",\n            \"end\": \"([ ])\",\n            \"process\": \"[ ]\",\n            \"decision\": \"{ }\",\n            \"io_data\": \"[/ /]\",\n            \"storage\": \"[( )]\",\n            \"missing\": \"{{ }}\"\n        }\n        return shape_map.get(node_type.lower(), \"{{ }}\")  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯MISSING\n\n    @staticmethod\n    def _get_status_color(status: NodeStatus) -&gt; str:\n        ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 24,
                "column": 1
              },
              "endPosition": {
                "line": 25,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 24,
            "isSignature": true
          },
          {
            "text": "def detect_logic_gaps(self) -&gt; List[Node]:",
            "lineNumber": 75
          },
          {
            "lineNumber": 141
          },
          {
            "text": "        ",
            "lineNumber": 142
          },
          {
            "text": "        return gaps",
            "lineNumber": 143
          },
          {
            "lineNumber": 144
          },
          {
            "text": "    def apply_logic_gap_detection(self) -&gt; 'Flowchart':",
            "lineNumber": 145
          },
          {
            "text": "        \"\"\"è«–ç†ã®ç©´ã‚’æ¤œå‡ºã—ã€MISSINGãƒãƒ¼ãƒ‰ã¨ã—ã¦è¿½åŠ \"\"\"",
            "lineNumber": 146
          },
          {
            "text": "        gaps = self.detect_logic_gaps()",
            "lineNumber": 147
          },
          {
            "text": "        ",
            "lineNumber": 148
          },
          {
            "text": "        if not gaps:",
            "lineNumber": 149
          },
          {
            "text": "            return self",
            "lineNumber": 150
          },
          {
            "text": "        ",
            "lineNumber": 151
          },
          {
            "text": "        # æ—¢å­˜ã®ãƒãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼",
            "lineNumber": 152
          },
          {
            "text": "        new_nodes = [Node(**node.model_dump()) for node in self.nodes]",
            "lineNumber": 153
          },
          {
            "text": "        new_edges = [Edge(**edge.model_dump()) for edge in self.edges]",
            "lineNumber": 154
          },
          {
            "text": "        ",
            "lineNumber": 155
          },
          {
            "text": "        # ã‚®ãƒ£ãƒƒãƒ—ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã¾ãŸã¯æ›´æ–°",
            "lineNumber": 156
          },
          {
            "text": "        existing_ids = {node.id for node in new_nodes}",
            "lineNumber": 157
          },
          {
            "text": "        for gap in gaps:",
            "lineNumber": 158
          },
          {
            "text": "            if gap.id not in existing_ids:",
            "lineNumber": 159
          },
          {
            "text": "                new_nodes.append(gap)",
            "lineNumber": 160
          },
          {
            "text": "            else:",
            "lineNumber": 161
          },
          {
            "text": "                # æ—¢å­˜ãƒãƒ¼ãƒ‰ã‚’MISSINGã¨ã—ã¦æ›´æ–°",
            "lineNumber": 162
          },
          {
            "text": "                for i, node in enumerate(new_nodes):",
            "lineNumber": 163
          },
          {
            "text": "                    if node.id == gap.id:",
            "lineNumber": 164
          },
          {
            "text": "                        new_nodes[i] = Node(",
            "lineNumber": 165
          },
          {
            "text": "                            id=node.id,",
            "lineNumber": 166
          },
          {
            "text": "                            label=node.label,",
            "lineNumber": 167
          },
          {
            "text": "                            type=\"missing\",",
            "lineNumber": 168
          },
          {
            "text": "                            status=NodeStatus.MISSING",
            "lineNumber": 169
          },
          {
            "text": "                        )",
            "lineNumber": 170
          },
          {
            "text": "                        break",
            "lineNumber": 171
          },
          {
            "text": "        ",
            "lineNumber": 172
          },
          {
            "text": "        return Flowchart(nodes=new_nodes, edges=new_edges)",
            "lineNumber": 173
          },
          {
            "lineNumber": 174
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 175
          },
          {
            "text": "    def _get_node_shape(node_type: str) -&gt; str:",
            "lineNumber": 176
          },
          {
            "text": "        \"\"\"ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸMermaidå½¢çŠ¶ã‚’è¿”ã™\"\"\"",
            "lineNumber": 177
          },
          {
            "text": "        shape_map = {",
            "lineNumber": 178
          },
          {
            "text": "            \"start\": \"([ ])\",",
            "lineNumber": 179
          },
          {
            "text": "            \"end\": \"([ ])\",",
            "lineNumber": 180
          },
          {
            "text": "            \"process\": \"[ ]\",",
            "lineNumber": 181
          },
          {
            "text": "            \"decision\": \"{ }\",",
            "lineNumber": 182
          },
          {
            "text": "            \"io_data\": \"[/ /]\",",
            "lineNumber": 183
          },
          {
            "text": "            \"storage\": \"[( )]\",",
            "lineNumber": 184
          },
          {
            "text": "            \"missing\": \"{{ }}\"",
            "lineNumber": 185
          },
          {
            "text": "        }",
            "lineNumber": 186
          },
          {
            "text": "        return shape_map.get(node_type.lower(), \"{{ }}\")  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯MISSING",
            "lineNumber": 187
          },
          {
            "lineNumber": 188
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 189
          },
          {
            "text": "    def _get_status_color(status: NodeStatus) -&gt; str:",
            "lineNumber": 190
          },
          {
            "text": "        ",
            "lineNumber": 191
          }
        ]
      },
      "score": 0.27948546409606934
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\Project.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 31
          }
        },
        "contents": "ã“ã‚Œã¾ã§ã®è­°è«–ã‚’çµ±åˆã—ã€æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¼ç”»ä»•æ§˜æ›¸ï¼ˆè¦ä»¶å®šç¾©æ›¸ï¼‰ã®åˆæ¡ˆã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€å®Ÿè£…ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ãŠã‚ˆã³ã€å…¬é–‹æ™‚ã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã®è§£èª¬è³‡æ–™ã¨ã—ã¦ã‚‚æ´»ç”¨ã§ãã‚‹æ§‹æˆã«ã—ã¦ã„ã¾ã™ã€‚\n\n---\n\n# ä¼ç”»ä»•æ§˜æ›¸ï¼šTOON-Flow Visualizer (ä»®)\n\n**ã€œAIã«ã‚ˆã‚‹å¯¾è©±å‹ãƒ­ã‚¸ãƒƒã‚¯æ§‹é€ åŒ–ãƒ»è¦–è¦šåŒ–ã‚·ã‚¹ãƒ†ãƒ ã€œ**\n\n## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èƒŒæ™¯ã¨ç›®çš„\n\nè‡ªç„¶è¨€èªã«ã‚ˆã‚‹æŒ‡ç¤ºã‚„çŠ¶æ³èª¬æ˜ï¼ˆä¾‹ï¼šã€ŒJARVISãŒãŠã‹ã—ã„ã€ï¼‰ã¯æ›–æ˜§ã§ã‚ã‚Šã€è«–ç†çš„ãªæ¬ è½ã‚„çŸ›ç›¾ã‚’å«ã¿ã‚„ã™ã„ã€‚æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€AIã¨ã®å¯¾è©±ã‚’é€šã˜ã¦ã“ã‚Œã‚‰ã®æ›–æ˜§ãªæƒ…å ±ã‚’**TOONï¼ˆToken-Oriented Object Notationï¼‰**å½¢å¼ã§æ§‹é€ åŒ–ã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆåŒ–ã™ã‚‹ã“ã¨ã§ã€**ã€Œæ€è€ƒã®ãƒã‚°ï¼ˆæœªå®Ÿè£…ãƒ»çŸ›ç›¾ï¼‰ã€ã‚’è¦–è¦šçš„ã«ç‰¹å®šãƒ»è§£æ¶ˆã™ã‚‹**ã“ã¨ã‚’ç›®çš„ã¨ã™ã‚‹ã€‚\n\n## 2. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£\n\nä¿¡é ¼æ€§ã¨åŠ¹ç‡ã‚’ä¸¡ç«‹ã•ã›ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®2æ®µéšAIãƒ—ãƒ­ã‚»ã‚¹ã‚’æ¡ç”¨ã™ã‚‹ã€‚\n\n1. **Semantic Layer (å¤§å‹LLM):** ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‡ªç”±å…¥åŠ›ã‚’å—ã‘å–ã‚Šã€æ–‡è„ˆã‚’ç†è§£ã—ã¦TOONå½¢å¼ï¼ˆMarkdownãƒ™ãƒ¼ã‚¹ï¼‰ã®ãƒ­ã‚°ã‚’ç”Ÿæˆãƒ»è¿½è¨˜ã™ã‚‹ã€‚\n2. **Structural Layer (è»½é‡LLM/Gemmaç­‰):** TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æã—ã€ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã®é–¢ä¿‚ã‚’æŠ½å‡ºã—ã¦JSONãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›ã™ã‚‹ã€‚\n3. **Visualization Layer (ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹):** æŠ½å‡ºã•ã‚ŒãŸJSONã«åŸºã¥ãã€å®šç¾©ã•ã‚ŒãŸå¯¾å¿œè¡¨ï¼ˆTOON-Mermaidå¯¾å¿œè¡¨ï¼‰ã«å¾“ã£ã¦Mermaid.jsã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã€Streamlitä¸Šã«æç”»ã™ã‚‹ã€‚\n\n---\n\n## 3. æ©Ÿèƒ½è¦ä»¶\n\n### 3.1 å¯¾è©±å‹TOONæ§‹ç¯‰æ©Ÿèƒ½\n\n* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®ãƒãƒ£ãƒƒãƒˆã‚’é€šã˜ã¦æƒ…å ±ã‚’åé›†ã—ã€Markdownãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ&#96;.md&#96;ï¼‰ã«å·®åˆ†è¿½è¨˜ï¼ˆLoggingï¼‰ã™ã‚‹ã€‚\n* ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã«æ—¢å­˜ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€éå»ã®æ–‡è„ˆã‚’ç¶­æŒã™ã‚‹ã€‚\n\n### 3.2 è¦–è¦šçš„æ‹¡å¼µï¼ˆå›³è§£ï¼‰æ©Ÿèƒ½",
        "signatures": {},
        "detailedLines": [
          {
            "text": "ã“ã‚Œã¾ã§ã®è­°è«–ã‚’çµ±åˆã—ã€æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¼ç”»ä»•æ§˜æ›¸ï¼ˆè¦ä»¶å®šç¾©æ›¸ï¼‰ã®åˆæ¡ˆã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€å®Ÿè£…ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ãŠã‚ˆã³ã€å…¬é–‹æ™‚ã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã®è§£èª¬è³‡æ–™ã¨ã—ã¦ã‚‚æ´»ç”¨ã§ãã‚‹æ§‹æˆã«ã—ã¦ã„ã¾ã™ã€‚",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "---",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "# ä¼ç”»ä»•æ§˜æ›¸ï¼šTOON-Flow Visualizer (ä»®)",
            "lineNumber": 5
          },
          {
            "lineNumber": 6
          },
          {
            "text": "**ã€œAIã«ã‚ˆã‚‹å¯¾è©±å‹ãƒ­ã‚¸ãƒƒã‚¯æ§‹é€ åŒ–ãƒ»è¦–è¦šåŒ–ã‚·ã‚¹ãƒ†ãƒ ã€œ**",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èƒŒæ™¯ã¨ç›®çš„",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "text": "è‡ªç„¶è¨€èªã«ã‚ˆã‚‹æŒ‡ç¤ºã‚„çŠ¶æ³èª¬æ˜ï¼ˆä¾‹ï¼šã€ŒJARVISãŒãŠã‹ã—ã„ã€ï¼‰ã¯æ›–æ˜§ã§ã‚ã‚Šã€è«–ç†çš„ãªæ¬ è½ã‚„çŸ›ç›¾ã‚’å«ã¿ã‚„ã™ã„ã€‚æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€AIã¨ã®å¯¾è©±ã‚’é€šã˜ã¦ã“ã‚Œã‚‰ã®æ›–æ˜§ãªæƒ…å ±ã‚’**TOONï¼ˆToken-Oriented Object Notationï¼‰**å½¢å¼ã§æ§‹é€ åŒ–ã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆåŒ–ã™ã‚‹ã“ã¨ã§ã€**ã€Œæ€è€ƒã®ãƒã‚°ï¼ˆæœªå®Ÿè£…ãƒ»çŸ›ç›¾ï¼‰ã€ã‚’è¦–è¦šçš„ã«ç‰¹å®šãƒ»è§£æ¶ˆã™ã‚‹**ã“ã¨ã‚’ç›®çš„ã¨ã™ã‚‹ã€‚",
            "lineNumber": 11
          },
          {
            "lineNumber": 12
          },
          {
            "text": "## 2. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£",
            "lineNumber": 13
          },
          {
            "lineNumber": 14
          },
          {
            "text": "ä¿¡é ¼æ€§ã¨åŠ¹ç‡ã‚’ä¸¡ç«‹ã•ã›ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®2æ®µéšAIãƒ—ãƒ­ã‚»ã‚¹ã‚’æ¡ç”¨ã™ã‚‹ã€‚",
            "lineNumber": 15
          },
          {
            "lineNumber": 16
          },
          {
            "text": "1. **Semantic Layer (å¤§å‹LLM):** ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‡ªç”±å…¥åŠ›ã‚’å—ã‘å–ã‚Šã€æ–‡è„ˆã‚’ç†è§£ã—ã¦TOONå½¢å¼ï¼ˆMarkdownãƒ™ãƒ¼ã‚¹ï¼‰ã®ãƒ­ã‚°ã‚’ç”Ÿæˆãƒ»è¿½è¨˜ã™ã‚‹ã€‚",
            "lineNumber": 17
          },
          {
            "text": "2. **Structural Layer (è»½é‡LLM/Gemmaç­‰):** TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æã—ã€ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã®é–¢ä¿‚ã‚’æŠ½å‡ºã—ã¦JSONãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›ã™ã‚‹ã€‚",
            "lineNumber": 18
          },
          {
            "text": "3. **Visualization Layer (ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹):** æŠ½å‡ºã•ã‚ŒãŸJSONã«åŸºã¥ãã€å®šç¾©ã•ã‚ŒãŸå¯¾å¿œè¡¨ï¼ˆTOON-Mermaidå¯¾å¿œè¡¨ï¼‰ã«å¾“ã£ã¦Mermaid.jsã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã€Streamlitä¸Šã«æç”»ã™ã‚‹ã€‚",
            "lineNumber": 19
          },
          {
            "lineNumber": 20
          },
          {
            "text": "---",
            "lineNumber": 21
          },
          {
            "lineNumber": 22
          },
          {
            "text": "## 3. æ©Ÿèƒ½è¦ä»¶",
            "lineNumber": 23
          },
          {
            "lineNumber": 24
          },
          {
            "text": "### 3.1 å¯¾è©±å‹TOONæ§‹ç¯‰æ©Ÿèƒ½",
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "text": "* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®ãƒãƒ£ãƒƒãƒˆã‚’é€šã˜ã¦æƒ…å ±ã‚’åé›†ã—ã€Markdownãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ&#96;.md&#96;ï¼‰ã«å·®åˆ†è¿½è¨˜ï¼ˆLoggingï¼‰ã™ã‚‹ã€‚",
            "lineNumber": 27
          },
          {
            "text": "* ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã«æ—¢å­˜ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€éå»ã®æ–‡è„ˆã‚’ç¶­æŒã™ã‚‹ã€‚",
            "lineNumber": 28
          },
          {
            "lineNumber": 29
          },
          {
            "text": "### 3.2 è¦–è¦šçš„æ‹¡å¼µï¼ˆå›³è§£ï¼‰æ©Ÿèƒ½",
            "lineNumber": 30
          }
        ]
      },
      "score": 0.27752581238746643
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 304,
            "column": 26
          },
          "endPosition": {
            "line": 327,
            "column": 40
          }
        },
        "contents": "        \n        st.divider()\n    \n    # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®é¸æŠ\n    append_mode = st.checkbox(\n        \"æ—¢å­˜TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†è¿½è¨˜ï¼ˆLOGï¼‰\",\n        help=\"ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã¨ã€æ—¢å­˜ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«æ–°ã—ã„ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã‚’è¿½åŠ ã—ã¾ã™ã€‚\"\n    )\n    \n    user_prompt = st.text_area(\n        \"ã©ã®ã‚ˆã†ãªãƒ—ãƒ­ã‚»ã‚¹ã‚’å¯è¦–åŒ–ã—ãŸã„ã§ã™ã‹ï¼Ÿ\", \n        placeholder=\"ä¾‹ï¼šãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®æ•…éšœè¨ºæ–­æ‰‹é †ã‚’ãƒ•ãƒ­ãƒ¼ã«ã—ã¦\",\n        help=\"è‡ªç„¶è¨€èªã§å…¥åŠ›ã™ã‚‹ã¨LLMãŒTOONå½¢å¼ã‚’ç”Ÿæˆã—ã€ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’æ›´æ–°ã—ã¾ã™ã€‚\",\n        height=150\n    )\n    \n    if st.button(\"ãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆ\", type=\"primary\", use_container_width=True):\n        if user_prompt:\n            with st.spinner(\"LLMãŒãƒ•ãƒ­ãƒ¼ã‚’è¨­è¨ˆä¸­...\"):\n                raw_toon_text = \"\"\n                try:\n                    # LLMã¨ã®é€šä¿¡\n                    client = LLMClient()",
        "signatures": {},
        "detailedLines": [
          {
            "text": "        ",
            "lineNumber": 306
          },
          {
            "text": "        st.divider()",
            "lineNumber": 307
          },
          {
            "text": "    ",
            "lineNumber": 308
          },
          {
            "text": "    # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®é¸æŠ",
            "lineNumber": 309
          },
          {
            "text": "    append_mode = st.checkbox(",
            "lineNumber": 310
          },
          {
            "text": "        \"æ—¢å­˜TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†è¿½è¨˜ï¼ˆLOGï¼‰\",",
            "lineNumber": 311
          },
          {
            "text": "        help=\"ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã¨ã€æ—¢å­˜ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«æ–°ã—ã„ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã‚’è¿½åŠ ã—ã¾ã™ã€‚\"",
            "lineNumber": 312
          },
          {
            "text": "    )",
            "lineNumber": 313
          },
          {
            "text": "    ",
            "lineNumber": 314
          },
          {
            "text": "    user_prompt = st.text_area(",
            "lineNumber": 315
          },
          {
            "text": "        \"ã©ã®ã‚ˆã†ãªãƒ—ãƒ­ã‚»ã‚¹ã‚’å¯è¦–åŒ–ã—ãŸã„ã§ã™ã‹ï¼Ÿ\", ",
            "lineNumber": 316
          },
          {
            "text": "        placeholder=\"ä¾‹ï¼šãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®æ•…éšœè¨ºæ–­æ‰‹é †ã‚’ãƒ•ãƒ­ãƒ¼ã«ã—ã¦\",",
            "lineNumber": 317
          },
          {
            "text": "        help=\"è‡ªç„¶è¨€èªã§å…¥åŠ›ã™ã‚‹ã¨LLMãŒTOONå½¢å¼ã‚’ç”Ÿæˆã—ã€ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’æ›´æ–°ã—ã¾ã™ã€‚\",",
            "lineNumber": 318
          },
          {
            "text": "        height=150",
            "lineNumber": 319
          },
          {
            "text": "    )",
            "lineNumber": 320
          },
          {
            "text": "    ",
            "lineNumber": 321
          },
          {
            "text": "    if st.button(\"ãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆ\", type=\"primary\", use_container_width=True):",
            "lineNumber": 322
          },
          {
            "text": "        if user_prompt:",
            "lineNumber": 323
          },
          {
            "text": "            with st.spinner(\"LLMãŒãƒ•ãƒ­ãƒ¼ã‚’è¨­è¨ˆä¸­...\"):",
            "lineNumber": 324
          },
          {
            "text": "                raw_toon_text = \"\"",
            "lineNumber": 325
          },
          {
            "text": "                try:",
            "lineNumber": 326
          },
          {
            "text": "                    # LLMã¨ã®é€šä¿¡",
            "lineNumber": 327
          },
          {
            "text": "                    client = LLMClient()",
            "lineNumber": 328
          }
        ]
      },
      "score": 0.2710660696029663
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\mermaid_parser.py",
        "range": {
          "startPosition": {
            "line": 5
          },
          "endPosition": {
            "line": 178
          }
        },
        "contents": "class MermaidParser:\n@staticmethod\ndef parse(mermaid_text: str) -&gt; Flowchart:\n\n            for pattern in node_patterns:\n                node_match = re.match(pattern, line)\n                if node_match:\n                    node_id = node_match.group(1)\n                    label = node_match.group(2)\n                    \n                    # å½¢çŠ¶ã‹ã‚‰ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š\n                    if '{' in line and '}' in line:\n                        node_type = \"decision\"\n                    elif '(' in line and ')' in line:\n                        # ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ã¾ãŸã¯å††ç­’å½¢\n                        if node_id == \"start\" or (not nodes and node_id != \"node_end\"):\n                            node_type = \"start\"\n                        elif node_id == \"node_end\" or node_id.endswith(\"_end\"):\n                            node_type = \"end\"\n                        else:\n                            node_type = \"process\"\n                    elif '/' in line:\n                        node_type = \"io_data\"\n                    else:\n                        node_type = \"process\"\n                    \n                    # IDãŒ'end'ã®å ´åˆã¯'node_end'ã«å¤‰æ›\n                    safe_id = \"node_end\" if node_id.lower() == \"end\" else node_id\n                    \n                    # æ—¢ã«å­˜åœ¨ã™ã‚‹ãƒãƒ¼ãƒ‰ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆé‡è¤‡ã‚’é˜²ãï¼‰\n                    if safe_id not in [n.id for n in nodes]:\n                        node = Node(\n                            id=safe_id,\n                            label=label.strip(),\n                            type=node_type,\n                            status=NodeStatus.ACTIVE\n                        )\n                        nodes.append(node)\n                        node_map[node_id] = node\n                    node_found = True\n                    break\n            \n            if node_found:\n                continue\n            \n            # ã‚¨ãƒƒã‚¸å®šç¾©: source--&gt;target ã¾ãŸã¯ source--&gt;|\"label\"|target",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 6,
                "column": 1
              },
              "endPosition": {
                "line": 7,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 9,
                "column": 5
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 10,
                "column": 5
              },
              "endPosition": {
                "line": 11,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class MermaidParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 9
          },
          {
            "text": "def parse(mermaid_text: str) -&gt; Flowchart:",
            "lineNumber": 10
          },
          {
            "lineNumber": 61
          },
          {
            "text": "            for pattern in node_patterns:",
            "lineNumber": 62
          },
          {
            "text": "                node_match = re.match(pattern, line)",
            "lineNumber": 63
          },
          {
            "text": "                if node_match:",
            "lineNumber": 64
          },
          {
            "text": "                    node_id = node_match.group(1)",
            "lineNumber": 65
          },
          {
            "text": "                    label = node_match.group(2)",
            "lineNumber": 66
          },
          {
            "text": "                    ",
            "lineNumber": 67
          },
          {
            "text": "                    # å½¢çŠ¶ã‹ã‚‰ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š",
            "lineNumber": 68
          },
          {
            "text": "                    if '{' in line and '}' in line:",
            "lineNumber": 69
          },
          {
            "text": "                        node_type = \"decision\"",
            "lineNumber": 70
          },
          {
            "text": "                    elif '(' in line and ')' in line:",
            "lineNumber": 71
          },
          {
            "text": "                        # ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ã¾ãŸã¯å††ç­’å½¢",
            "lineNumber": 72
          },
          {
            "text": "                        if node_id == \"start\" or (not nodes and node_id != \"node_end\"):",
            "lineNumber": 73
          },
          {
            "text": "                            node_type = \"start\"",
            "lineNumber": 74
          },
          {
            "text": "                        elif node_id == \"node_end\" or node_id.endswith(\"_end\"):",
            "lineNumber": 75
          },
          {
            "text": "                            node_type = \"end\"",
            "lineNumber": 76
          },
          {
            "text": "                        else:",
            "lineNumber": 77
          },
          {
            "text": "                            node_type = \"process\"",
            "lineNumber": 78
          },
          {
            "text": "                    elif '/' in line:",
            "lineNumber": 79
          },
          {
            "text": "                        node_type = \"io_data\"",
            "lineNumber": 80
          },
          {
            "text": "                    else:",
            "lineNumber": 81
          },
          {
            "text": "                        node_type = \"process\"",
            "lineNumber": 82
          },
          {
            "text": "                    ",
            "lineNumber": 83
          },
          {
            "text": "                    # IDãŒ'end'ã®å ´åˆã¯'node_end'ã«å¤‰æ›",
            "lineNumber": 84
          },
          {
            "text": "                    safe_id = \"node_end\" if node_id.lower() == \"end\" else node_id",
            "lineNumber": 85
          },
          {
            "text": "                    ",
            "lineNumber": 86
          },
          {
            "text": "                    # æ—¢ã«å­˜åœ¨ã™ã‚‹ãƒãƒ¼ãƒ‰ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆé‡è¤‡ã‚’é˜²ãï¼‰",
            "lineNumber": 87
          },
          {
            "text": "                    if safe_id not in [n.id for n in nodes]:",
            "lineNumber": 88
          },
          {
            "text": "                        node = Node(",
            "lineNumber": 89
          },
          {
            "text": "                            id=safe_id,",
            "lineNumber": 90
          },
          {
            "text": "                            label=label.strip(),",
            "lineNumber": 91
          },
          {
            "text": "                            type=node_type,",
            "lineNumber": 92
          },
          {
            "text": "                            status=NodeStatus.ACTIVE",
            "lineNumber": 93
          },
          {
            "text": "                        )",
            "lineNumber": 94
          },
          {
            "text": "                        nodes.append(node)",
            "lineNumber": 95
          },
          {
            "text": "                        node_map[node_id] = node",
            "lineNumber": 96
          },
          {
            "text": "                    node_found = True",
            "lineNumber": 97
          },
          {
            "text": "                    break",
            "lineNumber": 98
          },
          {
            "text": "            ",
            "lineNumber": 99
          },
          {
            "text": "            if node_found:",
            "lineNumber": 100
          },
          {
            "text": "                continue",
            "lineNumber": 101
          },
          {
            "text": "            ",
            "lineNumber": 102
          },
          {
            "text": "            # ã‚¨ãƒƒã‚¸å®šç¾©: source--&gt;target ã¾ãŸã¯ source--&gt;|\"label\"|target",
            "lineNumber": 103
          }
        ]
      },
      "score": 0.2671906054019928
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\mermaid_parser.py",
        "range": {
          "startPosition": {
            "line": 5
          },
          "endPosition": {
            "line": 178
          }
        },
        "contents": "class MermaidParser:\n@staticmethod\ndef parse(mermaid_text: str) -&gt; Flowchart:\n\n        for line in lines:\n            # ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—\n            if line.startswith('%%'):\n                continue\n            \n            # styleè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆå¾Œã§å‡¦ç†ï¼‰\n            if line.startswith('style '):\n                continue\n            \n            # subgraphã®é–‹å§‹/çµ‚äº†ã‚’æ¤œå‡º\n            if line.startswith('subgraph '):\n                in_subgraph = True\n                continue\n            if line.strip() == 'end':\n                in_subgraph = False\n                continue\n            \n            # ãƒãƒ¼ãƒ‰å®šç¾©: id[\"label\"] ã¾ãŸã¯ id{\"label\"} ã¾ãŸã¯ id[(\"label\")]\n            # ã‚ˆã‚ŠæŸ”è»Ÿãªãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°\n            node_patterns = [\n                r'(\\w+)\\[\\([\"\\']([^\"\\']+)[\"\\']\\)\\]',  # id[(\"label\")]\n                r'(\\w+)\\[/[\"\\']([^\"\\']+)[\"\\']/\\]',     # id[/\"label\"/]\n                r'(\\w+)\\[[\"\\']([^\"\\']+)[\"\\']\\]',       # id[\"label\"]\n                r'(\\w+)\\{[\"\\']([^\"\\']+)[\"\\']\\}',       # id{\"label\"}\n                r'(\\w+)\\[\\(([^)]+)\\)\\]',                # id[(label)]\n                r'(\\w+)\\[([^\\]]+)\\]',                   # id[label]\n                r'(\\w+)\\{([^}]+)\\}',                    # id{label}\n            ]\n            \n            node_found = False\n            for pattern in node_patterns:\n                node_match = re.match(pattern, line)",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 6,
                "column": 1
              },
              "endPosition": {
                "line": 7,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 9,
                "column": 5
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 10,
                "column": 5
              },
              "endPosition": {
                "line": 11,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class MermaidParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 9
          },
          {
            "text": "def parse(mermaid_text: str) -&gt; Flowchart:",
            "lineNumber": 10
          },
          {
            "lineNumber": 31
          },
          {
            "text": "        for line in lines:",
            "lineNumber": 32
          },
          {
            "text": "            # ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—",
            "lineNumber": 33
          },
          {
            "text": "            if line.startswith('%%'):",
            "lineNumber": 34
          },
          {
            "text": "                continue",
            "lineNumber": 35
          },
          {
            "text": "            ",
            "lineNumber": 36
          },
          {
            "text": "            # styleè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆå¾Œã§å‡¦ç†ï¼‰",
            "lineNumber": 37
          },
          {
            "text": "            if line.startswith('style '):",
            "lineNumber": 38
          },
          {
            "text": "                continue",
            "lineNumber": 39
          },
          {
            "text": "            ",
            "lineNumber": 40
          },
          {
            "text": "            # subgraphã®é–‹å§‹/çµ‚äº†ã‚’æ¤œå‡º",
            "lineNumber": 41
          },
          {
            "text": "            if line.startswith('subgraph '):",
            "lineNumber": 42
          },
          {
            "text": "                in_subgraph = True",
            "lineNumber": 43
          },
          {
            "text": "                continue",
            "lineNumber": 44
          },
          {
            "text": "            if line.strip() == 'end':",
            "lineNumber": 45
          },
          {
            "text": "                in_subgraph = False",
            "lineNumber": 46
          },
          {
            "text": "                continue",
            "lineNumber": 47
          },
          {
            "text": "            ",
            "lineNumber": 48
          },
          {
            "text": "            # ãƒãƒ¼ãƒ‰å®šç¾©: id[\"label\"] ã¾ãŸã¯ id{\"label\"} ã¾ãŸã¯ id[(\"label\")]",
            "lineNumber": 49
          },
          {
            "text": "            # ã‚ˆã‚ŠæŸ”è»Ÿãªãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°",
            "lineNumber": 50
          },
          {
            "text": "            node_patterns = [",
            "lineNumber": 51
          },
          {
            "text": "                r'(\\w+)\\[\\([\"\\']([^\"\\']+)[\"\\']\\)\\]',  # id[(\"label\")]",
            "lineNumber": 52
          },
          {
            "text": "                r'(\\w+)\\[/[\"\\']([^\"\\']+)[\"\\']/\\]',     # id[/\"label\"/]",
            "lineNumber": 53
          },
          {
            "text": "                r'(\\w+)\\[[\"\\']([^\"\\']+)[\"\\']\\]',       # id[\"label\"]",
            "lineNumber": 54
          },
          {
            "text": "                r'(\\w+)\\{[\"\\']([^\"\\']+)[\"\\']\\}',       # id{\"label\"}",
            "lineNumber": 55
          },
          {
            "text": "                r'(\\w+)\\[\\(([^)]+)\\)\\]',                # id[(label)]",
            "lineNumber": 56
          },
          {
            "text": "                r'(\\w+)\\[([^\\]]+)\\]',                   # id[label]",
            "lineNumber": 57
          },
          {
            "text": "                r'(\\w+)\\{([^}]+)\\}',                    # id{label}",
            "lineNumber": 58
          },
          {
            "text": "            ]",
            "lineNumber": 59
          },
          {
            "text": "            ",
            "lineNumber": 60
          },
          {
            "text": "            node_found = False",
            "lineNumber": 61
          },
          {
            "text": "            for pattern in node_patterns:",
            "lineNumber": 62
          },
          {
            "text": "                node_match = re.match(pattern, line)",
            "lineNumber": 63
          }
        ]
      },
      "score": 0.2621254026889801
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\mermaid_parser.py",
        "range": {
          "startPosition": {
            "line": 5
          },
          "endPosition": {
            "line": 178,
            "column": 24
          }
        },
        "contents": "class MermaidParser:\n@staticmethod\ndef parse(mermaid_text: str) -&gt; Flowchart:\n\n        \n        if \"end\" not in node_types:\n            # endãƒãƒ¼ãƒ‰ãŒãªã„å ´åˆã€node_endãŒã‚ã‚Œã°ãã‚Œã‚’endã«è¨­å®š\n            end_node = next((n for n in nodes if n.id == \"node_end\"), None)\n            if end_node:\n                end_node.type = \"end\"\n            else:\n                # çµ‚äº†ãƒãƒ¼ãƒ‰ãŒãªã„å ´åˆã€æœ€å¾Œã®ãƒãƒ¼ãƒ‰ã‚’endã«è¨­å®š\n                if nodes:\n                    nodes[-1].type = \"end\"\n        \n        return Flowchart(nodes=nodes, edges=edges)\n    \n    @staticmethod\n    def _determine_node_type(shape_start: str, shape_end: str) -&gt; str:\n        \"\"\"\n        Mermaidã®å½¢çŠ¶ã‹ã‚‰ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®šã—ã¾ã™ã€‚\n        \n        Args:\n            shape_start: å½¢çŠ¶ã®é–‹å§‹æ–‡å­—ï¼ˆ[, {, (ï¼‰\n            shape_end: å½¢çŠ¶ã®çµ‚äº†æ–‡å­—ï¼ˆ], }, )ï¼‰\n            \n        Returns:\n            ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ï¼ˆstart, end, process, decisionï¼‰\n        \"\"\"\n        # ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ ([ ]) -&gt; start/end\n        if shape_start == \"(\" and shape_end == \")\":\n            return \"start\"  # æœ€åˆã«è¦‹ã¤ã‹ã£ãŸã‚‚ã®ã¯startã€æœ€å¾Œã¯endã«è¨­å®šã•ã‚Œã‚‹\n        \n        # è±å½¢ { } -&gt; decision\n        if shape_start == \"{\" and shape_end == \"}\":\n            return \"decision\"\n        \n        # é•·æ–¹å½¢ [ ] -&gt; process\n        if shape_start == \"[\" and shape_end == \"]\":\n            return \"process\"\n        \n        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯process\n        return \"process\"",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 6,
                "column": 1
              },
              "endPosition": {
                "line": 7,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 9,
                "column": 5
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 10,
                "column": 5
              },
              "endPosition": {
                "line": 11,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class MermaidParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 9
          },
          {
            "text": "def parse(mermaid_text: str) -&gt; Flowchart:",
            "lineNumber": 10
          },
          {
            "lineNumber": 140
          },
          {
            "text": "        ",
            "lineNumber": 141
          },
          {
            "text": "        if \"end\" not in node_types:",
            "lineNumber": 142
          },
          {
            "text": "            # endãƒãƒ¼ãƒ‰ãŒãªã„å ´åˆã€node_endãŒã‚ã‚Œã°ãã‚Œã‚’endã«è¨­å®š",
            "lineNumber": 143
          },
          {
            "text": "            end_node = next((n for n in nodes if n.id == \"node_end\"), None)",
            "lineNumber": 144
          },
          {
            "text": "            if end_node:",
            "lineNumber": 145
          },
          {
            "text": "                end_node.type = \"end\"",
            "lineNumber": 146
          },
          {
            "text": "            else:",
            "lineNumber": 147
          },
          {
            "text": "                # çµ‚äº†ãƒãƒ¼ãƒ‰ãŒãªã„å ´åˆã€æœ€å¾Œã®ãƒãƒ¼ãƒ‰ã‚’endã«è¨­å®š",
            "lineNumber": 148
          },
          {
            "text": "                if nodes:",
            "lineNumber": 149
          },
          {
            "text": "                    nodes[-1].type = \"end\"",
            "lineNumber": 150
          },
          {
            "text": "        ",
            "lineNumber": 151
          },
          {
            "text": "        return Flowchart(nodes=nodes, edges=edges)",
            "lineNumber": 152
          },
          {
            "text": "    ",
            "lineNumber": 153
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 154
          },
          {
            "text": "    def _determine_node_type(shape_start: str, shape_end: str) -&gt; str:",
            "lineNumber": 155
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 156
          },
          {
            "text": "        Mermaidã®å½¢çŠ¶ã‹ã‚‰ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®šã—ã¾ã™ã€‚",
            "lineNumber": 157
          },
          {
            "text": "        ",
            "lineNumber": 158
          },
          {
            "text": "        Args:",
            "lineNumber": 159
          },
          {
            "text": "            shape_start: å½¢çŠ¶ã®é–‹å§‹æ–‡å­—ï¼ˆ[, {, (ï¼‰",
            "lineNumber": 160
          },
          {
            "text": "            shape_end: å½¢çŠ¶ã®çµ‚äº†æ–‡å­—ï¼ˆ], }, )ï¼‰",
            "lineNumber": 161
          },
          {
            "text": "            ",
            "lineNumber": 162
          },
          {
            "text": "        Returns:",
            "lineNumber": 163
          },
          {
            "text": "            ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ï¼ˆstart, end, process, decisionï¼‰",
            "lineNumber": 164
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 165
          },
          {
            "text": "        # ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ ([ ]) -&gt; start/end",
            "lineNumber": 166
          },
          {
            "text": "        if shape_start == \"(\" and shape_end == \")\":",
            "lineNumber": 167
          },
          {
            "text": "            return \"start\"  # æœ€åˆã«è¦‹ã¤ã‹ã£ãŸã‚‚ã®ã¯startã€æœ€å¾Œã¯endã«è¨­å®šã•ã‚Œã‚‹",
            "lineNumber": 168
          },
          {
            "text": "        ",
            "lineNumber": 169
          },
          {
            "text": "        # è±å½¢ { } -&gt; decision",
            "lineNumber": 170
          },
          {
            "text": "        if shape_start == \"{\" and shape_end == \"}\":",
            "lineNumber": 171
          },
          {
            "text": "            return \"decision\"",
            "lineNumber": 172
          },
          {
            "text": "        ",
            "lineNumber": 173
          },
          {
            "text": "        # é•·æ–¹å½¢ [ ] -&gt; process",
            "lineNumber": 174
          },
          {
            "text": "        if shape_start == \"[\" and shape_end == \"]\":",
            "lineNumber": 175
          },
          {
            "text": "            return \"process\"",
            "lineNumber": 176
          },
          {
            "text": "        ",
            "lineNumber": 177
          },
          {
            "text": "        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯process",
            "lineNumber": 178
          },
          {
            "text": "        return \"process\"",
            "lineNumber": 179,
            "isSignature": true
          }
        ]
      },
      "score": 0.24453319609165192
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\tests\\test_schemas.py",
        "range": {
          "startPosition": {
            "line": 31
          },
          "endPosition": {
            "line": 170
          }
        },
        "contents": "class TestFlowchart:\n\n\n    def test_detect_logic_gaps_decision_no_outgoing(self):\n        nodes = [\n            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),\n            Node(id=\"decision1\", label=\"åˆ¤å®š\", type=\"decision\"),\n            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")\n        ]\n        edges = [\n            Edge(source=\"start\", target=\"decision1\")\n            # decision1ã‹ã‚‰å‡ºå£ãŒãªã„\n        ]\n        flowchart = Flowchart(nodes=nodes, edges=edges)\n        gaps = flowchart.detect_logic_gaps()\n        assert len(gaps) == 1\n        assert gaps[0].id == \"decision1\"\n\n    def test_detect_logic_gaps_missing_target(self):\n        nodes = [\n            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),\n            Node(id=\"process1\", label=\"å‡¦ç†\", type=\"process\"),\n            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")\n        ]\n        edges = [\n            Edge(source=\"start\", target=\"process1\"),\n            Edge(source=\"process1\", target=\"missing_node\")  # å­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰\n        ]\n        flowchart = Flowchart(nodes=nodes, edges=edges)\n        gaps = flowchart.detect_logic_gaps()\n        assert len(gaps) == 1\n        assert gaps[0].id == \"missing_missing_node\"\n        assert gaps[0].type == \"missing\"\n\n    def test_to_mermaid(self):\n        nodes = [\n            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),\n            Node(id=\"process1\", label=\"å‡¦ç†\", type=\"process\"),\n            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")\n        ]\n        edges = [\n            Edge(source=\"start\", target=\"process1\"),\n            Edge(source=\"process1\", target=\"node_end\")\n        ]\n        flowchart = Flowchart(nodes=nodes, edges=edges)\n        mermaid = flowchart.to_mermaid()\n        assert \"graph TD\" in mermaid\n        assert 'start[\"é–‹å§‹\"]' in mermaid\n        assert 'process1[\"å‡¦ç†\"]' in mermaid\n        assert 'start--&gt;process1' in mermaid\n\n    def test_to_toon_format(self):\n        nodes =",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 32,
                "column": 1
              },
              "endPosition": {
                "line": 33,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class TestFlowchart:",
            "lineNumber": 32,
            "isSignature": true
          },
          {
            "lineNumber": 110
          },
          {
            "lineNumber": 111
          },
          {
            "text": "    def test_detect_logic_gaps_decision_no_outgoing(self):",
            "lineNumber": 112
          },
          {
            "text": "        nodes = [",
            "lineNumber": 113
          },
          {
            "text": "            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),",
            "lineNumber": 114
          },
          {
            "text": "            Node(id=\"decision1\", label=\"åˆ¤å®š\", type=\"decision\"),",
            "lineNumber": 115
          },
          {
            "text": "            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")",
            "lineNumber": 116
          },
          {
            "text": "        ]",
            "lineNumber": 117
          },
          {
            "text": "        edges = [",
            "lineNumber": 118
          },
          {
            "text": "            Edge(source=\"start\", target=\"decision1\")",
            "lineNumber": 119
          },
          {
            "text": "            # decision1ã‹ã‚‰å‡ºå£ãŒãªã„",
            "lineNumber": 120
          },
          {
            "text": "        ]",
            "lineNumber": 121
          },
          {
            "text": "        flowchart = Flowchart(nodes=nodes, edges=edges)",
            "lineNumber": 122
          },
          {
            "text": "        gaps = flowchart.detect_logic_gaps()",
            "lineNumber": 123
          },
          {
            "text": "        assert len(gaps) == 1",
            "lineNumber": 124
          },
          {
            "text": "        assert gaps[0].id == \"decision1\"",
            "lineNumber": 125
          },
          {
            "lineNumber": 126
          },
          {
            "text": "    def test_detect_logic_gaps_missing_target(self):",
            "lineNumber": 127
          },
          {
            "text": "        nodes = [",
            "lineNumber": 128
          },
          {
            "text": "            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),",
            "lineNumber": 129
          },
          {
            "text": "            Node(id=\"process1\", label=\"å‡¦ç†\", type=\"process\"),",
            "lineNumber": 130
          },
          {
            "text": "            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")",
            "lineNumber": 131
          },
          {
            "text": "        ]",
            "lineNumber": 132
          },
          {
            "text": "        edges = [",
            "lineNumber": 133
          },
          {
            "text": "            Edge(source=\"start\", target=\"process1\"),",
            "lineNumber": 134
          },
          {
            "text": "            Edge(source=\"process1\", target=\"missing_node\")  # å­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰",
            "lineNumber": 135
          },
          {
            "text": "        ]",
            "lineNumber": 136
          },
          {
            "text": "        flowchart = Flowchart(nodes=nodes, edges=edges)",
            "lineNumber": 137
          },
          {
            "text": "        gaps = flowchart.detect_logic_gaps()",
            "lineNumber": 138
          },
          {
            "text": "        assert len(gaps) == 1",
            "lineNumber": 139
          },
          {
            "text": "        assert gaps[0].id == \"missing_missing_node\"",
            "lineNumber": 140
          },
          {
            "text": "        assert gaps[0].type == \"missing\"",
            "lineNumber": 141
          },
          {
            "lineNumber": 142
          },
          {
            "text": "    def test_to_mermaid(self):",
            "lineNumber": 143
          },
          {
            "text": "        nodes = [",
            "lineNumber": 144
          },
          {
            "text": "            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),",
            "lineNumber": 145
          },
          {
            "text": "            Node(id=\"process1\", label=\"å‡¦ç†\", type=\"process\"),",
            "lineNumber": 146
          },
          {
            "text": "            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")",
            "lineNumber": 147
          },
          {
            "text": "        ]",
            "lineNumber": 148
          },
          {
            "text": "        edges = [",
            "lineNumber": 149
          },
          {
            "text": "            Edge(source=\"start\", target=\"process1\"),",
            "lineNumber": 150
          },
          {
            "text": "            Edge(source=\"process1\", target=\"node_end\")",
            "lineNumber": 151
          },
          {
            "text": "        ]",
            "lineNumber": 152
          },
          {
            "text": "        flowchart = Flowchart(nodes=nodes, edges=edges)",
            "lineNumber": 153
          },
          {
            "text": "        mermaid = flowchart.to_mermaid()",
            "lineNumber": 154
          },
          {
            "text": "        assert \"graph TD\" in mermaid",
            "lineNumber": 155
          },
          {
            "text": "        assert 'start[\"é–‹å§‹\"]' in mermaid",
            "lineNumber": 156
          },
          {
            "text": "        assert 'process1[\"å‡¦ç†\"]' in mermaid",
            "lineNumber": 157
          },
          {
            "text": "        assert 'start--&gt;process1' in mermaid",
            "lineNumber": 158
          },
          {
            "lineNumber": 159
          },
          {
            "text": "    def test_to_toon_format(self):",
            "lineNumber": 160
          },
          {
            "text": "        nodes =",
            "lineNumber": 161
          }
        ]
      },
      "score": 0.24301695823669434
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\program_base.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 43
          }
        },
        "contents": "1ãƒ•ã‚¡ã‚¤ãƒ«1è²¬ä»»ã®åŸå‰‡ï¼ˆSRPï¼‰ã«åŸºã¥ãã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç‹¬ç«‹ã•ã›ã‚‹ã“ã¨ã§ã€**ã€ŒAIã®æŒ™å‹•ã‚’å¤‰ãˆãŸã„ã¨ãã€**ã¨**ã€Œå›³ã®è¦‹ãŸç›®ï¼ˆMermaidï¼‰ã‚’å¤‰ãˆãŸã„ã¨ãã€**ã‚’å®Œå…¨ã«åˆ‡ã‚Šåˆ†ã‘ã¦ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã§ãã‚‹æ§‹é€ ã‚’ææ¡ˆã—ã¾ã™ã€‚\n\n---\n\n## 1. æ¨å¥¨ã•ã‚Œã‚‹ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ \n\næ‹¡å¼µæ€§ã¨è¦‹é€šã—ã®è‰¯ã•ã‚’é‡è¦–ã—ãŸæ§‹æˆã§ã™ã€‚\n\n&#96;&#96;&#96;text\ntoon-flow-visualizer/\nâ”œâ”€â”€ app.py                # ã€Entry Pointã€‘Streamlitã®ãƒ¡ã‚¤ãƒ³UIãƒ»çŠ¶æ…‹ç®¡ç†\nâ”œâ”€â”€ core/                 # ã€Logicã€‘å…±é€šåŸºç›¤ãƒ»ãƒ‡ãƒ¼ã‚¿å®šç¾©\nâ”‚   â””â”€â”€ models.py         # ãƒãƒ¼ãƒ‰ã‚„ã‚¨ãƒƒã‚¸ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€  (Pydanticç­‰)\nâ”œâ”€â”€ parser/               # ã€Responsibility: è§£æã€‘\nâ”‚   â””â”€â”€ toon_parser.py    # Markdown(TOON)ã‹ã‚‰å†…éƒ¨ãƒ¢ãƒ‡ãƒ«ã¸ã®å¤‰æ›\nâ”œâ”€â”€ generator/            # ã€Responsibility: æç”»ç”Ÿæˆã€‘\nâ”‚   â””â”€â”€ mermaid_gen.py    # å†…éƒ¨ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰Mermaidæ§‹æ–‡ã¸ã®å¤‰æ›\nâ”œâ”€â”€ llm/                  # ã€Responsibility: AIå¯¾è©±ã€‘\nâ”‚   â””â”€â”€ agent.py          # å¤§å‹LLMã¸ã®æŒ‡ç¤ºã€TOONå·®åˆ†å–å¾—\nâ”œâ”€â”€ schema/               # ã€Assetsã€‘\nâ”‚   â””â”€â”€ template.md       # LLMã«æ¸¡ã™TOONã®åŸºæœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ\nâ””â”€â”€ data/                 # ã€Storageã€‘\n    â””â”€â”€ sessions/         # ä¿å­˜ã•ã‚ŒãŸTOONãƒ•ã‚¡ã‚¤ãƒ«(.md)\n\n&#96;&#96;&#96;\n\n---\n\n## 2. å„ãƒ•ã‚¡ã‚¤ãƒ«ã®è²¬ä»»ç¯„å›²ï¼ˆè¦ä»¶å®šç¾©ï¼‰\n\n### â‘  &#96;core/models.py&#96;\n\n**è²¬ä»»ï¼šãƒ‡ãƒ¼ã‚¿ã®å‹å®šç¾©**\n\n* Pythonã® &#96;Dataclass&#96; ã‚„ &#96;Pydantic&#96; ã‚’ä½¿ã„ã€&#96;Node&#96; ã‚„ &#96;Edge&#96; ã®å±æ€§ï¼ˆID, Type, Label, Statusï¼‰ã‚’å³å¯†ã«å®šç¾©ã—ã¾ã™ã€‚\n* ã“ã“ã‚’å›ºå®šã™ã‚‹ã“ã¨ã§ã€ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«é–“ã§ã®ãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—ãƒŸã‚¹ã‚’é˜²ãã¾ã™ã€‚\n\n### â‘¡ &#96;parser/toon_parser.py&#96;\n\n**è²¬ä»»ï¼šTOONã®è§£é‡ˆï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰**\n\n* Markdownå½¢å¼ã®TOONã‚’æ­£è¦è¡¨ç¾ï¼ˆRegexï¼‰ãªã©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã€&#96;models.py&#96; ã§å®šç¾©ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚¹ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚\n* **ã€Œå·®åˆ†ï¼ˆLOGï¼‰ã€ã®åæ˜ ãƒ­ã‚¸ãƒƒã‚¯**ã‚‚ã“ã“ã«æŒã¡ã¾ã™ã€‚å¤ã„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«LOGã®å†…å®¹ã‚’ä¸Šæ›¸ãã—ã¦ã€æœ€æ–°ã®çŠ¶æ…‹ã‚’ä½œã‚‹è²¬ä»»è€…ã§ã™ã€‚",
        "signatures": {},
        "detailedLines": [
          {
            "text": "1ãƒ•ã‚¡ã‚¤ãƒ«1è²¬ä»»ã®åŸå‰‡ï¼ˆSRPï¼‰ã«åŸºã¥ãã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç‹¬ç«‹ã•ã›ã‚‹ã“ã¨ã§ã€**ã€ŒAIã®æŒ™å‹•ã‚’å¤‰ãˆãŸã„ã¨ãã€**ã¨**ã€Œå›³ã®è¦‹ãŸç›®ï¼ˆMermaidï¼‰ã‚’å¤‰ãˆãŸã„ã¨ãã€**ã‚’å®Œå…¨ã«åˆ‡ã‚Šåˆ†ã‘ã¦ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã§ãã‚‹æ§‹é€ ã‚’ææ¡ˆã—ã¾ã™ã€‚",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "---",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "## 1. æ¨å¥¨ã•ã‚Œã‚‹ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ ",
            "lineNumber": 5
          },
          {
            "lineNumber": 6
          },
          {
            "text": "æ‹¡å¼µæ€§ã¨è¦‹é€šã—ã®è‰¯ã•ã‚’é‡è¦–ã—ãŸæ§‹æˆã§ã™ã€‚",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "&#96;&#96;&#96;text",
            "lineNumber": 9
          },
          {
            "text": "toon-flow-visualizer/",
            "lineNumber": 10
          },
          {
            "text": "â”œâ”€â”€ app.py                # ã€Entry Pointã€‘Streamlitã®ãƒ¡ã‚¤ãƒ³UIãƒ»çŠ¶æ…‹ç®¡ç†",
            "lineNumber": 11
          },
          {
            "text": "â”œâ”€â”€ core/                 # ã€Logicã€‘å…±é€šåŸºç›¤ãƒ»ãƒ‡ãƒ¼ã‚¿å®šç¾©",
            "lineNumber": 12
          },
          {
            "text": "â”‚   â””â”€â”€ models.py         # ãƒãƒ¼ãƒ‰ã‚„ã‚¨ãƒƒã‚¸ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€  (Pydanticç­‰)",
            "lineNumber": 13
          },
          {
            "text": "â”œâ”€â”€ parser/               # ã€Responsibility: è§£æã€‘",
            "lineNumber": 14
          },
          {
            "text": "â”‚   â””â”€â”€ toon_parser.py    # Markdown(TOON)ã‹ã‚‰å†…éƒ¨ãƒ¢ãƒ‡ãƒ«ã¸ã®å¤‰æ›",
            "lineNumber": 15
          },
          {
            "text": "â”œâ”€â”€ generator/            # ã€Responsibility: æç”»ç”Ÿæˆã€‘",
            "lineNumber": 16
          },
          {
            "text": "â”‚   â””â”€â”€ mermaid_gen.py    # å†…éƒ¨ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰Mermaidæ§‹æ–‡ã¸ã®å¤‰æ›",
            "lineNumber": 17
          },
          {
            "text": "â”œâ”€â”€ llm/                  # ã€Responsibility: AIå¯¾è©±ã€‘",
            "lineNumber": 18
          },
          {
            "text": "â”‚   â””â”€â”€ agent.py          # å¤§å‹LLMã¸ã®æŒ‡ç¤ºã€TOONå·®åˆ†å–å¾—",
            "lineNumber": 19
          },
          {
            "text": "â”œâ”€â”€ schema/               # ã€Assetsã€‘",
            "lineNumber": 20
          },
          {
            "text": "â”‚   â””â”€â”€ template.md       # LLMã«æ¸¡ã™TOONã®åŸºæœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ",
            "lineNumber": 21
          },
          {
            "text": "â””â”€â”€ data/                 # ã€Storageã€‘",
            "lineNumber": 22
          },
          {
            "text": "    â””â”€â”€ sessions/         # ä¿å­˜ã•ã‚ŒãŸTOONãƒ•ã‚¡ã‚¤ãƒ«(.md)",
            "lineNumber": 23
          },
          {
            "lineNumber": 24
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "text": "---",
            "lineNumber": 27
          },
          {
            "lineNumber": 28
          },
          {
            "text": "## 2. å„ãƒ•ã‚¡ã‚¤ãƒ«ã®è²¬ä»»ç¯„å›²ï¼ˆè¦ä»¶å®šç¾©ï¼‰",
            "lineNumber": 29
          },
          {
            "lineNumber": 30
          },
          {
            "text": "### â‘  &#96;core/models.py&#96;",
            "lineNumber": 31
          },
          {
            "lineNumber": 32
          },
          {
            "text": "**è²¬ä»»ï¼šãƒ‡ãƒ¼ã‚¿ã®å‹å®šç¾©**",
            "lineNumber": 33
          },
          {
            "lineNumber": 34
          },
          {
            "text": "* Pythonã® &#96;Dataclass&#96; ã‚„ &#96;Pydantic&#96; ã‚’ä½¿ã„ã€&#96;Node&#96; ã‚„ &#96;Edge&#96; ã®å±æ€§ï¼ˆID, Type, Label, Statusï¼‰ã‚’å³å¯†ã«å®šç¾©ã—ã¾ã™ã€‚",
            "lineNumber": 35
          },
          {
            "text": "* ã“ã“ã‚’å›ºå®šã™ã‚‹ã“ã¨ã§ã€ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«é–“ã§ã®ãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—ãƒŸã‚¹ã‚’é˜²ãã¾ã™ã€‚",
            "lineNumber": 36
          },
          {
            "lineNumber": 37
          },
          {
            "text": "### â‘¡ &#96;parser/toon_parser.py&#96;",
            "lineNumber": 38
          },
          {
            "lineNumber": 39
          },
          {
            "text": "**è²¬ä»»ï¼šTOONã®è§£é‡ˆï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰**",
            "lineNumber": 40
          },
          {
            "lineNumber": 41
          },
          {
            "text": "* Markdownå½¢å¼ã®TOONã‚’æ­£è¦è¡¨ç¾ï¼ˆRegexï¼‰ãªã©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã€&#96;models.py&#96; ã§å®šç¾©ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚¹ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚",
            "lineNumber": 42
          },
          {
            "text": "* **ã€Œå·®åˆ†ï¼ˆLOGï¼‰ã€ã®åæ˜ ãƒ­ã‚¸ãƒƒã‚¯**ã‚‚ã“ã“ã«æŒã¡ã¾ã™ã€‚å¤ã„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«LOGã®å†…å®¹ã‚’ä¸Šæ›¸ãã—ã¦ã€æœ€æ–°ã®çŠ¶æ…‹ã‚’ä½œã‚‹è²¬ä»»è€…ã§ã™ã€‚",
            "lineNumber": 43
          }
        ]
      },
      "score": 0.23328189551830292
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\mermaid_parser.py",
        "range": {
          "startPosition": {
            "line": 5
          },
          "endPosition": {
            "line": 178
          }
        },
        "contents": "class MermaidParser:\n@staticmethod\ndef parse(mermaid_text: str) -&gt; Flowchart:\n\n            \n            # ã‚¨ãƒƒã‚¸å®šç¾©: source--&gt;target ã¾ãŸã¯ source--&gt;|\"label\"|target\n            edge_patterns = [\n                r'(\\w+)\\s*--&gt;\\s*\\|\\s*[\"\\']([^\"\\']+)[\"\\']\\s*\\|\\s*(\\w+)',  # source--&gt;|\"label\"|target\n                r'(\\w+)\\s*--&gt;\\s*(\\w+)',                                   # source--&gt;target\n            ]\n            \n            for pattern in edge_patterns:\n                edge_match = re.match(pattern, line)\n                if edge_match:\n                    source_id = edge_match.group(1)\n                    if len(edge_match.groups()) == 3:\n                        label = edge_match.group(2)\n                        target_id = edge_match.group(3)\n                    else:\n                        label = None\n                        target_id = edge_match.group(2)\n                    \n                    # IDãŒ'end'ã®å ´åˆã¯'node_end'ã«å¤‰æ›\n                    safe_source = \"node_end\" if source_id.lower() == \"end\" else source_id\n                    safe_target = \"node_end\" if target_id.lower() == \"end\" else target_id\n                    \n                    edges.append(Edge(\n                        source=safe_source,\n                        target=safe_target,\n                        label=label.strip() if label else None\n                    ))\n                    break\n        \n        # ãƒãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼\n        if not nodes:\n            raise TOONParseError(f\"Mermaidå½¢å¼ã®ãƒãƒ¼ãƒ‰ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚å†…å®¹ï¼š\\n{mermaid_text[:200]}...\")\n        \n        # startãƒãƒ¼ãƒ‰ã¨endãƒãƒ¼ãƒ‰ã®å­˜åœ¨ç¢ºèª\n        node_types = {node.type for node in nodes}\n        if \"start\" not in node_types:\n            # startãƒãƒ¼ãƒ‰ãŒãªã„å ´åˆã€æœ€åˆã®ãƒãƒ¼ãƒ‰ã‚’startã«è¨­å®š\n            if nodes:\n                nodes[0].type = \"start\"\n        \n        if \"end\" not in node_types:",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 6,
                "column": 1
              },
              "endPosition": {
                "line": 7,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 9,
                "column": 5
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 10,
                "column": 5
              },
              "endPosition": {
                "line": 11,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class MermaidParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 9
          },
          {
            "text": "def parse(mermaid_text: str) -&gt; Flowchart:",
            "lineNumber": 10
          },
          {
            "lineNumber": 101
          },
          {
            "text": "            ",
            "lineNumber": 102
          },
          {
            "text": "            # ã‚¨ãƒƒã‚¸å®šç¾©: source--&gt;target ã¾ãŸã¯ source--&gt;|\"label\"|target",
            "lineNumber": 103
          },
          {
            "text": "            edge_patterns = [",
            "lineNumber": 104
          },
          {
            "text": "                r'(\\w+)\\s*--&gt;\\s*\\|\\s*[\"\\']([^\"\\']+)[\"\\']\\s*\\|\\s*(\\w+)',  # source--&gt;|\"label\"|target",
            "lineNumber": 105
          },
          {
            "text": "                r'(\\w+)\\s*--&gt;\\s*(\\w+)',                                   # source--&gt;target",
            "lineNumber": 106
          },
          {
            "text": "            ]",
            "lineNumber": 107
          },
          {
            "text": "            ",
            "lineNumber": 108
          },
          {
            "text": "            for pattern in edge_patterns:",
            "lineNumber": 109
          },
          {
            "text": "                edge_match = re.match(pattern, line)",
            "lineNumber": 110
          },
          {
            "text": "                if edge_match:",
            "lineNumber": 111
          },
          {
            "text": "                    source_id = edge_match.group(1)",
            "lineNumber": 112
          },
          {
            "text": "                    if len(edge_match.groups()) == 3:",
            "lineNumber": 113
          },
          {
            "text": "                        label = edge_match.group(2)",
            "lineNumber": 114
          },
          {
            "text": "                        target_id = edge_match.group(3)",
            "lineNumber": 115
          },
          {
            "text": "                    else:",
            "lineNumber": 116
          },
          {
            "text": "                        label = None",
            "lineNumber": 117
          },
          {
            "text": "                        target_id = edge_match.group(2)",
            "lineNumber": 118
          },
          {
            "text": "                    ",
            "lineNumber": 119
          },
          {
            "text": "                    # IDãŒ'end'ã®å ´åˆã¯'node_end'ã«å¤‰æ›",
            "lineNumber": 120
          },
          {
            "text": "                    safe_source = \"node_end\" if source_id.lower() == \"end\" else source_id",
            "lineNumber": 121
          },
          {
            "text": "                    safe_target = \"node_end\" if target_id.lower() == \"end\" else target_id",
            "lineNumber": 122
          },
          {
            "text": "                    ",
            "lineNumber": 123
          },
          {
            "text": "                    edges.append(Edge(",
            "lineNumber": 124
          },
          {
            "text": "                        source=safe_source,",
            "lineNumber": 125
          },
          {
            "text": "                        target=safe_target,",
            "lineNumber": 126
          },
          {
            "text": "                        label=label.strip() if label else None",
            "lineNumber": 127
          },
          {
            "text": "                    ))",
            "lineNumber": 128
          },
          {
            "text": "                    break",
            "lineNumber": 129
          },
          {
            "text": "        ",
            "lineNumber": 130
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼",
            "lineNumber": 131
          },
          {
            "text": "        if not nodes:",
            "lineNumber": 132
          },
          {
            "text": "            raise TOONParseError(f\"Mermaidå½¢å¼ã®ãƒãƒ¼ãƒ‰ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚å†…å®¹ï¼š\\n{mermaid_text[:200]}...\")",
            "lineNumber": 133
          },
          {
            "text": "        ",
            "lineNumber": 134
          },
          {
            "text": "        # startãƒãƒ¼ãƒ‰ã¨endãƒãƒ¼ãƒ‰ã®å­˜åœ¨ç¢ºèª",
            "lineNumber": 135
          },
          {
            "text": "        node_types = {node.type for node in nodes}",
            "lineNumber": 136
          },
          {
            "text": "        if \"start\" not in node_types:",
            "lineNumber": 137
          },
          {
            "text": "            # startãƒãƒ¼ãƒ‰ãŒãªã„å ´åˆã€æœ€åˆã®ãƒãƒ¼ãƒ‰ã‚’startã«è¨­å®š",
            "lineNumber": 138
          },
          {
            "text": "            if nodes:",
            "lineNumber": 139
          },
          {
            "text": "                nodes[0].type = \"start\"",
            "lineNumber": 140
          },
          {
            "text": "        ",
            "lineNumber": 141
          },
          {
            "text": "        if \"end\" not in node_types:",
            "lineNumber": 142
          }
        ]
      },
      "score": 0.22867625951766968
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


LLMã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å®Ÿè£…ã‚’ç¢ºèªã—ã€å‡ºåŠ›åˆ¶é™ã®æ–¹æ³•ã‚’æ¤œè¨ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/llm_client.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "How does LLM generate flowchart? What prompts are used?",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\llm_client.py",
        "range": {
          "startPosition": {
            "line": 8
          },
          "endPosition": {
            "line": 229
          }
        },
        "contents": "class LLMClient:\n@staticmethod\ndef is_question_response(response_text: str) -&gt; bool:\n\n        return False\n\n    def generate_flow(self, user_input: str, current_flowchart: Optional[Flowchart] = None) -&gt; str:\n        \"\"\"\n        ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’å—ã‘å–ã‚Šã€Ollamaã‹ã‚‰TOONå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚\n        \n        Args:\n            user_input: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ\n            current_flowchart: æ—¢å­˜ã®Flowchartï¼ˆæ–‡è„ˆã¨ã—ã¦æ¸¡ã™ï¼‰\n        \n        Raises:\n            ValueError: ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰æœ‰åŠ¹ãªå¿œç­”ãŒå¾—ã‚‰ã‚Œãªã„å ´åˆ\n            LLMAPIError: Ollama APIã¨ã®é€šä¿¡ã«å¤±æ•—ã—ãŸå ´åˆ\n        \"\"\"\n        try:\n            # æ—¢å­˜ã®FlowchartãŒã‚ã‚‹å ´åˆã€TOONå½¢å¼ã«å¤‰æ›ã—ã¦ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦è¿½åŠ \n            if current_flowchart:\n                context = f\"æ—¢å­˜ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ:\\n{current_flowchart.to_toon_format()}\\n\\n\"\n                enhanced_input = context + f\"ä¸Šè¨˜ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’å‚è€ƒã«ã€ä»¥ä¸‹ã®æŒ‡ç¤ºã«å¾“ã£ã¦ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’ç”Ÿæˆã¾ãŸã¯æ›´æ–°ã—ã¦ãã ã•ã„:\\n{user_input}\"\n            else:\n                enhanced_input = user_input\n            \n            # ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã«è³ªå•ã‚’ä¿ƒã™ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹ã‹ãƒã‚§ãƒƒã‚¯\n            question_keywords = [\"å•ã„ã‹ã‘ã¦\", \"è³ªå•ã—ã¦\", \"èã„ã¦\", \"ç¢ºèªã—ã¦\"]\n            requires_questions = any(keyword in user_input for keyword in question_keywords)\n            \n            # ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¿½åŠ ã®å¼·èª¿ã‚’åŠ ãˆã‚‹\n            if requires_questions:\n                additional_instruction = \"\\n\\nã€é‡è¦ã€‘ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æƒ…å ±ä¸è¶³æ™‚ã«è³ªå•ã™ã‚‹ã“ã¨ã‚’æ˜ç¤ºçš„ã«è¦æ±‚ã—ã¦ã„ã¾ã™ã€‚æ¨æ¸¬ã›ãšã€å¿…è¦ãªæƒ…å ±ã‚’è³ªå•ã—ã¦ãã ã•ã„ã€‚\"\n                system_prompt = self.system_instruction + additional_instruction\n            else:\n                system_prompt = self.system_instruction\n            \n            # Ollama HTTP APIã‚’ç›´æ¥å‘¼ã³å‡ºã—\n            payload",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 9,
                "column": 1
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class LLMClient:",
            "lineNumber": 9,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 66
          },
          {
            "text": "def is_question_response(response_text: str) -&gt; bool:",
            "lineNumber": 67
          },
          {
            "lineNumber": 113
          },
          {
            "text": "        return False",
            "lineNumber": 114
          },
          {
            "lineNumber": 115
          },
          {
            "text": "    def generate_flow(self, user_input: str, current_flowchart: Optional[Flowchart] = None) -&gt; str:",
            "lineNumber": 116
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 117
          },
          {
            "text": "        ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’å—ã‘å–ã‚Šã€Ollamaã‹ã‚‰TOONå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚",
            "lineNumber": 118
          },
          {
            "text": "        ",
            "lineNumber": 119
          },
          {
            "text": "        Args:",
            "lineNumber": 120
          },
          {
            "text": "            user_input: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ",
            "lineNumber": 121
          },
          {
            "text": "            current_flowchart: æ—¢å­˜ã®Flowchartï¼ˆæ–‡è„ˆã¨ã—ã¦æ¸¡ã™ï¼‰",
            "lineNumber": 122
          },
          {
            "text": "        ",
            "lineNumber": 123
          },
          {
            "text": "        Raises:",
            "lineNumber": 124
          },
          {
            "text": "            ValueError: ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰æœ‰åŠ¹ãªå¿œç­”ãŒå¾—ã‚‰ã‚Œãªã„å ´åˆ",
            "lineNumber": 125
          },
          {
            "text": "            LLMAPIError: Ollama APIã¨ã®é€šä¿¡ã«å¤±æ•—ã—ãŸå ´åˆ",
            "lineNumber": 126
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 127
          },
          {
            "text": "        try:",
            "lineNumber": 128
          },
          {
            "text": "            # æ—¢å­˜ã®FlowchartãŒã‚ã‚‹å ´åˆã€TOONå½¢å¼ã«å¤‰æ›ã—ã¦ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦è¿½åŠ ",
            "lineNumber": 129
          },
          {
            "text": "            if current_flowchart:",
            "lineNumber": 130
          },
          {
            "text": "                context = f\"æ—¢å­˜ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ:\\n{current_flowchart.to_toon_format()}\\n\\n\"",
            "lineNumber": 131
          },
          {
            "text": "                enhanced_input = context + f\"ä¸Šè¨˜ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’å‚è€ƒã«ã€ä»¥ä¸‹ã®æŒ‡ç¤ºã«å¾“ã£ã¦ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’ç”Ÿæˆã¾ãŸã¯æ›´æ–°ã—ã¦ãã ã•ã„:\\n{user_input}\"",
            "lineNumber": 132
          },
          {
            "text": "            else:",
            "lineNumber": 133
          },
          {
            "text": "                enhanced_input = user_input",
            "lineNumber": 134
          },
          {
            "text": "            ",
            "lineNumber": 135
          },
          {
            "text": "            # ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã«è³ªå•ã‚’ä¿ƒã™ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹ã‹ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 136
          },
          {
            "text": "            question_keywords = [\"å•ã„ã‹ã‘ã¦\", \"è³ªå•ã—ã¦\", \"èã„ã¦\", \"ç¢ºèªã—ã¦\"]",
            "lineNumber": 137
          },
          {
            "text": "            requires_questions = any(keyword in user_input for keyword in question_keywords)",
            "lineNumber": 138
          },
          {
            "text": "            ",
            "lineNumber": 139
          },
          {
            "text": "            # ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¿½åŠ ã®å¼·èª¿ã‚’åŠ ãˆã‚‹",
            "lineNumber": 140
          },
          {
            "text": "            if requires_questions:",
            "lineNumber": 141
          },
          {
            "text": "                additional_instruction = \"\\n\\nã€é‡è¦ã€‘ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æƒ…å ±ä¸è¶³æ™‚ã«è³ªå•ã™ã‚‹ã“ã¨ã‚’æ˜ç¤ºçš„ã«è¦æ±‚ã—ã¦ã„ã¾ã™ã€‚æ¨æ¸¬ã›ãšã€å¿…è¦ãªæƒ…å ±ã‚’è³ªå•ã—ã¦ãã ã•ã„ã€‚\"",
            "lineNumber": 142
          },
          {
            "text": "                system_prompt = self.system_instruction + additional_instruction",
            "lineNumber": 143
          },
          {
            "text": "            else:",
            "lineNumber": 144
          },
          {
            "text": "                system_prompt = self.system_instruction",
            "lineNumber": 145
          },
          {
            "text": "            ",
            "lineNumber": 146
          },
          {
            "text": "            # Ollama HTTP APIã‚’ç›´æ¥å‘¼ã³å‡ºã—",
            "lineNumber": 147
          },
          {
            "text": "            payload",
            "lineNumber": 148
          }
        ]
      },
      "score": 0.5900073051452637
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\llm_client.py",
        "range": {
          "startPosition": {
            "line": 8
          },
          "endPosition": {
            "line": 229
          }
        },
        "contents": "class LLMClient:\ndef generate_flow(self, user_input: str, current_flowchart: Optional[Flowchart] = None) -&gt; str:\n\n            \n            # Ollama HTTP APIã‚’ç›´æ¥å‘¼ã³å‡ºã—\n            payload = {\n                \"model\": self.model,\n                \"messages\": [\n                    {\"role\": \"system\", \"content\": system_prompt},\n                    {\"role\": \"user\", \"content\": enhanced_input}\n                ],\n                \"options\": {\n                    \"temperature\": 0.7\n                },\n                \"stream\": False\n            }\n            \n            # localhostã¸ã®æ¥ç¶šã§ã¯ãƒ—ãƒ­ã‚­ã‚·ã‚’ä½¿ç”¨ã—ãªã„\n            proxies = {\"http\": None, \"https\": None} if \"localhost\" in self.base_url or \"127.0.0.1\" in self.base_url else None\n            \n            response = requests.post(\n                self.api_url,\n                json=payload,\n                timeout=300,  # 5åˆ†ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ\n                proxies=proxies\n            )\n            \n            # HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯\n            response.raise_for_status()\n            \n            # JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è§£æ\n            result = response.json()\n            \n            if result and 'message' in result and 'content' in result['message']:\n                return result['message']['content']\n            else:\n                raise ValueError(\"ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰æœ‰åŠ¹ãªå¿œç­”ãŒå¾—ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚\")\n                \n        except ValueError:\n            # å†ç™ºç”Ÿã•ã›ã‚‹\n            raise\n        except requests.exceptions.ConnectionError as e:\n            # æ¥ç¶šã‚¨ãƒ©ãƒ¼ã®å ´åˆ\n            raise",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 9,
                "column": 1
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 116,
                "column": 5
              },
              "endPosition": {
                "line": 117,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class LLMClient:",
            "lineNumber": 9,
            "isSignature": true
          },
          {
            "text": "def generate_flow(self, user_input: str, current_flowchart: Optional[Flowchart] = None) -&gt; str:",
            "lineNumber": 116
          },
          {
            "lineNumber": 145
          },
          {
            "text": "            ",
            "lineNumber": 146
          },
          {
            "text": "            # Ollama HTTP APIã‚’ç›´æ¥å‘¼ã³å‡ºã—",
            "lineNumber": 147
          },
          {
            "text": "            payload = {",
            "lineNumber": 148
          },
          {
            "text": "                \"model\": self.model,",
            "lineNumber": 149
          },
          {
            "text": "                \"messages\": [",
            "lineNumber": 150
          },
          {
            "text": "                    {\"role\": \"system\", \"content\": system_prompt},",
            "lineNumber": 151
          },
          {
            "text": "                    {\"role\": \"user\", \"content\": enhanced_input}",
            "lineNumber": 152
          },
          {
            "text": "                ],",
            "lineNumber": 153
          },
          {
            "text": "                \"options\": {",
            "lineNumber": 154
          },
          {
            "text": "                    \"temperature\": 0.7",
            "lineNumber": 155
          },
          {
            "text": "                },",
            "lineNumber": 156
          },
          {
            "text": "                \"stream\": False",
            "lineNumber": 157
          },
          {
            "text": "            }",
            "lineNumber": 158
          },
          {
            "text": "            ",
            "lineNumber": 159
          },
          {
            "text": "            # localhostã¸ã®æ¥ç¶šã§ã¯ãƒ—ãƒ­ã‚­ã‚·ã‚’ä½¿ç”¨ã—ãªã„",
            "lineNumber": 160
          },
          {
            "text": "            proxies = {\"http\": None, \"https\": None} if \"localhost\" in self.base_url or \"127.0.0.1\" in self.base_url else None",
            "lineNumber": 161
          },
          {
            "text": "            ",
            "lineNumber": 162
          },
          {
            "text": "            response = requests.post(",
            "lineNumber": 163
          },
          {
            "text": "                self.api_url,",
            "lineNumber": 164
          },
          {
            "text": "                json=payload,",
            "lineNumber": 165
          },
          {
            "text": "                timeout=300,  # 5åˆ†ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ",
            "lineNumber": 166
          },
          {
            "text": "                proxies=proxies",
            "lineNumber": 167
          },
          {
            "text": "            )",
            "lineNumber": 168
          },
          {
            "text": "            ",
            "lineNumber": 169
          },
          {
            "text": "            # HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 170
          },
          {
            "text": "            response.raise_for_status()",
            "lineNumber": 171
          },
          {
            "text": "            ",
            "lineNumber": 172
          },
          {
            "text": "            # JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è§£æ",
            "lineNumber": 173
          },
          {
            "text": "            result = response.json()",
            "lineNumber": 174
          },
          {
            "text": "            ",
            "lineNumber": 175
          },
          {
            "text": "            if result and 'message' in result and 'content' in result['message']:",
            "lineNumber": 176
          },
          {
            "text": "                return result['message']['content']",
            "lineNumber": 177
          },
          {
            "text": "            else:",
            "lineNumber": 178
          },
          {
            "text": "                raise ValueError(\"ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰æœ‰åŠ¹ãªå¿œç­”ãŒå¾—ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚\")",
            "lineNumber": 179
          },
          {
            "text": "                ",
            "lineNumber": 180
          },
          {
            "text": "        except ValueError:",
            "lineNumber": 181
          },
          {
            "text": "            # å†ç™ºç”Ÿã•ã›ã‚‹",
            "lineNumber": 182
          },
          {
            "text": "            raise",
            "lineNumber": 183
          },
          {
            "text": "        except requests.exceptions.ConnectionError as e:",
            "lineNumber": 184
          },
          {
            "text": "            # æ¥ç¶šã‚¨ãƒ©ãƒ¼ã®å ´åˆ",
            "lineNumber": 185
          },
          {
            "text": "            raise",
            "lineNumber": 186
          }
        ]
      },
      "score": 0.4085856080055237
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 323,
            "column": 62
          },
          "endPosition": {
            "line": 360,
            "column": 54
          }
        },
        "contents": "                raw_toon_text = \"\"\n                try:\n                    # LLMã¨ã®é€šä¿¡\n                    client = LLMClient()\n                    # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯æ—¢å­˜ã®Flowchartã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦æ¸¡ã™\n                    context_flowchart = current_flow if append_mode else None\n                    raw_toon_text = client.generate_flow(user_prompt, context_flowchart)\n                    \n                    # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯\n                    if client.is_question_response(raw_toon_text):\n                        # è³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜\n                        st.session_state.conversation_context = user_prompt\n                        st.session_state.pending_questions = raw_toon_text\n                        st.session_state.question_responses = []\n                        st.session_state.append_mode_for_question = append_mode  # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜\n                        st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n                        st.rerun()\n                    else:\n                        # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹\n                        new_flow = TOONParser.parse(raw_toon_text)\n                        \n                        # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨\n                        new_flow = new_flow.apply_logic_gap_detection()\n                        \n                        # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ\n                        if append_mode:\n                            merged_flow = history_mgr.append_toon_log(session_name, new_flow)\n                            st.session_state.history.append(merged_flow)\n                            st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")\n                        else:\n                            # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ \n                            st.session_state.history.append(new_flow)\n                        \n                        st.rerun()\n                except LLMAPIError as e:\n                    # LLM APIã‚¨ãƒ©ãƒ¼\n                    st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {e}\")",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                raw_toon_text = \"\"",
            "lineNumber": 325
          },
          {
            "text": "                try:",
            "lineNumber": 326
          },
          {
            "text": "                    # LLMã¨ã®é€šä¿¡",
            "lineNumber": 327
          },
          {
            "text": "                    client = LLMClient()",
            "lineNumber": 328
          },
          {
            "text": "                    # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯æ—¢å­˜ã®Flowchartã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦æ¸¡ã™",
            "lineNumber": 329
          },
          {
            "text": "                    context_flowchart = current_flow if append_mode else None",
            "lineNumber": 330
          },
          {
            "text": "                    raw_toon_text = client.generate_flow(user_prompt, context_flowchart)",
            "lineNumber": 331
          },
          {
            "text": "                    ",
            "lineNumber": 332
          },
          {
            "text": "                    # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 333
          },
          {
            "text": "                    if client.is_question_response(raw_toon_text):",
            "lineNumber": 334
          },
          {
            "text": "                        # è³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜",
            "lineNumber": 335
          },
          {
            "text": "                        st.session_state.conversation_context = user_prompt",
            "lineNumber": 336
          },
          {
            "text": "                        st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 337
          },
          {
            "text": "                        st.session_state.question_responses = []",
            "lineNumber": 338
          },
          {
            "text": "                        st.session_state.append_mode_for_question = append_mode  # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜",
            "lineNumber": 339
          },
          {
            "text": "                        st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 340
          },
          {
            "text": "                        st.rerun()",
            "lineNumber": 341
          },
          {
            "text": "                    else:",
            "lineNumber": 342
          },
          {
            "text": "                        # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹",
            "lineNumber": 343
          },
          {
            "text": "                        new_flow = TOONParser.parse(raw_toon_text)",
            "lineNumber": 344
          },
          {
            "text": "                        ",
            "lineNumber": 345
          },
          {
            "text": "                        # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨",
            "lineNumber": 346
          },
          {
            "text": "                        new_flow = new_flow.apply_logic_gap_detection()",
            "lineNumber": 347
          },
          {
            "text": "                        ",
            "lineNumber": 348
          },
          {
            "text": "                        # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ",
            "lineNumber": 349
          },
          {
            "text": "                        if append_mode:",
            "lineNumber": 350
          },
          {
            "text": "                            merged_flow = history_mgr.append_toon_log(session_name, new_flow)",
            "lineNumber": 351
          },
          {
            "text": "                            st.session_state.history.append(merged_flow)",
            "lineNumber": 352
          },
          {
            "text": "                            st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")",
            "lineNumber": 353
          },
          {
            "text": "                        else:",
            "lineNumber": 354
          },
          {
            "text": "                            # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ ",
            "lineNumber": 355
          },
          {
            "text": "                            st.session_state.history.append(new_flow)",
            "lineNumber": 356
          },
          {
            "text": "                        ",
            "lineNumber": 357
          },
          {
            "text": "                        st.rerun()",
            "lineNumber": 358
          },
          {
            "text": "                except LLMAPIError as e:",
            "lineNumber": 359
          },
          {
            "text": "                    # LLM APIã‚¨ãƒ©ãƒ¼",
            "lineNumber": 360
          },
          {
            "text": "                    st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {e}\")",
            "lineNumber": 361
          }
        ]
      },
      "score": 0.4057902991771698
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\llm_client.py",
        "range": {
          "startPosition": {
            "line": 8
          },
          "endPosition": {
            "line": 229
          }
        },
        "contents": "class LLMClient:\ndef __init__(self):\n        # Streamlitã®secretsã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã‚€ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ä»˜ãï¼‰\n\n        \n        # æƒ…å ±åé›†ã®æŒ‡ç¤ºã‚’è¿½åŠ \n        information_gathering_instruction = \"\"\"\n## é‡è¦: æƒ…å ±ä¸è¶³æ™‚ã®å‹•ä½œ\n\nãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ãŒä¸ååˆ†ã§ã€ä»¥ä¸‹ã®æƒ…å ±ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆï¼š\n- å…·ä½“çš„ãªãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢/ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ä»•æ§˜\n- æ•…éšœã®å…·ä½“çš„ãªç—‡çŠ¶ã‚„ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n- ç’°å¢ƒè¨­å®šã‚„å‰ææ¡ä»¶\n- å®Ÿè¡Œã™ã¹ãå…·ä½“çš„ãªæ‰‹é †\n\n**æ¨æ¸¬ã§ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’ç”Ÿæˆã›ãšã€å¿…è¦ãªæƒ…å ±ã‚’è³ªå•ã™ã‚‹å½¢å¼ã§è¿”ã—ã¦ãã ã•ã„ã€‚**\n\nè³ªå•ã®å½¢å¼ä¾‹ï¼š\nã€Œä»¥ä¸‹ã®æƒ…å ±ã‚’æ•™ãˆã¦ãã ã•ã„ï¼š\n1. jarvisã®å…·ä½“çš„ãªæ•…éšœç—‡çŠ¶ã¯ä½•ã§ã™ã‹ï¼Ÿï¼ˆä¾‹ï¼šé›»æºãŒå…¥ã‚‰ãªã„ã€LEDãŒç‚¹ç¯ã—ãªã„ãªã©ï¼‰\n2. jarvisã®æ©Ÿç¨®ã‚„å‹ç•ªã¯ä½•ã§ã™ã‹ï¼Ÿ\n3. æ•…éšœãŒç™ºç”Ÿã—ãŸéš›ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿã€\n\nãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œã‚ã‹ã‚‰ãªã„ã¨ã“ã‚ã¯å•ã„ã‹ã‘ã¦ãã ã•ã„ã€ã¨æ˜ç¤ºã—ã¦ã„ã‚‹å ´åˆã€ç‰¹ã«æ³¨æ„ã—ã¦æƒ…å ±ä¸è¶³ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚\n\"\"\"\n        \n        # ã‚·ã‚¹ãƒ†ãƒ æŒ‡ç¤ºï¼ˆSystem Instructionï¼‰ã®æ§‹ç¯‰\n        self.system_instruction = f\"{rules_text}\\n\\n{base_text}\\n\\n{information_gathering_instruction}\"\n\n    def _load_file(self, path: Path, default_title: str) -&gt; str:\n        \"\"\"ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®‰å…¨ã«èª­ã¿è¾¼ã¿ã€å­˜åœ¨ã—ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è¦‹å‡ºã—ã‚’è¿”ã™\"\"\"\n        if path.exists():\n            return path.read_text(encoding=\"utf-8\")\n        return f\"# {default_title}\\n(No specific instructions found.)\"\n\n    @staticmethod\n    def is_question_response(response_text: str) -&gt; bool:\n        \"\"\"",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 9,
                "column": 1
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 10,
                "column": 5
              },
              "endPosition": {
                "line": 12,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class LLMClient:",
            "lineNumber": 9,
            "isSignature": true
          },
          {
            "text": "def __init__(self):",
            "lineNumber": 10
          },
          {
            "text": "        # Streamlitã®secretsã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã‚€ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ä»˜ãï¼‰",
            "lineNumber": 11
          },
          {
            "lineNumber": 34
          },
          {
            "text": "        ",
            "lineNumber": 35
          },
          {
            "text": "        # æƒ…å ±åé›†ã®æŒ‡ç¤ºã‚’è¿½åŠ ",
            "lineNumber": 36
          },
          {
            "text": "        information_gathering_instruction = \"\"\"",
            "lineNumber": 37
          },
          {
            "text": "## é‡è¦: æƒ…å ±ä¸è¶³æ™‚ã®å‹•ä½œ",
            "lineNumber": 38
          },
          {
            "lineNumber": 39
          },
          {
            "text": "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ãŒä¸ååˆ†ã§ã€ä»¥ä¸‹ã®æƒ…å ±ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆï¼š",
            "lineNumber": 40
          },
          {
            "text": "- å…·ä½“çš„ãªãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢/ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ä»•æ§˜",
            "lineNumber": 41
          },
          {
            "text": "- æ•…éšœã®å…·ä½“çš„ãªç—‡çŠ¶ã‚„ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸",
            "lineNumber": 42
          },
          {
            "text": "- ç’°å¢ƒè¨­å®šã‚„å‰ææ¡ä»¶",
            "lineNumber": 43
          },
          {
            "text": "- å®Ÿè¡Œã™ã¹ãå…·ä½“çš„ãªæ‰‹é †",
            "lineNumber": 44
          },
          {
            "lineNumber": 45
          },
          {
            "text": "**æ¨æ¸¬ã§ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’ç”Ÿæˆã›ãšã€å¿…è¦ãªæƒ…å ±ã‚’è³ªå•ã™ã‚‹å½¢å¼ã§è¿”ã—ã¦ãã ã•ã„ã€‚**",
            "lineNumber": 46
          },
          {
            "lineNumber": 47
          },
          {
            "text": "è³ªå•ã®å½¢å¼ä¾‹ï¼š",
            "lineNumber": 48
          },
          {
            "text": "ã€Œä»¥ä¸‹ã®æƒ…å ±ã‚’æ•™ãˆã¦ãã ã•ã„ï¼š",
            "lineNumber": 49
          },
          {
            "text": "1. jarvisã®å…·ä½“çš„ãªæ•…éšœç—‡çŠ¶ã¯ä½•ã§ã™ã‹ï¼Ÿï¼ˆä¾‹ï¼šé›»æºãŒå…¥ã‚‰ãªã„ã€LEDãŒç‚¹ç¯ã—ãªã„ãªã©ï¼‰",
            "lineNumber": 50
          },
          {
            "text": "2. jarvisã®æ©Ÿç¨®ã‚„å‹ç•ªã¯ä½•ã§ã™ã‹ï¼Ÿ",
            "lineNumber": 51
          },
          {
            "text": "3. æ•…éšœãŒç™ºç”Ÿã—ãŸéš›ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿã€",
            "lineNumber": 52
          },
          {
            "lineNumber": 53
          },
          {
            "text": "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œã‚ã‹ã‚‰ãªã„ã¨ã“ã‚ã¯å•ã„ã‹ã‘ã¦ãã ã•ã„ã€ã¨æ˜ç¤ºã—ã¦ã„ã‚‹å ´åˆã€ç‰¹ã«æ³¨æ„ã—ã¦æƒ…å ±ä¸è¶³ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚",
            "lineNumber": 54
          },
          {
            "text": "\"\"\"",
            "lineNumber": 55
          },
          {
            "text": "        ",
            "lineNumber": 56
          },
          {
            "text": "        # ã‚·ã‚¹ãƒ†ãƒ æŒ‡ç¤ºï¼ˆSystem Instructionï¼‰ã®æ§‹ç¯‰",
            "lineNumber": 57
          },
          {
            "text": "        self.system_instruction = f\"{rules_text}\\n\\n{base_text}\\n\\n{information_gathering_instruction}\"",
            "lineNumber": 58
          },
          {
            "lineNumber": 59
          },
          {
            "text": "    def _load_file(self, path: Path, default_title: str) -&gt; str:",
            "lineNumber": 60
          },
          {
            "text": "        \"\"\"ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®‰å…¨ã«èª­ã¿è¾¼ã¿ã€å­˜åœ¨ã—ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è¦‹å‡ºã—ã‚’è¿”ã™\"\"\"",
            "lineNumber": 61
          },
          {
            "text": "        if path.exists():",
            "lineNumber": 62
          },
          {
            "text": "            return path.read_text(encoding=\"utf-8\")",
            "lineNumber": 63
          },
          {
            "text": "        return f\"# {default_title}\\n(No specific instructions found.)\"",
            "lineNumber": 64
          },
          {
            "lineNumber": 65
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 66
          },
          {
            "text": "    def is_question_response(response_text: str) -&gt; bool:",
            "lineNumber": 67
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 68
          }
        ]
      },
      "score": 0.40144985914230347
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\llm_client.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 229
          }
        },
        "contents": "import os\nimport requests\nimport re\nfrom pathlib import Path\nfrom typing import Optional\nfrom core.exceptions import LLMAPIError\nfrom core.schemas import Flowchart\n\nclass LLMClient:\n    def __init__(self):\n        # Streamlitã®secretsã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã‚€ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ä»˜ãï¼‰\n        try:\n            import streamlit as st\n            # st.secretsãŒåˆ©ç”¨å¯èƒ½ãªå ´åˆï¼ˆStreamlitå®Ÿè¡Œç’°å¢ƒï¼‰\n            ollama_config = st.secrets.get(\"ollama\", {})\n            self.base_url = ollama_config.get(\"base_url\", \"http://localhost:11434\")\n            self.model = ollama_config.get(\"model\", \"llama3.2\")\n        except (AttributeError, FileNotFoundError, ImportError, RuntimeError):\n            # secrets.tomlãŒå­˜åœ¨ã—ãªã„å ´åˆã€ã¾ãŸã¯Streamlitå¤–ã§å®Ÿè¡Œã•ã‚Œã‚‹å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯\n            # ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã‚€ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒãªã©ï¼‰\n            self.base_url = os.getenv(\"OLLAMA_BASE_URL\", \"http://localhost:11434\")\n            self.model = os.getenv(\"OLLAMA_MODEL\", \"llama3.2\")\n        \n        # APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ\n        self.api_url = f\"{self.base_url}/api/chat\"\n\n        # rules.md (Skills) ã¨ TOON_BASE.md (Format) ã‚’èª­ã¿è¾¼ã‚€\n        # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‚’æ˜ç¤ºçš„ã«æŒ‡å®šï¼ˆStreamlitã®å®Ÿè¡Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¾å­˜ã—ãªã„ï¼‰\n        base_dir = Path(__file__).parent.parent\n        rules_path = base_dir / \"rules.md\"\n        base_path = base_dir / \"TOON_BASE.md\"\n        \n        rules_text = self._load_file(rules_path, \"Skills: Standard Flow Logic\")\n        base_text = self._load_file(base_path, \"Format: TOON Output\")\n        \n        # æƒ…å ±åé›†ã®æŒ‡ç¤ºã‚’è¿½åŠ \n        information_gathering_instruction",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import os",
            "lineNumber": 1
          },
          {
            "text": "import requests",
            "lineNumber": 2
          },
          {
            "text": "import re",
            "lineNumber": 3
          },
          {
            "text": "from pathlib import Path",
            "lineNumber": 4
          },
          {
            "text": "from typing import Optional",
            "lineNumber": 5
          },
          {
            "text": "from core.exceptions import LLMAPIError",
            "lineNumber": 6
          },
          {
            "text": "from core.schemas import Flowchart",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "class LLMClient:",
            "lineNumber": 9,
            "isSignature": true
          },
          {
            "text": "    def __init__(self):",
            "lineNumber": 10
          },
          {
            "text": "        # Streamlitã®secretsã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã‚€ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ä»˜ãï¼‰",
            "lineNumber": 11
          },
          {
            "text": "        try:",
            "lineNumber": 12
          },
          {
            "text": "            import streamlit as st",
            "lineNumber": 13
          },
          {
            "text": "            # st.secretsãŒåˆ©ç”¨å¯èƒ½ãªå ´åˆï¼ˆStreamlitå®Ÿè¡Œç’°å¢ƒï¼‰",
            "lineNumber": 14
          },
          {
            "text": "            ollama_config = st.secrets.get(\"ollama\", {})",
            "lineNumber": 15
          },
          {
            "text": "            self.base_url = ollama_config.get(\"base_url\", \"http://localhost:11434\")",
            "lineNumber": 16
          },
          {
            "text": "            self.model = ollama_config.get(\"model\", \"llama3.2\")",
            "lineNumber": 17
          },
          {
            "text": "        except (AttributeError, FileNotFoundError, ImportError, RuntimeError):",
            "lineNumber": 18
          },
          {
            "text": "            # secrets.tomlãŒå­˜åœ¨ã—ãªã„å ´åˆã€ã¾ãŸã¯Streamlitå¤–ã§å®Ÿè¡Œã•ã‚Œã‚‹å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯",
            "lineNumber": 19
          },
          {
            "text": "            # ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã‚€ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒãªã©ï¼‰",
            "lineNumber": 20
          },
          {
            "text": "            self.base_url = os.getenv(\"OLLAMA_BASE_URL\", \"http://localhost:11434\")",
            "lineNumber": 21
          },
          {
            "text": "            self.model = os.getenv(\"OLLAMA_MODEL\", \"llama3.2\")",
            "lineNumber": 22
          },
          {
            "text": "        ",
            "lineNumber": 23
          },
          {
            "text": "        # APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ",
            "lineNumber": 24
          },
          {
            "text": "        self.api_url = f\"{self.base_url}/api/chat\"",
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "text": "        # rules.md (Skills) ã¨ TOON_BASE.md (Format) ã‚’èª­ã¿è¾¼ã‚€",
            "lineNumber": 27
          },
          {
            "text": "        # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‚’æ˜ç¤ºçš„ã«æŒ‡å®šï¼ˆStreamlitã®å®Ÿè¡Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¾å­˜ã—ãªã„ï¼‰",
            "lineNumber": 28
          },
          {
            "text": "        base_dir = Path(__file__).parent.parent",
            "lineNumber": 29
          },
          {
            "text": "        rules_path = base_dir / \"rules.md\"",
            "lineNumber": 30
          },
          {
            "text": "        base_path = base_dir / \"TOON_BASE.md\"",
            "lineNumber": 31
          },
          {
            "text": "        ",
            "lineNumber": 32
          },
          {
            "text": "        rules_text = self._load_file(rules_path, \"Skills: Standard Flow Logic\")",
            "lineNumber": 33
          },
          {
            "text": "        base_text = self._load_file(base_path, \"Format: TOON Output\")",
            "lineNumber": 34
          },
          {
            "text": "        ",
            "lineNumber": 35
          },
          {
            "text": "        # æƒ…å ±åé›†ã®æŒ‡ç¤ºã‚’è¿½åŠ ",
            "lineNumber": 36
          },
          {
            "text": "        information_gathering_instruction",
            "lineNumber": 37
          }
        ]
      },
      "score": 0.3896273374557495
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 304,
            "column": 26
          },
          "endPosition": {
            "line": 327,
            "column": 40
          }
        },
        "contents": "        \n        st.divider()\n    \n    # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®é¸æŠ\n    append_mode = st.checkbox(\n        \"æ—¢å­˜TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†è¿½è¨˜ï¼ˆLOGï¼‰\",\n        help=\"ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã¨ã€æ—¢å­˜ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«æ–°ã—ã„ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã‚’è¿½åŠ ã—ã¾ã™ã€‚\"\n    )\n    \n    user_prompt = st.text_area(\n        \"ã©ã®ã‚ˆã†ãªãƒ—ãƒ­ã‚»ã‚¹ã‚’å¯è¦–åŒ–ã—ãŸã„ã§ã™ã‹ï¼Ÿ\", \n        placeholder=\"ä¾‹ï¼šãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®æ•…éšœè¨ºæ–­æ‰‹é †ã‚’ãƒ•ãƒ­ãƒ¼ã«ã—ã¦\",\n        help=\"è‡ªç„¶è¨€èªã§å…¥åŠ›ã™ã‚‹ã¨LLMãŒTOONå½¢å¼ã‚’ç”Ÿæˆã—ã€ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’æ›´æ–°ã—ã¾ã™ã€‚\",\n        height=150\n    )\n    \n    if st.button(\"ãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆ\", type=\"primary\", use_container_width=True):\n        if user_prompt:\n            with st.spinner(\"LLMãŒãƒ•ãƒ­ãƒ¼ã‚’è¨­è¨ˆä¸­...\"):\n                raw_toon_text = \"\"\n                try:\n                    # LLMã¨ã®é€šä¿¡\n                    client = LLMClient()",
        "signatures": {},
        "detailedLines": [
          {
            "text": "        ",
            "lineNumber": 306
          },
          {
            "text": "        st.divider()",
            "lineNumber": 307
          },
          {
            "text": "    ",
            "lineNumber": 308
          },
          {
            "text": "    # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®é¸æŠ",
            "lineNumber": 309
          },
          {
            "text": "    append_mode = st.checkbox(",
            "lineNumber": 310
          },
          {
            "text": "        \"æ—¢å­˜TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†è¿½è¨˜ï¼ˆLOGï¼‰\",",
            "lineNumber": 311
          },
          {
            "text": "        help=\"ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã¨ã€æ—¢å­˜ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«æ–°ã—ã„ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã‚’è¿½åŠ ã—ã¾ã™ã€‚\"",
            "lineNumber": 312
          },
          {
            "text": "    )",
            "lineNumber": 313
          },
          {
            "text": "    ",
            "lineNumber": 314
          },
          {
            "text": "    user_prompt = st.text_area(",
            "lineNumber": 315
          },
          {
            "text": "        \"ã©ã®ã‚ˆã†ãªãƒ—ãƒ­ã‚»ã‚¹ã‚’å¯è¦–åŒ–ã—ãŸã„ã§ã™ã‹ï¼Ÿ\", ",
            "lineNumber": 316
          },
          {
            "text": "        placeholder=\"ä¾‹ï¼šãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®æ•…éšœè¨ºæ–­æ‰‹é †ã‚’ãƒ•ãƒ­ãƒ¼ã«ã—ã¦\",",
            "lineNumber": 317
          },
          {
            "text": "        help=\"è‡ªç„¶è¨€èªã§å…¥åŠ›ã™ã‚‹ã¨LLMãŒTOONå½¢å¼ã‚’ç”Ÿæˆã—ã€ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’æ›´æ–°ã—ã¾ã™ã€‚\",",
            "lineNumber": 318
          },
          {
            "text": "        height=150",
            "lineNumber": 319
          },
          {
            "text": "    )",
            "lineNumber": 320
          },
          {
            "text": "    ",
            "lineNumber": 321
          },
          {
            "text": "    if st.button(\"ãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆ\", type=\"primary\", use_container_width=True):",
            "lineNumber": 322
          },
          {
            "text": "        if user_prompt:",
            "lineNumber": 323
          },
          {
            "text": "            with st.spinner(\"LLMãŒãƒ•ãƒ­ãƒ¼ã‚’è¨­è¨ˆä¸­...\"):",
            "lineNumber": 324
          },
          {
            "text": "                raw_toon_text = \"\"",
            "lineNumber": 325
          },
          {
            "text": "                try:",
            "lineNumber": 326
          },
          {
            "text": "                    # LLMã¨ã®é€šä¿¡",
            "lineNumber": 327
          },
          {
            "text": "                    client = LLMClient()",
            "lineNumber": 328
          }
        ]
      },
      "score": 0.3808478116989136
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\rules.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 19,
            "column": 186
          }
        },
        "contents": "# Skills: Flowchart Logic Expert\n\n## Core Rules\n- **Logical Integrity**: å…¨ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ã¯å¿…ãšã€Œé–‹å§‹ã€ã‹ã‚‰å§‹ã¾ã‚Šã€Œçµ‚äº†ã€ã¸åˆ°é”ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚\n- **Reserved Word Protection**: Mermaid.js ã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã‚’é˜²ããŸã‚ã€çµ‚äº†ãƒãƒ¼ãƒ‰ã® ID ã«ã¯å¿…ãš &#96;node_end&#96; ã‚’ä½¿ç”¨ã—ã€ID å˜ä½“ã§ &#96;end&#96; ã‚’ä½¿ç”¨ã—ã¦ã¯ãªã‚‰ãªã„ã€‚\n- **Node Classification**:\n  - &#96;start&#96;: ãƒ•ãƒ­ãƒ¼ã®èµ·ç‚¹ã€‚\n  - &#96;end&#96;: ãƒ•ãƒ­ãƒ¼ã®çµ‚ç€ç‚¹ã€‚\n  - &#96;process&#96;: å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚„ä½œæ¥­ã€‚\n  - &#96;decision&#96;: äºŒè€…æŠä¸€ã€ã¾ãŸã¯å¤šè‚¢é¸æŠã®åˆ†å²ç‚¹ã€‚\n- **Atomic Steps**: 1ã¤ã®ãƒãƒ¼ãƒ‰ã«è¤‡æ•°ã®å·¥ç¨‹ã‚’è©°ã‚è¾¼ã¾ãšã€å¯èƒ½ãªé™ã‚Šæœ€å°å˜ä½ã«åˆ†å‰²ã™ã‚‹ã“ã¨ã€‚\n\n## Constraints\n- Windows / Python 3.10+ ç’°å¢ƒã§å‹•ä½œã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã‚ã‚‹ã“ã¨ã‚’æ„è­˜ã™ã‚‹ã“ã¨ã€‚\n- æ—¥æœ¬èªãƒ©ãƒ™ãƒ«ã¯å¸¸ã«æ­£ç¢ºã«ã€ã‹ã¤ç°¡æ½”ã«è¡¨ç¾ã™ã‚‹ã“ã¨ã€‚\n\n## Information Gathering Rules\n- **Ask Before Assuming**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ãŒä¸ååˆ†ã§ã€å…·ä½“çš„ãªæƒ…å ±ï¼ˆãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®ä»•æ§˜ã€æ•…éšœã®ç—‡çŠ¶ã€ç’°å¢ƒè¨­å®šãªã©ï¼‰ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆã€æ¨æ¸¬ã§ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’ç”Ÿæˆã›ãšã€å¿…è¦ãªæƒ…å ±ã‚’è³ªå•ã™ã‚‹å½¢å¼ã§è¿”ã™ã“ã¨ã€‚\n- **Question Format**: è³ªå•ã¯TOONå½¢å¼ã§ã¯ãªãã€æ˜ç¢ºãªè³ªå•æ–‡ã¨ã—ã¦è¿”ã™ã“ã¨ã€‚ä¾‹ï¼šã€Œjarvisã®å…·ä½“çš„ãªæ•…éšœç—‡çŠ¶ã‚’æ•™ãˆã¦ãã ã•ã„ï¼ˆä¾‹ï¼šé›»æºãŒå…¥ã‚‰ãªã„ã€LEDãŒç‚¹ç¯ã—ãªã„ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãªã©ï¼‰ã€\n- **Minimal Information**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œã‚ã‹ã‚‰ãªã„ã¨ã“ã‚ã¯å•ã„ã‹ã‘ã¦ãã ã•ã„ã€ã¨æ˜ç¤ºã—ã¦ã„ã‚‹å ´åˆã€ç‰¹ã«æ³¨æ„ã—ã¦æƒ…å ±ä¸è¶³ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã€‚",
        "signatures": {},
        "detailedLines": [
          {
            "text": "# Skills: Flowchart Logic Expert",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "## Core Rules",
            "lineNumber": 3
          },
          {
            "text": "- **Logical Integrity**: å…¨ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ã¯å¿…ãšã€Œé–‹å§‹ã€ã‹ã‚‰å§‹ã¾ã‚Šã€Œçµ‚äº†ã€ã¸åˆ°é”ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚",
            "lineNumber": 4
          },
          {
            "text": "- **Reserved Word Protection**: Mermaid.js ã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã‚’é˜²ããŸã‚ã€çµ‚äº†ãƒãƒ¼ãƒ‰ã® ID ã«ã¯å¿…ãš &#96;node_end&#96; ã‚’ä½¿ç”¨ã—ã€ID å˜ä½“ã§ &#96;end&#96; ã‚’ä½¿ç”¨ã—ã¦ã¯ãªã‚‰ãªã„ã€‚",
            "lineNumber": 5
          },
          {
            "text": "- **Node Classification**:",
            "lineNumber": 6
          },
          {
            "text": "  - &#96;start&#96;: ãƒ•ãƒ­ãƒ¼ã®èµ·ç‚¹ã€‚",
            "lineNumber": 7
          },
          {
            "text": "  - &#96;end&#96;: ãƒ•ãƒ­ãƒ¼ã®çµ‚ç€ç‚¹ã€‚",
            "lineNumber": 8
          },
          {
            "text": "  - &#96;process&#96;: å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚„ä½œæ¥­ã€‚",
            "lineNumber": 9
          },
          {
            "text": "  - &#96;decision&#96;: äºŒè€…æŠä¸€ã€ã¾ãŸã¯å¤šè‚¢é¸æŠã®åˆ†å²ç‚¹ã€‚",
            "lineNumber": 10
          },
          {
            "text": "- **Atomic Steps**: 1ã¤ã®ãƒãƒ¼ãƒ‰ã«è¤‡æ•°ã®å·¥ç¨‹ã‚’è©°ã‚è¾¼ã¾ãšã€å¯èƒ½ãªé™ã‚Šæœ€å°å˜ä½ã«åˆ†å‰²ã™ã‚‹ã“ã¨ã€‚",
            "lineNumber": 11
          },
          {
            "lineNumber": 12
          },
          {
            "text": "## Constraints",
            "lineNumber": 13
          },
          {
            "text": "- Windows / Python 3.10+ ç’°å¢ƒã§å‹•ä½œã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã‚ã‚‹ã“ã¨ã‚’æ„è­˜ã™ã‚‹ã“ã¨ã€‚",
            "lineNumber": 14
          },
          {
            "text": "- æ—¥æœ¬èªãƒ©ãƒ™ãƒ«ã¯å¸¸ã«æ­£ç¢ºã«ã€ã‹ã¤ç°¡æ½”ã«è¡¨ç¾ã™ã‚‹ã“ã¨ã€‚",
            "lineNumber": 15
          },
          {
            "lineNumber": 16
          },
          {
            "text": "## Information Gathering Rules",
            "lineNumber": 17
          },
          {
            "text": "- **Ask Before Assuming**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ãŒä¸ååˆ†ã§ã€å…·ä½“çš„ãªæƒ…å ±ï¼ˆãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®ä»•æ§˜ã€æ•…éšœã®ç—‡çŠ¶ã€ç’°å¢ƒè¨­å®šãªã©ï¼‰ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆã€æ¨æ¸¬ã§ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’ç”Ÿæˆã›ãšã€å¿…è¦ãªæƒ…å ±ã‚’è³ªå•ã™ã‚‹å½¢å¼ã§è¿”ã™ã“ã¨ã€‚",
            "lineNumber": 18
          },
          {
            "text": "- **Question Format**: è³ªå•ã¯TOONå½¢å¼ã§ã¯ãªãã€æ˜ç¢ºãªè³ªå•æ–‡ã¨ã—ã¦è¿”ã™ã“ã¨ã€‚ä¾‹ï¼šã€Œjarvisã®å…·ä½“çš„ãªæ•…éšœç—‡çŠ¶ã‚’æ•™ãˆã¦ãã ã•ã„ï¼ˆä¾‹ï¼šé›»æºãŒå…¥ã‚‰ãªã„ã€LEDãŒç‚¹ç¯ã—ãªã„ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãªã©ï¼‰ã€",
            "lineNumber": 19
          },
          {
            "text": "- **Minimal Information**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œã‚ã‹ã‚‰ãªã„ã¨ã“ã‚ã¯å•ã„ã‹ã‘ã¦ãã ã•ã„ã€ã¨æ˜ç¤ºã—ã¦ã„ã‚‹å ´åˆã€ç‰¹ã«æ³¨æ„ã—ã¦æƒ…å ±ä¸è¶³ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã€‚",
            "lineNumber": 20
          }
        ]
      },
      "score": 0.36548733711242676
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 49,
            "column": 53
          }
        },
        "contents": "import streamlit as st\nimport streamlit.components.v1 as components\nimport base64\nfrom core.schemas import Node, Edge, Flowchart\nfrom core.llm_client import LLMClient\nfrom core.toon_parser import TOONParser\nfrom core.history_mgr import HistoryManager\nfrom core.exceptions import LLMAPIError, TOONParseError, FlowchartValidationError\nfrom pathlib import Path\n\nst.set_page_config(layout=\"wide\")\nst.title(\"Flowchart Generator &amp; History Manager\")\n\n# 1. ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–\nhistory_mgr = HistoryManager()\n\n# 2. ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´ã®åˆæœŸåŒ–\nif 'history' not in st.session_state:\n    # åˆæœŸçŠ¶æ…‹ï¼šé–‹å§‹ã¨çµ‚äº†ã®ã¿ã®æ§‹æˆ\n    initial_flow = Flowchart(\n        nodes=[\n            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),\n            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")\n        ],\n        edges=[Edge(source=\"start\", target=\"node_end\")]\n    )\n    st.session_state.history = [initial_flow]\n\n# 3. è³ªå•å¿œç­”ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®åˆæœŸåŒ–\nif 'conversation_context' not in st.session_state:\n    st.session_state.conversation_context = None  # å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\nif 'pending_questions' not in st.session_state:\n    st.session_state.pending_questions = None  # ç¾åœ¨ã®è³ªå•ãƒ†ã‚­ã‚¹ãƒˆ\nif 'question_responses' not in st.session_state:\n    st.session_state.question_responses = []  # å›ç­”ã®ãƒªã‚¹ãƒˆ\nif 'append_mode_for_question' not in st.session_state:\n    st.session_state.append_mode_for_question = False  # è³ªå•æ™‚ã®å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®š\n\n# --- ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼šã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† ---\nst.sidebar.header(\"ğŸ’¾ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†\")\n\n# ä¿å­˜æ¸ˆã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä¸€è¦§ã‚’å–å¾—\nsaved_sessions = history_mgr.list_sessions()\n\n# ã‚»ãƒƒã‚·ãƒ§ãƒ³åã®å…¥åŠ›ï¼ˆæ–°è¦ä½œæˆç”¨ï¼‰\nsession_name = st.sidebar.text_input(\"ã‚»ãƒƒã‚·ãƒ§ãƒ³åï¼ˆæ–°è¦ä½œæˆ/ä¿å­˜ç”¨ï¼‰\", value=\"default_session\")\n\ncol_save, col_load = st.sidebar.columns(2)\nwith col_save:\n    if st.button(\"ä¿å­˜\", use_container_width=True):",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import streamlit as st",
            "lineNumber": 1
          },
          {
            "text": "import streamlit.components.v1 as components",
            "lineNumber": 2
          },
          {
            "text": "import base64",
            "lineNumber": 3
          },
          {
            "text": "from core.schemas import Node, Edge, Flowchart",
            "lineNumber": 4
          },
          {
            "text": "from core.llm_client import LLMClient",
            "lineNumber": 5
          },
          {
            "text": "from core.toon_parser import TOONParser",
            "lineNumber": 6
          },
          {
            "text": "from core.history_mgr import HistoryManager",
            "lineNumber": 7
          },
          {
            "text": "from core.exceptions import LLMAPIError, TOONParseError, FlowchartValidationError",
            "lineNumber": 8
          },
          {
            "text": "from pathlib import Path",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "text": "st.set_page_config(layout=\"wide\")",
            "lineNumber": 11
          },
          {
            "text": "st.title(\"Flowchart Generator &amp; History Manager\")",
            "lineNumber": 12
          },
          {
            "lineNumber": 13
          },
          {
            "text": "# 1. ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–",
            "lineNumber": 14
          },
          {
            "text": "history_mgr = HistoryManager()",
            "lineNumber": 15
          },
          {
            "lineNumber": 16
          },
          {
            "text": "# 2. ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´ã®åˆæœŸåŒ–",
            "lineNumber": 17
          },
          {
            "text": "if 'history' not in st.session_state:",
            "lineNumber": 18
          },
          {
            "text": "    # åˆæœŸçŠ¶æ…‹ï¼šé–‹å§‹ã¨çµ‚äº†ã®ã¿ã®æ§‹æˆ",
            "lineNumber": 19
          },
          {
            "text": "    initial_flow = Flowchart(",
            "lineNumber": 20
          },
          {
            "text": "        nodes=[",
            "lineNumber": 21
          },
          {
            "text": "            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),",
            "lineNumber": 22
          },
          {
            "text": "            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")",
            "lineNumber": 23
          },
          {
            "text": "        ],",
            "lineNumber": 24
          },
          {
            "text": "        edges=[Edge(source=\"start\", target=\"node_end\")]",
            "lineNumber": 25
          },
          {
            "text": "    )",
            "lineNumber": 26
          },
          {
            "text": "    st.session_state.history = [initial_flow]",
            "lineNumber": 27
          },
          {
            "lineNumber": 28
          },
          {
            "text": "# 3. è³ªå•å¿œç­”ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®åˆæœŸåŒ–",
            "lineNumber": 29
          },
          {
            "text": "if 'conversation_context' not in st.session_state:",
            "lineNumber": 30
          },
          {
            "text": "    st.session_state.conversation_context = None  # å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ",
            "lineNumber": 31
          },
          {
            "text": "if 'pending_questions' not in st.session_state:",
            "lineNumber": 32
          },
          {
            "text": "    st.session_state.pending_questions = None  # ç¾åœ¨ã®è³ªå•ãƒ†ã‚­ã‚¹ãƒˆ",
            "lineNumber": 33
          },
          {
            "text": "if 'question_responses' not in st.session_state:",
            "lineNumber": 34
          },
          {
            "text": "    st.session_state.question_responses = []  # å›ç­”ã®ãƒªã‚¹ãƒˆ",
            "lineNumber": 35
          },
          {
            "text": "if 'append_mode_for_question' not in st.session_state:",
            "lineNumber": 36
          },
          {
            "text": "    st.session_state.append_mode_for_question = False  # è³ªå•æ™‚ã®å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®š",
            "lineNumber": 37
          },
          {
            "lineNumber": 38
          },
          {
            "text": "# --- ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼šã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† ---",
            "lineNumber": 39
          },
          {
            "text": "st.sidebar.header(\"ğŸ’¾ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†\")",
            "lineNumber": 40
          },
          {
            "lineNumber": 41
          },
          {
            "text": "# ä¿å­˜æ¸ˆã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä¸€è¦§ã‚’å–å¾—",
            "lineNumber": 42
          },
          {
            "text": "saved_sessions = history_mgr.list_sessions()",
            "lineNumber": 43
          },
          {
            "lineNumber": 44
          },
          {
            "text": "# ã‚»ãƒƒã‚·ãƒ§ãƒ³åã®å…¥åŠ›ï¼ˆæ–°è¦ä½œæˆç”¨ï¼‰",
            "lineNumber": 45
          },
          {
            "text": "session_name = st.sidebar.text_input(\"ã‚»ãƒƒã‚·ãƒ§ãƒ³åï¼ˆæ–°è¦ä½œæˆ/ä¿å­˜ç”¨ï¼‰\", value=\"default_session\")",
            "lineNumber": 46
          },
          {
            "lineNumber": 47
          },
          {
            "text": "col_save, col_load = st.sidebar.columns(2)",
            "lineNumber": 48
          },
          {
            "text": "with col_save:",
            "lineNumber": 49
          },
          {
            "text": "    if st.button(\"ä¿å­˜\", use_container_width=True):",
            "lineNumber": 50
          }
        ]
      },
      "score": 0.3587320148944855
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\Project.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 31
          }
        },
        "contents": "ã“ã‚Œã¾ã§ã®è­°è«–ã‚’çµ±åˆã—ã€æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¼ç”»ä»•æ§˜æ›¸ï¼ˆè¦ä»¶å®šç¾©æ›¸ï¼‰ã®åˆæ¡ˆã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€å®Ÿè£…ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ãŠã‚ˆã³ã€å…¬é–‹æ™‚ã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã®è§£èª¬è³‡æ–™ã¨ã—ã¦ã‚‚æ´»ç”¨ã§ãã‚‹æ§‹æˆã«ã—ã¦ã„ã¾ã™ã€‚\n\n---\n\n# ä¼ç”»ä»•æ§˜æ›¸ï¼šTOON-Flow Visualizer (ä»®)\n\n**ã€œAIã«ã‚ˆã‚‹å¯¾è©±å‹ãƒ­ã‚¸ãƒƒã‚¯æ§‹é€ åŒ–ãƒ»è¦–è¦šåŒ–ã‚·ã‚¹ãƒ†ãƒ ã€œ**\n\n## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èƒŒæ™¯ã¨ç›®çš„\n\nè‡ªç„¶è¨€èªã«ã‚ˆã‚‹æŒ‡ç¤ºã‚„çŠ¶æ³èª¬æ˜ï¼ˆä¾‹ï¼šã€ŒJARVISãŒãŠã‹ã—ã„ã€ï¼‰ã¯æ›–æ˜§ã§ã‚ã‚Šã€è«–ç†çš„ãªæ¬ è½ã‚„çŸ›ç›¾ã‚’å«ã¿ã‚„ã™ã„ã€‚æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€AIã¨ã®å¯¾è©±ã‚’é€šã˜ã¦ã“ã‚Œã‚‰ã®æ›–æ˜§ãªæƒ…å ±ã‚’**TOONï¼ˆToken-Oriented Object Notationï¼‰**å½¢å¼ã§æ§‹é€ åŒ–ã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆåŒ–ã™ã‚‹ã“ã¨ã§ã€**ã€Œæ€è€ƒã®ãƒã‚°ï¼ˆæœªå®Ÿè£…ãƒ»çŸ›ç›¾ï¼‰ã€ã‚’è¦–è¦šçš„ã«ç‰¹å®šãƒ»è§£æ¶ˆã™ã‚‹**ã“ã¨ã‚’ç›®çš„ã¨ã™ã‚‹ã€‚\n\n## 2. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£\n\nä¿¡é ¼æ€§ã¨åŠ¹ç‡ã‚’ä¸¡ç«‹ã•ã›ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®2æ®µéšAIãƒ—ãƒ­ã‚»ã‚¹ã‚’æ¡ç”¨ã™ã‚‹ã€‚\n\n1. **Semantic Layer (å¤§å‹LLM):** ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‡ªç”±å…¥åŠ›ã‚’å—ã‘å–ã‚Šã€æ–‡è„ˆã‚’ç†è§£ã—ã¦TOONå½¢å¼ï¼ˆMarkdownãƒ™ãƒ¼ã‚¹ï¼‰ã®ãƒ­ã‚°ã‚’ç”Ÿæˆãƒ»è¿½è¨˜ã™ã‚‹ã€‚\n2. **Structural Layer (è»½é‡LLM/Gemmaç­‰):** TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æã—ã€ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã®é–¢ä¿‚ã‚’æŠ½å‡ºã—ã¦JSONãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›ã™ã‚‹ã€‚\n3. **Visualization Layer (ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹):** æŠ½å‡ºã•ã‚ŒãŸJSONã«åŸºã¥ãã€å®šç¾©ã•ã‚ŒãŸå¯¾å¿œè¡¨ï¼ˆTOON-Mermaidå¯¾å¿œè¡¨ï¼‰ã«å¾“ã£ã¦Mermaid.jsã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã€Streamlitä¸Šã«æç”»ã™ã‚‹ã€‚\n\n---\n\n## 3. æ©Ÿèƒ½è¦ä»¶\n\n### 3.1 å¯¾è©±å‹TOONæ§‹ç¯‰æ©Ÿèƒ½\n\n* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®ãƒãƒ£ãƒƒãƒˆã‚’é€šã˜ã¦æƒ…å ±ã‚’åé›†ã—ã€Markdownãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ&#96;.md&#96;ï¼‰ã«å·®åˆ†è¿½è¨˜ï¼ˆLoggingï¼‰ã™ã‚‹ã€‚\n* ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã«æ—¢å­˜ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€éå»ã®æ–‡è„ˆã‚’ç¶­æŒã™ã‚‹ã€‚\n\n### 3.2 è¦–è¦šçš„æ‹¡å¼µï¼ˆå›³è§£ï¼‰æ©Ÿèƒ½",
        "signatures": {},
        "detailedLines": [
          {
            "text": "ã“ã‚Œã¾ã§ã®è­°è«–ã‚’çµ±åˆã—ã€æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¼ç”»ä»•æ§˜æ›¸ï¼ˆè¦ä»¶å®šç¾©æ›¸ï¼‰ã®åˆæ¡ˆã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€å®Ÿè£…ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ãŠã‚ˆã³ã€å…¬é–‹æ™‚ã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã®è§£èª¬è³‡æ–™ã¨ã—ã¦ã‚‚æ´»ç”¨ã§ãã‚‹æ§‹æˆã«ã—ã¦ã„ã¾ã™ã€‚",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "---",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "# ä¼ç”»ä»•æ§˜æ›¸ï¼šTOON-Flow Visualizer (ä»®)",
            "lineNumber": 5
          },
          {
            "lineNumber": 6
          },
          {
            "text": "**ã€œAIã«ã‚ˆã‚‹å¯¾è©±å‹ãƒ­ã‚¸ãƒƒã‚¯æ§‹é€ åŒ–ãƒ»è¦–è¦šåŒ–ã‚·ã‚¹ãƒ†ãƒ ã€œ**",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èƒŒæ™¯ã¨ç›®çš„",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "text": "è‡ªç„¶è¨€èªã«ã‚ˆã‚‹æŒ‡ç¤ºã‚„çŠ¶æ³èª¬æ˜ï¼ˆä¾‹ï¼šã€ŒJARVISãŒãŠã‹ã—ã„ã€ï¼‰ã¯æ›–æ˜§ã§ã‚ã‚Šã€è«–ç†çš„ãªæ¬ è½ã‚„çŸ›ç›¾ã‚’å«ã¿ã‚„ã™ã„ã€‚æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€AIã¨ã®å¯¾è©±ã‚’é€šã˜ã¦ã“ã‚Œã‚‰ã®æ›–æ˜§ãªæƒ…å ±ã‚’**TOONï¼ˆToken-Oriented Object Notationï¼‰**å½¢å¼ã§æ§‹é€ åŒ–ã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆåŒ–ã™ã‚‹ã“ã¨ã§ã€**ã€Œæ€è€ƒã®ãƒã‚°ï¼ˆæœªå®Ÿè£…ãƒ»çŸ›ç›¾ï¼‰ã€ã‚’è¦–è¦šçš„ã«ç‰¹å®šãƒ»è§£æ¶ˆã™ã‚‹**ã“ã¨ã‚’ç›®çš„ã¨ã™ã‚‹ã€‚",
            "lineNumber": 11
          },
          {
            "lineNumber": 12
          },
          {
            "text": "## 2. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£",
            "lineNumber": 13
          },
          {
            "lineNumber": 14
          },
          {
            "text": "ä¿¡é ¼æ€§ã¨åŠ¹ç‡ã‚’ä¸¡ç«‹ã•ã›ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®2æ®µéšAIãƒ—ãƒ­ã‚»ã‚¹ã‚’æ¡ç”¨ã™ã‚‹ã€‚",
            "lineNumber": 15
          },
          {
            "lineNumber": 16
          },
          {
            "text": "1. **Semantic Layer (å¤§å‹LLM):** ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‡ªç”±å…¥åŠ›ã‚’å—ã‘å–ã‚Šã€æ–‡è„ˆã‚’ç†è§£ã—ã¦TOONå½¢å¼ï¼ˆMarkdownãƒ™ãƒ¼ã‚¹ï¼‰ã®ãƒ­ã‚°ã‚’ç”Ÿæˆãƒ»è¿½è¨˜ã™ã‚‹ã€‚",
            "lineNumber": 17
          },
          {
            "text": "2. **Structural Layer (è»½é‡LLM/Gemmaç­‰):** TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æã—ã€ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã®é–¢ä¿‚ã‚’æŠ½å‡ºã—ã¦JSONãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›ã™ã‚‹ã€‚",
            "lineNumber": 18
          },
          {
            "text": "3. **Visualization Layer (ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹):** æŠ½å‡ºã•ã‚ŒãŸJSONã«åŸºã¥ãã€å®šç¾©ã•ã‚ŒãŸå¯¾å¿œè¡¨ï¼ˆTOON-Mermaidå¯¾å¿œè¡¨ï¼‰ã«å¾“ã£ã¦Mermaid.jsã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã€Streamlitä¸Šã«æç”»ã™ã‚‹ã€‚",
            "lineNumber": 19
          },
          {
            "lineNumber": 20
          },
          {
            "text": "---",
            "lineNumber": 21
          },
          {
            "lineNumber": 22
          },
          {
            "text": "## 3. æ©Ÿèƒ½è¦ä»¶",
            "lineNumber": 23
          },
          {
            "lineNumber": 24
          },
          {
            "text": "### 3.1 å¯¾è©±å‹TOONæ§‹ç¯‰æ©Ÿèƒ½",
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "text": "* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®ãƒãƒ£ãƒƒãƒˆã‚’é€šã˜ã¦æƒ…å ±ã‚’åé›†ã—ã€Markdownãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ&#96;.md&#96;ï¼‰ã«å·®åˆ†è¿½è¨˜ï¼ˆLoggingï¼‰ã™ã‚‹ã€‚",
            "lineNumber": 27
          },
          {
            "text": "* ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã«æ—¢å­˜ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€éå»ã®æ–‡è„ˆã‚’ç¶­æŒã™ã‚‹ã€‚",
            "lineNumber": 28
          },
          {
            "lineNumber": 29
          },
          {
            "text": "### 3.2 è¦–è¦šçš„æ‹¡å¼µï¼ˆå›³è§£ï¼‰æ©Ÿèƒ½",
            "lineNumber": 30
          }
        ]
      },
      "score": 0.3543485105037689
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 207,
            "column": 79
          },
          "endPosition": {
            "line": 225,
            "column": 107
          }
        },
        "contents": "                    \n                    # å†é€ä¿¡å‡¦ç†\n                    with st.spinner(\"LLMãŒãƒ•ãƒ­ãƒ¼ã‚’è¨­è¨ˆä¸­...\"):\n                        raw_toon_text = \"\"\n                        try:\n                            client = LLMClient()\n                            raw_toon_text = client.generate_flow(combined_prompt, current_flow if append_mode_flag else None)\n                            \n                            # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯\n                            if client.is_question_response(raw_toon_text):\n                                # å†åº¦è³ªå•ãŒæ¥ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°\n                                st.session_state.conversation_context = combined_prompt\n                                st.session_state.pending_questions = raw_toon_text\n                                st.session_state.question_responses = []  # æ–°ã—ã„è³ªå•ãªã®ã§å›ç­”ã‚’ãƒªã‚»ãƒƒãƒˆ\n                                st.info(\"LLMã‹ã‚‰è¿½åŠ ã®è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n                                st.rerun()\n                            else:\n                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹æˆåŠŸæ™‚ã®ã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                    ",
            "lineNumber": 209
          },
          {
            "text": "                    # å†é€ä¿¡å‡¦ç†",
            "lineNumber": 210
          },
          {
            "text": "                    with st.spinner(\"LLMãŒãƒ•ãƒ­ãƒ¼ã‚’è¨­è¨ˆä¸­...\"):",
            "lineNumber": 211
          },
          {
            "text": "                        raw_toon_text = \"\"",
            "lineNumber": 212
          },
          {
            "text": "                        try:",
            "lineNumber": 213
          },
          {
            "text": "                            client = LLMClient()",
            "lineNumber": 214
          },
          {
            "text": "                            raw_toon_text = client.generate_flow(combined_prompt, current_flow if append_mode_flag else None)",
            "lineNumber": 215
          },
          {
            "text": "                            ",
            "lineNumber": 216
          },
          {
            "text": "                            # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 217
          },
          {
            "text": "                            if client.is_question_response(raw_toon_text):",
            "lineNumber": 218
          },
          {
            "text": "                                # å†åº¦è³ªå•ãŒæ¥ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°",
            "lineNumber": 219
          },
          {
            "text": "                                st.session_state.conversation_context = combined_prompt",
            "lineNumber": 220
          },
          {
            "text": "                                st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 221
          },
          {
            "text": "                                st.session_state.question_responses = []  # æ–°ã—ã„è³ªå•ãªã®ã§å›ç­”ã‚’ãƒªã‚»ãƒƒãƒˆ",
            "lineNumber": 222
          },
          {
            "text": "                                st.info(\"LLMã‹ã‚‰è¿½åŠ ã®è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 223
          },
          {
            "text": "                                st.rerun()",
            "lineNumber": 224
          },
          {
            "text": "                            else:",
            "lineNumber": 225
          },
          {
            "text": "                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹æˆåŠŸæ™‚ã®ã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ",
            "lineNumber": 226
          }
        ]
      },
      "score": 0.35288554430007935
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\program_base.md",
        "range": {
          "startPosition": {
            "line": 40
          },
          "endPosition": {
            "line": 93
          }
        },
        "contents": "* Markdownå½¢å¼ã®TOONã‚’æ­£è¦è¡¨ç¾ï¼ˆRegexï¼‰ãªã©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã€&#96;models.py&#96; ã§å®šç¾©ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚¹ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚\n* **ã€Œå·®åˆ†ï¼ˆLOGï¼‰ã€ã®åæ˜ ãƒ­ã‚¸ãƒƒã‚¯**ã‚‚ã“ã“ã«æŒã¡ã¾ã™ã€‚å¤ã„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«LOGã®å†…å®¹ã‚’ä¸Šæ›¸ãã—ã¦ã€æœ€æ–°ã®çŠ¶æ…‹ã‚’ä½œã‚‹è²¬ä»»è€…ã§ã™ã€‚\n\n### â‘¢ &#96;generator/mermaid_gen.py&#96;\n\n**è²¬ä»»ï¼šè¦–è¦šåŒ–ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰**\n\n* &#96;models.py&#96; ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å—ã‘å–ã‚Šã€è¦å®šã—ãŸå¯¾å¿œè¡¨ã«åŸºã¥ã„ã¦ Mermaid æ§‹æ–‡ï¼ˆ&#96;([ ])&#96;, &#96;{ }&#96;ãªã©ï¼‰ã®æ–‡å­—åˆ—ã‚’çµ„ã¿ç«‹ã¦ã¾ã™ã€‚\n* ãƒãƒ¼ãƒ‰ã®è‰²ä»˜ã‘ï¼ˆ&#96;style&#96; æ§‹æ–‡ï¼‰ã®æ³¨å…¥ã‚‚ã“ã“ã§è¡Œã„ã¾ã™ã€‚\n\n### â‘£ &#96;llm/agent.py&#96;\n\n**è²¬ä»»ï¼šAIã¨ã®æ„æ€ç–é€š**\n\n* å¤§å‹LLMï¼ˆGPT-4oç­‰ï¼‰ã«å¯¾ã—ã€ç¾åœ¨ã®TOONã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’æ¸¡ã—ã€**ã€Œæ–°ã—ã„TOONã®å·®åˆ†è¡Œã€**ã‚’ç”Ÿæˆã•ã›ã¾ã™ã€‚\n* ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ç®¡ç†ã‚‚ã“ã“ã§è¡Œã„ã¾ã™ã€‚\n\n### â‘¤ &#96;app.py&#96;\n\n**è²¬ä»»ï¼šUIè¡¨ç¤ºã¨çŠ¶æ…‹ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**\n\n* Streamlitã®ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€‚\n* &#96;st.session_state&#96; ã‚’ä½¿ã„ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’å—ã‘ã¦ &#96;agent&#96; â†’ &#96;parser&#96; â†’ &#96;generator&#96; ã®é †ã«å‘¼ã³å‡ºã™å¸ä»¤å¡”ã§ã™ã€‚\n\n---\n\n## 3. ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å‹•ä½œãƒ•ãƒ­ãƒ¼ï¼ˆå›³è§£ï¼‰\n\n1ãƒ•ã‚¡ã‚¤ãƒ«1è²¬ä»»ã‚’å¾¹åº•ã™ã‚‹ã“ã¨ã§ã€æƒ…å ±ã®æµã‚ŒãŒä¸€æœ¬é“ã«ãªã‚Šã€ãƒ‡ãƒãƒƒã‚°ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚\n\n&#96;&#96;&#96;mermaid\ngraph LR\n    User([ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›]) --&gt; App[app.py]\n    App --&gt; Agent[llm/agent.py]\n    Agent --&gt;|TOONå·®åˆ†| Parser[parser/toon_parser.py]\n    Parser --&gt;|æœ€æ–°ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«| App\n    App --&gt; Gen[generator/mermaid_gen.py]\n    Gen --&gt;|Mermaidæ–‡å­—åˆ—| App\n    App --&gt; UI[ğŸ–¥ï¸ Streamlitè¡¨ç¤º]\n\n    subgraph Data\n        Parser -.-&gt; Snapshot[(TOON.md)]\n    end\n\n&#96;&#96;&#96;\n\n---\n\n## 4. ã“ã®æ§‹é€ ã®ãƒ¡ãƒªãƒƒãƒˆ\n\n* **äº¤æ›å¯èƒ½æ€§:** ã€ŒMermaidã§ã¯ãªãåˆ¥ã®å›³è§£ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã„ãŸã„ã€ã¨æ€ã£ãŸã‚‰ã€&#96;mermaid_gen.py&#96; ã ã‘ã‚’æ›¸ãæ›ãˆã‚Œã°æ¸ˆã¿ã¾ã™ã€‚\n* **ãƒ†ã‚¹ãƒˆã®å®¹æ˜“ã•:** AIãŒã„ãªãã¦ã‚‚ã€&#96;template.md&#96; ã‚’ &#96;toon_parser.py&#96; ã«èª­ã¿è¾¼ã¾ã›ã‚‹ã ã‘ã§ã€å›³è§£ãƒ­ã‚¸ãƒƒã‚¯ãŒæ­£ã—ã„ã‹ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚",
        "signatures": {},
        "detailedLines": [
          {
            "text": "* Markdownå½¢å¼ã®TOONã‚’æ­£è¦è¡¨ç¾ï¼ˆRegexï¼‰ãªã©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã€&#96;models.py&#96; ã§å®šç¾©ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚¹ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚",
            "lineNumber": 42
          },
          {
            "text": "* **ã€Œå·®åˆ†ï¼ˆLOGï¼‰ã€ã®åæ˜ ãƒ­ã‚¸ãƒƒã‚¯**ã‚‚ã“ã“ã«æŒã¡ã¾ã™ã€‚å¤ã„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«LOGã®å†…å®¹ã‚’ä¸Šæ›¸ãã—ã¦ã€æœ€æ–°ã®çŠ¶æ…‹ã‚’ä½œã‚‹è²¬ä»»è€…ã§ã™ã€‚",
            "lineNumber": 43
          },
          {
            "lineNumber": 44
          },
          {
            "text": "### â‘¢ &#96;generator/mermaid_gen.py&#96;",
            "lineNumber": 45
          },
          {
            "lineNumber": 46
          },
          {
            "text": "**è²¬ä»»ï¼šè¦–è¦šåŒ–ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰**",
            "lineNumber": 47
          },
          {
            "lineNumber": 48
          },
          {
            "text": "* &#96;models.py&#96; ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å—ã‘å–ã‚Šã€è¦å®šã—ãŸå¯¾å¿œè¡¨ã«åŸºã¥ã„ã¦ Mermaid æ§‹æ–‡ï¼ˆ&#96;([ ])&#96;, &#96;{ }&#96;ãªã©ï¼‰ã®æ–‡å­—åˆ—ã‚’çµ„ã¿ç«‹ã¦ã¾ã™ã€‚",
            "lineNumber": 49
          },
          {
            "text": "* ãƒãƒ¼ãƒ‰ã®è‰²ä»˜ã‘ï¼ˆ&#96;style&#96; æ§‹æ–‡ï¼‰ã®æ³¨å…¥ã‚‚ã“ã“ã§è¡Œã„ã¾ã™ã€‚",
            "lineNumber": 50
          },
          {
            "lineNumber": 51
          },
          {
            "text": "### â‘£ &#96;llm/agent.py&#96;",
            "lineNumber": 52
          },
          {
            "lineNumber": 53
          },
          {
            "text": "**è²¬ä»»ï¼šAIã¨ã®æ„æ€ç–é€š**",
            "lineNumber": 54
          },
          {
            "lineNumber": 55
          },
          {
            "text": "* å¤§å‹LLMï¼ˆGPT-4oç­‰ï¼‰ã«å¯¾ã—ã€ç¾åœ¨ã®TOONã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’æ¸¡ã—ã€**ã€Œæ–°ã—ã„TOONã®å·®åˆ†è¡Œã€**ã‚’ç”Ÿæˆã•ã›ã¾ã™ã€‚",
            "lineNumber": 56
          },
          {
            "text": "* ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ç®¡ç†ã‚‚ã“ã“ã§è¡Œã„ã¾ã™ã€‚",
            "lineNumber": 57
          },
          {
            "lineNumber": 58
          },
          {
            "text": "### â‘¤ &#96;app.py&#96;",
            "lineNumber": 59
          },
          {
            "lineNumber": 60
          },
          {
            "text": "**è²¬ä»»ï¼šUIè¡¨ç¤ºã¨çŠ¶æ…‹ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**",
            "lineNumber": 61
          },
          {
            "lineNumber": 62
          },
          {
            "text": "* Streamlitã®ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€‚",
            "lineNumber": 63
          },
          {
            "text": "* &#96;st.session_state&#96; ã‚’ä½¿ã„ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’å—ã‘ã¦ &#96;agent&#96; â†’ &#96;parser&#96; â†’ &#96;generator&#96; ã®é †ã«å‘¼ã³å‡ºã™å¸ä»¤å¡”ã§ã™ã€‚",
            "lineNumber": 64
          },
          {
            "lineNumber": 65
          },
          {
            "text": "---",
            "lineNumber": 66
          },
          {
            "lineNumber": 67
          },
          {
            "text": "## 3. ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å‹•ä½œãƒ•ãƒ­ãƒ¼ï¼ˆå›³è§£ï¼‰",
            "lineNumber": 68
          },
          {
            "lineNumber": 69
          },
          {
            "text": "1ãƒ•ã‚¡ã‚¤ãƒ«1è²¬ä»»ã‚’å¾¹åº•ã™ã‚‹ã“ã¨ã§ã€æƒ…å ±ã®æµã‚ŒãŒä¸€æœ¬é“ã«ãªã‚Šã€ãƒ‡ãƒãƒƒã‚°ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚",
            "lineNumber": 70
          },
          {
            "lineNumber": 71
          },
          {
            "text": "&#96;&#96;&#96;mermaid",
            "lineNumber": 72
          },
          {
            "text": "graph LR",
            "lineNumber": 73
          },
          {
            "text": "    User([ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›]) --&gt; App[app.py]",
            "lineNumber": 74
          },
          {
            "text": "    App --&gt; Agent[llm/agent.py]",
            "lineNumber": 75
          },
          {
            "text": "    Agent --&gt;|TOONå·®åˆ†| Parser[parser/toon_parser.py]",
            "lineNumber": 76
          },
          {
            "text": "    Parser --&gt;|æœ€æ–°ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«| App",
            "lineNumber": 77
          },
          {
            "text": "    App --&gt; Gen[generator/mermaid_gen.py]",
            "lineNumber": 78
          },
          {
            "text": "    Gen --&gt;|Mermaidæ–‡å­—åˆ—| App",
            "lineNumber": 79
          },
          {
            "text": "    App --&gt; UI[ğŸ–¥ï¸ Streamlitè¡¨ç¤º]",
            "lineNumber": 80
          },
          {
            "lineNumber": 81
          },
          {
            "text": "    subgraph Data",
            "lineNumber": 82
          },
          {
            "text": "        Parser -.-&gt; Snapshot[(TOON.md)]",
            "lineNumber": 83
          },
          {
            "text": "    end",
            "lineNumber": 84
          },
          {
            "lineNumber": 85
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 86
          },
          {
            "lineNumber": 87
          },
          {
            "text": "---",
            "lineNumber": 88
          },
          {
            "lineNumber": 89
          },
          {
            "text": "## 4. ã“ã®æ§‹é€ ã®ãƒ¡ãƒªãƒƒãƒˆ",
            "lineNumber": 90
          },
          {
            "lineNumber": 91
          },
          {
            "text": "* **äº¤æ›å¯èƒ½æ€§:** ã€ŒMermaidã§ã¯ãªãåˆ¥ã®å›³è§£ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã„ãŸã„ã€ã¨æ€ã£ãŸã‚‰ã€&#96;mermaid_gen.py&#96; ã ã‘ã‚’æ›¸ãæ›ãˆã‚Œã°æ¸ˆã¿ã¾ã™ã€‚",
            "lineNumber": 92
          },
          {
            "text": "* **ãƒ†ã‚¹ãƒˆã®å®¹æ˜“ã•:** AIãŒã„ãªãã¦ã‚‚ã€&#96;template.md&#96; ã‚’ &#96;toon_parser.py&#96; ã«èª­ã¿è¾¼ã¾ã›ã‚‹ã ã‘ã§ã€å›³è§£ãƒ­ã‚¸ãƒƒã‚¯ãŒæ­£ã—ã„ã‹ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚",
            "lineNumber": 93
          }
        ]
      },
      "score": 0.33881425857543945
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 21,
            "column": 31
          },
          "endPosition": {
            "line": 271
          }
        },
        "contents": "class Flowchart(BaseModel):\n    nodes: List[Node]\n    edges: List[Edge]\n\n    @field_validator('nodes')\n    @classmethod\n    def validate_flow_structure(cls, v: List[Node]) -&gt; List[Node]:\n        if not v:\n            raise FlowchartValidationError(\"ãƒãƒ¼ãƒ‰ãŒ1ã¤ã‚‚å­˜åœ¨ã—ã¾ã›ã‚“\")\n        \n        # é–‹å§‹/çµ‚äº†ãƒãƒ¼ãƒ‰ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯\n        types = {node.type for node in v}\n        if \"start\" not in types or \"end\" not in types:\n            raise FlowchartValidationError(\"é–‹å§‹/çµ‚äº†ãƒãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™\")\n        \n        # ãƒãƒ¼ãƒ‰IDã®é‡è¤‡ãƒã‚§ãƒƒã‚¯\n        node_ids = [node.id for node in v]\n        duplicates = [node_id for node_id in node_ids if node_ids.count(node_id) &gt; 1]\n        if duplicates:\n            raise FlowchartValidationError(f\"ãƒãƒ¼ãƒ‰IDãŒé‡è¤‡ã—ã¦ã„ã¾ã™: {set(duplicates)}\")\n        \n        # ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã®æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯\n        valid_types = {\"start\", \"end\", \"process\", \"decision\", \"io_data\", \"storage\", \"missing\"}\n        invalid_types = [node.type for node in v if node.type not in valid_types]\n        if invalid_types:\n            raise FlowchartValidationError(f\"ç„¡åŠ¹ãªãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™: {set(invalid_types)}\")\n        \n        return v\n\n    @model_validator(mode='after')\n    def validate_edges_reference_nodes(self):\n        \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 24,
            "isSignature": true
          },
          {
            "text": "    nodes: List[Node]",
            "lineNumber": 25
          },
          {
            "text": "    edges: List[Edge]",
            "lineNumber": 26
          },
          {
            "lineNumber": 27
          },
          {
            "text": "    @field_validator('nodes')",
            "lineNumber": 28
          },
          {
            "text": "    @classmethod",
            "lineNumber": 29
          },
          {
            "text": "    def validate_flow_structure(cls, v: List[Node]) -&gt; List[Node]:",
            "lineNumber": 30
          },
          {
            "text": "        if not v:",
            "lineNumber": 31
          },
          {
            "text": "            raise FlowchartValidationError(\"ãƒãƒ¼ãƒ‰ãŒ1ã¤ã‚‚å­˜åœ¨ã—ã¾ã›ã‚“\")",
            "lineNumber": 32
          },
          {
            "text": "        ",
            "lineNumber": 33
          },
          {
            "text": "        # é–‹å§‹/çµ‚äº†ãƒãƒ¼ãƒ‰ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 34
          },
          {
            "text": "        types = {node.type for node in v}",
            "lineNumber": 35
          },
          {
            "text": "        if \"start\" not in types or \"end\" not in types:",
            "lineNumber": 36
          },
          {
            "text": "            raise FlowchartValidationError(\"é–‹å§‹/çµ‚äº†ãƒãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™\")",
            "lineNumber": 37
          },
          {
            "text": "        ",
            "lineNumber": 38
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰IDã®é‡è¤‡ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 39
          },
          {
            "text": "        node_ids = [node.id for node in v]",
            "lineNumber": 40
          },
          {
            "text": "        duplicates = [node_id for node_id in node_ids if node_ids.count(node_id) &gt; 1]",
            "lineNumber": 41
          },
          {
            "text": "        if duplicates:",
            "lineNumber": 42
          },
          {
            "text": "            raise FlowchartValidationError(f\"ãƒãƒ¼ãƒ‰IDãŒé‡è¤‡ã—ã¦ã„ã¾ã™: {set(duplicates)}\")",
            "lineNumber": 43
          },
          {
            "text": "        ",
            "lineNumber": 44
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã®æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 45
          },
          {
            "text": "        valid_types = {\"start\", \"end\", \"process\", \"decision\", \"io_data\", \"storage\", \"missing\"}",
            "lineNumber": 46
          },
          {
            "text": "        invalid_types = [node.type for node in v if node.type not in valid_types]",
            "lineNumber": 47
          },
          {
            "text": "        if invalid_types:",
            "lineNumber": 48
          },
          {
            "text": "            raise FlowchartValidationError(f\"ç„¡åŠ¹ãªãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™: {set(invalid_types)}\")",
            "lineNumber": 49
          },
          {
            "text": "        ",
            "lineNumber": 50
          },
          {
            "text": "        return v",
            "lineNumber": 51
          },
          {
            "lineNumber": 52
          },
          {
            "text": "    @model_validator(mode='after')",
            "lineNumber": 53
          },
          {
            "text": "    def validate_edges_reference_nodes(self):",
            "lineNumber": 54
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 55
          }
        ]
      },
      "score": 0.3296295404434204
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\TOON_BASE.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 40,
            "column": 13
          }
        },
        "contents": "# Output Format: TOON (Token-Oriented Object Notation)\n\nå›ç­”ã¯ä»¥ä¸‹ã®ãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ã®ã¿ã§æ§‹æˆã—ã¦ãã ã•ã„ã€‚è§£èª¬ã‚„å°å…¥æ–‡ã¯ä¸€åˆ‡ç¦æ­¢ã—ã¾ã™ã€‚\n\n[Node]\nid: (è‹±æ•°å­—ID)\nlabel: (å·¥ç¨‹å)\ntype: (start | end | process | decision | io_data | storage)\n\n[Edge]\nsource: (ç™ºä¿¡å…ƒID)\ntarget: (å®›å…ˆID)\nlabel: (åˆ†å²æ¡ä»¶ãŒã‚ã‚‹å ´åˆã®ã¿)\n\n## Examples\n[Node]\nid: start\nlabel: é–‹å§‹\ntype: start\n[Node]\nid: task1\nlabel: å‡¦ç†\ntype: process\n[Node]\nid: node_end\nlabel: çµ‚äº†\ntype: end\n[Edge]\nsource: start\ntarget: task1\n[Edge]\nsource: task1\ntarget: node_end\n[Node]\nid: input1\nlabel: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›\ntype: io_data\n[Node]\nid: db1\nlabel: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹\ntype: storage",
        "signatures": {},
        "detailedLines": [
          {
            "text": "# Output Format: TOON (Token-Oriented Object Notation)",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "å›ç­”ã¯ä»¥ä¸‹ã®ãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ã®ã¿ã§æ§‹æˆã—ã¦ãã ã•ã„ã€‚è§£èª¬ã‚„å°å…¥æ–‡ã¯ä¸€åˆ‡ç¦æ­¢ã—ã¾ã™ã€‚",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "[Node]",
            "lineNumber": 5
          },
          {
            "text": "id: (è‹±æ•°å­—ID)",
            "lineNumber": 6
          },
          {
            "text": "label: (å·¥ç¨‹å)",
            "lineNumber": 7
          },
          {
            "text": "type: (start | end | process | decision | io_data | storage)",
            "lineNumber": 8
          },
          {
            "lineNumber": 9
          },
          {
            "text": "[Edge]",
            "lineNumber": 10
          },
          {
            "text": "source: (ç™ºä¿¡å…ƒID)",
            "lineNumber": 11
          },
          {
            "text": "target: (å®›å…ˆID)",
            "lineNumber": 12
          },
          {
            "text": "label: (åˆ†å²æ¡ä»¶ãŒã‚ã‚‹å ´åˆã®ã¿)",
            "lineNumber": 13
          },
          {
            "lineNumber": 14
          },
          {
            "text": "## Examples",
            "lineNumber": 15
          },
          {
            "text": "[Node]",
            "lineNumber": 16
          },
          {
            "text": "id: start",
            "lineNumber": 17
          },
          {
            "text": "label: é–‹å§‹",
            "lineNumber": 18
          },
          {
            "text": "type: start",
            "lineNumber": 19
          },
          {
            "text": "[Node]",
            "lineNumber": 20
          },
          {
            "text": "id: task1",
            "lineNumber": 21
          },
          {
            "text": "label: å‡¦ç†",
            "lineNumber": 22
          },
          {
            "text": "type: process",
            "lineNumber": 23
          },
          {
            "text": "[Node]",
            "lineNumber": 24
          },
          {
            "text": "id: node_end",
            "lineNumber": 25
          },
          {
            "text": "label: çµ‚äº†",
            "lineNumber": 26
          },
          {
            "text": "type: end",
            "lineNumber": 27
          },
          {
            "text": "[Edge]",
            "lineNumber": 28
          },
          {
            "text": "source: start",
            "lineNumber": 29
          },
          {
            "text": "target: task1",
            "lineNumber": 30
          },
          {
            "text": "[Edge]",
            "lineNumber": 31
          },
          {
            "text": "source: task1",
            "lineNumber": 32
          },
          {
            "text": "target: node_end",
            "lineNumber": 33
          },
          {
            "text": "[Node]",
            "lineNumber": 34
          },
          {
            "text": "id: input1",
            "lineNumber": 35
          },
          {
            "text": "label: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›",
            "lineNumber": 36
          },
          {
            "text": "type: io_data",
            "lineNumber": 37
          },
          {
            "text": "[Node]",
            "lineNumber": 38
          },
          {
            "text": "id: db1",
            "lineNumber": 39
          },
          {
            "text": "label: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹",
            "lineNumber": 40
          },
          {
            "text": "type: storage",
            "lineNumber": 41
          }
        ]
      },
      "score": 0.32208335399627686
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 23
          },
          "endPosition": {
            "line": 271
          }
        },
        "contents": "class Flowchart(BaseModel):\n@staticmethod\ndef _get_node_shape(node_type: str) -&gt; str:\n  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯MISSING\n\n    @staticmethod\n    def _get_status_color(status: NodeStatus) -&gt; str:\n        \"\"\"ãƒãƒ¼ãƒ‰çŠ¶æ…‹ã«å¿œã˜ãŸè‰²ã‚’è¿”ã™\"\"\"\n        color_map = {\n            NodeStatus.ACTIVE: \"#90EE90\",      # ãƒ©ã‚¤ãƒˆã‚°ãƒªãƒ¼ãƒ³\n            NodeStatus.COMPLETED: \"#87CEEB\",   # ã‚¹ã‚«ã‚¤ãƒ–ãƒ«ãƒ¼\n            NodeStatus.MISSING: \"#FF6B6B\"       # èµ¤\n        }\n        return color_map.get(status, \"#D3D3D3\")  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã‚°ãƒ¬ãƒ¼\n\n    def to_mermaid(self) -&gt; str:\n        \"\"\"Flowchartã‚’Mermaidæ§‹æ–‡ã«å¤‰æ›\"\"\"\n        lines = [\"graph TD\"]\n        style_lines = []\n        \n        # ãƒãƒ¼ãƒ‰å®šç¾©\n        for n in self.nodes:\n            # IDãŒ 'end' ã ã¨äºˆç´„èªè¡çªã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ãŸã‚ã€å®‰å…¨ã«å¤‰æ›\n            safe_id = f\"n_{n.id}\" if n.id == \"end\" else n.id\n            \n            # ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸå½¢çŠ¶ã‚’å–å¾—\n            shape = self._get_node_shape(n.type)\n            \n            # æ—¥æœ¬èªãƒ©ãƒ™ãƒ«ã¯å¿…ãšãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§å›²ã‚€\n            # å½¢çŠ¶æ§‹æ–‡ã«ãƒ©ãƒ™ãƒ«ã‚’åŸ‹ã‚è¾¼ã‚€\n            if shape == \"([ ])\":  # START/END\n                lines.append(f'{safe_id}[\"{n.label}\"]')\n            elif shape == \"[ ]\":  # PROCESS\n                lines.append(f'{safe_id}[\"{n.label}\"]')\n            elif shape == \"{ }\":  # DECISION\n                lines.append(f'{safe_id}{{\"{n.label}\"}}')\n            elif shape == \"[/ /]\":  # IO_DATA (å¹³è¡Œå››è¾ºå½¢)\n                lines.append(f'{safe_id}[/\"{n.label}\"/]')\n            elif shape == \"[( )]\":  # STORAGE (å††ç­’å½¢)\n                lines.append(f'{safe_id}[(\"{n.label}\")]')\n            elif shape == \"{{ }}\":  # MISSING\n                lines.append(f'{safe_id}{{\"{n.label}\"}}')\n            \n            # çŠ¶æ…‹ã«å¿œã˜ãŸã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ \n            color = self._get_status_color(n.status)\n            style_lines.append(f'    style {safe_id} fill:{color}')\n        \n        # ã‚¨ãƒƒã‚¸å®šç¾©\n        for e in self.edges:",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 24,
                "column": 1
              },
              "endPosition": {
                "line": 25,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 24,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 175
          },
          {
            "text": "def _get_node_shape(node_type: str) -&gt; str:",
            "lineNumber": 176
          },
          {
            "text": "  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯MISSING",
            "lineNumber": 187
          },
          {
            "lineNumber": 188
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 189
          },
          {
            "text": "    def _get_status_color(status: NodeStatus) -&gt; str:",
            "lineNumber": 190
          },
          {
            "text": "        \"\"\"ãƒãƒ¼ãƒ‰çŠ¶æ…‹ã«å¿œã˜ãŸè‰²ã‚’è¿”ã™\"\"\"",
            "lineNumber": 191
          },
          {
            "text": "        color_map = {",
            "lineNumber": 192
          },
          {
            "text": "            NodeStatus.ACTIVE: \"#90EE90\",      # ãƒ©ã‚¤ãƒˆã‚°ãƒªãƒ¼ãƒ³",
            "lineNumber": 193
          },
          {
            "text": "            NodeStatus.COMPLETED: \"#87CEEB\",   # ã‚¹ã‚«ã‚¤ãƒ–ãƒ«ãƒ¼",
            "lineNumber": 194
          },
          {
            "text": "            NodeStatus.MISSING: \"#FF6B6B\"       # èµ¤",
            "lineNumber": 195
          },
          {
            "text": "        }",
            "lineNumber": 196
          },
          {
            "text": "        return color_map.get(status, \"#D3D3D3\")  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã‚°ãƒ¬ãƒ¼",
            "lineNumber": 197
          },
          {
            "lineNumber": 198
          },
          {
            "text": "    def to_mermaid(self) -&gt; str:",
            "lineNumber": 199
          },
          {
            "text": "        \"\"\"Flowchartã‚’Mermaidæ§‹æ–‡ã«å¤‰æ›\"\"\"",
            "lineNumber": 200
          },
          {
            "text": "        lines = [\"graph TD\"]",
            "lineNumber": 201
          },
          {
            "text": "        style_lines = []",
            "lineNumber": 202
          },
          {
            "text": "        ",
            "lineNumber": 203
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰å®šç¾©",
            "lineNumber": 204
          },
          {
            "text": "        for n in self.nodes:",
            "lineNumber": 205
          },
          {
            "text": "            # IDãŒ 'end' ã ã¨äºˆç´„èªè¡çªã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ãŸã‚ã€å®‰å…¨ã«å¤‰æ›",
            "lineNumber": 206
          },
          {
            "text": "            safe_id = f\"n_{n.id}\" if n.id == \"end\" else n.id",
            "lineNumber": 207
          },
          {
            "text": "            ",
            "lineNumber": 208
          },
          {
            "text": "            # ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸå½¢çŠ¶ã‚’å–å¾—",
            "lineNumber": 209
          },
          {
            "text": "            shape = self._get_node_shape(n.type)",
            "lineNumber": 210
          },
          {
            "text": "            ",
            "lineNumber": 211
          },
          {
            "text": "            # æ—¥æœ¬èªãƒ©ãƒ™ãƒ«ã¯å¿…ãšãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§å›²ã‚€",
            "lineNumber": 212
          },
          {
            "text": "            # å½¢çŠ¶æ§‹æ–‡ã«ãƒ©ãƒ™ãƒ«ã‚’åŸ‹ã‚è¾¼ã‚€",
            "lineNumber": 213
          },
          {
            "text": "            if shape == \"([ ])\":  # START/END",
            "lineNumber": 214
          },
          {
            "text": "                lines.append(f'{safe_id}[\"{n.label}\"]')",
            "lineNumber": 215
          },
          {
            "text": "            elif shape == \"[ ]\":  # PROCESS",
            "lineNumber": 216
          },
          {
            "text": "                lines.append(f'{safe_id}[\"{n.label}\"]')",
            "lineNumber": 217
          },
          {
            "text": "            elif shape == \"{ }\":  # DECISION",
            "lineNumber": 218
          },
          {
            "text": "                lines.append(f'{safe_id}{{\"{n.label}\"}}')",
            "lineNumber": 219
          },
          {
            "text": "            elif shape == \"[/ /]\":  # IO_DATA (å¹³è¡Œå››è¾ºå½¢)",
            "lineNumber": 220
          },
          {
            "text": "                lines.append(f'{safe_id}[/\"{n.label}\"/]')",
            "lineNumber": 221
          },
          {
            "text": "            elif shape == \"[( )]\":  # STORAGE (å††ç­’å½¢)",
            "lineNumber": 222
          },
          {
            "text": "                lines.append(f'{safe_id}[(\"{n.label}\")]')",
            "lineNumber": 223
          },
          {
            "text": "            elif shape == \"{{ }}\":  # MISSING",
            "lineNumber": 224
          },
          {
            "text": "                lines.append(f'{safe_id}{{\"{n.label}\"}}')",
            "lineNumber": 225
          },
          {
            "text": "            ",
            "lineNumber": 226
          },
          {
            "text": "            # çŠ¶æ…‹ã«å¿œã˜ãŸã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ ",
            "lineNumber": 227
          },
          {
            "text": "            color = self._get_status_color(n.status)",
            "lineNumber": 228
          },
          {
            "text": "            style_lines.append(f'    style {safe_id} fill:{color}')",
            "lineNumber": 229
          },
          {
            "text": "        ",
            "lineNumber": 230
          },
          {
            "text": "        # ã‚¨ãƒƒã‚¸å®šç¾©",
            "lineNumber": 231
          },
          {
            "text": "        for e in self.edges:",
            "lineNumber": 232
          }
        ]
      },
      "score": 0.3096104860305786
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 23
          },
          "endPosition": {
            "line": 271,
            "column": 31
          }
        },
        "contents": "class Flowchart(BaseModel):\ndef to_mermaid(self) -&gt; str:\n\n        \n        # ã‚¨ãƒƒã‚¸å®šç¾©\n        for e in self.edges:\n            # ã‚¨ãƒƒã‚¸ï¼ˆæ¥ç¶šç·šï¼‰ã®IDã‚‚åŒæ§˜ã«å¤‰æ›\n            src = f\"n_{e.source}\" if e.source == \"end\" else e.source\n            tgt = f\"n_{e.target}\" if e.target == \"end\" else e.target\n            \n            if e.label:\n                lines.append(f'{src}--&gt;|\"{e.label}\"|{tgt}')\n            else:\n                lines.append(f'{src}--&gt;{tgt}')\n        \n        # ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©ã‚’è¿½åŠ \n        if style_lines:\n            lines.append(\"\")\n            lines.extend(style_lines)\n            \n        return \"\\n\".join(lines)\n\n    def to_toon_format(self) -&gt; str:\n        \"\"\"Flowchartã‚’TOONå½¢å¼ï¼ˆMarkdownï¼‰ã«å¤‰æ›\"\"\"\n        lines = []\n        \n        # ãƒãƒ¼ãƒ‰å®šç¾©\n        for node in self.nodes:\n            lines.append(\"[Node]\")\n            lines.append(f\"id: {node.id}\")\n            lines.append(f\"label: {node.label}\")\n            lines.append(f\"type: {node.type}\")\n            if node.status != NodeStatus.ACTIVE:\n                lines.append(f\"status: {node.status.value}\")\n            lines.append(\"\")\n        \n        # ã‚¨ãƒƒã‚¸å®šç¾©\n        for edge in self.edges:\n            lines.append(\"[Edge]\")\n            lines.append(f\"source: {edge.source}\")\n            lines.append(f\"target: {edge.target}\")\n            if edge.label:\n                lines.append(f\"label: {edge.label}\")\n            lines.append(\"\")\n        \n        return \"\\n\".join(lines)",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 24,
                "column": 1
              },
              "endPosition": {
                "line": 25,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 199,
                "column": 5
              },
              "endPosition": {
                "line": 200,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 24,
            "isSignature": true
          },
          {
            "text": "def to_mermaid(self) -&gt; str:",
            "lineNumber": 199
          },
          {
            "lineNumber": 229
          },
          {
            "text": "        ",
            "lineNumber": 230
          },
          {
            "text": "        # ã‚¨ãƒƒã‚¸å®šç¾©",
            "lineNumber": 231
          },
          {
            "text": "        for e in self.edges:",
            "lineNumber": 232
          },
          {
            "text": "            # ã‚¨ãƒƒã‚¸ï¼ˆæ¥ç¶šç·šï¼‰ã®IDã‚‚åŒæ§˜ã«å¤‰æ›",
            "lineNumber": 233
          },
          {
            "text": "            src = f\"n_{e.source}\" if e.source == \"end\" else e.source",
            "lineNumber": 234
          },
          {
            "text": "            tgt = f\"n_{e.target}\" if e.target == \"end\" else e.target",
            "lineNumber": 235
          },
          {
            "text": "            ",
            "lineNumber": 236
          },
          {
            "text": "            if e.label:",
            "lineNumber": 237
          },
          {
            "text": "                lines.append(f'{src}--&gt;|\"{e.label}\"|{tgt}')",
            "lineNumber": 238
          },
          {
            "text": "            else:",
            "lineNumber": 239
          },
          {
            "text": "                lines.append(f'{src}--&gt;{tgt}')",
            "lineNumber": 240
          },
          {
            "text": "        ",
            "lineNumber": 241
          },
          {
            "text": "        # ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©ã‚’è¿½åŠ ",
            "lineNumber": 242
          },
          {
            "text": "        if style_lines:",
            "lineNumber": 243
          },
          {
            "text": "            lines.append(\"\")",
            "lineNumber": 244
          },
          {
            "text": "            lines.extend(style_lines)",
            "lineNumber": 245
          },
          {
            "text": "            ",
            "lineNumber": 246
          },
          {
            "text": "        return \"\\n\".join(lines)",
            "lineNumber": 247
          },
          {
            "lineNumber": 248
          },
          {
            "text": "    def to_toon_format(self) -&gt; str:",
            "lineNumber": 249
          },
          {
            "text": "        \"\"\"Flowchartã‚’TOONå½¢å¼ï¼ˆMarkdownï¼‰ã«å¤‰æ›\"\"\"",
            "lineNumber": 250
          },
          {
            "text": "        lines = []",
            "lineNumber": 251
          },
          {
            "text": "        ",
            "lineNumber": 252
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰å®šç¾©",
            "lineNumber": 253
          },
          {
            "text": "        for node in self.nodes:",
            "lineNumber": 254
          },
          {
            "text": "            lines.append(\"[Node]\")",
            "lineNumber": 255
          },
          {
            "text": "            lines.append(f\"id: {node.id}\")",
            "lineNumber": 256
          },
          {
            "text": "            lines.append(f\"label: {node.label}\")",
            "lineNumber": 257
          },
          {
            "text": "            lines.append(f\"type: {node.type}\")",
            "lineNumber": 258
          },
          {
            "text": "            if node.status != NodeStatus.ACTIVE:",
            "lineNumber": 259
          },
          {
            "text": "                lines.append(f\"status: {node.status.value}\")",
            "lineNumber": 260
          },
          {
            "text": "            lines.append(\"\")",
            "lineNumber": 261
          },
          {
            "text": "        ",
            "lineNumber": 262
          },
          {
            "text": "        # ã‚¨ãƒƒã‚¸å®šç¾©",
            "lineNumber": 263
          },
          {
            "text": "        for edge in self.edges:",
            "lineNumber": 264
          },
          {
            "text": "            lines.append(\"[Edge]\")",
            "lineNumber": 265
          },
          {
            "text": "            lines.append(f\"source: {edge.source}\")",
            "lineNumber": 266
          },
          {
            "text": "            lines.append(f\"target: {edge.target}\")",
            "lineNumber": 267
          },
          {
            "text": "            if edge.label:",
            "lineNumber": 268
          },
          {
            "text": "                lines.append(f\"label: {edge.label}\")",
            "lineNumber": 269
          },
          {
            "text": "            lines.append(\"\")",
            "lineNumber": 270
          },
          {
            "text": "        ",
            "lineNumber": 271
          },
          {
            "text": "        return \"\\n\".join(lines)",
            "lineNumber": 272,
            "isSignature": true
          }
        ]
      },
      "score": 0.30098289251327515
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 23
          },
          "endPosition": {
            "line": 271
          }
        },
        "contents": "class Flowchart(BaseModel):\ndef detect_logic_gaps(self) -&gt; List[Node]:\n\n        \n        return gaps\n\n    def apply_logic_gap_detection(self) -&gt; 'Flowchart':\n        \"\"\"è«–ç†ã®ç©´ã‚’æ¤œå‡ºã—ã€MISSINGãƒãƒ¼ãƒ‰ã¨ã—ã¦è¿½åŠ \"\"\"\n        gaps = self.detect_logic_gaps()\n        \n        if not gaps:\n            return self\n        \n        # æ—¢å­˜ã®ãƒãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼\n        new_nodes = [Node(**node.model_dump()) for node in self.nodes]\n        new_edges = [Edge(**edge.model_dump()) for edge in self.edges]\n        \n        # ã‚®ãƒ£ãƒƒãƒ—ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã¾ãŸã¯æ›´æ–°\n        existing_ids = {node.id for node in new_nodes}\n        for gap in gaps:\n            if gap.id not in existing_ids:\n                new_nodes.append(gap)\n            else:\n                # æ—¢å­˜ãƒãƒ¼ãƒ‰ã‚’MISSINGã¨ã—ã¦æ›´æ–°\n                for i, node in enumerate(new_nodes):\n                    if node.id == gap.id:\n                        new_nodes[i] = Node(\n                            id=node.id,\n                            label=node.label,\n                            type=\"missing\",\n                            status=NodeStatus.MISSING\n                        )\n                        break\n        \n        return Flowchart(nodes=new_nodes, edges=new_edges)\n\n    @staticmethod\n    def _get_node_shape(node_type: str) -&gt; str:\n        \"\"\"ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸMermaidå½¢çŠ¶ã‚’è¿”ã™\"\"\"\n        shape_map = {\n            \"start\": \"([ ])\",\n            \"end\": \"([ ])\",\n            \"process\": \"[ ]\",\n            \"decision\": \"{ }\",\n            \"io_data\": \"[/ /]\",\n            \"storage\": \"[( )]\",\n            \"missing\": \"{{ }}\"\n        }\n        return shape_map.get(node_type.lower(), \"{{ }}\")  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯MISSING\n\n    @staticmethod\n    def _get_status_color(status: NodeStatus) -&gt; str:\n        ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 24,
                "column": 1
              },
              "endPosition": {
                "line": 25,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 24,
            "isSignature": true
          },
          {
            "text": "def detect_logic_gaps(self) -&gt; List[Node]:",
            "lineNumber": 75
          },
          {
            "lineNumber": 141
          },
          {
            "text": "        ",
            "lineNumber": 142
          },
          {
            "text": "        return gaps",
            "lineNumber": 143
          },
          {
            "lineNumber": 144
          },
          {
            "text": "    def apply_logic_gap_detection(self) -&gt; 'Flowchart':",
            "lineNumber": 145
          },
          {
            "text": "        \"\"\"è«–ç†ã®ç©´ã‚’æ¤œå‡ºã—ã€MISSINGãƒãƒ¼ãƒ‰ã¨ã—ã¦è¿½åŠ \"\"\"",
            "lineNumber": 146
          },
          {
            "text": "        gaps = self.detect_logic_gaps()",
            "lineNumber": 147
          },
          {
            "text": "        ",
            "lineNumber": 148
          },
          {
            "text": "        if not gaps:",
            "lineNumber": 149
          },
          {
            "text": "            return self",
            "lineNumber": 150
          },
          {
            "text": "        ",
            "lineNumber": 151
          },
          {
            "text": "        # æ—¢å­˜ã®ãƒãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼",
            "lineNumber": 152
          },
          {
            "text": "        new_nodes = [Node(**node.model_dump()) for node in self.nodes]",
            "lineNumber": 153
          },
          {
            "text": "        new_edges = [Edge(**edge.model_dump()) for edge in self.edges]",
            "lineNumber": 154
          },
          {
            "text": "        ",
            "lineNumber": 155
          },
          {
            "text": "        # ã‚®ãƒ£ãƒƒãƒ—ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã¾ãŸã¯æ›´æ–°",
            "lineNumber": 156
          },
          {
            "text": "        existing_ids = {node.id for node in new_nodes}",
            "lineNumber": 157
          },
          {
            "text": "        for gap in gaps:",
            "lineNumber": 158
          },
          {
            "text": "            if gap.id not in existing_ids:",
            "lineNumber": 159
          },
          {
            "text": "                new_nodes.append(gap)",
            "lineNumber": 160
          },
          {
            "text": "            else:",
            "lineNumber": 161
          },
          {
            "text": "                # æ—¢å­˜ãƒãƒ¼ãƒ‰ã‚’MISSINGã¨ã—ã¦æ›´æ–°",
            "lineNumber": 162
          },
          {
            "text": "                for i, node in enumerate(new_nodes):",
            "lineNumber": 163
          },
          {
            "text": "                    if node.id == gap.id:",
            "lineNumber": 164
          },
          {
            "text": "                        new_nodes[i] = Node(",
            "lineNumber": 165
          },
          {
            "text": "                            id=node.id,",
            "lineNumber": 166
          },
          {
            "text": "                            label=node.label,",
            "lineNumber": 167
          },
          {
            "text": "                            type=\"missing\",",
            "lineNumber": 168
          },
          {
            "text": "                            status=NodeStatus.MISSING",
            "lineNumber": 169
          },
          {
            "text": "                        )",
            "lineNumber": 170
          },
          {
            "text": "                        break",
            "lineNumber": 171
          },
          {
            "text": "        ",
            "lineNumber": 172
          },
          {
            "text": "        return Flowchart(nodes=new_nodes, edges=new_edges)",
            "lineNumber": 173
          },
          {
            "lineNumber": 174
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 175
          },
          {
            "text": "    def _get_node_shape(node_type: str) -&gt; str:",
            "lineNumber": 176
          },
          {
            "text": "        \"\"\"ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸMermaidå½¢çŠ¶ã‚’è¿”ã™\"\"\"",
            "lineNumber": 177
          },
          {
            "text": "        shape_map = {",
            "lineNumber": 178
          },
          {
            "text": "            \"start\": \"([ ])\",",
            "lineNumber": 179
          },
          {
            "text": "            \"end\": \"([ ])\",",
            "lineNumber": 180
          },
          {
            "text": "            \"process\": \"[ ]\",",
            "lineNumber": 181
          },
          {
            "text": "            \"decision\": \"{ }\",",
            "lineNumber": 182
          },
          {
            "text": "            \"io_data\": \"[/ /]\",",
            "lineNumber": 183
          },
          {
            "text": "            \"storage\": \"[( )]\",",
            "lineNumber": 184
          },
          {
            "text": "            \"missing\": \"{{ }}\"",
            "lineNumber": 185
          },
          {
            "text": "        }",
            "lineNumber": 186
          },
          {
            "text": "        return shape_map.get(node_type.lower(), \"{{ }}\")  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯MISSING",
            "lineNumber": 187
          },
          {
            "lineNumber": 188
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 189
          },
          {
            "text": "    def _get_status_color(status: NodeStatus) -&gt; str:",
            "lineNumber": 190
          },
          {
            "text": "        ",
            "lineNumber": 191
          }
        ]
      },
      "score": 0.29448044300079346
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\storage\\sessions\\flow_md.json",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 65
          }
        },
        "contents": "[\n    {\n        \"nodes\": [\n            {\n                \"id\": \"start\",\n                \"label\": \"é–‹å§‹\",\n                \"type\": \"start\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"task1\",\n                \"label\": \"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\",\n                \"type\": \"process\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"task2\",\n                \"label\": \"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\",\n                \"type\": \"process\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"decision1\",\n                \"label\": \"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\",\n                \"type\": \"decision\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"task3\",\n                \"label\": \"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\",\n                \"type\": \"process\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"decision2\",\n                \"label\": \"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\",\n                \"type\": \"decision\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"task4\",\n                \"label\": \"è¡¨ç¤ºãŒãŠã‹ã—ã„\",\n                \"type\": \"process\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"decision3\",\n                \"label\": \"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\",\n                \"type\": \"decision\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"task5\",\n                \"label\": \"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\",\n                \"type\": \"process\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"task6\",\n                \"label\": \"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\",\n                \"type\": \"process\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"task7\",",
        "signatures": {},
        "detailedLines": [
          {
            "text": "[",
            "lineNumber": 1
          },
          {
            "text": "    {",
            "lineNumber": 2
          },
          {
            "text": "        \"nodes\": [",
            "lineNumber": 3
          },
          {
            "text": "            {",
            "lineNumber": 4
          },
          {
            "text": "                \"id\": \"start\",",
            "lineNumber": 5
          },
          {
            "text": "                \"label\": \"é–‹å§‹\",",
            "lineNumber": 6
          },
          {
            "text": "                \"type\": \"start\",",
            "lineNumber": 7
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 8
          },
          {
            "text": "            },",
            "lineNumber": 9
          },
          {
            "text": "            {",
            "lineNumber": 10
          },
          {
            "text": "                \"id\": \"task1\",",
            "lineNumber": 11
          },
          {
            "text": "                \"label\": \"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\",",
            "lineNumber": 12
          },
          {
            "text": "                \"type\": \"process\",",
            "lineNumber": 13
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 14
          },
          {
            "text": "            },",
            "lineNumber": 15
          },
          {
            "text": "            {",
            "lineNumber": 16
          },
          {
            "text": "                \"id\": \"task2\",",
            "lineNumber": 17
          },
          {
            "text": "                \"label\": \"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\",",
            "lineNumber": 18
          },
          {
            "text": "                \"type\": \"process\",",
            "lineNumber": 19
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 20
          },
          {
            "text": "            },",
            "lineNumber": 21
          },
          {
            "text": "            {",
            "lineNumber": 22
          },
          {
            "text": "                \"id\": \"decision1\",",
            "lineNumber": 23
          },
          {
            "text": "                \"label\": \"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\",",
            "lineNumber": 24
          },
          {
            "text": "                \"type\": \"decision\",",
            "lineNumber": 25
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 26
          },
          {
            "text": "            },",
            "lineNumber": 27
          },
          {
            "text": "            {",
            "lineNumber": 28
          },
          {
            "text": "                \"id\": \"task3\",",
            "lineNumber": 29
          },
          {
            "text": "                \"label\": \"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\",",
            "lineNumber": 30
          },
          {
            "text": "                \"type\": \"process\",",
            "lineNumber": 31
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 32
          },
          {
            "text": "            },",
            "lineNumber": 33
          },
          {
            "text": "            {",
            "lineNumber": 34
          },
          {
            "text": "                \"id\": \"decision2\",",
            "lineNumber": 35
          },
          {
            "text": "                \"label\": \"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\",",
            "lineNumber": 36
          },
          {
            "text": "                \"type\": \"decision\",",
            "lineNumber": 37
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 38
          },
          {
            "text": "            },",
            "lineNumber": 39
          },
          {
            "text": "            {",
            "lineNumber": 40
          },
          {
            "text": "                \"id\": \"task4\",",
            "lineNumber": 41
          },
          {
            "text": "                \"label\": \"è¡¨ç¤ºãŒãŠã‹ã—ã„\",",
            "lineNumber": 42
          },
          {
            "text": "                \"type\": \"process\",",
            "lineNumber": 43
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 44
          },
          {
            "text": "            },",
            "lineNumber": 45
          },
          {
            "text": "            {",
            "lineNumber": 46
          },
          {
            "text": "                \"id\": \"decision3\",",
            "lineNumber": 47
          },
          {
            "text": "                \"label\": \"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\",",
            "lineNumber": 48
          },
          {
            "text": "                \"type\": \"decision\",",
            "lineNumber": 49
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 50
          },
          {
            "text": "            },",
            "lineNumber": 51
          },
          {
            "text": "            {",
            "lineNumber": 52
          },
          {
            "text": "                \"id\": \"task5\",",
            "lineNumber": 53
          },
          {
            "text": "                \"label\": \"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\",",
            "lineNumber": 54
          },
          {
            "text": "                \"type\": \"process\",",
            "lineNumber": 55
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 56
          },
          {
            "text": "            },",
            "lineNumber": 57
          },
          {
            "text": "            {",
            "lineNumber": 58
          },
          {
            "text": "                \"id\": \"task6\",",
            "lineNumber": 59
          },
          {
            "text": "                \"label\": \"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\",",
            "lineNumber": 60
          },
          {
            "text": "                \"type\": \"process\",",
            "lineNumber": 61
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 62
          },
          {
            "text": "            },",
            "lineNumber": 63
          },
          {
            "text": "            {",
            "lineNumber": 64
          },
          {
            "text": "                \"id\": \"task7\",",
            "lineNumber": 65
          }
        ]
      },
      "score": 0.2773943543434143
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\flow.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 47
          }
        },
        "contents": "&#96;&#96;&#96;mermaid\ngraph TD\n    start[\"é–‹å§‹\"]\n    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]\n    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]\n    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]\n    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}\n    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}\n    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]\n    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]\n    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]\n    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]\n    task10[\"æµå‹•ã«æˆ»ã™\"]\n    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}\n    node_end[\"çµ‚äº†\"]\n    \n    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼\n    start--&gt;task1\n    task1--&gt;task2\n    task2--&gt;decision1\n    \n    %% å†ç¾ã—ãªã„å ´åˆ\n    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10\n    task10--&gt;decision_recurrence\n    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1\n    \n    %% å†ç¾ã™ã‚‹å ´åˆ\n    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3\n    task3--&gt;decision2\n    \n    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²\n    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4\n    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8\n    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9\n    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other\n    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "&#96;&#96;&#96;mermaid",
            "lineNumber": 1
          },
          {
            "text": "graph TD",
            "lineNumber": 2
          },
          {
            "text": "    start[\"é–‹å§‹\"]",
            "lineNumber": 3
          },
          {
            "text": "    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]",
            "lineNumber": 4
          },
          {
            "text": "    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]",
            "lineNumber": 5
          },
          {
            "text": "    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 6
          },
          {
            "text": "    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]",
            "lineNumber": 7
          },
          {
            "text": "    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}",
            "lineNumber": 8
          },
          {
            "text": "    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 9
          },
          {
            "text": "    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}",
            "lineNumber": 10
          },
          {
            "text": "    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 11
          },
          {
            "text": "    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 12
          },
          {
            "text": "    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]",
            "lineNumber": 13
          },
          {
            "text": "    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]",
            "lineNumber": 14
          },
          {
            "text": "    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]",
            "lineNumber": 15
          },
          {
            "text": "    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]",
            "lineNumber": 16
          },
          {
            "text": "    task10[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 17
          },
          {
            "text": "    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}",
            "lineNumber": 18
          },
          {
            "text": "    node_end[\"çµ‚äº†\"]",
            "lineNumber": 19
          },
          {
            "text": "    ",
            "lineNumber": 20
          },
          {
            "text": "    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 21
          },
          {
            "text": "    start--&gt;task1",
            "lineNumber": 22
          },
          {
            "text": "    task1--&gt;task2",
            "lineNumber": 23
          },
          {
            "text": "    task2--&gt;decision1",
            "lineNumber": 24
          },
          {
            "text": "    ",
            "lineNumber": 25
          },
          {
            "text": "    %% å†ç¾ã—ãªã„å ´åˆ",
            "lineNumber": 26
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 27
          },
          {
            "text": "    task10--&gt;decision_recurrence",
            "lineNumber": 28
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end",
            "lineNumber": 29
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1",
            "lineNumber": 30
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2",
            "lineNumber": 31
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3",
            "lineNumber": 32
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4",
            "lineNumber": 33
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1",
            "lineNumber": 34
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1",
            "lineNumber": 35
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1",
            "lineNumber": 36
          },
          {
            "text": "    ",
            "lineNumber": 37
          },
          {
            "text": "    %% å†ç¾ã™ã‚‹å ´åˆ",
            "lineNumber": 38
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3",
            "lineNumber": 39
          },
          {
            "text": "    task3--&gt;decision2",
            "lineNumber": 40
          },
          {
            "text": "    ",
            "lineNumber": 41
          },
          {
            "text": "    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²",
            "lineNumber": 42
          },
          {
            "text": "    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4",
            "lineNumber": 43
          },
          {
            "text": "    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8",
            "lineNumber": 44
          },
          {
            "text": "    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9",
            "lineNumber": 45
          },
          {
            "text": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other",
            "lineNumber": 46
          },
          {
            "text": "    ",
            "lineNumber": 47
          }
        ]
      },
      "score": 0.27538156509399414
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\program_base.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 43
          }
        },
        "contents": "1ãƒ•ã‚¡ã‚¤ãƒ«1è²¬ä»»ã®åŸå‰‡ï¼ˆSRPï¼‰ã«åŸºã¥ãã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç‹¬ç«‹ã•ã›ã‚‹ã“ã¨ã§ã€**ã€ŒAIã®æŒ™å‹•ã‚’å¤‰ãˆãŸã„ã¨ãã€**ã¨**ã€Œå›³ã®è¦‹ãŸç›®ï¼ˆMermaidï¼‰ã‚’å¤‰ãˆãŸã„ã¨ãã€**ã‚’å®Œå…¨ã«åˆ‡ã‚Šåˆ†ã‘ã¦ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã§ãã‚‹æ§‹é€ ã‚’ææ¡ˆã—ã¾ã™ã€‚\n\n---\n\n## 1. æ¨å¥¨ã•ã‚Œã‚‹ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ \n\næ‹¡å¼µæ€§ã¨è¦‹é€šã—ã®è‰¯ã•ã‚’é‡è¦–ã—ãŸæ§‹æˆã§ã™ã€‚\n\n&#96;&#96;&#96;text\ntoon-flow-visualizer/\nâ”œâ”€â”€ app.py                # ã€Entry Pointã€‘Streamlitã®ãƒ¡ã‚¤ãƒ³UIãƒ»çŠ¶æ…‹ç®¡ç†\nâ”œâ”€â”€ core/                 # ã€Logicã€‘å…±é€šåŸºç›¤ãƒ»ãƒ‡ãƒ¼ã‚¿å®šç¾©\nâ”‚   â””â”€â”€ models.py         # ãƒãƒ¼ãƒ‰ã‚„ã‚¨ãƒƒã‚¸ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€  (Pydanticç­‰)\nâ”œâ”€â”€ parser/               # ã€Responsibility: è§£æã€‘\nâ”‚   â””â”€â”€ toon_parser.py    # Markdown(TOON)ã‹ã‚‰å†…éƒ¨ãƒ¢ãƒ‡ãƒ«ã¸ã®å¤‰æ›\nâ”œâ”€â”€ generator/            # ã€Responsibility: æç”»ç”Ÿæˆã€‘\nâ”‚   â””â”€â”€ mermaid_gen.py    # å†…éƒ¨ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰Mermaidæ§‹æ–‡ã¸ã®å¤‰æ›\nâ”œâ”€â”€ llm/                  # ã€Responsibility: AIå¯¾è©±ã€‘\nâ”‚   â””â”€â”€ agent.py          # å¤§å‹LLMã¸ã®æŒ‡ç¤ºã€TOONå·®åˆ†å–å¾—\nâ”œâ”€â”€ schema/               # ã€Assetsã€‘\nâ”‚   â””â”€â”€ template.md       # LLMã«æ¸¡ã™TOONã®åŸºæœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ\nâ””â”€â”€ data/                 # ã€Storageã€‘\n    â””â”€â”€ sessions/         # ä¿å­˜ã•ã‚ŒãŸTOONãƒ•ã‚¡ã‚¤ãƒ«(.md)\n\n&#96;&#96;&#96;\n\n---\n\n## 2. å„ãƒ•ã‚¡ã‚¤ãƒ«ã®è²¬ä»»ç¯„å›²ï¼ˆè¦ä»¶å®šç¾©ï¼‰\n\n### â‘  &#96;core/models.py&#96;\n\n**è²¬ä»»ï¼šãƒ‡ãƒ¼ã‚¿ã®å‹å®šç¾©**\n\n* Pythonã® &#96;Dataclass&#96; ã‚„ &#96;Pydantic&#96; ã‚’ä½¿ã„ã€&#96;Node&#96; ã‚„ &#96;Edge&#96; ã®å±æ€§ï¼ˆID, Type, Label, Statusï¼‰ã‚’å³å¯†ã«å®šç¾©ã—ã¾ã™ã€‚\n* ã“ã“ã‚’å›ºå®šã™ã‚‹ã“ã¨ã§ã€ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«é–“ã§ã®ãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—ãƒŸã‚¹ã‚’é˜²ãã¾ã™ã€‚\n\n### â‘¡ &#96;parser/toon_parser.py&#96;\n\n**è²¬ä»»ï¼šTOONã®è§£é‡ˆï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰**\n\n* Markdownå½¢å¼ã®TOONã‚’æ­£è¦è¡¨ç¾ï¼ˆRegexï¼‰ãªã©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã€&#96;models.py&#96; ã§å®šç¾©ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚¹ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚\n* **ã€Œå·®åˆ†ï¼ˆLOGï¼‰ã€ã®åæ˜ ãƒ­ã‚¸ãƒƒã‚¯**ã‚‚ã“ã“ã«æŒã¡ã¾ã™ã€‚å¤ã„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«LOGã®å†…å®¹ã‚’ä¸Šæ›¸ãã—ã¦ã€æœ€æ–°ã®çŠ¶æ…‹ã‚’ä½œã‚‹è²¬ä»»è€…ã§ã™ã€‚",
        "signatures": {},
        "detailedLines": [
          {
            "text": "1ãƒ•ã‚¡ã‚¤ãƒ«1è²¬ä»»ã®åŸå‰‡ï¼ˆSRPï¼‰ã«åŸºã¥ãã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç‹¬ç«‹ã•ã›ã‚‹ã“ã¨ã§ã€**ã€ŒAIã®æŒ™å‹•ã‚’å¤‰ãˆãŸã„ã¨ãã€**ã¨**ã€Œå›³ã®è¦‹ãŸç›®ï¼ˆMermaidï¼‰ã‚’å¤‰ãˆãŸã„ã¨ãã€**ã‚’å®Œå…¨ã«åˆ‡ã‚Šåˆ†ã‘ã¦ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã§ãã‚‹æ§‹é€ ã‚’ææ¡ˆã—ã¾ã™ã€‚",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "---",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "## 1. æ¨å¥¨ã•ã‚Œã‚‹ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ ",
            "lineNumber": 5
          },
          {
            "lineNumber": 6
          },
          {
            "text": "æ‹¡å¼µæ€§ã¨è¦‹é€šã—ã®è‰¯ã•ã‚’é‡è¦–ã—ãŸæ§‹æˆã§ã™ã€‚",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "&#96;&#96;&#96;text",
            "lineNumber": 9
          },
          {
            "text": "toon-flow-visualizer/",
            "lineNumber": 10
          },
          {
            "text": "â”œâ”€â”€ app.py                # ã€Entry Pointã€‘Streamlitã®ãƒ¡ã‚¤ãƒ³UIãƒ»çŠ¶æ…‹ç®¡ç†",
            "lineNumber": 11
          },
          {
            "text": "â”œâ”€â”€ core/                 # ã€Logicã€‘å…±é€šåŸºç›¤ãƒ»ãƒ‡ãƒ¼ã‚¿å®šç¾©",
            "lineNumber": 12
          },
          {
            "text": "â”‚   â””â”€â”€ models.py         # ãƒãƒ¼ãƒ‰ã‚„ã‚¨ãƒƒã‚¸ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€  (Pydanticç­‰)",
            "lineNumber": 13
          },
          {
            "text": "â”œâ”€â”€ parser/               # ã€Responsibility: è§£æã€‘",
            "lineNumber": 14
          },
          {
            "text": "â”‚   â””â”€â”€ toon_parser.py    # Markdown(TOON)ã‹ã‚‰å†…éƒ¨ãƒ¢ãƒ‡ãƒ«ã¸ã®å¤‰æ›",
            "lineNumber": 15
          },
          {
            "text": "â”œâ”€â”€ generator/            # ã€Responsibility: æç”»ç”Ÿæˆã€‘",
            "lineNumber": 16
          },
          {
            "text": "â”‚   â””â”€â”€ mermaid_gen.py    # å†…éƒ¨ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰Mermaidæ§‹æ–‡ã¸ã®å¤‰æ›",
            "lineNumber": 17
          },
          {
            "text": "â”œâ”€â”€ llm/                  # ã€Responsibility: AIå¯¾è©±ã€‘",
            "lineNumber": 18
          },
          {
            "text": "â”‚   â””â”€â”€ agent.py          # å¤§å‹LLMã¸ã®æŒ‡ç¤ºã€TOONå·®åˆ†å–å¾—",
            "lineNumber": 19
          },
          {
            "text": "â”œâ”€â”€ schema/               # ã€Assetsã€‘",
            "lineNumber": 20
          },
          {
            "text": "â”‚   â””â”€â”€ template.md       # LLMã«æ¸¡ã™TOONã®åŸºæœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ",
            "lineNumber": 21
          },
          {
            "text": "â””â”€â”€ data/                 # ã€Storageã€‘",
            "lineNumber": 22
          },
          {
            "text": "    â””â”€â”€ sessions/         # ä¿å­˜ã•ã‚ŒãŸTOONãƒ•ã‚¡ã‚¤ãƒ«(.md)",
            "lineNumber": 23
          },
          {
            "lineNumber": 24
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "text": "---",
            "lineNumber": 27
          },
          {
            "lineNumber": 28
          },
          {
            "text": "## 2. å„ãƒ•ã‚¡ã‚¤ãƒ«ã®è²¬ä»»ç¯„å›²ï¼ˆè¦ä»¶å®šç¾©ï¼‰",
            "lineNumber": 29
          },
          {
            "lineNumber": 30
          },
          {
            "text": "### â‘  &#96;core/models.py&#96;",
            "lineNumber": 31
          },
          {
            "lineNumber": 32
          },
          {
            "text": "**è²¬ä»»ï¼šãƒ‡ãƒ¼ã‚¿ã®å‹å®šç¾©**",
            "lineNumber": 33
          },
          {
            "lineNumber": 34
          },
          {
            "text": "* Pythonã® &#96;Dataclass&#96; ã‚„ &#96;Pydantic&#96; ã‚’ä½¿ã„ã€&#96;Node&#96; ã‚„ &#96;Edge&#96; ã®å±æ€§ï¼ˆID, Type, Label, Statusï¼‰ã‚’å³å¯†ã«å®šç¾©ã—ã¾ã™ã€‚",
            "lineNumber": 35
          },
          {
            "text": "* ã“ã“ã‚’å›ºå®šã™ã‚‹ã“ã¨ã§ã€ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«é–“ã§ã®ãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—ãƒŸã‚¹ã‚’é˜²ãã¾ã™ã€‚",
            "lineNumber": 36
          },
          {
            "lineNumber": 37
          },
          {
            "text": "### â‘¡ &#96;parser/toon_parser.py&#96;",
            "lineNumber": 38
          },
          {
            "lineNumber": 39
          },
          {
            "text": "**è²¬ä»»ï¼šTOONã®è§£é‡ˆï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰**",
            "lineNumber": 40
          },
          {
            "lineNumber": 41
          },
          {
            "text": "* Markdownå½¢å¼ã®TOONã‚’æ­£è¦è¡¨ç¾ï¼ˆRegexï¼‰ãªã©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã€&#96;models.py&#96; ã§å®šç¾©ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚¹ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚",
            "lineNumber": 42
          },
          {
            "text": "* **ã€Œå·®åˆ†ï¼ˆLOGï¼‰ã€ã®åæ˜ ãƒ­ã‚¸ãƒƒã‚¯**ã‚‚ã“ã“ã«æŒã¡ã¾ã™ã€‚å¤ã„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«LOGã®å†…å®¹ã‚’ä¸Šæ›¸ãã—ã¦ã€æœ€æ–°ã®çŠ¶æ…‹ã‚’ä½œã‚‹è²¬ä»»è€…ã§ã™ã€‚",
            "lineNumber": 43
          }
        ]
      },
      "score": 0.27345168590545654
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\Project.md",
        "range": {
          "startPosition": {
            "line": 28
          },
          "endPosition": {
            "line": 71
          }
        },
        "contents": "### 3.2 è¦–è¦šçš„æ‹¡å¼µï¼ˆå›³è§£ï¼‰æ©Ÿèƒ½\n\n* **Mermaid.jsã«ã‚ˆã‚‹æç”»:** TOONã®å„ã‚¿ã‚¤ãƒ—ã‚’ç‰¹å®šã®å½¢çŠ¶ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦è¡¨ç¤ºã™ã‚‹ã€‚\n* **ã€Œè«–ç†ã®ç©´ã€ã®æ¤œçŸ¥:** å‡ºå£ã®ãªã„åˆ†å²ã‚„ã€æ¥ç¶šå…ˆãŒæœªå®šç¾©ã®ãƒãƒ¼ãƒ‰ã‚’ &#96;MISSING&#96;ï¼ˆå…­è§’å½¢ãƒ»èµ¤è‰²ï¼‰ã¨ã—ã¦å¼·èª¿è¡¨ç¤ºã™ã‚‹ã€‚\n* **ã‚¹ã‚¿ã‚¤ãƒ«åˆ¶å¾¡:** ç¾åœ¨é€²è¡Œä¸­ã®ãƒãƒ¼ãƒ‰ã‚„å®Œäº†ã—ãŸå·¥ç¨‹ã‚’è‰²åˆ†ã‘ã—ã¦è¦–è¦šçš„ã«å¼·èª¿ã™ã‚‹ã€‚\n\n### 3.3 çŠ¶æ…‹ç®¡ç†æ©Ÿèƒ½\n\n* Streamlitã® &#96;session_state&#96; ã‚’åˆ©ç”¨ã—ã€å¯¾è©±ã®é€²æ—ã¨TOONã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’åŒæœŸã™ã‚‹ã€‚\n\n---\n\n## 4. ãƒ‡ãƒ¼ã‚¿å®šç¾©ï¼ˆTOON-Mermaid ãƒãƒƒãƒ”ãƒ³ã‚°ï¼‰\n\nç¾å ´ä½œæ¥­ã§ã®ã€Œè¦‹ã‚„ã™ã•ã€ã¨ã€Œç›´æ„Ÿæ€§ã€ã‚’é‡è¦–ã—ãŸå®šç¾©ã‚’æ¡ç”¨ã™ã‚‹ã€‚\n\n| ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ— | Mermaidå½¢çŠ¶ | è¨˜æ³• | æ„å‘³ãƒ»å½¹å‰² |\n| --- | --- | --- | --- |\n| **START/END** | ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ | &#96;([ ])&#96; | ãƒ•ãƒ­ãƒ¼ã®èµ·ç‚¹ãƒ»çµ‚ç€ç‚¹ã€‚ |\n| **PROCESS** | é•·æ–¹å½¢ | &#96;[ ]&#96; | å…·ä½“çš„ãªä½œæ¥­å†…å®¹ã‚„å‘½ä»¤ã€‚ |\n| **DECISION** | è±å½¢ | &#96;{ }&#96; | æ¡ä»¶åˆ†å²ã€‚Yes/Noãªã©ã®ãƒ«ãƒ¼ãƒˆåˆ†ã‘ã€‚ |\n| **IO_DATA** | å¹³è¡Œå››è¾ºå½¢ | &#96;[/ /]&#96; | ç”»é¢å…¥åŠ›ã‚„æ‰‹å‹•æ“ä½œã€‚ |\n| **STORAGE** | å††ç­’å½¢ | &#96;[( )]&#96; | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ“ä½œã€‚ |\n| **MISSING** | å…­è§’å½¢ï¼ˆèµ¤ï¼‰ | &#96;{{ }}&#96; | **æœªå®Ÿè£…ãƒ»è¦æ¤œè¨ç®‡æ‰€ã€‚** |\n\n---\n\n## 5. UI/UX è¨­è¨ˆæ¡ˆ\n\nç¾å ´ã§ã®ä½œæ¥­åŠ¹ç‡ã‚’æœ€å¤§åŒ–ã™ã‚‹ã€Œ3ãƒšã‚¤ãƒ³æ§‹æˆã€ã‚’æƒ³å®šã™ã‚‹ã€‚\n\n1. **å·¦ãƒšã‚¤ãƒ³ï¼ˆChatï¼‰:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒAIã¨å¯¾è©±ã™ã‚‹ã‚¨ãƒªã‚¢ã€‚\n2. **ä¸­å¤®ãƒšã‚¤ãƒ³ï¼ˆFlowchartï¼‰:** Mermaid.jsã«ã‚ˆã£ã¦æç”»ã•ã‚Œã‚‹å‹•çš„ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã€‚\n3. **å³ãƒšã‚¤ãƒ³ï¼ˆSourceï¼‰:** ç¾åœ¨ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã€‚\n\n---\n\n## 6. éæ©Ÿèƒ½è¦ä»¶\n\n* **æ‹¡å¼µæ€§:** TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…±é€šè¨€èªã¨ã™ã‚‹ã“ã¨ã§ã€å°†æ¥çš„ã«Pythonã‚³ãƒ¼ãƒ‰ã®è‡ªå‹•ç”Ÿæˆæ©Ÿèƒ½ãªã©ã‚’è¿½åŠ å¯èƒ½ã«ã™ã‚‹ã€‚\n* **å …ç‰¢æ€§:** è»½é‡LLMãŒãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ãŸå ´åˆã§ã‚‚ã€ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ã«ã‚ˆã£ã¦å›³è§£ãŒå´©ã‚Œã‚‹ã®ã‚’é˜²æ­¢ã™ã‚‹ã€‚\n* **è»½é‡åŒ–:** 2æ®µéšç›®ã®è§£æã«Gemma:4bç­‰ã®å°å‹ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®é«˜é€ŸåŒ–ã‚’å›³ã‚‹ã€‚",
        "signatures": {},
        "detailedLines": [
          {
            "text": "### 3.2 è¦–è¦šçš„æ‹¡å¼µï¼ˆå›³è§£ï¼‰æ©Ÿèƒ½",
            "lineNumber": 30
          },
          {
            "lineNumber": 31
          },
          {
            "text": "* **Mermaid.jsã«ã‚ˆã‚‹æç”»:** TOONã®å„ã‚¿ã‚¤ãƒ—ã‚’ç‰¹å®šã®å½¢çŠ¶ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦è¡¨ç¤ºã™ã‚‹ã€‚",
            "lineNumber": 32
          },
          {
            "text": "* **ã€Œè«–ç†ã®ç©´ã€ã®æ¤œçŸ¥:** å‡ºå£ã®ãªã„åˆ†å²ã‚„ã€æ¥ç¶šå…ˆãŒæœªå®šç¾©ã®ãƒãƒ¼ãƒ‰ã‚’ &#96;MISSING&#96;ï¼ˆå…­è§’å½¢ãƒ»èµ¤è‰²ï¼‰ã¨ã—ã¦å¼·èª¿è¡¨ç¤ºã™ã‚‹ã€‚",
            "lineNumber": 33
          },
          {
            "text": "* **ã‚¹ã‚¿ã‚¤ãƒ«åˆ¶å¾¡:** ç¾åœ¨é€²è¡Œä¸­ã®ãƒãƒ¼ãƒ‰ã‚„å®Œäº†ã—ãŸå·¥ç¨‹ã‚’è‰²åˆ†ã‘ã—ã¦è¦–è¦šçš„ã«å¼·èª¿ã™ã‚‹ã€‚",
            "lineNumber": 34
          },
          {
            "lineNumber": 35
          },
          {
            "text": "### 3.3 çŠ¶æ…‹ç®¡ç†æ©Ÿèƒ½",
            "lineNumber": 36
          },
          {
            "lineNumber": 37
          },
          {
            "text": "* Streamlitã® &#96;session_state&#96; ã‚’åˆ©ç”¨ã—ã€å¯¾è©±ã®é€²æ—ã¨TOONã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’åŒæœŸã™ã‚‹ã€‚",
            "lineNumber": 38
          },
          {
            "lineNumber": 39
          },
          {
            "text": "---",
            "lineNumber": 40
          },
          {
            "lineNumber": 41
          },
          {
            "text": "## 4. ãƒ‡ãƒ¼ã‚¿å®šç¾©ï¼ˆTOON-Mermaid ãƒãƒƒãƒ”ãƒ³ã‚°ï¼‰",
            "lineNumber": 42
          },
          {
            "lineNumber": 43
          },
          {
            "text": "ç¾å ´ä½œæ¥­ã§ã®ã€Œè¦‹ã‚„ã™ã•ã€ã¨ã€Œç›´æ„Ÿæ€§ã€ã‚’é‡è¦–ã—ãŸå®šç¾©ã‚’æ¡ç”¨ã™ã‚‹ã€‚",
            "lineNumber": 44
          },
          {
            "lineNumber": 45
          },
          {
            "text": "| ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ— | Mermaidå½¢çŠ¶ | è¨˜æ³• | æ„å‘³ãƒ»å½¹å‰² |",
            "lineNumber": 46
          },
          {
            "text": "| --- | --- | --- | --- |",
            "lineNumber": 47
          },
          {
            "text": "| **START/END** | ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ | &#96;([ ])&#96; | ãƒ•ãƒ­ãƒ¼ã®èµ·ç‚¹ãƒ»çµ‚ç€ç‚¹ã€‚ |",
            "lineNumber": 48
          },
          {
            "text": "| **PROCESS** | é•·æ–¹å½¢ | &#96;[ ]&#96; | å…·ä½“çš„ãªä½œæ¥­å†…å®¹ã‚„å‘½ä»¤ã€‚ |",
            "lineNumber": 49
          },
          {
            "text": "| **DECISION** | è±å½¢ | &#96;{ }&#96; | æ¡ä»¶åˆ†å²ã€‚Yes/Noãªã©ã®ãƒ«ãƒ¼ãƒˆåˆ†ã‘ã€‚ |",
            "lineNumber": 50
          },
          {
            "text": "| **IO_DATA** | å¹³è¡Œå››è¾ºå½¢ | &#96;[/ /]&#96; | ç”»é¢å…¥åŠ›ã‚„æ‰‹å‹•æ“ä½œã€‚ |",
            "lineNumber": 51
          },
          {
            "text": "| **STORAGE** | å††ç­’å½¢ | &#96;[( )]&#96; | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ“ä½œã€‚ |",
            "lineNumber": 52
          },
          {
            "text": "| **MISSING** | å…­è§’å½¢ï¼ˆèµ¤ï¼‰ | &#96;{{ }}&#96; | **æœªå®Ÿè£…ãƒ»è¦æ¤œè¨ç®‡æ‰€ã€‚** |",
            "lineNumber": 53
          },
          {
            "lineNumber": 54
          },
          {
            "text": "---",
            "lineNumber": 55
          },
          {
            "lineNumber": 56
          },
          {
            "text": "## 5. UI/UX è¨­è¨ˆæ¡ˆ",
            "lineNumber": 57
          },
          {
            "lineNumber": 58
          },
          {
            "text": "ç¾å ´ã§ã®ä½œæ¥­åŠ¹ç‡ã‚’æœ€å¤§åŒ–ã™ã‚‹ã€Œ3ãƒšã‚¤ãƒ³æ§‹æˆã€ã‚’æƒ³å®šã™ã‚‹ã€‚",
            "lineNumber": 59
          },
          {
            "lineNumber": 60
          },
          {
            "text": "1. **å·¦ãƒšã‚¤ãƒ³ï¼ˆChatï¼‰:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒAIã¨å¯¾è©±ã™ã‚‹ã‚¨ãƒªã‚¢ã€‚",
            "lineNumber": 61
          },
          {
            "text": "2. **ä¸­å¤®ãƒšã‚¤ãƒ³ï¼ˆFlowchartï¼‰:** Mermaid.jsã«ã‚ˆã£ã¦æç”»ã•ã‚Œã‚‹å‹•çš„ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã€‚",
            "lineNumber": 62
          },
          {
            "text": "3. **å³ãƒšã‚¤ãƒ³ï¼ˆSourceï¼‰:** ç¾åœ¨ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã€‚",
            "lineNumber": 63
          },
          {
            "lineNumber": 64
          },
          {
            "text": "---",
            "lineNumber": 65
          },
          {
            "lineNumber": 66
          },
          {
            "text": "## 6. éæ©Ÿèƒ½è¦ä»¶",
            "lineNumber": 67
          },
          {
            "lineNumber": 68
          },
          {
            "text": "* **æ‹¡å¼µæ€§:** TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…±é€šè¨€èªã¨ã™ã‚‹ã“ã¨ã§ã€å°†æ¥çš„ã«Pythonã‚³ãƒ¼ãƒ‰ã®è‡ªå‹•ç”Ÿæˆæ©Ÿèƒ½ãªã©ã‚’è¿½åŠ å¯èƒ½ã«ã™ã‚‹ã€‚",
            "lineNumber": 69
          },
          {
            "text": "* **å …ç‰¢æ€§:** è»½é‡LLMãŒãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ãŸå ´åˆã§ã‚‚ã€ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ã«ã‚ˆã£ã¦å›³è§£ãŒå´©ã‚Œã‚‹ã®ã‚’é˜²æ­¢ã™ã‚‹ã€‚",
            "lineNumber": 70
          },
          {
            "text": "* **è»½é‡åŒ–:** 2æ®µéšç›®ã®è§£æã«Gemma:4bç­‰ã®å°å‹ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®é«˜é€ŸåŒ–ã‚’å›³ã‚‹ã€‚",
            "lineNumber": 71
          }
        ]
      },
      "score": 0.26915955543518066
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\llm_client.py",
        "range": {
          "startPosition": {
            "line": 8
          },
          "endPosition": {
            "line": 229
          }
        },
        "contents": "class LLMClient:\n\n\n    @staticmethod\n    def is_question_response(response_text: str) -&gt; bool:\n        \"\"\"\n        LLMã®å¿œç­”ãŒè³ªå•å½¢å¼ã‹TOONå½¢å¼ã‹ã‚’åˆ¤å®šã—ã¾ã™ã€‚\n        \n        Args:\n            response_text: LLMã‹ã‚‰ã®å¿œç­”ãƒ†ã‚­ã‚¹ãƒˆ\n            \n        Returns:\n            True: è³ªå•å½¢å¼ã®å ´åˆ\n            False: TOONå½¢å¼ã®å ´åˆ\n        \"\"\"\n        # TOONå½¢å¼ã®ç‰¹å¾´ã‚’ãƒã‚§ãƒƒã‚¯\n        # [Node]ã‚¿ã‚°ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯TOONå½¢å¼ã¨åˆ¤æ–­\n        if re.search(r'\\[Node\\]', response_text, re.IGNORECASE):\n            return False\n        \n        # [Edge]ã‚¿ã‚°ãŒå­˜åœ¨ã™ã‚‹å ´åˆã‚‚TOONå½¢å¼ã¨åˆ¤æ–­\n        if re.search(r'\\[Edge\\]', response_text, re.IGNORECASE):\n            return False\n        \n        # è³ªå•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯\n        question_patterns = [\n            r'æ•™ãˆã¦ãã ã•ã„',\n            r'ä½•ã§ã™ã‹[ï¼Ÿ?]',\n            r'ã©ã®ã‚ˆã†[ãªã«]',\n            r'ã©ã‚Œ[ãŒã‚’]',\n            r'ã„ã¤[ãŒã‚’]',\n            r'ã©ã“[ãŒã‚’]',\n            r'ãªãœ',\n            r'ã©ã†ã—ã¦',\n            r'[ï¼Ÿ?]\\s*$',  # æ–‡æœ«ãŒ?ã§çµ‚ã‚ã‚‹\n            r'ä»¥ä¸‹ã®æƒ…å ±',\n            r'è³ªå•',\n            r'ç¢ºèª',\n        ]\n        \n        # è³ªå•ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯\n        for pattern in question_patterns:\n            if re.search(pattern, response_text, re.IGNORECASE):\n                return True\n        \n        # æ•°å­—ä»˜ãã®è³ªå•ãƒªã‚¹ãƒˆå½¢å¼ï¼ˆä¾‹ï¼šã€Œ1. ...ã§ã™ã‹ï¼Ÿã€ï¼‰\n        numbered_question_pattern = r'\\d+[\\.ï¼]\\s*[^ã€‚\\n]*[ï¼Ÿ?]'\n        if re.search(numbered_question_pattern, response_text):\n            return True\n        \n        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯TOONå½¢å¼ã¨åˆ¤æ–­ï¼ˆè³ªå•å½¢å¼ã§ã¯ãªã„ï¼‰\n        return False\n\n    def generate_flow(self, user_input: str, current_flowchart: Optional[Flowchart] = None) -&gt; str:\n        ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 9,
                "column": 1
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class LLMClient:",
            "lineNumber": 9,
            "isSignature": true
          },
          {
            "lineNumber": 64
          },
          {
            "lineNumber": 65
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 66
          },
          {
            "text": "    def is_question_response(response_text: str) -&gt; bool:",
            "lineNumber": 67
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 68
          },
          {
            "text": "        LLMã®å¿œç­”ãŒè³ªå•å½¢å¼ã‹TOONå½¢å¼ã‹ã‚’åˆ¤å®šã—ã¾ã™ã€‚",
            "lineNumber": 69
          },
          {
            "text": "        ",
            "lineNumber": 70
          },
          {
            "text": "        Args:",
            "lineNumber": 71
          },
          {
            "text": "            response_text: LLMã‹ã‚‰ã®å¿œç­”ãƒ†ã‚­ã‚¹ãƒˆ",
            "lineNumber": 72
          },
          {
            "text": "            ",
            "lineNumber": 73
          },
          {
            "text": "        Returns:",
            "lineNumber": 74
          },
          {
            "text": "            True: è³ªå•å½¢å¼ã®å ´åˆ",
            "lineNumber": 75
          },
          {
            "text": "            False: TOONå½¢å¼ã®å ´åˆ",
            "lineNumber": 76
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 77
          },
          {
            "text": "        # TOONå½¢å¼ã®ç‰¹å¾´ã‚’ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 78
          },
          {
            "text": "        # [Node]ã‚¿ã‚°ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯TOONå½¢å¼ã¨åˆ¤æ–­",
            "lineNumber": 79
          },
          {
            "text": "        if re.search(r'\\[Node\\]', response_text, re.IGNORECASE):",
            "lineNumber": 80
          },
          {
            "text": "            return False",
            "lineNumber": 81
          },
          {
            "text": "        ",
            "lineNumber": 82
          },
          {
            "text": "        # [Edge]ã‚¿ã‚°ãŒå­˜åœ¨ã™ã‚‹å ´åˆã‚‚TOONå½¢å¼ã¨åˆ¤æ–­",
            "lineNumber": 83
          },
          {
            "text": "        if re.search(r'\\[Edge\\]', response_text, re.IGNORECASE):",
            "lineNumber": 84
          },
          {
            "text": "            return False",
            "lineNumber": 85
          },
          {
            "text": "        ",
            "lineNumber": 86
          },
          {
            "text": "        # è³ªå•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 87
          },
          {
            "text": "        question_patterns = [",
            "lineNumber": 88
          },
          {
            "text": "            r'æ•™ãˆã¦ãã ã•ã„',",
            "lineNumber": 89
          },
          {
            "text": "            r'ä½•ã§ã™ã‹[ï¼Ÿ?]',",
            "lineNumber": 90
          },
          {
            "text": "            r'ã©ã®ã‚ˆã†[ãªã«]',",
            "lineNumber": 91
          },
          {
            "text": "            r'ã©ã‚Œ[ãŒã‚’]',",
            "lineNumber": 92
          },
          {
            "text": "            r'ã„ã¤[ãŒã‚’]',",
            "lineNumber": 93
          },
          {
            "text": "            r'ã©ã“[ãŒã‚’]',",
            "lineNumber": 94
          },
          {
            "text": "            r'ãªãœ',",
            "lineNumber": 95
          },
          {
            "text": "            r'ã©ã†ã—ã¦',",
            "lineNumber": 96
          },
          {
            "text": "            r'[ï¼Ÿ?]\\s*$',  # æ–‡æœ«ãŒ?ã§çµ‚ã‚ã‚‹",
            "lineNumber": 97
          },
          {
            "text": "            r'ä»¥ä¸‹ã®æƒ…å ±',",
            "lineNumber": 98
          },
          {
            "text": "            r'è³ªå•',",
            "lineNumber": 99
          },
          {
            "text": "            r'ç¢ºèª',",
            "lineNumber": 100
          },
          {
            "text": "        ]",
            "lineNumber": 101
          },
          {
            "text": "        ",
            "lineNumber": 102
          },
          {
            "text": "        # è³ªå•ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 103
          },
          {
            "text": "        for pattern in question_patterns:",
            "lineNumber": 104
          },
          {
            "text": "            if re.search(pattern, response_text, re.IGNORECASE):",
            "lineNumber": 105
          },
          {
            "text": "                return True",
            "lineNumber": 106
          },
          {
            "text": "        ",
            "lineNumber": 107
          },
          {
            "text": "        # æ•°å­—ä»˜ãã®è³ªå•ãƒªã‚¹ãƒˆå½¢å¼ï¼ˆä¾‹ï¼šã€Œ1. ...ã§ã™ã‹ï¼Ÿã€ï¼‰",
            "lineNumber": 108
          },
          {
            "text": "        numbered_question_pattern = r'\\d+[\\.ï¼]\\s*[^ã€‚\\n]*[ï¼Ÿ?]'",
            "lineNumber": 109
          },
          {
            "text": "        if re.search(numbered_question_pattern, response_text):",
            "lineNumber": 110
          },
          {
            "text": "            return True",
            "lineNumber": 111
          },
          {
            "text": "        ",
            "lineNumber": 112
          },
          {
            "text": "        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯TOONå½¢å¼ã¨åˆ¤æ–­ï¼ˆè³ªå•å½¢å¼ã§ã¯ãªã„ï¼‰",
            "lineNumber": 113
          },
          {
            "text": "        return False",
            "lineNumber": 114
          },
          {
            "lineNumber": 115
          },
          {
            "text": "    def generate_flow(self, user_input: str, current_flowchart: Optional[Flowchart] = None) -&gt; str:",
            "lineNumber": 116
          },
          {
            "text": "        ",
            "lineNumber": 117
          }
        ]
      },
      "score": 0.2662896513938904
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


rules.mdã¨TOON_BASE.mdã‚’ç¢ºèªã—ã€å‡ºåŠ›åˆ¶é™ã®è¿½åŠ æ–¹æ³•ã‚’æ¤œè¨ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: rules.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: TOON_BASE.md</summary>

</details>
</tool-use>

---



---


LLMã®å‡ºåŠ›ã‚’åˆ¶é™ã™ã‚‹æ–¹é‡ã§é€²ã‚ã¾ã™ã€‚å®Ÿè£…è¨ˆç”»ã‚’ä½œæˆã—ã¾ã™ã€‚


---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** â€¢ Todo List</summary>

- [-] rules.mdã«å‡ºåŠ›åˆ¶é™ã®ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ ï¼ˆãƒãƒ¼ãƒ‰æ•°ãƒ»ã‚¨ãƒƒã‚¸æ•°ã®ä¸Šé™ã€éƒ¨åˆ†çš„ãªãƒ•ãƒ­ãƒ¼ã®ç”Ÿæˆã‚’æ¨å¥¨ï¼‰
- [ ] LLMClientã«å‡ºåŠ›åˆ¶é™ã®æ¤œè¨¼æ©Ÿèƒ½ã‚’è¿½åŠ ï¼ˆç”Ÿæˆå¾Œã«ãƒãƒ¼ãƒ‰æ•°ãƒ»ã‚¨ãƒƒã‚¸æ•°ã‚’ãƒã‚§ãƒƒã‚¯ï¼‰
- [ ] Streamlitã‚¢ãƒ—ãƒªã«ã€Œéƒ¨åˆ†ãƒ•ãƒ­ãƒ¼ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰ã€ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
- [ ] TOON_BASE.mdã«å‡ºåŠ›åˆ¶é™ã®ä¾‹ã‚’è¿½åŠ 

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/schemas.py</summary>

</details>
</tool-use>

---



---


rules.mdã«å‡ºåŠ›åˆ¶é™ã®ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ ä¸­ã€‚


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: rules.md</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: TOON_BASE.md</summary>

</details>

</tool-use>

---



---


LLMClientã«å‡ºåŠ›åˆ¶é™ã®æ¤œè¨¼æ©Ÿèƒ½ã‚’è¿½åŠ ä¸­ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/llm_client.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/llm_client.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: core/llm_client.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: core/llm_client.py</summary>

</details>

</tool-use>

---



---


Streamlitã‚¢ãƒ—ãƒªã«å‡ºåŠ›ã‚µã‚¤ã‚ºã®è­¦å‘Šè¡¨ç¤ºã¨éƒ¨åˆ†ãƒ•ãƒ­ãƒ¼ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰ã‚’è¿½åŠ ä¸­ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: app.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** â€¢ Todo List</summary>

- [x] rules.mdã«å‡ºåŠ›åˆ¶é™ã®ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ ï¼ˆãƒãƒ¼ãƒ‰æ•°ãƒ»ã‚¨ãƒƒã‚¸æ•°ã®ä¸Šé™ã€éƒ¨åˆ†çš„ãªãƒ•ãƒ­ãƒ¼ã®ç”Ÿæˆã‚’æ¨å¥¨ï¼‰
- [x] LLMClientã«å‡ºåŠ›åˆ¶é™ã®æ¤œè¨¼æ©Ÿèƒ½ã‚’è¿½åŠ ï¼ˆç”Ÿæˆå¾Œã«ãƒãƒ¼ãƒ‰æ•°ãƒ»ã‚¨ãƒƒã‚¸æ•°ã‚’ãƒã‚§ãƒƒã‚¯ï¼‰
- [x] Streamlitã‚¢ãƒ—ãƒªã«ã€Œéƒ¨åˆ†ãƒ•ãƒ­ãƒ¼ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰ã€ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
- [x] TOON_BASE.mdã«å‡ºåŠ›åˆ¶é™ã®ä¾‹ã‚’è¿½åŠ 

</details>
</tool-use>

---



---


è³ªå•å¿œç­”æ™‚ã®å‡¦ç†ã«ã‚‚å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼ã‚’è¿½åŠ ä¸­ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: app.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="read_lints">
<details>
<summary>Tool use: **read_lints**</summary>


Parameters:

```json
{
  "paths": [
    "core/llm_client.py",
    "app.py"
  ]
}
```
Result:

```json
{
  "linterErrorsByFile": [
    {
      "relativeWorkspacePath": "core/llm_client.py"
    },
    {
      "relativeWorkspacePath": "app.py"
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---



---


å‹ãƒ’ãƒ³ãƒˆã‚’ç¢ºèªã—ã€å¿…è¦ã«å¿œã˜ã¦ä¿®æ­£ä¸­ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/llm_client.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/llm_client.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "from typing import",
  "path": "core/llm_client.py",
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "from typing import",
    "path": "core/llm_client.py",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain": {
        "content": {
          "matches": [
            {
              "file": "core\\llm_client.py",
              "matches": [
                {
                  "lineNumber": 5,
                  "content": "from typing import Optional"
                }
              ]
            }
          ],
          "totalLines": 1,
          "totalMatchedLines": 1
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---



---


å®Ÿè£…ã‚’å®Œäº†ã—ã¾ã—ãŸã€‚å¤‰æ›´ç‚¹ã®ã¾ã¨ã‚ã§ã™ã€‚

## å®Ÿè£…å®Œäº†ï¼šLLMå‡ºåŠ›ã®åˆ¶é™æ©Ÿèƒ½

### å®Ÿè£…å†…å®¹

1. **rules.mdã«å‡ºåŠ›åˆ¶é™ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ **
   - ãƒãƒ¼ãƒ‰æ•°: æœ€å¤§30å€‹
   - ã‚¨ãƒƒã‚¸æ•°: æœ€å¤§50å€‹
   - éƒ¨åˆ†çš„ãªãƒ•ãƒ­ãƒ¼ã®ç”Ÿæˆã‚’æ¨å¥¨
   - Streamlitè¡¨ç¤ºã®æœ€é©åŒ–ã‚’è€ƒæ…®

2. **TOON_BASE.mdã«å‡ºåŠ›åˆ¶é™ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’è¿½åŠ **
   - ã‚µã‚¤ã‚ºåˆ¶é™ã®æ˜è¨˜
   - éƒ¨åˆ†çš„ãªãƒ•ãƒ­ãƒ¼ç”Ÿæˆã®æ¨å¥¨

3. **LLMClientã«æ¤œè¨¼æ©Ÿèƒ½ã‚’è¿½åŠ **
   - `validate_output_size()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ 
   - ç”Ÿæˆå¾Œã®TOONãƒ†ã‚­ã‚¹ãƒˆã®ãƒãƒ¼ãƒ‰æ•°ãƒ»ã‚¨ãƒƒã‚¸æ•°ã‚’è‡ªå‹•ãƒã‚§ãƒƒã‚¯
   - åˆ¶é™è¶…éæ™‚ã«è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™

4. **Streamlitã‚¢ãƒ—ãƒªã«æ©Ÿèƒ½ã‚’è¿½åŠ **
   - ã€Œéƒ¨åˆ†ãƒ•ãƒ­ãƒ¼ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰ã€ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ONï¼‰
   - å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼çµæœã‚’è­¦å‘Šã¨ã—ã¦è¡¨ç¤º
   - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è‡ªå‹•çš„ã«åˆ¶é™æŒ‡ç¤ºã‚’è¿½åŠ 

### å‹•ä½œ

- éƒ¨åˆ†ãƒ•ãƒ­ãƒ¼ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰ãŒONã®å ´åˆã€LLMã«ã€Œä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã€ã™ã‚‹ã‚ˆã†æŒ‡ç¤º
- ç”Ÿæˆå¾Œã«è‡ªå‹•æ¤œè¨¼ã—ã€åˆ¶é™è¶…éæ™‚ã¯è­¦å‘Šã‚’è¡¨ç¤º
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ä¸»è¦ãƒ«ãƒ¼ãƒˆã®ã¿ã®ç”Ÿæˆã‚„åˆ†å‰²ã‚’æ¨å¥¨

ã“ã‚Œã«ã‚ˆã‚Šã€Streamlitã§ã®ãƒãƒ¼ãƒ¡ã‚¤ãƒ‰å›³è¡¨ç¤ºã®å•é¡Œã‚’å›é¿ã§ãã¾ã™ã€‚è¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ãŒå¿…è¦ãªå ´åˆã¯ã€æ®µéšçš„ã«ç”Ÿæˆã™ã‚‹ã‹ã€è¤‡æ•°ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã«åˆ†å‰²ã—ã¦ãã ã•ã„ã€‚

---

_**User**_

ç¾çŠ¶ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆä½œæˆæ©Ÿèƒ½ã«ã¤ã„ã¦ç§ã¯ä¾‹ãˆã°ã‚ã‚‹ãƒ•ãƒ­ãƒ¼ã‚’æŠ˜ã‚ŠãŸãŸã‚“ã ã‚Šã§ããŸã‚Šã—ã¦è¦–èªæ€§ã‚’ä¸Šã’ãŸã‚Šã§ããªã„ã‹ã¨è€ƒãˆã¦ã„ã‚‹ãŒã©ã†ã‹ï¼Ÿ

---

_**Agent (model default, mode Agent)**_



---


ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ã®å®Ÿè£…å¯èƒ½æ€§ã‚’èª¿æŸ»ä¸­ã€‚ç¾çŠ¶ã®å®Ÿè£…ã‚’ç¢ºèªã—ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: app.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: frontend/index.html</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/schemas.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "How are subgraphs handled in mermaid diagram generation?",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\mermaid_parser.py",
        "range": {
          "startPosition": {
            "line": 5
          },
          "endPosition": {
            "line": 178
          }
        },
        "contents": "class MermaidParser:\n@staticmethod\ndef parse(mermaid_text: str) -&gt; Flowchart:\n\n        for line in lines:\n            # ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—\n            if line.startswith('%%'):\n                continue\n            \n            # styleè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆå¾Œã§å‡¦ç†ï¼‰\n            if line.startswith('style '):\n                continue\n            \n            # subgraphã®é–‹å§‹/çµ‚äº†ã‚’æ¤œå‡º\n            if line.startswith('subgraph '):\n                in_subgraph = True\n                continue\n            if line.strip() == 'end':\n                in_subgraph = False\n                continue\n            \n            # ãƒãƒ¼ãƒ‰å®šç¾©: id[\"label\"] ã¾ãŸã¯ id{\"label\"} ã¾ãŸã¯ id[(\"label\")]\n            # ã‚ˆã‚ŠæŸ”è»Ÿãªãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°\n            node_patterns = [\n                r'(\\w+)\\[\\([\"\\']([^\"\\']+)[\"\\']\\)\\]',  # id[(\"label\")]\n                r'(\\w+)\\[/[\"\\']([^\"\\']+)[\"\\']/\\]',     # id[/\"label\"/]\n                r'(\\w+)\\[[\"\\']([^\"\\']+)[\"\\']\\]',       # id[\"label\"]\n                r'(\\w+)\\{[\"\\']([^\"\\']+)[\"\\']\\}',       # id{\"label\"}\n                r'(\\w+)\\[\\(([^)]+)\\)\\]',                # id[(label)]\n                r'(\\w+)\\[([^\\]]+)\\]',                   # id[label]\n                r'(\\w+)\\{([^}]+)\\}',                    # id{label}\n            ]\n            \n            node_found = False\n            for pattern in node_patterns:\n                node_match = re.match(pattern, line)",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 6,
                "column": 1
              },
              "endPosition": {
                "line": 7,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 9,
                "column": 5
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 10,
                "column": 5
              },
              "endPosition": {
                "line": 11,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class MermaidParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 9
          },
          {
            "text": "def parse(mermaid_text: str) -&gt; Flowchart:",
            "lineNumber": 10
          },
          {
            "lineNumber": 31
          },
          {
            "text": "        for line in lines:",
            "lineNumber": 32
          },
          {
            "text": "            # ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—",
            "lineNumber": 33
          },
          {
            "text": "            if line.startswith('%%'):",
            "lineNumber": 34
          },
          {
            "text": "                continue",
            "lineNumber": 35
          },
          {
            "text": "            ",
            "lineNumber": 36
          },
          {
            "text": "            # styleè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆå¾Œã§å‡¦ç†ï¼‰",
            "lineNumber": 37
          },
          {
            "text": "            if line.startswith('style '):",
            "lineNumber": 38
          },
          {
            "text": "                continue",
            "lineNumber": 39
          },
          {
            "text": "            ",
            "lineNumber": 40
          },
          {
            "text": "            # subgraphã®é–‹å§‹/çµ‚äº†ã‚’æ¤œå‡º",
            "lineNumber": 41
          },
          {
            "text": "            if line.startswith('subgraph '):",
            "lineNumber": 42
          },
          {
            "text": "                in_subgraph = True",
            "lineNumber": 43
          },
          {
            "text": "                continue",
            "lineNumber": 44
          },
          {
            "text": "            if line.strip() == 'end':",
            "lineNumber": 45
          },
          {
            "text": "                in_subgraph = False",
            "lineNumber": 46
          },
          {
            "text": "                continue",
            "lineNumber": 47
          },
          {
            "text": "            ",
            "lineNumber": 48
          },
          {
            "text": "            # ãƒãƒ¼ãƒ‰å®šç¾©: id[\"label\"] ã¾ãŸã¯ id{\"label\"} ã¾ãŸã¯ id[(\"label\")]",
            "lineNumber": 49
          },
          {
            "text": "            # ã‚ˆã‚ŠæŸ”è»Ÿãªãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°",
            "lineNumber": 50
          },
          {
            "text": "            node_patterns = [",
            "lineNumber": 51
          },
          {
            "text": "                r'(\\w+)\\[\\([\"\\']([^\"\\']+)[\"\\']\\)\\]',  # id[(\"label\")]",
            "lineNumber": 52
          },
          {
            "text": "                r'(\\w+)\\[/[\"\\']([^\"\\']+)[\"\\']/\\]',     # id[/\"label\"/]",
            "lineNumber": 53
          },
          {
            "text": "                r'(\\w+)\\[[\"\\']([^\"\\']+)[\"\\']\\]',       # id[\"label\"]",
            "lineNumber": 54
          },
          {
            "text": "                r'(\\w+)\\{[\"\\']([^\"\\']+)[\"\\']\\}',       # id{\"label\"}",
            "lineNumber": 55
          },
          {
            "text": "                r'(\\w+)\\[\\(([^)]+)\\)\\]',                # id[(label)]",
            "lineNumber": 56
          },
          {
            "text": "                r'(\\w+)\\[([^\\]]+)\\]',                   # id[label]",
            "lineNumber": 57
          },
          {
            "text": "                r'(\\w+)\\{([^}]+)\\}',                    # id{label}",
            "lineNumber": 58
          },
          {
            "text": "            ]",
            "lineNumber": 59
          },
          {
            "text": "            ",
            "lineNumber": 60
          },
          {
            "text": "            node_found = False",
            "lineNumber": 61
          },
          {
            "text": "            for pattern in node_patterns:",
            "lineNumber": 62
          },
          {
            "text": "                node_match = re.match(pattern, line)",
            "lineNumber": 63
          }
        ]
      },
      "score": 0.48530566692352295
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\mermaid_parser.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 178
          }
        },
        "contents": "import re\nfrom typing import List, Dict, Tuple\nfrom core.schemas import Node, Edge, Flowchart, NodeStatus\nfrom core.exceptions import TOONParseError\n\nclass MermaidParser:\n    \"\"\"Mermaidå½¢å¼ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹ãƒ‘ãƒ¼ã‚µãƒ¼\"\"\"\n    \n    @staticmethod\n    def parse(mermaid_text: str) -&gt; Flowchart:\n        \"\"\"\n        Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚\n        \n        Args:\n            mermaid_text: Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆ\n            \n        Returns:\n            Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ\n        \"\"\"\n        # Markdownã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’é™¤å»\n        clean_text = re.sub(r'&#96;&#96;&#96;mermaid\\s*\\n?', '', mermaid_text)\n        clean_text = clean_text.replace('&#96;&#96;&#96;', '').strip()\n        \n        lines = [line.strip() for line in clean_text.split('\\n') if line.strip()]\n        \n        nodes = []\n        edges = []\n        node_map = {}  # ID -&gt; Node ã®ãƒãƒƒãƒ”ãƒ³ã‚°\n        \n        # ãƒãƒ¼ãƒ‰å®šç¾©ã¨ã‚¨ãƒƒã‚¸å®šç¾©ã‚’æŠ½å‡º\n        in_subgraph = False\n        for line in lines:\n            # ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—\n            if line.startswith('%%'):\n                continue",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import re",
            "lineNumber": 1
          },
          {
            "text": "from typing import List, Dict, Tuple",
            "lineNumber": 2
          },
          {
            "text": "from core.schemas import Node, Edge, Flowchart, NodeStatus",
            "lineNumber": 3
          },
          {
            "text": "from core.exceptions import TOONParseError",
            "lineNumber": 4
          },
          {
            "lineNumber": 5
          },
          {
            "text": "class MermaidParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "    \"\"\"Mermaidå½¢å¼ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹ãƒ‘ãƒ¼ã‚µãƒ¼\"\"\"",
            "lineNumber": 7
          },
          {
            "text": "    ",
            "lineNumber": 8
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 9
          },
          {
            "text": "    def parse(mermaid_text: str) -&gt; Flowchart:",
            "lineNumber": 10
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 11
          },
          {
            "text": "        Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚",
            "lineNumber": 12
          },
          {
            "text": "        ",
            "lineNumber": 13
          },
          {
            "text": "        Args:",
            "lineNumber": 14
          },
          {
            "text": "            mermaid_text: Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆ",
            "lineNumber": 15
          },
          {
            "text": "            ",
            "lineNumber": 16
          },
          {
            "text": "        Returns:",
            "lineNumber": 17
          },
          {
            "text": "            Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ",
            "lineNumber": 18
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 19
          },
          {
            "text": "        # Markdownã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’é™¤å»",
            "lineNumber": 20
          },
          {
            "text": "        clean_text = re.sub(r'&#96;&#96;&#96;mermaid\\s*\\n?', '', mermaid_text)",
            "lineNumber": 21
          },
          {
            "text": "        clean_text = clean_text.replace('&#96;&#96;&#96;', '').strip()",
            "lineNumber": 22
          },
          {
            "text": "        ",
            "lineNumber": 23
          },
          {
            "text": "        lines = [line.strip() for line in clean_text.split('\\n') if line.strip()]",
            "lineNumber": 24
          },
          {
            "text": "        ",
            "lineNumber": 25
          },
          {
            "text": "        nodes = []",
            "lineNumber": 26
          },
          {
            "text": "        edges = []",
            "lineNumber": 27
          },
          {
            "text": "        node_map = {}  # ID -&gt; Node ã®ãƒãƒƒãƒ”ãƒ³ã‚°",
            "lineNumber": 28
          },
          {
            "text": "        ",
            "lineNumber": 29
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰å®šç¾©ã¨ã‚¨ãƒƒã‚¸å®šç¾©ã‚’æŠ½å‡º",
            "lineNumber": 30
          },
          {
            "text": "        in_subgraph = False",
            "lineNumber": 31
          },
          {
            "text": "        for line in lines:",
            "lineNumber": 32
          },
          {
            "text": "            # ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—",
            "lineNumber": 33
          },
          {
            "text": "            if line.startswith('%%'):",
            "lineNumber": 34
          },
          {
            "text": "                continue",
            "lineNumber": 35
          }
        ]
      },
      "score": 0.3907535970211029
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 23
          },
          "endPosition": {
            "line": 271
          }
        },
        "contents": "class Flowchart(BaseModel):\n@staticmethod\ndef _get_node_shape(node_type: str) -&gt; str:\n  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯MISSING\n\n    @staticmethod\n    def _get_status_color(status: NodeStatus) -&gt; str:\n        \"\"\"ãƒãƒ¼ãƒ‰çŠ¶æ…‹ã«å¿œã˜ãŸè‰²ã‚’è¿”ã™\"\"\"\n        color_map = {\n            NodeStatus.ACTIVE: \"#90EE90\",      # ãƒ©ã‚¤ãƒˆã‚°ãƒªãƒ¼ãƒ³\n            NodeStatus.COMPLETED: \"#87CEEB\",   # ã‚¹ã‚«ã‚¤ãƒ–ãƒ«ãƒ¼\n            NodeStatus.MISSING: \"#FF6B6B\"       # èµ¤\n        }\n        return color_map.get(status, \"#D3D3D3\")  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã‚°ãƒ¬ãƒ¼\n\n    def to_mermaid(self) -&gt; str:\n        \"\"\"Flowchartã‚’Mermaidæ§‹æ–‡ã«å¤‰æ›\"\"\"\n        lines = [\"graph TD\"]\n        style_lines = []\n        \n        # ãƒãƒ¼ãƒ‰å®šç¾©\n        for n in self.nodes:\n            # IDãŒ 'end' ã ã¨äºˆç´„èªè¡çªã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ãŸã‚ã€å®‰å…¨ã«å¤‰æ›\n            safe_id = f\"n_{n.id}\" if n.id == \"end\" else n.id\n            \n            # ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸå½¢çŠ¶ã‚’å–å¾—\n            shape = self._get_node_shape(n.type)\n            \n            # æ—¥æœ¬èªãƒ©ãƒ™ãƒ«ã¯å¿…ãšãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§å›²ã‚€\n            # å½¢çŠ¶æ§‹æ–‡ã«ãƒ©ãƒ™ãƒ«ã‚’åŸ‹ã‚è¾¼ã‚€\n            if shape == \"([ ])\":  # START/END\n                lines.append(f'{safe_id}[\"{n.label}\"]')\n            elif shape == \"[ ]\":  # PROCESS\n                lines.append(f'{safe_id}[\"{n.label}\"]')\n            elif shape == \"{ }\":  # DECISION\n                lines.append(f'{safe_id}{{\"{n.label}\"}}')\n            elif shape == \"[/ /]\":  # IO_DATA (å¹³è¡Œå››è¾ºå½¢)\n                lines.append(f'{safe_id}[/\"{n.label}\"/]')\n            elif shape == \"[( )]\":  # STORAGE (å††ç­’å½¢)\n                lines.append(f'{safe_id}[(\"{n.label}\")]')\n            elif shape == \"{{ }}\":  # MISSING\n                lines.append(f'{safe_id}{{\"{n.label}\"}}')\n            \n            # çŠ¶æ…‹ã«å¿œã˜ãŸã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ \n            color = self._get_status_color(n.status)\n            style_lines.append(f'    style {safe_id} fill:{color}')\n        \n        # ã‚¨ãƒƒã‚¸å®šç¾©\n        for e in self.edges:",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 24,
                "column": 1
              },
              "endPosition": {
                "line": 25,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 24,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 175
          },
          {
            "text": "def _get_node_shape(node_type: str) -&gt; str:",
            "lineNumber": 176
          },
          {
            "text": "  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯MISSING",
            "lineNumber": 187
          },
          {
            "lineNumber": 188
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 189
          },
          {
            "text": "    def _get_status_color(status: NodeStatus) -&gt; str:",
            "lineNumber": 190
          },
          {
            "text": "        \"\"\"ãƒãƒ¼ãƒ‰çŠ¶æ…‹ã«å¿œã˜ãŸè‰²ã‚’è¿”ã™\"\"\"",
            "lineNumber": 191
          },
          {
            "text": "        color_map = {",
            "lineNumber": 192
          },
          {
            "text": "            NodeStatus.ACTIVE: \"#90EE90\",      # ãƒ©ã‚¤ãƒˆã‚°ãƒªãƒ¼ãƒ³",
            "lineNumber": 193
          },
          {
            "text": "            NodeStatus.COMPLETED: \"#87CEEB\",   # ã‚¹ã‚«ã‚¤ãƒ–ãƒ«ãƒ¼",
            "lineNumber": 194
          },
          {
            "text": "            NodeStatus.MISSING: \"#FF6B6B\"       # èµ¤",
            "lineNumber": 195
          },
          {
            "text": "        }",
            "lineNumber": 196
          },
          {
            "text": "        return color_map.get(status, \"#D3D3D3\")  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã‚°ãƒ¬ãƒ¼",
            "lineNumber": 197
          },
          {
            "lineNumber": 198
          },
          {
            "text": "    def to_mermaid(self) -&gt; str:",
            "lineNumber": 199
          },
          {
            "text": "        \"\"\"Flowchartã‚’Mermaidæ§‹æ–‡ã«å¤‰æ›\"\"\"",
            "lineNumber": 200
          },
          {
            "text": "        lines = [\"graph TD\"]",
            "lineNumber": 201
          },
          {
            "text": "        style_lines = []",
            "lineNumber": 202
          },
          {
            "text": "        ",
            "lineNumber": 203
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰å®šç¾©",
            "lineNumber": 204
          },
          {
            "text": "        for n in self.nodes:",
            "lineNumber": 205
          },
          {
            "text": "            # IDãŒ 'end' ã ã¨äºˆç´„èªè¡çªã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ãŸã‚ã€å®‰å…¨ã«å¤‰æ›",
            "lineNumber": 206
          },
          {
            "text": "            safe_id = f\"n_{n.id}\" if n.id == \"end\" else n.id",
            "lineNumber": 207
          },
          {
            "text": "            ",
            "lineNumber": 208
          },
          {
            "text": "            # ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸå½¢çŠ¶ã‚’å–å¾—",
            "lineNumber": 209
          },
          {
            "text": "            shape = self._get_node_shape(n.type)",
            "lineNumber": 210
          },
          {
            "text": "            ",
            "lineNumber": 211
          },
          {
            "text": "            # æ—¥æœ¬èªãƒ©ãƒ™ãƒ«ã¯å¿…ãšãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§å›²ã‚€",
            "lineNumber": 212
          },
          {
            "text": "            # å½¢çŠ¶æ§‹æ–‡ã«ãƒ©ãƒ™ãƒ«ã‚’åŸ‹ã‚è¾¼ã‚€",
            "lineNumber": 213
          },
          {
            "text": "            if shape == \"([ ])\":  # START/END",
            "lineNumber": 214
          },
          {
            "text": "                lines.append(f'{safe_id}[\"{n.label}\"]')",
            "lineNumber": 215
          },
          {
            "text": "            elif shape == \"[ ]\":  # PROCESS",
            "lineNumber": 216
          },
          {
            "text": "                lines.append(f'{safe_id}[\"{n.label}\"]')",
            "lineNumber": 217
          },
          {
            "text": "            elif shape == \"{ }\":  # DECISION",
            "lineNumber": 218
          },
          {
            "text": "                lines.append(f'{safe_id}{{\"{n.label}\"}}')",
            "lineNumber": 219
          },
          {
            "text": "            elif shape == \"[/ /]\":  # IO_DATA (å¹³è¡Œå››è¾ºå½¢)",
            "lineNumber": 220
          },
          {
            "text": "                lines.append(f'{safe_id}[/\"{n.label}\"/]')",
            "lineNumber": 221
          },
          {
            "text": "            elif shape == \"[( )]\":  # STORAGE (å††ç­’å½¢)",
            "lineNumber": 222
          },
          {
            "text": "                lines.append(f'{safe_id}[(\"{n.label}\")]')",
            "lineNumber": 223
          },
          {
            "text": "            elif shape == \"{{ }}\":  # MISSING",
            "lineNumber": 224
          },
          {
            "text": "                lines.append(f'{safe_id}{{\"{n.label}\"}}')",
            "lineNumber": 225
          },
          {
            "text": "            ",
            "lineNumber": 226
          },
          {
            "text": "            # çŠ¶æ…‹ã«å¿œã˜ãŸã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ ",
            "lineNumber": 227
          },
          {
            "text": "            color = self._get_status_color(n.status)",
            "lineNumber": 228
          },
          {
            "text": "            style_lines.append(f'    style {safe_id} fill:{color}')",
            "lineNumber": 229
          },
          {
            "text": "        ",
            "lineNumber": 230
          },
          {
            "text": "        # ã‚¨ãƒƒã‚¸å®šç¾©",
            "lineNumber": 231
          },
          {
            "text": "        for e in self.edges:",
            "lineNumber": 232
          }
        ]
      },
      "score": 0.3305487632751465
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\mermaid_parser.py",
        "range": {
          "startPosition": {
            "line": 5
          },
          "endPosition": {
            "line": 178
          }
        },
        "contents": "class MermaidParser:\n@staticmethod\ndef parse(mermaid_text: str) -&gt; Flowchart:\n\n            for pattern in node_patterns:\n                node_match = re.match(pattern, line)\n                if node_match:\n                    node_id = node_match.group(1)\n                    label = node_match.group(2)\n                    \n                    # å½¢çŠ¶ã‹ã‚‰ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š\n                    if '{' in line and '}' in line:\n                        node_type = \"decision\"\n                    elif '(' in line and ')' in line:\n                        # ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ã¾ãŸã¯å††ç­’å½¢\n                        if node_id == \"start\" or (not nodes and node_id != \"node_end\"):\n                            node_type = \"start\"\n                        elif node_id == \"node_end\" or node_id.endswith(\"_end\"):\n                            node_type = \"end\"\n                        else:\n                            node_type = \"process\"\n                    elif '/' in line:\n                        node_type = \"io_data\"\n                    else:\n                        node_type = \"process\"\n                    \n                    # IDãŒ'end'ã®å ´åˆã¯'node_end'ã«å¤‰æ›\n                    safe_id = \"node_end\" if node_id.lower() == \"end\" else node_id\n                    \n                    # æ—¢ã«å­˜åœ¨ã™ã‚‹ãƒãƒ¼ãƒ‰ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆé‡è¤‡ã‚’é˜²ãï¼‰\n                    if safe_id not in [n.id for n in nodes]:\n                        node = Node(\n                            id=safe_id,\n                            label=label.strip(),\n                            type=node_type,\n                            status=NodeStatus.ACTIVE\n                        )\n                        nodes.append(node)\n                        node_map[node_id] = node\n                    node_found = True\n                    break\n            \n            if node_found:\n                continue\n            \n            # ã‚¨ãƒƒã‚¸å®šç¾©: source--&gt;target ã¾ãŸã¯ source--&gt;|\"label\"|target",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 6,
                "column": 1
              },
              "endPosition": {
                "line": 7,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 9,
                "column": 5
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 10,
                "column": 5
              },
              "endPosition": {
                "line": 11,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class MermaidParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 9
          },
          {
            "text": "def parse(mermaid_text: str) -&gt; Flowchart:",
            "lineNumber": 10
          },
          {
            "lineNumber": 61
          },
          {
            "text": "            for pattern in node_patterns:",
            "lineNumber": 62
          },
          {
            "text": "                node_match = re.match(pattern, line)",
            "lineNumber": 63
          },
          {
            "text": "                if node_match:",
            "lineNumber": 64
          },
          {
            "text": "                    node_id = node_match.group(1)",
            "lineNumber": 65
          },
          {
            "text": "                    label = node_match.group(2)",
            "lineNumber": 66
          },
          {
            "text": "                    ",
            "lineNumber": 67
          },
          {
            "text": "                    # å½¢çŠ¶ã‹ã‚‰ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š",
            "lineNumber": 68
          },
          {
            "text": "                    if '{' in line and '}' in line:",
            "lineNumber": 69
          },
          {
            "text": "                        node_type = \"decision\"",
            "lineNumber": 70
          },
          {
            "text": "                    elif '(' in line and ')' in line:",
            "lineNumber": 71
          },
          {
            "text": "                        # ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ã¾ãŸã¯å††ç­’å½¢",
            "lineNumber": 72
          },
          {
            "text": "                        if node_id == \"start\" or (not nodes and node_id != \"node_end\"):",
            "lineNumber": 73
          },
          {
            "text": "                            node_type = \"start\"",
            "lineNumber": 74
          },
          {
            "text": "                        elif node_id == \"node_end\" or node_id.endswith(\"_end\"):",
            "lineNumber": 75
          },
          {
            "text": "                            node_type = \"end\"",
            "lineNumber": 76
          },
          {
            "text": "                        else:",
            "lineNumber": 77
          },
          {
            "text": "                            node_type = \"process\"",
            "lineNumber": 78
          },
          {
            "text": "                    elif '/' in line:",
            "lineNumber": 79
          },
          {
            "text": "                        node_type = \"io_data\"",
            "lineNumber": 80
          },
          {
            "text": "                    else:",
            "lineNumber": 81
          },
          {
            "text": "                        node_type = \"process\"",
            "lineNumber": 82
          },
          {
            "text": "                    ",
            "lineNumber": 83
          },
          {
            "text": "                    # IDãŒ'end'ã®å ´åˆã¯'node_end'ã«å¤‰æ›",
            "lineNumber": 84
          },
          {
            "text": "                    safe_id = \"node_end\" if node_id.lower() == \"end\" else node_id",
            "lineNumber": 85
          },
          {
            "text": "                    ",
            "lineNumber": 86
          },
          {
            "text": "                    # æ—¢ã«å­˜åœ¨ã™ã‚‹ãƒãƒ¼ãƒ‰ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆé‡è¤‡ã‚’é˜²ãï¼‰",
            "lineNumber": 87
          },
          {
            "text": "                    if safe_id not in [n.id for n in nodes]:",
            "lineNumber": 88
          },
          {
            "text": "                        node = Node(",
            "lineNumber": 89
          },
          {
            "text": "                            id=safe_id,",
            "lineNumber": 90
          },
          {
            "text": "                            label=label.strip(),",
            "lineNumber": 91
          },
          {
            "text": "                            type=node_type,",
            "lineNumber": 92
          },
          {
            "text": "                            status=NodeStatus.ACTIVE",
            "lineNumber": 93
          },
          {
            "text": "                        )",
            "lineNumber": 94
          },
          {
            "text": "                        nodes.append(node)",
            "lineNumber": 95
          },
          {
            "text": "                        node_map[node_id] = node",
            "lineNumber": 96
          },
          {
            "text": "                    node_found = True",
            "lineNumber": 97
          },
          {
            "text": "                    break",
            "lineNumber": 98
          },
          {
            "text": "            ",
            "lineNumber": 99
          },
          {
            "text": "            if node_found:",
            "lineNumber": 100
          },
          {
            "text": "                continue",
            "lineNumber": 101
          },
          {
            "text": "            ",
            "lineNumber": 102
          },
          {
            "text": "            # ã‚¨ãƒƒã‚¸å®šç¾©: source--&gt;target ã¾ãŸã¯ source--&gt;|\"label\"|target",
            "lineNumber": 103
          }
        ]
      },
      "score": 0.31219756603240967
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 23
          },
          "endPosition": {
            "line": 271
          }
        },
        "contents": "class Flowchart(BaseModel):\ndef detect_logic_gaps(self) -&gt; List[Node]:\n\n        \n        return gaps\n\n    def apply_logic_gap_detection(self) -&gt; 'Flowchart':\n        \"\"\"è«–ç†ã®ç©´ã‚’æ¤œå‡ºã—ã€MISSINGãƒãƒ¼ãƒ‰ã¨ã—ã¦è¿½åŠ \"\"\"\n        gaps = self.detect_logic_gaps()\n        \n        if not gaps:\n            return self\n        \n        # æ—¢å­˜ã®ãƒãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼\n        new_nodes = [Node(**node.model_dump()) for node in self.nodes]\n        new_edges = [Edge(**edge.model_dump()) for edge in self.edges]\n        \n        # ã‚®ãƒ£ãƒƒãƒ—ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã¾ãŸã¯æ›´æ–°\n        existing_ids = {node.id for node in new_nodes}\n        for gap in gaps:\n            if gap.id not in existing_ids:\n                new_nodes.append(gap)\n            else:\n                # æ—¢å­˜ãƒãƒ¼ãƒ‰ã‚’MISSINGã¨ã—ã¦æ›´æ–°\n                for i, node in enumerate(new_nodes):\n                    if node.id == gap.id:\n                        new_nodes[i] = Node(\n                            id=node.id,\n                            label=node.label,\n                            type=\"missing\",\n                            status=NodeStatus.MISSING\n                        )\n                        break\n        \n        return Flowchart(nodes=new_nodes, edges=new_edges)\n\n    @staticmethod\n    def _get_node_shape(node_type: str) -&gt; str:\n        \"\"\"ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸMermaidå½¢çŠ¶ã‚’è¿”ã™\"\"\"\n        shape_map = {\n            \"start\": \"([ ])\",\n            \"end\": \"([ ])\",\n            \"process\": \"[ ]\",\n            \"decision\": \"{ }\",\n            \"io_data\": \"[/ /]\",\n            \"storage\": \"[( )]\",\n            \"missing\": \"{{ }}\"\n        }\n        return shape_map.get(node_type.lower(), \"{{ }}\")  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯MISSING\n\n    @staticmethod\n    def _get_status_color(status: NodeStatus) -&gt; str:\n        ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 24,
                "column": 1
              },
              "endPosition": {
                "line": 25,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 24,
            "isSignature": true
          },
          {
            "text": "def detect_logic_gaps(self) -&gt; List[Node]:",
            "lineNumber": 75
          },
          {
            "lineNumber": 141
          },
          {
            "text": "        ",
            "lineNumber": 142
          },
          {
            "text": "        return gaps",
            "lineNumber": 143
          },
          {
            "lineNumber": 144
          },
          {
            "text": "    def apply_logic_gap_detection(self) -&gt; 'Flowchart':",
            "lineNumber": 145
          },
          {
            "text": "        \"\"\"è«–ç†ã®ç©´ã‚’æ¤œå‡ºã—ã€MISSINGãƒãƒ¼ãƒ‰ã¨ã—ã¦è¿½åŠ \"\"\"",
            "lineNumber": 146
          },
          {
            "text": "        gaps = self.detect_logic_gaps()",
            "lineNumber": 147
          },
          {
            "text": "        ",
            "lineNumber": 148
          },
          {
            "text": "        if not gaps:",
            "lineNumber": 149
          },
          {
            "text": "            return self",
            "lineNumber": 150
          },
          {
            "text": "        ",
            "lineNumber": 151
          },
          {
            "text": "        # æ—¢å­˜ã®ãƒãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼",
            "lineNumber": 152
          },
          {
            "text": "        new_nodes = [Node(**node.model_dump()) for node in self.nodes]",
            "lineNumber": 153
          },
          {
            "text": "        new_edges = [Edge(**edge.model_dump()) for edge in self.edges]",
            "lineNumber": 154
          },
          {
            "text": "        ",
            "lineNumber": 155
          },
          {
            "text": "        # ã‚®ãƒ£ãƒƒãƒ—ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã¾ãŸã¯æ›´æ–°",
            "lineNumber": 156
          },
          {
            "text": "        existing_ids = {node.id for node in new_nodes}",
            "lineNumber": 157
          },
          {
            "text": "        for gap in gaps:",
            "lineNumber": 158
          },
          {
            "text": "            if gap.id not in existing_ids:",
            "lineNumber": 159
          },
          {
            "text": "                new_nodes.append(gap)",
            "lineNumber": 160
          },
          {
            "text": "            else:",
            "lineNumber": 161
          },
          {
            "text": "                # æ—¢å­˜ãƒãƒ¼ãƒ‰ã‚’MISSINGã¨ã—ã¦æ›´æ–°",
            "lineNumber": 162
          },
          {
            "text": "                for i, node in enumerate(new_nodes):",
            "lineNumber": 163
          },
          {
            "text": "                    if node.id == gap.id:",
            "lineNumber": 164
          },
          {
            "text": "                        new_nodes[i] = Node(",
            "lineNumber": 165
          },
          {
            "text": "                            id=node.id,",
            "lineNumber": 166
          },
          {
            "text": "                            label=node.label,",
            "lineNumber": 167
          },
          {
            "text": "                            type=\"missing\",",
            "lineNumber": 168
          },
          {
            "text": "                            status=NodeStatus.MISSING",
            "lineNumber": 169
          },
          {
            "text": "                        )",
            "lineNumber": 170
          },
          {
            "text": "                        break",
            "lineNumber": 171
          },
          {
            "text": "        ",
            "lineNumber": 172
          },
          {
            "text": "        return Flowchart(nodes=new_nodes, edges=new_edges)",
            "lineNumber": 173
          },
          {
            "lineNumber": 174
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 175
          },
          {
            "text": "    def _get_node_shape(node_type: str) -&gt; str:",
            "lineNumber": 176
          },
          {
            "text": "        \"\"\"ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸMermaidå½¢çŠ¶ã‚’è¿”ã™\"\"\"",
            "lineNumber": 177
          },
          {
            "text": "        shape_map = {",
            "lineNumber": 178
          },
          {
            "text": "            \"start\": \"([ ])\",",
            "lineNumber": 179
          },
          {
            "text": "            \"end\": \"([ ])\",",
            "lineNumber": 180
          },
          {
            "text": "            \"process\": \"[ ]\",",
            "lineNumber": 181
          },
          {
            "text": "            \"decision\": \"{ }\",",
            "lineNumber": 182
          },
          {
            "text": "            \"io_data\": \"[/ /]\",",
            "lineNumber": 183
          },
          {
            "text": "            \"storage\": \"[( )]\",",
            "lineNumber": 184
          },
          {
            "text": "            \"missing\": \"{{ }}\"",
            "lineNumber": 185
          },
          {
            "text": "        }",
            "lineNumber": 186
          },
          {
            "text": "        return shape_map.get(node_type.lower(), \"{{ }}\")  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯MISSING",
            "lineNumber": 187
          },
          {
            "lineNumber": 188
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 189
          },
          {
            "text": "    def _get_status_color(status: NodeStatus) -&gt; str:",
            "lineNumber": 190
          },
          {
            "text": "        ",
            "lineNumber": 191
          }
        ]
      },
      "score": 0.2944602966308594
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 23
          },
          "endPosition": {
            "line": 271,
            "column": 31
          }
        },
        "contents": "class Flowchart(BaseModel):\ndef to_mermaid(self) -&gt; str:\n\n        \n        # ã‚¨ãƒƒã‚¸å®šç¾©\n        for e in self.edges:\n            # ã‚¨ãƒƒã‚¸ï¼ˆæ¥ç¶šç·šï¼‰ã®IDã‚‚åŒæ§˜ã«å¤‰æ›\n            src = f\"n_{e.source}\" if e.source == \"end\" else e.source\n            tgt = f\"n_{e.target}\" if e.target == \"end\" else e.target\n            \n            if e.label:\n                lines.append(f'{src}--&gt;|\"{e.label}\"|{tgt}')\n            else:\n                lines.append(f'{src}--&gt;{tgt}')\n        \n        # ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©ã‚’è¿½åŠ \n        if style_lines:\n            lines.append(\"\")\n            lines.extend(style_lines)\n            \n        return \"\\n\".join(lines)\n\n    def to_toon_format(self) -&gt; str:\n        \"\"\"Flowchartã‚’TOONå½¢å¼ï¼ˆMarkdownï¼‰ã«å¤‰æ›\"\"\"\n        lines = []\n        \n        # ãƒãƒ¼ãƒ‰å®šç¾©\n        for node in self.nodes:\n            lines.append(\"[Node]\")\n            lines.append(f\"id: {node.id}\")\n            lines.append(f\"label: {node.label}\")\n            lines.append(f\"type: {node.type}\")\n            if node.status != NodeStatus.ACTIVE:\n                lines.append(f\"status: {node.status.value}\")\n            lines.append(\"\")\n        \n        # ã‚¨ãƒƒã‚¸å®šç¾©\n        for edge in self.edges:\n            lines.append(\"[Edge]\")\n            lines.append(f\"source: {edge.source}\")\n            lines.append(f\"target: {edge.target}\")\n            if edge.label:\n                lines.append(f\"label: {edge.label}\")\n            lines.append(\"\")\n        \n        return \"\\n\".join(lines)",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 24,
                "column": 1
              },
              "endPosition": {
                "line": 25,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 199,
                "column": 5
              },
              "endPosition": {
                "line": 200,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 24,
            "isSignature": true
          },
          {
            "text": "def to_mermaid(self) -&gt; str:",
            "lineNumber": 199
          },
          {
            "lineNumber": 229
          },
          {
            "text": "        ",
            "lineNumber": 230
          },
          {
            "text": "        # ã‚¨ãƒƒã‚¸å®šç¾©",
            "lineNumber": 231
          },
          {
            "text": "        for e in self.edges:",
            "lineNumber": 232
          },
          {
            "text": "            # ã‚¨ãƒƒã‚¸ï¼ˆæ¥ç¶šç·šï¼‰ã®IDã‚‚åŒæ§˜ã«å¤‰æ›",
            "lineNumber": 233
          },
          {
            "text": "            src = f\"n_{e.source}\" if e.source == \"end\" else e.source",
            "lineNumber": 234
          },
          {
            "text": "            tgt = f\"n_{e.target}\" if e.target == \"end\" else e.target",
            "lineNumber": 235
          },
          {
            "text": "            ",
            "lineNumber": 236
          },
          {
            "text": "            if e.label:",
            "lineNumber": 237
          },
          {
            "text": "                lines.append(f'{src}--&gt;|\"{e.label}\"|{tgt}')",
            "lineNumber": 238
          },
          {
            "text": "            else:",
            "lineNumber": 239
          },
          {
            "text": "                lines.append(f'{src}--&gt;{tgt}')",
            "lineNumber": 240
          },
          {
            "text": "        ",
            "lineNumber": 241
          },
          {
            "text": "        # ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©ã‚’è¿½åŠ ",
            "lineNumber": 242
          },
          {
            "text": "        if style_lines:",
            "lineNumber": 243
          },
          {
            "text": "            lines.append(\"\")",
            "lineNumber": 244
          },
          {
            "text": "            lines.extend(style_lines)",
            "lineNumber": 245
          },
          {
            "text": "            ",
            "lineNumber": 246
          },
          {
            "text": "        return \"\\n\".join(lines)",
            "lineNumber": 247
          },
          {
            "lineNumber": 248
          },
          {
            "text": "    def to_toon_format(self) -&gt; str:",
            "lineNumber": 249
          },
          {
            "text": "        \"\"\"Flowchartã‚’TOONå½¢å¼ï¼ˆMarkdownï¼‰ã«å¤‰æ›\"\"\"",
            "lineNumber": 250
          },
          {
            "text": "        lines = []",
            "lineNumber": 251
          },
          {
            "text": "        ",
            "lineNumber": 252
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰å®šç¾©",
            "lineNumber": 253
          },
          {
            "text": "        for node in self.nodes:",
            "lineNumber": 254
          },
          {
            "text": "            lines.append(\"[Node]\")",
            "lineNumber": 255
          },
          {
            "text": "            lines.append(f\"id: {node.id}\")",
            "lineNumber": 256
          },
          {
            "text": "            lines.append(f\"label: {node.label}\")",
            "lineNumber": 257
          },
          {
            "text": "            lines.append(f\"type: {node.type}\")",
            "lineNumber": 258
          },
          {
            "text": "            if node.status != NodeStatus.ACTIVE:",
            "lineNumber": 259
          },
          {
            "text": "                lines.append(f\"status: {node.status.value}\")",
            "lineNumber": 260
          },
          {
            "text": "            lines.append(\"\")",
            "lineNumber": 261
          },
          {
            "text": "        ",
            "lineNumber": 262
          },
          {
            "text": "        # ã‚¨ãƒƒã‚¸å®šç¾©",
            "lineNumber": 263
          },
          {
            "text": "        for edge in self.edges:",
            "lineNumber": 264
          },
          {
            "text": "            lines.append(\"[Edge]\")",
            "lineNumber": 265
          },
          {
            "text": "            lines.append(f\"source: {edge.source}\")",
            "lineNumber": 266
          },
          {
            "text": "            lines.append(f\"target: {edge.target}\")",
            "lineNumber": 267
          },
          {
            "text": "            if edge.label:",
            "lineNumber": 268
          },
          {
            "text": "                lines.append(f\"label: {edge.label}\")",
            "lineNumber": 269
          },
          {
            "text": "            lines.append(\"\")",
            "lineNumber": 270
          },
          {
            "text": "        ",
            "lineNumber": 271
          },
          {
            "text": "        return \"\\n\".join(lines)",
            "lineNumber": 272,
            "isSignature": true
          }
        ]
      },
      "score": 0.2930566072463989
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\frontend\\index.html",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 40,
            "column": 7
          }
        },
        "contents": "&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/npm/mermaid@10.9.5/dist/mermaid.min.js\"&gt;&lt;/script&gt;\n    &lt;style&gt;\n        body { margin: 0; background: white; overflow: auto; }\n        #container { display: flex; justify-content: center; padding: 20px; min-height: 100%; }\n        #graph { width: 100%; overflow: auto; }\n        svg { max-width: 100%; height: auto; display: block; }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"container\"&gt;\n        &lt;div id=\"graph\"&gt;&lt;/div&gt;\n    &lt;/div&gt;\n    &lt;script&gt;\n        mermaid.initialize({ startOnLoad: false, theme: 'default' });\n\n        async function render(b64) {\n            const container = document.getElementById('graph');\n            try {\n                // Base64ã‚’UTF-8æ–‡å­—åˆ—ã«å¾©å·\n                const code = decodeURIComponent(escape(window.atob(b64)));\n                container.innerHTML = \"\";\n                \n                const id = \"m\" + Math.random().toString(36).substr(2, 9);\n                const { svg } = await mermaid.render(id, code);\n                container.innerHTML = svg;\n            } catch (e) {\n                container.innerHTML = &#96;&lt;pre style='color:red'&gt;Render Error: ${e.message}&lt;/pre&gt;&#96;;\n            }\n        }\n\n        window.addEventListener(\"message\", (event) =&gt; {\n            if (event.data.type === \"render\") {\n                render(event.data.base64Code);\n            }\n        });\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "&lt;!DOCTYPE html&gt;",
            "lineNumber": 1
          },
          {
            "text": "&lt;html&gt;",
            "lineNumber": 2
          },
          {
            "text": "&lt;head&gt;",
            "lineNumber": 3
          },
          {
            "text": "    &lt;script src=\"https://cdn.jsdelivr.net/npm/mermaid@10.9.5/dist/mermaid.min.js\"&gt;&lt;/script&gt;",
            "lineNumber": 4
          },
          {
            "text": "    &lt;style&gt;",
            "lineNumber": 5
          },
          {
            "text": "        body { margin: 0; background: white; overflow: auto; }",
            "lineNumber": 6
          },
          {
            "text": "        #container { display: flex; justify-content: center; padding: 20px; min-height: 100%; }",
            "lineNumber": 7
          },
          {
            "text": "        #graph { width: 100%; overflow: auto; }",
            "lineNumber": 8
          },
          {
            "text": "        svg { max-width: 100%; height: auto; display: block; }",
            "lineNumber": 9
          },
          {
            "text": "    &lt;/style&gt;",
            "lineNumber": 10
          },
          {
            "text": "&lt;/head&gt;",
            "lineNumber": 11
          },
          {
            "text": "&lt;body&gt;",
            "lineNumber": 12
          },
          {
            "text": "    &lt;div id=\"container\"&gt;",
            "lineNumber": 13
          },
          {
            "text": "        &lt;div id=\"graph\"&gt;&lt;/div&gt;",
            "lineNumber": 14
          },
          {
            "text": "    &lt;/div&gt;",
            "lineNumber": 15
          },
          {
            "text": "    &lt;script&gt;",
            "lineNumber": 16
          },
          {
            "text": "        mermaid.initialize({ startOnLoad: false, theme: 'default' });",
            "lineNumber": 17
          },
          {
            "lineNumber": 18
          },
          {
            "text": "        async function render(b64) {",
            "lineNumber": 19
          },
          {
            "text": "            const container = document.getElementById('graph');",
            "lineNumber": 20
          },
          {
            "text": "            try {",
            "lineNumber": 21
          },
          {
            "text": "                // Base64ã‚’UTF-8æ–‡å­—åˆ—ã«å¾©å·",
            "lineNumber": 22
          },
          {
            "text": "                const code = decodeURIComponent(escape(window.atob(b64)));",
            "lineNumber": 23
          },
          {
            "text": "                container.innerHTML = \"\";",
            "lineNumber": 24
          },
          {
            "text": "                ",
            "lineNumber": 25
          },
          {
            "text": "                const id = \"m\" + Math.random().toString(36).substr(2, 9);",
            "lineNumber": 26
          },
          {
            "text": "                const { svg } = await mermaid.render(id, code);",
            "lineNumber": 27
          },
          {
            "text": "                container.innerHTML = svg;",
            "lineNumber": 28
          },
          {
            "text": "            } catch (e) {",
            "lineNumber": 29
          },
          {
            "text": "                container.innerHTML = &#96;&lt;pre style='color:red'&gt;Render Error: ${e.message}&lt;/pre&gt;&#96;;",
            "lineNumber": 30
          },
          {
            "text": "            }",
            "lineNumber": 31
          },
          {
            "text": "        }",
            "lineNumber": 32
          },
          {
            "lineNumber": 33
          },
          {
            "text": "        window.addEventListener(\"message\", (event) =&gt; {",
            "lineNumber": 34
          },
          {
            "text": "            if (event.data.type === \"render\") {",
            "lineNumber": 35
          },
          {
            "text": "                render(event.data.base64Code);",
            "lineNumber": 36
          },
          {
            "text": "            }",
            "lineNumber": 37
          },
          {
            "text": "        });",
            "lineNumber": 38
          },
          {
            "text": "    &lt;/script&gt;",
            "lineNumber": 39
          },
          {
            "text": "&lt;/body&gt;",
            "lineNumber": 40
          },
          {
            "text": "&lt;/html&gt;",
            "lineNumber": 41
          }
        ]
      },
      "score": 0.28700774908065796
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\rules.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 26
          }
        },
        "contents": "# Skills: Flowchart Logic Expert\n\n## Core Rules\n- **Logical Integrity**: å…¨ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ã¯å¿…ãšã€Œé–‹å§‹ã€ã‹ã‚‰å§‹ã¾ã‚Šã€Œçµ‚äº†ã€ã¸åˆ°é”ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚\n- **Reserved Word Protection**: Mermaid.js ã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã‚’é˜²ããŸã‚ã€çµ‚äº†ãƒãƒ¼ãƒ‰ã® ID ã«ã¯å¿…ãš &#96;node_end&#96; ã‚’ä½¿ç”¨ã—ã€ID å˜ä½“ã§ &#96;end&#96; ã‚’ä½¿ç”¨ã—ã¦ã¯ãªã‚‰ãªã„ã€‚\n- **Node Classification**:\n  - &#96;start&#96;: ãƒ•ãƒ­ãƒ¼ã®èµ·ç‚¹ã€‚\n  - &#96;end&#96;: ãƒ•ãƒ­ãƒ¼ã®çµ‚ç€ç‚¹ã€‚\n  - &#96;process&#96;: å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚„ä½œæ¥­ã€‚\n  - &#96;decision&#96;: äºŒè€…æŠä¸€ã€ã¾ãŸã¯å¤šè‚¢é¸æŠã®åˆ†å²ç‚¹ã€‚\n- **Atomic Steps**: 1ã¤ã®ãƒãƒ¼ãƒ‰ã«è¤‡æ•°ã®å·¥ç¨‹ã‚’è©°ã‚è¾¼ã¾ãšã€å¯èƒ½ãªé™ã‚Šæœ€å°å˜ä½ã«åˆ†å‰²ã™ã‚‹ã“ã¨ã€‚\n\n## Constraints\n- Windows / Python 3.10+ ç’°å¢ƒã§å‹•ä½œã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã‚ã‚‹ã“ã¨ã‚’æ„è­˜ã™ã‚‹ã“ã¨ã€‚\n- æ—¥æœ¬èªãƒ©ãƒ™ãƒ«ã¯å¸¸ã«æ­£ç¢ºã«ã€ã‹ã¤ç°¡æ½”ã«è¡¨ç¾ã™ã‚‹ã“ã¨ã€‚\n\n## Output Size Limits\n- **ãƒãƒ¼ãƒ‰æ•°ã®åˆ¶é™**: 1ã¤ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã«å«ã¾ã‚Œã‚‹ãƒãƒ¼ãƒ‰æ•°ã¯æœ€å¤§30å€‹ã¾ã§ã¨ã™ã‚‹ã€‚ã“ã‚Œã‚’è¶…ãˆã‚‹å ´åˆã¯ã€è¤‡æ•°ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã«åˆ†å‰²ã™ã‚‹ã‹ã€ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚\n- **ã‚¨ãƒƒã‚¸æ•°ã®åˆ¶é™**: ã‚¨ãƒƒã‚¸æ•°ã¯æœ€å¤§50å€‹ã¾ã§ã¨ã™ã‚‹ã€‚è¤‡é›‘ãªåˆ†å²ãŒå¤šã„å ´åˆã¯ã€ä¸»è¦ãªãƒ‘ã‚¹ã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚\n- **éƒ¨åˆ†çš„ãªãƒ•ãƒ­ãƒ¼ã®ç”Ÿæˆã‚’æ¨å¥¨**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã‚„éƒ¨åˆ†ã‚’æŒ‡å®šã—ã¦ã„ã‚‹å ´åˆã€ãã®éƒ¨åˆ†ã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚å…¨ãƒ«ãƒ¼ãƒˆã‚’å«ã‚€å¿…è¦ã¯ãªã„ã€‚\n- **æ®µéšçš„ãªç”Ÿæˆ**: å¤§è¦æ¨¡ãªãƒ—ãƒ­ã‚»ã‚¹ã‚’å¯è¦–åŒ–ã™ã‚‹å ´åˆã€ã¾ãšä¸»è¦ãªãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆã—ã€è©³ç´°ã¯å¾Œã‹ã‚‰è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã™ã‚‹ã€‚\n- **Streamlitè¡¨ç¤ºã®æœ€é©åŒ–**: Streamlitã§ãƒãƒ¼ãƒ¡ã‚¤ãƒ‰å›³ã‚’è¡¨ç¤ºã™ã‚‹éš›ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ã—ã€éåº¦ã«è¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã¯é¿ã‘ã‚‹ã“ã¨ã€‚\n\n## Information Gathering Rules\n- **Ask Before Assuming**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ãŒä¸ååˆ†ã§ã€å…·ä½“çš„ãªæƒ…å ±ï¼ˆãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®ä»•æ§˜ã€æ•…éšœã®ç—‡çŠ¶ã€ç’°å¢ƒè¨­å®šãªã©ï¼‰ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆã€æ¨æ¸¬ã§ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’ç”Ÿæˆã›ãšã€å¿…è¦ãªæƒ…å ±ã‚’è³ªå•ã™ã‚‹å½¢å¼ã§è¿”ã™ã“ã¨ã€‚\n- **Question Format**: è³ªå•ã¯TOONå½¢å¼ã§ã¯ãªãã€æ˜ç¢ºãªè³ªå•æ–‡ã¨ã—ã¦è¿”ã™ã“ã¨ã€‚ä¾‹ï¼šã€Œjarvisã®å…·ä½“çš„ãªæ•…éšœç—‡çŠ¶ã‚’æ•™ãˆã¦ãã ã•ã„ï¼ˆä¾‹ï¼šé›»æºãŒå…¥ã‚‰ãªã„ã€LEDãŒç‚¹ç¯ã—ãªã„ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãªã©ï¼‰ã€",
        "signatures": {},
        "detailedLines": [
          {
            "text": "# Skills: Flowchart Logic Expert",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "## Core Rules",
            "lineNumber": 3
          },
          {
            "text": "- **Logical Integrity**: å…¨ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ã¯å¿…ãšã€Œé–‹å§‹ã€ã‹ã‚‰å§‹ã¾ã‚Šã€Œçµ‚äº†ã€ã¸åˆ°é”ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚",
            "lineNumber": 4
          },
          {
            "text": "- **Reserved Word Protection**: Mermaid.js ã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã‚’é˜²ããŸã‚ã€çµ‚äº†ãƒãƒ¼ãƒ‰ã® ID ã«ã¯å¿…ãš &#96;node_end&#96; ã‚’ä½¿ç”¨ã—ã€ID å˜ä½“ã§ &#96;end&#96; ã‚’ä½¿ç”¨ã—ã¦ã¯ãªã‚‰ãªã„ã€‚",
            "lineNumber": 5
          },
          {
            "text": "- **Node Classification**:",
            "lineNumber": 6
          },
          {
            "text": "  - &#96;start&#96;: ãƒ•ãƒ­ãƒ¼ã®èµ·ç‚¹ã€‚",
            "lineNumber": 7
          },
          {
            "text": "  - &#96;end&#96;: ãƒ•ãƒ­ãƒ¼ã®çµ‚ç€ç‚¹ã€‚",
            "lineNumber": 8
          },
          {
            "text": "  - &#96;process&#96;: å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚„ä½œæ¥­ã€‚",
            "lineNumber": 9
          },
          {
            "text": "  - &#96;decision&#96;: äºŒè€…æŠä¸€ã€ã¾ãŸã¯å¤šè‚¢é¸æŠã®åˆ†å²ç‚¹ã€‚",
            "lineNumber": 10
          },
          {
            "text": "- **Atomic Steps**: 1ã¤ã®ãƒãƒ¼ãƒ‰ã«è¤‡æ•°ã®å·¥ç¨‹ã‚’è©°ã‚è¾¼ã¾ãšã€å¯èƒ½ãªé™ã‚Šæœ€å°å˜ä½ã«åˆ†å‰²ã™ã‚‹ã“ã¨ã€‚",
            "lineNumber": 11
          },
          {
            "lineNumber": 12
          },
          {
            "text": "## Constraints",
            "lineNumber": 13
          },
          {
            "text": "- Windows / Python 3.10+ ç’°å¢ƒã§å‹•ä½œã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã‚ã‚‹ã“ã¨ã‚’æ„è­˜ã™ã‚‹ã“ã¨ã€‚",
            "lineNumber": 14
          },
          {
            "text": "- æ—¥æœ¬èªãƒ©ãƒ™ãƒ«ã¯å¸¸ã«æ­£ç¢ºã«ã€ã‹ã¤ç°¡æ½”ã«è¡¨ç¾ã™ã‚‹ã“ã¨ã€‚",
            "lineNumber": 15
          },
          {
            "lineNumber": 16
          },
          {
            "text": "## Output Size Limits",
            "lineNumber": 17
          },
          {
            "text": "- **ãƒãƒ¼ãƒ‰æ•°ã®åˆ¶é™**: 1ã¤ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã«å«ã¾ã‚Œã‚‹ãƒãƒ¼ãƒ‰æ•°ã¯æœ€å¤§30å€‹ã¾ã§ã¨ã™ã‚‹ã€‚ã“ã‚Œã‚’è¶…ãˆã‚‹å ´åˆã¯ã€è¤‡æ•°ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã«åˆ†å‰²ã™ã‚‹ã‹ã€ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚",
            "lineNumber": 18
          },
          {
            "text": "- **ã‚¨ãƒƒã‚¸æ•°ã®åˆ¶é™**: ã‚¨ãƒƒã‚¸æ•°ã¯æœ€å¤§50å€‹ã¾ã§ã¨ã™ã‚‹ã€‚è¤‡é›‘ãªåˆ†å²ãŒå¤šã„å ´åˆã¯ã€ä¸»è¦ãªãƒ‘ã‚¹ã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚",
            "lineNumber": 19
          },
          {
            "text": "- **éƒ¨åˆ†çš„ãªãƒ•ãƒ­ãƒ¼ã®ç”Ÿæˆã‚’æ¨å¥¨**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã‚„éƒ¨åˆ†ã‚’æŒ‡å®šã—ã¦ã„ã‚‹å ´åˆã€ãã®éƒ¨åˆ†ã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚å…¨ãƒ«ãƒ¼ãƒˆã‚’å«ã‚€å¿…è¦ã¯ãªã„ã€‚",
            "lineNumber": 20
          },
          {
            "text": "- **æ®µéšçš„ãªç”Ÿæˆ**: å¤§è¦æ¨¡ãªãƒ—ãƒ­ã‚»ã‚¹ã‚’å¯è¦–åŒ–ã™ã‚‹å ´åˆã€ã¾ãšä¸»è¦ãªãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆã—ã€è©³ç´°ã¯å¾Œã‹ã‚‰è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã™ã‚‹ã€‚",
            "lineNumber": 21
          },
          {
            "text": "- **Streamlitè¡¨ç¤ºã®æœ€é©åŒ–**: Streamlitã§ãƒãƒ¼ãƒ¡ã‚¤ãƒ‰å›³ã‚’è¡¨ç¤ºã™ã‚‹éš›ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ã—ã€éåº¦ã«è¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã¯é¿ã‘ã‚‹ã“ã¨ã€‚",
            "lineNumber": 22
          },
          {
            "lineNumber": 23
          },
          {
            "text": "## Information Gathering Rules",
            "lineNumber": 24
          },
          {
            "text": "- **Ask Before Assuming**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ãŒä¸ååˆ†ã§ã€å…·ä½“çš„ãªæƒ…å ±ï¼ˆãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®ä»•æ§˜ã€æ•…éšœã®ç—‡çŠ¶ã€ç’°å¢ƒè¨­å®šãªã©ï¼‰ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆã€æ¨æ¸¬ã§ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’ç”Ÿæˆã›ãšã€å¿…è¦ãªæƒ…å ±ã‚’è³ªå•ã™ã‚‹å½¢å¼ã§è¿”ã™ã“ã¨ã€‚",
            "lineNumber": 25
          },
          {
            "text": "- **Question Format**: è³ªå•ã¯TOONå½¢å¼ã§ã¯ãªãã€æ˜ç¢ºãªè³ªå•æ–‡ã¨ã—ã¦è¿”ã™ã“ã¨ã€‚ä¾‹ï¼šã€Œjarvisã®å…·ä½“çš„ãªæ•…éšœç—‡çŠ¶ã‚’æ•™ãˆã¦ãã ã•ã„ï¼ˆä¾‹ï¼šé›»æºãŒå…¥ã‚‰ãªã„ã€LEDãŒç‚¹ç¯ã—ãªã„ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãªã©ï¼‰ã€",
            "lineNumber": 26
          }
        ]
      },
      "score": 0.2750985622406006
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\mermaid_parser.py",
        "range": {
          "startPosition": {
            "line": 5
          },
          "endPosition": {
            "line": 178
          }
        },
        "contents": "class MermaidParser:\n@staticmethod\ndef parse(mermaid_text: str) -&gt; Flowchart:\n\n            \n            # ã‚¨ãƒƒã‚¸å®šç¾©: source--&gt;target ã¾ãŸã¯ source--&gt;|\"label\"|target\n            edge_patterns = [\n                r'(\\w+)\\s*--&gt;\\s*\\|\\s*[\"\\']([^\"\\']+)[\"\\']\\s*\\|\\s*(\\w+)',  # source--&gt;|\"label\"|target\n                r'(\\w+)\\s*--&gt;\\s*(\\w+)',                                   # source--&gt;target\n            ]\n            \n            for pattern in edge_patterns:\n                edge_match = re.match(pattern, line)\n                if edge_match:\n                    source_id = edge_match.group(1)\n                    if len(edge_match.groups()) == 3:\n                        label = edge_match.group(2)\n                        target_id = edge_match.group(3)\n                    else:\n                        label = None\n                        target_id = edge_match.group(2)\n                    \n                    # IDãŒ'end'ã®å ´åˆã¯'node_end'ã«å¤‰æ›\n                    safe_source = \"node_end\" if source_id.lower() == \"end\" else source_id\n                    safe_target = \"node_end\" if target_id.lower() == \"end\" else target_id\n                    \n                    edges.append(Edge(\n                        source=safe_source,\n                        target=safe_target,\n                        label=label.strip() if label else None\n                    ))\n                    break\n        \n        # ãƒãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼\n        if not nodes:\n            raise TOONParseError(f\"Mermaidå½¢å¼ã®ãƒãƒ¼ãƒ‰ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚å†…å®¹ï¼š\\n{mermaid_text[:200]}...\")\n        \n        # startãƒãƒ¼ãƒ‰ã¨endãƒãƒ¼ãƒ‰ã®å­˜åœ¨ç¢ºèª\n        node_types = {node.type for node in nodes}\n        if \"start\" not in node_types:\n            # startãƒãƒ¼ãƒ‰ãŒãªã„å ´åˆã€æœ€åˆã®ãƒãƒ¼ãƒ‰ã‚’startã«è¨­å®š\n            if nodes:\n                nodes[0].type = \"start\"\n        \n        if \"end\" not in node_types:",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 6,
                "column": 1
              },
              "endPosition": {
                "line": 7,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 9,
                "column": 5
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 10,
                "column": 5
              },
              "endPosition": {
                "line": 11,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class MermaidParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 9
          },
          {
            "text": "def parse(mermaid_text: str) -&gt; Flowchart:",
            "lineNumber": 10
          },
          {
            "lineNumber": 101
          },
          {
            "text": "            ",
            "lineNumber": 102
          },
          {
            "text": "            # ã‚¨ãƒƒã‚¸å®šç¾©: source--&gt;target ã¾ãŸã¯ source--&gt;|\"label\"|target",
            "lineNumber": 103
          },
          {
            "text": "            edge_patterns = [",
            "lineNumber": 104
          },
          {
            "text": "                r'(\\w+)\\s*--&gt;\\s*\\|\\s*[\"\\']([^\"\\']+)[\"\\']\\s*\\|\\s*(\\w+)',  # source--&gt;|\"label\"|target",
            "lineNumber": 105
          },
          {
            "text": "                r'(\\w+)\\s*--&gt;\\s*(\\w+)',                                   # source--&gt;target",
            "lineNumber": 106
          },
          {
            "text": "            ]",
            "lineNumber": 107
          },
          {
            "text": "            ",
            "lineNumber": 108
          },
          {
            "text": "            for pattern in edge_patterns:",
            "lineNumber": 109
          },
          {
            "text": "                edge_match = re.match(pattern, line)",
            "lineNumber": 110
          },
          {
            "text": "                if edge_match:",
            "lineNumber": 111
          },
          {
            "text": "                    source_id = edge_match.group(1)",
            "lineNumber": 112
          },
          {
            "text": "                    if len(edge_match.groups()) == 3:",
            "lineNumber": 113
          },
          {
            "text": "                        label = edge_match.group(2)",
            "lineNumber": 114
          },
          {
            "text": "                        target_id = edge_match.group(3)",
            "lineNumber": 115
          },
          {
            "text": "                    else:",
            "lineNumber": 116
          },
          {
            "text": "                        label = None",
            "lineNumber": 117
          },
          {
            "text": "                        target_id = edge_match.group(2)",
            "lineNumber": 118
          },
          {
            "text": "                    ",
            "lineNumber": 119
          },
          {
            "text": "                    # IDãŒ'end'ã®å ´åˆã¯'node_end'ã«å¤‰æ›",
            "lineNumber": 120
          },
          {
            "text": "                    safe_source = \"node_end\" if source_id.lower() == \"end\" else source_id",
            "lineNumber": 121
          },
          {
            "text": "                    safe_target = \"node_end\" if target_id.lower() == \"end\" else target_id",
            "lineNumber": 122
          },
          {
            "text": "                    ",
            "lineNumber": 123
          },
          {
            "text": "                    edges.append(Edge(",
            "lineNumber": 124
          },
          {
            "text": "                        source=safe_source,",
            "lineNumber": 125
          },
          {
            "text": "                        target=safe_target,",
            "lineNumber": 126
          },
          {
            "text": "                        label=label.strip() if label else None",
            "lineNumber": 127
          },
          {
            "text": "                    ))",
            "lineNumber": 128
          },
          {
            "text": "                    break",
            "lineNumber": 129
          },
          {
            "text": "        ",
            "lineNumber": 130
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼",
            "lineNumber": 131
          },
          {
            "text": "        if not nodes:",
            "lineNumber": 132
          },
          {
            "text": "            raise TOONParseError(f\"Mermaidå½¢å¼ã®ãƒãƒ¼ãƒ‰ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚å†…å®¹ï¼š\\n{mermaid_text[:200]}...\")",
            "lineNumber": 133
          },
          {
            "text": "        ",
            "lineNumber": 134
          },
          {
            "text": "        # startãƒãƒ¼ãƒ‰ã¨endãƒãƒ¼ãƒ‰ã®å­˜åœ¨ç¢ºèª",
            "lineNumber": 135
          },
          {
            "text": "        node_types = {node.type for node in nodes}",
            "lineNumber": 136
          },
          {
            "text": "        if \"start\" not in node_types:",
            "lineNumber": 137
          },
          {
            "text": "            # startãƒãƒ¼ãƒ‰ãŒãªã„å ´åˆã€æœ€åˆã®ãƒãƒ¼ãƒ‰ã‚’startã«è¨­å®š",
            "lineNumber": 138
          },
          {
            "text": "            if nodes:",
            "lineNumber": 139
          },
          {
            "text": "                nodes[0].type = \"start\"",
            "lineNumber": 140
          },
          {
            "text": "        ",
            "lineNumber": 141
          },
          {
            "text": "        if \"end\" not in node_types:",
            "lineNumber": 142
          }
        ]
      },
      "score": 0.2672330141067505
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\mermaid_parser.py",
        "range": {
          "startPosition": {
            "line": 5
          },
          "endPosition": {
            "line": 178,
            "column": 24
          }
        },
        "contents": "class MermaidParser:\n@staticmethod\ndef parse(mermaid_text: str) -&gt; Flowchart:\n\n        \n        if \"end\" not in node_types:\n            # endãƒãƒ¼ãƒ‰ãŒãªã„å ´åˆã€node_endãŒã‚ã‚Œã°ãã‚Œã‚’endã«è¨­å®š\n            end_node = next((n for n in nodes if n.id == \"node_end\"), None)\n            if end_node:\n                end_node.type = \"end\"\n            else:\n                # çµ‚äº†ãƒãƒ¼ãƒ‰ãŒãªã„å ´åˆã€æœ€å¾Œã®ãƒãƒ¼ãƒ‰ã‚’endã«è¨­å®š\n                if nodes:\n                    nodes[-1].type = \"end\"\n        \n        return Flowchart(nodes=nodes, edges=edges)\n    \n    @staticmethod\n    def _determine_node_type(shape_start: str, shape_end: str) -&gt; str:\n        \"\"\"\n        Mermaidã®å½¢çŠ¶ã‹ã‚‰ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®šã—ã¾ã™ã€‚\n        \n        Args:\n            shape_start: å½¢çŠ¶ã®é–‹å§‹æ–‡å­—ï¼ˆ[, {, (ï¼‰\n            shape_end: å½¢çŠ¶ã®çµ‚äº†æ–‡å­—ï¼ˆ], }, )ï¼‰\n            \n        Returns:\n            ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ï¼ˆstart, end, process, decisionï¼‰\n        \"\"\"\n        # ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ ([ ]) -&gt; start/end\n        if shape_start == \"(\" and shape_end == \")\":\n            return \"start\"  # æœ€åˆã«è¦‹ã¤ã‹ã£ãŸã‚‚ã®ã¯startã€æœ€å¾Œã¯endã«è¨­å®šã•ã‚Œã‚‹\n        \n        # è±å½¢ { } -&gt; decision\n        if shape_start == \"{\" and shape_end == \"}\":\n            return \"decision\"\n        \n        # é•·æ–¹å½¢ [ ] -&gt; process\n        if shape_start == \"[\" and shape_end == \"]\":\n            return \"process\"\n        \n        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯process\n        return \"process\"",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 6,
                "column": 1
              },
              "endPosition": {
                "line": 7,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 9,
                "column": 5
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 10,
                "column": 5
              },
              "endPosition": {
                "line": 11,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class MermaidParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 9
          },
          {
            "text": "def parse(mermaid_text: str) -&gt; Flowchart:",
            "lineNumber": 10
          },
          {
            "lineNumber": 140
          },
          {
            "text": "        ",
            "lineNumber": 141
          },
          {
            "text": "        if \"end\" not in node_types:",
            "lineNumber": 142
          },
          {
            "text": "            # endãƒãƒ¼ãƒ‰ãŒãªã„å ´åˆã€node_endãŒã‚ã‚Œã°ãã‚Œã‚’endã«è¨­å®š",
            "lineNumber": 143
          },
          {
            "text": "            end_node = next((n for n in nodes if n.id == \"node_end\"), None)",
            "lineNumber": 144
          },
          {
            "text": "            if end_node:",
            "lineNumber": 145
          },
          {
            "text": "                end_node.type = \"end\"",
            "lineNumber": 146
          },
          {
            "text": "            else:",
            "lineNumber": 147
          },
          {
            "text": "                # çµ‚äº†ãƒãƒ¼ãƒ‰ãŒãªã„å ´åˆã€æœ€å¾Œã®ãƒãƒ¼ãƒ‰ã‚’endã«è¨­å®š",
            "lineNumber": 148
          },
          {
            "text": "                if nodes:",
            "lineNumber": 149
          },
          {
            "text": "                    nodes[-1].type = \"end\"",
            "lineNumber": 150
          },
          {
            "text": "        ",
            "lineNumber": 151
          },
          {
            "text": "        return Flowchart(nodes=nodes, edges=edges)",
            "lineNumber": 152
          },
          {
            "text": "    ",
            "lineNumber": 153
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 154
          },
          {
            "text": "    def _determine_node_type(shape_start: str, shape_end: str) -&gt; str:",
            "lineNumber": 155
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 156
          },
          {
            "text": "        Mermaidã®å½¢çŠ¶ã‹ã‚‰ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®šã—ã¾ã™ã€‚",
            "lineNumber": 157
          },
          {
            "text": "        ",
            "lineNumber": 158
          },
          {
            "text": "        Args:",
            "lineNumber": 159
          },
          {
            "text": "            shape_start: å½¢çŠ¶ã®é–‹å§‹æ–‡å­—ï¼ˆ[, {, (ï¼‰",
            "lineNumber": 160
          },
          {
            "text": "            shape_end: å½¢çŠ¶ã®çµ‚äº†æ–‡å­—ï¼ˆ], }, )ï¼‰",
            "lineNumber": 161
          },
          {
            "text": "            ",
            "lineNumber": 162
          },
          {
            "text": "        Returns:",
            "lineNumber": 163
          },
          {
            "text": "            ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ï¼ˆstart, end, process, decisionï¼‰",
            "lineNumber": 164
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 165
          },
          {
            "text": "        # ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ ([ ]) -&gt; start/end",
            "lineNumber": 166
          },
          {
            "text": "        if shape_start == \"(\" and shape_end == \")\":",
            "lineNumber": 167
          },
          {
            "text": "            return \"start\"  # æœ€åˆã«è¦‹ã¤ã‹ã£ãŸã‚‚ã®ã¯startã€æœ€å¾Œã¯endã«è¨­å®šã•ã‚Œã‚‹",
            "lineNumber": 168
          },
          {
            "text": "        ",
            "lineNumber": 169
          },
          {
            "text": "        # è±å½¢ { } -&gt; decision",
            "lineNumber": 170
          },
          {
            "text": "        if shape_start == \"{\" and shape_end == \"}\":",
            "lineNumber": 171
          },
          {
            "text": "            return \"decision\"",
            "lineNumber": 172
          },
          {
            "text": "        ",
            "lineNumber": 173
          },
          {
            "text": "        # é•·æ–¹å½¢ [ ] -&gt; process",
            "lineNumber": 174
          },
          {
            "text": "        if shape_start == \"[\" and shape_end == \"]\":",
            "lineNumber": 175
          },
          {
            "text": "            return \"process\"",
            "lineNumber": 176
          },
          {
            "text": "        ",
            "lineNumber": 177
          },
          {
            "text": "        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯process",
            "lineNumber": 178
          },
          {
            "text": "        return \"process\"",
            "lineNumber": 179,
            "isSignature": true
          }
        ]
      },
      "score": 0.2669006586074829
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\program_base.md",
        "range": {
          "startPosition": {
            "line": 40
          },
          "endPosition": {
            "line": 93
          }
        },
        "contents": "* Markdownå½¢å¼ã®TOONã‚’æ­£è¦è¡¨ç¾ï¼ˆRegexï¼‰ãªã©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã€&#96;models.py&#96; ã§å®šç¾©ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚¹ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚\n* **ã€Œå·®åˆ†ï¼ˆLOGï¼‰ã€ã®åæ˜ ãƒ­ã‚¸ãƒƒã‚¯**ã‚‚ã“ã“ã«æŒã¡ã¾ã™ã€‚å¤ã„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«LOGã®å†…å®¹ã‚’ä¸Šæ›¸ãã—ã¦ã€æœ€æ–°ã®çŠ¶æ…‹ã‚’ä½œã‚‹è²¬ä»»è€…ã§ã™ã€‚\n\n### â‘¢ &#96;generator/mermaid_gen.py&#96;\n\n**è²¬ä»»ï¼šè¦–è¦šåŒ–ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰**\n\n* &#96;models.py&#96; ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å—ã‘å–ã‚Šã€è¦å®šã—ãŸå¯¾å¿œè¡¨ã«åŸºã¥ã„ã¦ Mermaid æ§‹æ–‡ï¼ˆ&#96;([ ])&#96;, &#96;{ }&#96;ãªã©ï¼‰ã®æ–‡å­—åˆ—ã‚’çµ„ã¿ç«‹ã¦ã¾ã™ã€‚\n* ãƒãƒ¼ãƒ‰ã®è‰²ä»˜ã‘ï¼ˆ&#96;style&#96; æ§‹æ–‡ï¼‰ã®æ³¨å…¥ã‚‚ã“ã“ã§è¡Œã„ã¾ã™ã€‚\n\n### â‘£ &#96;llm/agent.py&#96;\n\n**è²¬ä»»ï¼šAIã¨ã®æ„æ€ç–é€š**\n\n* å¤§å‹LLMï¼ˆGPT-4oç­‰ï¼‰ã«å¯¾ã—ã€ç¾åœ¨ã®TOONã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’æ¸¡ã—ã€**ã€Œæ–°ã—ã„TOONã®å·®åˆ†è¡Œã€**ã‚’ç”Ÿæˆã•ã›ã¾ã™ã€‚\n* ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ç®¡ç†ã‚‚ã“ã“ã§è¡Œã„ã¾ã™ã€‚\n\n### â‘¤ &#96;app.py&#96;\n\n**è²¬ä»»ï¼šUIè¡¨ç¤ºã¨çŠ¶æ…‹ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**\n\n* Streamlitã®ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€‚\n* &#96;st.session_state&#96; ã‚’ä½¿ã„ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’å—ã‘ã¦ &#96;agent&#96; â†’ &#96;parser&#96; â†’ &#96;generator&#96; ã®é †ã«å‘¼ã³å‡ºã™å¸ä»¤å¡”ã§ã™ã€‚\n\n---\n\n## 3. ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å‹•ä½œãƒ•ãƒ­ãƒ¼ï¼ˆå›³è§£ï¼‰\n\n1ãƒ•ã‚¡ã‚¤ãƒ«1è²¬ä»»ã‚’å¾¹åº•ã™ã‚‹ã“ã¨ã§ã€æƒ…å ±ã®æµã‚ŒãŒä¸€æœ¬é“ã«ãªã‚Šã€ãƒ‡ãƒãƒƒã‚°ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚\n\n&#96;&#96;&#96;mermaid\ngraph LR\n    User([ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›]) --&gt; App[app.py]\n    App --&gt; Agent[llm/agent.py]\n    Agent --&gt;|TOONå·®åˆ†| Parser[parser/toon_parser.py]\n    Parser --&gt;|æœ€æ–°ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«| App\n    App --&gt; Gen[generator/mermaid_gen.py]\n    Gen --&gt;|Mermaidæ–‡å­—åˆ—| App\n    App --&gt; UI[ğŸ–¥ï¸ Streamlitè¡¨ç¤º]\n\n    subgraph Data\n        Parser -.-&gt; Snapshot[(TOON.md)]\n    end\n\n&#96;&#96;&#96;\n\n---\n\n## 4. ã“ã®æ§‹é€ ã®ãƒ¡ãƒªãƒƒãƒˆ\n\n* **äº¤æ›å¯èƒ½æ€§:** ã€ŒMermaidã§ã¯ãªãåˆ¥ã®å›³è§£ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã„ãŸã„ã€ã¨æ€ã£ãŸã‚‰ã€&#96;mermaid_gen.py&#96; ã ã‘ã‚’æ›¸ãæ›ãˆã‚Œã°æ¸ˆã¿ã¾ã™ã€‚\n* **ãƒ†ã‚¹ãƒˆã®å®¹æ˜“ã•:** AIãŒã„ãªãã¦ã‚‚ã€&#96;template.md&#96; ã‚’ &#96;toon_parser.py&#96; ã«èª­ã¿è¾¼ã¾ã›ã‚‹ã ã‘ã§ã€å›³è§£ãƒ­ã‚¸ãƒƒã‚¯ãŒæ­£ã—ã„ã‹ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚",
        "signatures": {},
        "detailedLines": [
          {
            "text": "* Markdownå½¢å¼ã®TOONã‚’æ­£è¦è¡¨ç¾ï¼ˆRegexï¼‰ãªã©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã€&#96;models.py&#96; ã§å®šç¾©ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚¹ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚",
            "lineNumber": 42
          },
          {
            "text": "* **ã€Œå·®åˆ†ï¼ˆLOGï¼‰ã€ã®åæ˜ ãƒ­ã‚¸ãƒƒã‚¯**ã‚‚ã“ã“ã«æŒã¡ã¾ã™ã€‚å¤ã„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«LOGã®å†…å®¹ã‚’ä¸Šæ›¸ãã—ã¦ã€æœ€æ–°ã®çŠ¶æ…‹ã‚’ä½œã‚‹è²¬ä»»è€…ã§ã™ã€‚",
            "lineNumber": 43
          },
          {
            "lineNumber": 44
          },
          {
            "text": "### â‘¢ &#96;generator/mermaid_gen.py&#96;",
            "lineNumber": 45
          },
          {
            "lineNumber": 46
          },
          {
            "text": "**è²¬ä»»ï¼šè¦–è¦šåŒ–ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰**",
            "lineNumber": 47
          },
          {
            "lineNumber": 48
          },
          {
            "text": "* &#96;models.py&#96; ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å—ã‘å–ã‚Šã€è¦å®šã—ãŸå¯¾å¿œè¡¨ã«åŸºã¥ã„ã¦ Mermaid æ§‹æ–‡ï¼ˆ&#96;([ ])&#96;, &#96;{ }&#96;ãªã©ï¼‰ã®æ–‡å­—åˆ—ã‚’çµ„ã¿ç«‹ã¦ã¾ã™ã€‚",
            "lineNumber": 49
          },
          {
            "text": "* ãƒãƒ¼ãƒ‰ã®è‰²ä»˜ã‘ï¼ˆ&#96;style&#96; æ§‹æ–‡ï¼‰ã®æ³¨å…¥ã‚‚ã“ã“ã§è¡Œã„ã¾ã™ã€‚",
            "lineNumber": 50
          },
          {
            "lineNumber": 51
          },
          {
            "text": "### â‘£ &#96;llm/agent.py&#96;",
            "lineNumber": 52
          },
          {
            "lineNumber": 53
          },
          {
            "text": "**è²¬ä»»ï¼šAIã¨ã®æ„æ€ç–é€š**",
            "lineNumber": 54
          },
          {
            "lineNumber": 55
          },
          {
            "text": "* å¤§å‹LLMï¼ˆGPT-4oç­‰ï¼‰ã«å¯¾ã—ã€ç¾åœ¨ã®TOONã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’æ¸¡ã—ã€**ã€Œæ–°ã—ã„TOONã®å·®åˆ†è¡Œã€**ã‚’ç”Ÿæˆã•ã›ã¾ã™ã€‚",
            "lineNumber": 56
          },
          {
            "text": "* ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ç®¡ç†ã‚‚ã“ã“ã§è¡Œã„ã¾ã™ã€‚",
            "lineNumber": 57
          },
          {
            "lineNumber": 58
          },
          {
            "text": "### â‘¤ &#96;app.py&#96;",
            "lineNumber": 59
          },
          {
            "lineNumber": 60
          },
          {
            "text": "**è²¬ä»»ï¼šUIè¡¨ç¤ºã¨çŠ¶æ…‹ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**",
            "lineNumber": 61
          },
          {
            "lineNumber": 62
          },
          {
            "text": "* Streamlitã®ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€‚",
            "lineNumber": 63
          },
          {
            "text": "* &#96;st.session_state&#96; ã‚’ä½¿ã„ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’å—ã‘ã¦ &#96;agent&#96; â†’ &#96;parser&#96; â†’ &#96;generator&#96; ã®é †ã«å‘¼ã³å‡ºã™å¸ä»¤å¡”ã§ã™ã€‚",
            "lineNumber": 64
          },
          {
            "lineNumber": 65
          },
          {
            "text": "---",
            "lineNumber": 66
          },
          {
            "lineNumber": 67
          },
          {
            "text": "## 3. ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å‹•ä½œãƒ•ãƒ­ãƒ¼ï¼ˆå›³è§£ï¼‰",
            "lineNumber": 68
          },
          {
            "lineNumber": 69
          },
          {
            "text": "1ãƒ•ã‚¡ã‚¤ãƒ«1è²¬ä»»ã‚’å¾¹åº•ã™ã‚‹ã“ã¨ã§ã€æƒ…å ±ã®æµã‚ŒãŒä¸€æœ¬é“ã«ãªã‚Šã€ãƒ‡ãƒãƒƒã‚°ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚",
            "lineNumber": 70
          },
          {
            "lineNumber": 71
          },
          {
            "text": "&#96;&#96;&#96;mermaid",
            "lineNumber": 72
          },
          {
            "text": "graph LR",
            "lineNumber": 73
          },
          {
            "text": "    User([ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›]) --&gt; App[app.py]",
            "lineNumber": 74
          },
          {
            "text": "    App --&gt; Agent[llm/agent.py]",
            "lineNumber": 75
          },
          {
            "text": "    Agent --&gt;|TOONå·®åˆ†| Parser[parser/toon_parser.py]",
            "lineNumber": 76
          },
          {
            "text": "    Parser --&gt;|æœ€æ–°ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«| App",
            "lineNumber": 77
          },
          {
            "text": "    App --&gt; Gen[generator/mermaid_gen.py]",
            "lineNumber": 78
          },
          {
            "text": "    Gen --&gt;|Mermaidæ–‡å­—åˆ—| App",
            "lineNumber": 79
          },
          {
            "text": "    App --&gt; UI[ğŸ–¥ï¸ Streamlitè¡¨ç¤º]",
            "lineNumber": 80
          },
          {
            "lineNumber": 81
          },
          {
            "text": "    subgraph Data",
            "lineNumber": 82
          },
          {
            "text": "        Parser -.-&gt; Snapshot[(TOON.md)]",
            "lineNumber": 83
          },
          {
            "text": "    end",
            "lineNumber": 84
          },
          {
            "lineNumber": 85
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 86
          },
          {
            "lineNumber": 87
          },
          {
            "text": "---",
            "lineNumber": 88
          },
          {
            "lineNumber": 89
          },
          {
            "text": "## 4. ã“ã®æ§‹é€ ã®ãƒ¡ãƒªãƒƒãƒˆ",
            "lineNumber": 90
          },
          {
            "lineNumber": 91
          },
          {
            "text": "* **äº¤æ›å¯èƒ½æ€§:** ã€ŒMermaidã§ã¯ãªãåˆ¥ã®å›³è§£ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã„ãŸã„ã€ã¨æ€ã£ãŸã‚‰ã€&#96;mermaid_gen.py&#96; ã ã‘ã‚’æ›¸ãæ›ãˆã‚Œã°æ¸ˆã¿ã¾ã™ã€‚",
            "lineNumber": 92
          },
          {
            "text": "* **ãƒ†ã‚¹ãƒˆã®å®¹æ˜“ã•:** AIãŒã„ãªãã¦ã‚‚ã€&#96;template.md&#96; ã‚’ &#96;toon_parser.py&#96; ã«èª­ã¿è¾¼ã¾ã›ã‚‹ã ã‘ã§ã€å›³è§£ãƒ­ã‚¸ãƒƒã‚¯ãŒæ­£ã—ã„ã‹ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚",
            "lineNumber": 93
          }
        ]
      },
      "score": 0.2585808038711548
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 445,
            "column": 62
          },
          "endPosition": {
            "line": 492,
            "column": 25
          }
        },
        "contents": "with col_flow:\n    st.subheader(\"ğŸ“Š ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ\")\n    # Mermaidæç”»å‡¦ç†\n    mermaid_code = current_flow.to_mermaid()\n    b64_mermaid = base64.b64encode(mermaid_code.encode('utf-8')).decode('utf-8')\n\n    html_path = Path(\"frontend/index.html\")\n    if html_path.exists():\n        html_content = html_path.read_text(encoding='utf-8')\n        components.html(\n            f\"\"\"\n            {html_content}\n            &lt;script&gt;\n                window.onload = () =&gt; {{\n                    window.postMessage({{ \n                        type: \"render\", \n                        base64Code: \"{b64_mermaid}\" \n                    }}, \"*\");\n                }};\n            &lt;/script&gt;\n            \"\"\",\n            height=800,\n            scrolling=True,\n        )\n    else:\n        st.error(\"frontend/index.html ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\")\n\nwith col_source:\n    st.subheader(\"ğŸ“„ TOONå½¢å¼ï¼ˆSourceï¼‰\")\n    \n    # TOONå½¢å¼ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ\n    toon_text = current_flow.to_toon_format()\n    \n    with st.expander(\"TOONå½¢å¼ã‚’è¡¨ç¤º\", expanded=True):\n        st.code(toon_text, language=\"markdown\")\n    \n    # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³\n    st.download_button(\n        label=\"ğŸ“¥ TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\",\n        data=toon_text,\n        file_name=f\"{session_name}_toon.md\",\n        mime=\"text/markdown\"\n    )\n\nwith st.sidebar.expander(\"ç¾åœ¨ã®Mermaidã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤º\"):\n    st.code(mermaid_code)",
        "signatures": {},
        "detailedLines": [
          {
            "text": "with col_flow:",
            "lineNumber": 448
          },
          {
            "text": "    st.subheader(\"ğŸ“Š ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ\")",
            "lineNumber": 449
          },
          {
            "text": "    # Mermaidæç”»å‡¦ç†",
            "lineNumber": 450
          },
          {
            "text": "    mermaid_code = current_flow.to_mermaid()",
            "lineNumber": 451
          },
          {
            "text": "    b64_mermaid = base64.b64encode(mermaid_code.encode('utf-8')).decode('utf-8')",
            "lineNumber": 452
          },
          {
            "lineNumber": 453
          },
          {
            "text": "    html_path = Path(\"frontend/index.html\")",
            "lineNumber": 454
          },
          {
            "text": "    if html_path.exists():",
            "lineNumber": 455
          },
          {
            "text": "        html_content = html_path.read_text(encoding='utf-8')",
            "lineNumber": 456
          },
          {
            "text": "        components.html(",
            "lineNumber": 457
          },
          {
            "text": "            f\"\"\"",
            "lineNumber": 458
          },
          {
            "text": "            {html_content}",
            "lineNumber": 459
          },
          {
            "text": "            &lt;script&gt;",
            "lineNumber": 460
          },
          {
            "text": "                window.onload = () =&gt; {{",
            "lineNumber": 461
          },
          {
            "text": "                    window.postMessage({{ ",
            "lineNumber": 462
          },
          {
            "text": "                        type: \"render\", ",
            "lineNumber": 463
          },
          {
            "text": "                        base64Code: \"{b64_mermaid}\" ",
            "lineNumber": 464
          },
          {
            "text": "                    }}, \"*\");",
            "lineNumber": 465
          },
          {
            "text": "                }};",
            "lineNumber": 466
          },
          {
            "text": "            &lt;/script&gt;",
            "lineNumber": 467
          },
          {
            "text": "            \"\"\",",
            "lineNumber": 468
          },
          {
            "text": "            height=800,",
            "lineNumber": 469
          },
          {
            "text": "            scrolling=True,",
            "lineNumber": 470
          },
          {
            "text": "        )",
            "lineNumber": 471
          },
          {
            "text": "    else:",
            "lineNumber": 472
          },
          {
            "text": "        st.error(\"frontend/index.html ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\")",
            "lineNumber": 473
          },
          {
            "lineNumber": 474
          },
          {
            "text": "with col_source:",
            "lineNumber": 475
          },
          {
            "text": "    st.subheader(\"ğŸ“„ TOONå½¢å¼ï¼ˆSourceï¼‰\")",
            "lineNumber": 476
          },
          {
            "text": "    ",
            "lineNumber": 477
          },
          {
            "text": "    # TOONå½¢å¼ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ",
            "lineNumber": 478
          },
          {
            "text": "    toon_text = current_flow.to_toon_format()",
            "lineNumber": 479
          },
          {
            "text": "    ",
            "lineNumber": 480
          },
          {
            "text": "    with st.expander(\"TOONå½¢å¼ã‚’è¡¨ç¤º\", expanded=True):",
            "lineNumber": 481
          },
          {
            "text": "        st.code(toon_text, language=\"markdown\")",
            "lineNumber": 482
          },
          {
            "text": "    ",
            "lineNumber": 483
          },
          {
            "text": "    # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³",
            "lineNumber": 484
          },
          {
            "text": "    st.download_button(",
            "lineNumber": 485
          },
          {
            "text": "        label=\"ğŸ“¥ TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\",",
            "lineNumber": 486
          },
          {
            "text": "        data=toon_text,",
            "lineNumber": 487
          },
          {
            "text": "        file_name=f\"{session_name}_toon.md\",",
            "lineNumber": 488
          },
          {
            "text": "        mime=\"text/markdown\"",
            "lineNumber": 489
          },
          {
            "text": "    )",
            "lineNumber": 490
          },
          {
            "lineNumber": 491
          },
          {
            "text": "with st.sidebar.expander(\"ç¾åœ¨ã®Mermaidã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤º\"):",
            "lineNumber": 492
          },
          {
            "text": "    st.code(mermaid_code)",
            "lineNumber": 493
          }
        ]
      },
      "score": 0.2553307116031647
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\convert_flow_to_json.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 52,
            "column": 26
          }
        },
        "contents": "#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\"\"\"\nflow.mdã‚’èª­ã¿è¾¼ã‚“ã§JSONå½¢å¼ã«å¤‰æ›ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ\n\"\"\"\nimport json\nimport sys\nfrom pathlib import Path\nfrom core.mermaid_parser import MermaidParser\nfrom core.history_mgr import HistoryManager\n\ndef convert_flow_to_json():\n    \"\"\"flow.mdã‚’èª­ã¿è¾¼ã‚“ã§JSONå½¢å¼ã«å¤‰æ›\"\"\"\n    # flow.mdã‚’èª­ã¿è¾¼ã‚€\n    flow_path = Path(\"flow.md\")\n    if not flow_path.exists():\n        print(f\"Error: {flow_path} not found\", file=sys.stderr)\n        return\n    \n    # Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚€\n    mermaid_text = flow_path.read_text(encoding=\"utf-8\")\n    \n    # Mermaidå½¢å¼ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›\n    try:\n        flowchart = MermaidParser.parse(mermaid_text)\n        print(\"OK: Mermaid parsing succeeded\")\n        print(f\"  Nodes: {len(flowchart.nodes)}\")\n        print(f\"  Edges: {len(flowchart.edges)}\")\n    except Exception as e:\n        print(f\"Error: Mermaid parsing failed: {e}\", file=sys.stderr)\n        import traceback\n        traceback.print_exc()\n        return\n    \n    # JSONå½¢å¼ã§ä¿å­˜\n    history_mgr = HistoryManager()\n    session_name = \"flow_md\"\n    \n    # ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ã—ã¦ä¿å­˜\n    history_mgr.save_session(session_name, [flowchart])\n    print(f\"OK: Saved as JSON: storage/sessions/{session_name}.json\")\n    \n    # TOONå½¢å¼ã§ã‚‚ä¿å­˜\n    history_mgr.save_toon_file(session_name, flowchart)\n    print(f\"OK: Saved as TOON: storage/toon_files/{session_name}.md\")\n    \n    # JSONãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’è¡¨ç¤º\n    json_path = history_mgr.storage_dir / f\"{session_name}.json\"\n    print(f\"\\nTo load:\")\n    print(f\"  Use session name '{session_name}' in Streamlit app\")\n\nif __name__ == \"__main__\":\n    convert_flow_to_json()",
        "signatures": {},
        "detailedLines": [
          {
            "text": "#!/usr/bin/env python3",
            "lineNumber": 1
          },
          {
            "text": "# -*- coding: utf-8 -*-",
            "lineNumber": 2
          },
          {
            "text": "\"\"\"",
            "lineNumber": 3
          },
          {
            "text": "flow.mdã‚’èª­ã¿è¾¼ã‚“ã§JSONå½¢å¼ã«å¤‰æ›ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ",
            "lineNumber": 4
          },
          {
            "text": "\"\"\"",
            "lineNumber": 5
          },
          {
            "text": "import json",
            "lineNumber": 6
          },
          {
            "text": "import sys",
            "lineNumber": 7
          },
          {
            "text": "from pathlib import Path",
            "lineNumber": 8
          },
          {
            "text": "from core.mermaid_parser import MermaidParser",
            "lineNumber": 9
          },
          {
            "text": "from core.history_mgr import HistoryManager",
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "text": "def convert_flow_to_json():",
            "lineNumber": 12,
            "isSignature": true
          },
          {
            "text": "    \"\"\"flow.mdã‚’èª­ã¿è¾¼ã‚“ã§JSONå½¢å¼ã«å¤‰æ›\"\"\"",
            "lineNumber": 13
          },
          {
            "text": "    # flow.mdã‚’èª­ã¿è¾¼ã‚€",
            "lineNumber": 14
          },
          {
            "text": "    flow_path = Path(\"flow.md\")",
            "lineNumber": 15
          },
          {
            "text": "    if not flow_path.exists():",
            "lineNumber": 16
          },
          {
            "text": "        print(f\"Error: {flow_path} not found\", file=sys.stderr)",
            "lineNumber": 17
          },
          {
            "text": "        return",
            "lineNumber": 18
          },
          {
            "text": "    ",
            "lineNumber": 19
          },
          {
            "text": "    # Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚€",
            "lineNumber": 20
          },
          {
            "text": "    mermaid_text = flow_path.read_text(encoding=\"utf-8\")",
            "lineNumber": 21
          },
          {
            "text": "    ",
            "lineNumber": 22
          },
          {
            "text": "    # Mermaidå½¢å¼ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›",
            "lineNumber": 23
          },
          {
            "text": "    try:",
            "lineNumber": 24
          },
          {
            "text": "        flowchart = MermaidParser.parse(mermaid_text)",
            "lineNumber": 25
          },
          {
            "text": "        print(\"OK: Mermaid parsing succeeded\")",
            "lineNumber": 26
          },
          {
            "text": "        print(f\"  Nodes: {len(flowchart.nodes)}\")",
            "lineNumber": 27
          },
          {
            "text": "        print(f\"  Edges: {len(flowchart.edges)}\")",
            "lineNumber": 28
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 29
          },
          {
            "text": "        print(f\"Error: Mermaid parsing failed: {e}\", file=sys.stderr)",
            "lineNumber": 30
          },
          {
            "text": "        import traceback",
            "lineNumber": 31
          },
          {
            "text": "        traceback.print_exc()",
            "lineNumber": 32
          },
          {
            "text": "        return",
            "lineNumber": 33
          },
          {
            "text": "    ",
            "lineNumber": 34
          },
          {
            "text": "    # JSONå½¢å¼ã§ä¿å­˜",
            "lineNumber": 35
          },
          {
            "text": "    history_mgr = HistoryManager()",
            "lineNumber": 36
          },
          {
            "text": "    session_name = \"flow_md\"",
            "lineNumber": 37
          },
          {
            "text": "    ",
            "lineNumber": 38
          },
          {
            "text": "    # ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ã—ã¦ä¿å­˜",
            "lineNumber": 39
          },
          {
            "text": "    history_mgr.save_session(session_name, [flowchart])",
            "lineNumber": 40
          },
          {
            "text": "    print(f\"OK: Saved as JSON: storage/sessions/{session_name}.json\")",
            "lineNumber": 41
          },
          {
            "text": "    ",
            "lineNumber": 42
          },
          {
            "text": "    # TOONå½¢å¼ã§ã‚‚ä¿å­˜",
            "lineNumber": 43
          },
          {
            "text": "    history_mgr.save_toon_file(session_name, flowchart)",
            "lineNumber": 44
          },
          {
            "text": "    print(f\"OK: Saved as TOON: storage/toon_files/{session_name}.md\")",
            "lineNumber": 45
          },
          {
            "text": "    ",
            "lineNumber": 46
          },
          {
            "text": "    # JSONãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’è¡¨ç¤º",
            "lineNumber": 47
          },
          {
            "text": "    json_path = history_mgr.storage_dir / f\"{session_name}.json\"",
            "lineNumber": 48
          },
          {
            "text": "    print(f\"\\nTo load:\")",
            "lineNumber": 49
          },
          {
            "text": "    print(f\"  Use session name '{session_name}' in Streamlit app\")",
            "lineNumber": 50,
            "isSignature": true
          },
          {
            "lineNumber": 51
          },
          {
            "text": "if __name__ == \"__main__\":",
            "lineNumber": 52
          },
          {
            "text": "    convert_flow_to_json()",
            "lineNumber": 53
          }
        ]
      },
      "score": 0.23255234956741333
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\TOON_BASE.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 46,
            "column": 13
          }
        },
        "contents": "# Output Format: TOON (Token-Oriented Object Notation)\n\nå›ç­”ã¯ä»¥ä¸‹ã®ãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ã®ã¿ã§æ§‹æˆã—ã¦ãã ã•ã„ã€‚è§£èª¬ã‚„å°å…¥æ–‡ã¯ä¸€åˆ‡ç¦æ­¢ã—ã¾ã™ã€‚\n\n## Output Size Guidelines\n- **ãƒãƒ¼ãƒ‰æ•°**: æœ€å¤§30å€‹ã¾ã§ï¼ˆStreamlitã§ã®è¡¨ç¤ºãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ï¼‰\n- **ã‚¨ãƒƒã‚¸æ•°**: æœ€å¤§50å€‹ã¾ã§\n- **éƒ¨åˆ†çš„ãªãƒ•ãƒ­ãƒ¼ã®ç”Ÿæˆ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã‚„éƒ¨åˆ†ã‚’æŒ‡å®šã—ã¦ã„ã‚‹å ´åˆã€ãã®éƒ¨åˆ†ã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚å…¨ãƒ«ãƒ¼ãƒˆã‚’å«ã‚€å¿…è¦ã¯ãªã„ã€‚\n- **è¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ã®å ´åˆ**: ã¾ãšä¸»è¦ãªãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆã—ã€è©³ç´°ã¯å¾Œã‹ã‚‰è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã™ã‚‹ã€‚\n\n[Node]\nid: (è‹±æ•°å­—ID)\nlabel: (å·¥ç¨‹å)\ntype: (start | end | process | decision | io_data | storage)\n\n[Edge]\nsource: (ç™ºä¿¡å…ƒID)\ntarget: (å®›å…ˆID)\nlabel: (åˆ†å²æ¡ä»¶ãŒã‚ã‚‹å ´åˆã®ã¿)\n\n## Examples\n[Node]\nid: start\nlabel: é–‹å§‹\ntype: start\n[Node]\nid: task1\nlabel: å‡¦ç†\ntype: process\n[Node]\nid: node_end\nlabel: çµ‚äº†\ntype: end\n[Edge]\nsource: start\ntarget: task1\n[Edge]\nsource: task1\ntarget: node_end\n[Node]\nid: input1\nlabel: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›\ntype: io_data\n[Node]\nid: db1\nlabel: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹\ntype: storage",
        "signatures": {},
        "detailedLines": [
          {
            "text": "# Output Format: TOON (Token-Oriented Object Notation)",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "å›ç­”ã¯ä»¥ä¸‹ã®ãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ã®ã¿ã§æ§‹æˆã—ã¦ãã ã•ã„ã€‚è§£èª¬ã‚„å°å…¥æ–‡ã¯ä¸€åˆ‡ç¦æ­¢ã—ã¾ã™ã€‚",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "## Output Size Guidelines",
            "lineNumber": 5
          },
          {
            "text": "- **ãƒãƒ¼ãƒ‰æ•°**: æœ€å¤§30å€‹ã¾ã§ï¼ˆStreamlitã§ã®è¡¨ç¤ºãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ï¼‰",
            "lineNumber": 6
          },
          {
            "text": "- **ã‚¨ãƒƒã‚¸æ•°**: æœ€å¤§50å€‹ã¾ã§",
            "lineNumber": 7
          },
          {
            "text": "- **éƒ¨åˆ†çš„ãªãƒ•ãƒ­ãƒ¼ã®ç”Ÿæˆ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã‚„éƒ¨åˆ†ã‚’æŒ‡å®šã—ã¦ã„ã‚‹å ´åˆã€ãã®éƒ¨åˆ†ã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚å…¨ãƒ«ãƒ¼ãƒˆã‚’å«ã‚€å¿…è¦ã¯ãªã„ã€‚",
            "lineNumber": 8
          },
          {
            "text": "- **è¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ã®å ´åˆ**: ã¾ãšä¸»è¦ãªãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆã—ã€è©³ç´°ã¯å¾Œã‹ã‚‰è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã™ã‚‹ã€‚",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "text": "[Node]",
            "lineNumber": 11
          },
          {
            "text": "id: (è‹±æ•°å­—ID)",
            "lineNumber": 12
          },
          {
            "text": "label: (å·¥ç¨‹å)",
            "lineNumber": 13
          },
          {
            "text": "type: (start | end | process | decision | io_data | storage)",
            "lineNumber": 14
          },
          {
            "lineNumber": 15
          },
          {
            "text": "[Edge]",
            "lineNumber": 16
          },
          {
            "text": "source: (ç™ºä¿¡å…ƒID)",
            "lineNumber": 17
          },
          {
            "text": "target: (å®›å…ˆID)",
            "lineNumber": 18
          },
          {
            "text": "label: (åˆ†å²æ¡ä»¶ãŒã‚ã‚‹å ´åˆã®ã¿)",
            "lineNumber": 19
          },
          {
            "lineNumber": 20
          },
          {
            "text": "## Examples",
            "lineNumber": 21
          },
          {
            "text": "[Node]",
            "lineNumber": 22
          },
          {
            "text": "id: start",
            "lineNumber": 23
          },
          {
            "text": "label: é–‹å§‹",
            "lineNumber": 24
          },
          {
            "text": "type: start",
            "lineNumber": 25
          },
          {
            "text": "[Node]",
            "lineNumber": 26
          },
          {
            "text": "id: task1",
            "lineNumber": 27
          },
          {
            "text": "label: å‡¦ç†",
            "lineNumber": 28
          },
          {
            "text": "type: process",
            "lineNumber": 29
          },
          {
            "text": "[Node]",
            "lineNumber": 30
          },
          {
            "text": "id: node_end",
            "lineNumber": 31
          },
          {
            "text": "label: çµ‚äº†",
            "lineNumber": 32
          },
          {
            "text": "type: end",
            "lineNumber": 33
          },
          {
            "text": "[Edge]",
            "lineNumber": 34
          },
          {
            "text": "source: start",
            "lineNumber": 35
          },
          {
            "text": "target: task1",
            "lineNumber": 36
          },
          {
            "text": "[Edge]",
            "lineNumber": 37
          },
          {
            "text": "source: task1",
            "lineNumber": 38
          },
          {
            "text": "target: node_end",
            "lineNumber": 39
          },
          {
            "text": "[Node]",
            "lineNumber": 40
          },
          {
            "text": "id: input1",
            "lineNumber": 41
          },
          {
            "text": "label: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›",
            "lineNumber": 42
          },
          {
            "text": "type: io_data",
            "lineNumber": 43
          },
          {
            "text": "[Node]",
            "lineNumber": 44
          },
          {
            "text": "id: db1",
            "lineNumber": 45
          },
          {
            "text": "label: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹",
            "lineNumber": 46
          },
          {
            "text": "type: storage",
            "lineNumber": 47
          }
        ]
      },
      "score": 0.22578489780426025
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\Project.md",
        "range": {
          "startPosition": {
            "line": 28
          },
          "endPosition": {
            "line": 71
          }
        },
        "contents": "### 3.2 è¦–è¦šçš„æ‹¡å¼µï¼ˆå›³è§£ï¼‰æ©Ÿèƒ½\n\n* **Mermaid.jsã«ã‚ˆã‚‹æç”»:** TOONã®å„ã‚¿ã‚¤ãƒ—ã‚’ç‰¹å®šã®å½¢çŠ¶ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦è¡¨ç¤ºã™ã‚‹ã€‚\n* **ã€Œè«–ç†ã®ç©´ã€ã®æ¤œçŸ¥:** å‡ºå£ã®ãªã„åˆ†å²ã‚„ã€æ¥ç¶šå…ˆãŒæœªå®šç¾©ã®ãƒãƒ¼ãƒ‰ã‚’ &#96;MISSING&#96;ï¼ˆå…­è§’å½¢ãƒ»èµ¤è‰²ï¼‰ã¨ã—ã¦å¼·èª¿è¡¨ç¤ºã™ã‚‹ã€‚\n* **ã‚¹ã‚¿ã‚¤ãƒ«åˆ¶å¾¡:** ç¾åœ¨é€²è¡Œä¸­ã®ãƒãƒ¼ãƒ‰ã‚„å®Œäº†ã—ãŸå·¥ç¨‹ã‚’è‰²åˆ†ã‘ã—ã¦è¦–è¦šçš„ã«å¼·èª¿ã™ã‚‹ã€‚\n\n### 3.3 çŠ¶æ…‹ç®¡ç†æ©Ÿèƒ½\n\n* Streamlitã® &#96;session_state&#96; ã‚’åˆ©ç”¨ã—ã€å¯¾è©±ã®é€²æ—ã¨TOONã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’åŒæœŸã™ã‚‹ã€‚\n\n---\n\n## 4. ãƒ‡ãƒ¼ã‚¿å®šç¾©ï¼ˆTOON-Mermaid ãƒãƒƒãƒ”ãƒ³ã‚°ï¼‰\n\nç¾å ´ä½œæ¥­ã§ã®ã€Œè¦‹ã‚„ã™ã•ã€ã¨ã€Œç›´æ„Ÿæ€§ã€ã‚’é‡è¦–ã—ãŸå®šç¾©ã‚’æ¡ç”¨ã™ã‚‹ã€‚\n\n| ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ— | Mermaidå½¢çŠ¶ | è¨˜æ³• | æ„å‘³ãƒ»å½¹å‰² |\n| --- | --- | --- | --- |\n| **START/END** | ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ | &#96;([ ])&#96; | ãƒ•ãƒ­ãƒ¼ã®èµ·ç‚¹ãƒ»çµ‚ç€ç‚¹ã€‚ |\n| **PROCESS** | é•·æ–¹å½¢ | &#96;[ ]&#96; | å…·ä½“çš„ãªä½œæ¥­å†…å®¹ã‚„å‘½ä»¤ã€‚ |\n| **DECISION** | è±å½¢ | &#96;{ }&#96; | æ¡ä»¶åˆ†å²ã€‚Yes/Noãªã©ã®ãƒ«ãƒ¼ãƒˆåˆ†ã‘ã€‚ |\n| **IO_DATA** | å¹³è¡Œå››è¾ºå½¢ | &#96;[/ /]&#96; | ç”»é¢å…¥åŠ›ã‚„æ‰‹å‹•æ“ä½œã€‚ |\n| **STORAGE** | å††ç­’å½¢ | &#96;[( )]&#96; | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ“ä½œã€‚ |\n| **MISSING** | å…­è§’å½¢ï¼ˆèµ¤ï¼‰ | &#96;{{ }}&#96; | **æœªå®Ÿè£…ãƒ»è¦æ¤œè¨ç®‡æ‰€ã€‚** |\n\n---\n\n## 5. UI/UX è¨­è¨ˆæ¡ˆ\n\nç¾å ´ã§ã®ä½œæ¥­åŠ¹ç‡ã‚’æœ€å¤§åŒ–ã™ã‚‹ã€Œ3ãƒšã‚¤ãƒ³æ§‹æˆã€ã‚’æƒ³å®šã™ã‚‹ã€‚\n\n1. **å·¦ãƒšã‚¤ãƒ³ï¼ˆChatï¼‰:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒAIã¨å¯¾è©±ã™ã‚‹ã‚¨ãƒªã‚¢ã€‚\n2. **ä¸­å¤®ãƒšã‚¤ãƒ³ï¼ˆFlowchartï¼‰:** Mermaid.jsã«ã‚ˆã£ã¦æç”»ã•ã‚Œã‚‹å‹•çš„ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã€‚\n3. **å³ãƒšã‚¤ãƒ³ï¼ˆSourceï¼‰:** ç¾åœ¨ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã€‚\n\n---\n\n## 6. éæ©Ÿèƒ½è¦ä»¶\n\n* **æ‹¡å¼µæ€§:** TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…±é€šè¨€èªã¨ã™ã‚‹ã“ã¨ã§ã€å°†æ¥çš„ã«Pythonã‚³ãƒ¼ãƒ‰ã®è‡ªå‹•ç”Ÿæˆæ©Ÿèƒ½ãªã©ã‚’è¿½åŠ å¯èƒ½ã«ã™ã‚‹ã€‚\n* **å …ç‰¢æ€§:** è»½é‡LLMãŒãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ãŸå ´åˆã§ã‚‚ã€ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ã«ã‚ˆã£ã¦å›³è§£ãŒå´©ã‚Œã‚‹ã®ã‚’é˜²æ­¢ã™ã‚‹ã€‚\n* **è»½é‡åŒ–:** 2æ®µéšç›®ã®è§£æã«Gemma:4bç­‰ã®å°å‹ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®é«˜é€ŸåŒ–ã‚’å›³ã‚‹ã€‚",
        "signatures": {},
        "detailedLines": [
          {
            "text": "### 3.2 è¦–è¦šçš„æ‹¡å¼µï¼ˆå›³è§£ï¼‰æ©Ÿèƒ½",
            "lineNumber": 30
          },
          {
            "lineNumber": 31
          },
          {
            "text": "* **Mermaid.jsã«ã‚ˆã‚‹æç”»:** TOONã®å„ã‚¿ã‚¤ãƒ—ã‚’ç‰¹å®šã®å½¢çŠ¶ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦è¡¨ç¤ºã™ã‚‹ã€‚",
            "lineNumber": 32
          },
          {
            "text": "* **ã€Œè«–ç†ã®ç©´ã€ã®æ¤œçŸ¥:** å‡ºå£ã®ãªã„åˆ†å²ã‚„ã€æ¥ç¶šå…ˆãŒæœªå®šç¾©ã®ãƒãƒ¼ãƒ‰ã‚’ &#96;MISSING&#96;ï¼ˆå…­è§’å½¢ãƒ»èµ¤è‰²ï¼‰ã¨ã—ã¦å¼·èª¿è¡¨ç¤ºã™ã‚‹ã€‚",
            "lineNumber": 33
          },
          {
            "text": "* **ã‚¹ã‚¿ã‚¤ãƒ«åˆ¶å¾¡:** ç¾åœ¨é€²è¡Œä¸­ã®ãƒãƒ¼ãƒ‰ã‚„å®Œäº†ã—ãŸå·¥ç¨‹ã‚’è‰²åˆ†ã‘ã—ã¦è¦–è¦šçš„ã«å¼·èª¿ã™ã‚‹ã€‚",
            "lineNumber": 34
          },
          {
            "lineNumber": 35
          },
          {
            "text": "### 3.3 çŠ¶æ…‹ç®¡ç†æ©Ÿèƒ½",
            "lineNumber": 36
          },
          {
            "lineNumber": 37
          },
          {
            "text": "* Streamlitã® &#96;session_state&#96; ã‚’åˆ©ç”¨ã—ã€å¯¾è©±ã®é€²æ—ã¨TOONã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’åŒæœŸã™ã‚‹ã€‚",
            "lineNumber": 38
          },
          {
            "lineNumber": 39
          },
          {
            "text": "---",
            "lineNumber": 40
          },
          {
            "lineNumber": 41
          },
          {
            "text": "## 4. ãƒ‡ãƒ¼ã‚¿å®šç¾©ï¼ˆTOON-Mermaid ãƒãƒƒãƒ”ãƒ³ã‚°ï¼‰",
            "lineNumber": 42
          },
          {
            "lineNumber": 43
          },
          {
            "text": "ç¾å ´ä½œæ¥­ã§ã®ã€Œè¦‹ã‚„ã™ã•ã€ã¨ã€Œç›´æ„Ÿæ€§ã€ã‚’é‡è¦–ã—ãŸå®šç¾©ã‚’æ¡ç”¨ã™ã‚‹ã€‚",
            "lineNumber": 44
          },
          {
            "lineNumber": 45
          },
          {
            "text": "| ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ— | Mermaidå½¢çŠ¶ | è¨˜æ³• | æ„å‘³ãƒ»å½¹å‰² |",
            "lineNumber": 46
          },
          {
            "text": "| --- | --- | --- | --- |",
            "lineNumber": 47
          },
          {
            "text": "| **START/END** | ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ | &#96;([ ])&#96; | ãƒ•ãƒ­ãƒ¼ã®èµ·ç‚¹ãƒ»çµ‚ç€ç‚¹ã€‚ |",
            "lineNumber": 48
          },
          {
            "text": "| **PROCESS** | é•·æ–¹å½¢ | &#96;[ ]&#96; | å…·ä½“çš„ãªä½œæ¥­å†…å®¹ã‚„å‘½ä»¤ã€‚ |",
            "lineNumber": 49
          },
          {
            "text": "| **DECISION** | è±å½¢ | &#96;{ }&#96; | æ¡ä»¶åˆ†å²ã€‚Yes/Noãªã©ã®ãƒ«ãƒ¼ãƒˆåˆ†ã‘ã€‚ |",
            "lineNumber": 50
          },
          {
            "text": "| **IO_DATA** | å¹³è¡Œå››è¾ºå½¢ | &#96;[/ /]&#96; | ç”»é¢å…¥åŠ›ã‚„æ‰‹å‹•æ“ä½œã€‚ |",
            "lineNumber": 51
          },
          {
            "text": "| **STORAGE** | å††ç­’å½¢ | &#96;[( )]&#96; | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ“ä½œã€‚ |",
            "lineNumber": 52
          },
          {
            "text": "| **MISSING** | å…­è§’å½¢ï¼ˆèµ¤ï¼‰ | &#96;{{ }}&#96; | **æœªå®Ÿè£…ãƒ»è¦æ¤œè¨ç®‡æ‰€ã€‚** |",
            "lineNumber": 53
          },
          {
            "lineNumber": 54
          },
          {
            "text": "---",
            "lineNumber": 55
          },
          {
            "lineNumber": 56
          },
          {
            "text": "## 5. UI/UX è¨­è¨ˆæ¡ˆ",
            "lineNumber": 57
          },
          {
            "lineNumber": 58
          },
          {
            "text": "ç¾å ´ã§ã®ä½œæ¥­åŠ¹ç‡ã‚’æœ€å¤§åŒ–ã™ã‚‹ã€Œ3ãƒšã‚¤ãƒ³æ§‹æˆã€ã‚’æƒ³å®šã™ã‚‹ã€‚",
            "lineNumber": 59
          },
          {
            "lineNumber": 60
          },
          {
            "text": "1. **å·¦ãƒšã‚¤ãƒ³ï¼ˆChatï¼‰:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒAIã¨å¯¾è©±ã™ã‚‹ã‚¨ãƒªã‚¢ã€‚",
            "lineNumber": 61
          },
          {
            "text": "2. **ä¸­å¤®ãƒšã‚¤ãƒ³ï¼ˆFlowchartï¼‰:** Mermaid.jsã«ã‚ˆã£ã¦æç”»ã•ã‚Œã‚‹å‹•çš„ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã€‚",
            "lineNumber": 62
          },
          {
            "text": "3. **å³ãƒšã‚¤ãƒ³ï¼ˆSourceï¼‰:** ç¾åœ¨ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã€‚",
            "lineNumber": 63
          },
          {
            "lineNumber": 64
          },
          {
            "text": "---",
            "lineNumber": 65
          },
          {
            "lineNumber": 66
          },
          {
            "text": "## 6. éæ©Ÿèƒ½è¦ä»¶",
            "lineNumber": 67
          },
          {
            "lineNumber": 68
          },
          {
            "text": "* **æ‹¡å¼µæ€§:** TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…±é€šè¨€èªã¨ã™ã‚‹ã“ã¨ã§ã€å°†æ¥çš„ã«Pythonã‚³ãƒ¼ãƒ‰ã®è‡ªå‹•ç”Ÿæˆæ©Ÿèƒ½ãªã©ã‚’è¿½åŠ å¯èƒ½ã«ã™ã‚‹ã€‚",
            "lineNumber": 69
          },
          {
            "text": "* **å …ç‰¢æ€§:** è»½é‡LLMãŒãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ãŸå ´åˆã§ã‚‚ã€ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ã«ã‚ˆã£ã¦å›³è§£ãŒå´©ã‚Œã‚‹ã®ã‚’é˜²æ­¢ã™ã‚‹ã€‚",
            "lineNumber": 70
          },
          {
            "text": "* **è»½é‡åŒ–:** 2æ®µéšç›®ã®è§£æã«Gemma:4bç­‰ã®å°å‹ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®é«˜é€ŸåŒ–ã‚’å›³ã‚‹ã€‚",
            "lineNumber": 71
          }
        ]
      },
      "score": 0.22476035356521606
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\toon_parser.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 61
          }
        },
        "contents": "import re\nfrom core.schemas import Node, Edge, Flowchart, NodeStatus\nfrom core.exceptions import TOONParseError\n\nclass TOONParser:\n    @staticmethod\n    def parse(text: str) -&gt; Flowchart:\n        # Markdownã®è£…é£¾ï¼ˆ&#96;&#96;&#96;toon...&#96;&#96;&#96;ï¼‰ãŒã‚ã‚Œã°é™¤å»\n        clean_text = re.sub(r'&#96;&#96;&#96;[a-zA-Z]*\\n?', '', text)\n        clean_text = clean_text.replace('&#96;&#96;&#96;', '').strip()\n\n        nodes = []\n        edges = []\n\n        # [Node]ã‚¿ã‚°ã§åˆ†å‰²ã—ã¦æŠ½å‡º\n        node_matches = re.split(r'\\[Node\\]', clean_text, flags=re.IGNORECASE)[1:]\n        for block in node_matches:\n            # æ¬¡ã®ã‚¿ã‚°ã®æ‰‹å‰ã¾ã§ã‚’ãƒ‘ãƒ¼ã‚¹\n            data = TOONParser._parse_block(re.split(r'\\[', block)[0])\n            if 'id' in data and 'label' in data:\n                raw_id = data['id'].strip()\n                safe_id = \"node_end\" if raw_id.lower() == \"end\" else raw_id\n                \n                # statusãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®èª­ã¿è¾¼ã¿\n                status = NodeStatus.ACTIVE  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤\n                if 'status' in data:\n                    try:\n                        status = NodeStatus(data['status'].strip().lower())\n                    except ValueError:\n                        # ç„¡åŠ¹ãªstatuså€¤ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨\n                        pass\n                \n                nodes.append(Node(\n                    id=safe_id,\n                    label=data['label'].strip(),\n                    type=data.get('type', 'process').strip().lower(),\n                    status=status\n                ))\n\n        # [Edge]ã‚¿ã‚°ã§åˆ†å‰²ã—ã¦æŠ½å‡º\n        edge_matches = re.split(r'\\[Edge\\]', clean_text, flags=re.IGNORECASE)[1:]\n        for block in edge_matches:\n            data =",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import re",
            "lineNumber": 1
          },
          {
            "text": "from core.schemas import Node, Edge, Flowchart, NodeStatus",
            "lineNumber": 2
          },
          {
            "text": "from core.exceptions import TOONParseError",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "class TOONParser:",
            "lineNumber": 5,
            "isSignature": true
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 6
          },
          {
            "text": "    def parse(text: str) -&gt; Flowchart:",
            "lineNumber": 7
          },
          {
            "text": "        # Markdownã®è£…é£¾ï¼ˆ&#96;&#96;&#96;toon...&#96;&#96;&#96;ï¼‰ãŒã‚ã‚Œã°é™¤å»",
            "lineNumber": 8
          },
          {
            "text": "        clean_text = re.sub(r'&#96;&#96;&#96;[a-zA-Z]*\\n?', '', text)",
            "lineNumber": 9
          },
          {
            "text": "        clean_text = clean_text.replace('&#96;&#96;&#96;', '').strip()",
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "text": "        nodes = []",
            "lineNumber": 12
          },
          {
            "text": "        edges = []",
            "lineNumber": 13
          },
          {
            "lineNumber": 14
          },
          {
            "text": "        # [Node]ã‚¿ã‚°ã§åˆ†å‰²ã—ã¦æŠ½å‡º",
            "lineNumber": 15
          },
          {
            "text": "        node_matches = re.split(r'\\[Node\\]', clean_text, flags=re.IGNORECASE)[1:]",
            "lineNumber": 16
          },
          {
            "text": "        for block in node_matches:",
            "lineNumber": 17
          },
          {
            "text": "            # æ¬¡ã®ã‚¿ã‚°ã®æ‰‹å‰ã¾ã§ã‚’ãƒ‘ãƒ¼ã‚¹",
            "lineNumber": 18
          },
          {
            "text": "            data = TOONParser._parse_block(re.split(r'\\[', block)[0])",
            "lineNumber": 19
          },
          {
            "text": "            if 'id' in data and 'label' in data:",
            "lineNumber": 20
          },
          {
            "text": "                raw_id = data['id'].strip()",
            "lineNumber": 21
          },
          {
            "text": "                safe_id = \"node_end\" if raw_id.lower() == \"end\" else raw_id",
            "lineNumber": 22
          },
          {
            "text": "                ",
            "lineNumber": 23
          },
          {
            "text": "                # statusãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®èª­ã¿è¾¼ã¿",
            "lineNumber": 24
          },
          {
            "text": "                status = NodeStatus.ACTIVE  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤",
            "lineNumber": 25
          },
          {
            "text": "                if 'status' in data:",
            "lineNumber": 26
          },
          {
            "text": "                    try:",
            "lineNumber": 27
          },
          {
            "text": "                        status = NodeStatus(data['status'].strip().lower())",
            "lineNumber": 28
          },
          {
            "text": "                    except ValueError:",
            "lineNumber": 29
          },
          {
            "text": "                        # ç„¡åŠ¹ãªstatuså€¤ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨",
            "lineNumber": 30
          },
          {
            "text": "                        pass",
            "lineNumber": 31
          },
          {
            "text": "                ",
            "lineNumber": 32
          },
          {
            "text": "                nodes.append(Node(",
            "lineNumber": 33
          },
          {
            "text": "                    id=safe_id,",
            "lineNumber": 34
          },
          {
            "text": "                    label=data['label'].strip(),",
            "lineNumber": 35
          },
          {
            "text": "                    type=data.get('type', 'process').strip().lower(),",
            "lineNumber": 36
          },
          {
            "text": "                    status=status",
            "lineNumber": 37
          },
          {
            "text": "                ))",
            "lineNumber": 38
          },
          {
            "lineNumber": 39
          },
          {
            "text": "        # [Edge]ã‚¿ã‚°ã§åˆ†å‰²ã—ã¦æŠ½å‡º",
            "lineNumber": 40
          },
          {
            "text": "        edge_matches = re.split(r'\\[Edge\\]', clean_text, flags=re.IGNORECASE)[1:]",
            "lineNumber": 41
          },
          {
            "text": "        for block in edge_matches:",
            "lineNumber": 42
          },
          {
            "text": "            data =",
            "lineNumber": 43
          }
        ]
      },
      "score": 0.22365164756774902
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\tests\\test_schemas.py",
        "range": {
          "startPosition": {
            "line": 31
          },
          "endPosition": {
            "line": 170
          }
        },
        "contents": "class TestFlowchart:\n\n\n    def test_detect_logic_gaps_decision_no_outgoing(self):\n        nodes = [\n            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),\n            Node(id=\"decision1\", label=\"åˆ¤å®š\", type=\"decision\"),\n            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")\n        ]\n        edges = [\n            Edge(source=\"start\", target=\"decision1\")\n            # decision1ã‹ã‚‰å‡ºå£ãŒãªã„\n        ]\n        flowchart = Flowchart(nodes=nodes, edges=edges)\n        gaps = flowchart.detect_logic_gaps()\n        assert len(gaps) == 1\n        assert gaps[0].id == \"decision1\"\n\n    def test_detect_logic_gaps_missing_target(self):\n        nodes = [\n            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),\n            Node(id=\"process1\", label=\"å‡¦ç†\", type=\"process\"),\n            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")\n        ]\n        edges = [\n            Edge(source=\"start\", target=\"process1\"),\n            Edge(source=\"process1\", target=\"missing_node\")  # å­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰\n        ]\n        flowchart = Flowchart(nodes=nodes, edges=edges)\n        gaps = flowchart.detect_logic_gaps()\n        assert len(gaps) == 1\n        assert gaps[0].id == \"missing_missing_node\"\n        assert gaps[0].type == \"missing\"\n\n    def test_to_mermaid(self):\n        nodes = [\n            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),\n            Node(id=\"process1\", label=\"å‡¦ç†\", type=\"process\"),\n            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")\n        ]\n        edges = [\n            Edge(source=\"start\", target=\"process1\"),\n            Edge(source=\"process1\", target=\"node_end\")\n        ]\n        flowchart = Flowchart(nodes=nodes, edges=edges)\n        mermaid = flowchart.to_mermaid()\n        assert \"graph TD\" in mermaid\n        assert 'start[\"é–‹å§‹\"]' in mermaid\n        assert 'process1[\"å‡¦ç†\"]' in mermaid\n        assert 'start--&gt;process1' in mermaid\n\n    def test_to_toon_format(self):\n        nodes =",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 32,
                "column": 1
              },
              "endPosition": {
                "line": 33,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class TestFlowchart:",
            "lineNumber": 32,
            "isSignature": true
          },
          {
            "lineNumber": 110
          },
          {
            "lineNumber": 111
          },
          {
            "text": "    def test_detect_logic_gaps_decision_no_outgoing(self):",
            "lineNumber": 112
          },
          {
            "text": "        nodes = [",
            "lineNumber": 113
          },
          {
            "text": "            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),",
            "lineNumber": 114
          },
          {
            "text": "            Node(id=\"decision1\", label=\"åˆ¤å®š\", type=\"decision\"),",
            "lineNumber": 115
          },
          {
            "text": "            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")",
            "lineNumber": 116
          },
          {
            "text": "        ]",
            "lineNumber": 117
          },
          {
            "text": "        edges = [",
            "lineNumber": 118
          },
          {
            "text": "            Edge(source=\"start\", target=\"decision1\")",
            "lineNumber": 119
          },
          {
            "text": "            # decision1ã‹ã‚‰å‡ºå£ãŒãªã„",
            "lineNumber": 120
          },
          {
            "text": "        ]",
            "lineNumber": 121
          },
          {
            "text": "        flowchart = Flowchart(nodes=nodes, edges=edges)",
            "lineNumber": 122
          },
          {
            "text": "        gaps = flowchart.detect_logic_gaps()",
            "lineNumber": 123
          },
          {
            "text": "        assert len(gaps) == 1",
            "lineNumber": 124
          },
          {
            "text": "        assert gaps[0].id == \"decision1\"",
            "lineNumber": 125
          },
          {
            "lineNumber": 126
          },
          {
            "text": "    def test_detect_logic_gaps_missing_target(self):",
            "lineNumber": 127
          },
          {
            "text": "        nodes = [",
            "lineNumber": 128
          },
          {
            "text": "            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),",
            "lineNumber": 129
          },
          {
            "text": "            Node(id=\"process1\", label=\"å‡¦ç†\", type=\"process\"),",
            "lineNumber": 130
          },
          {
            "text": "            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")",
            "lineNumber": 131
          },
          {
            "text": "        ]",
            "lineNumber": 132
          },
          {
            "text": "        edges = [",
            "lineNumber": 133
          },
          {
            "text": "            Edge(source=\"start\", target=\"process1\"),",
            "lineNumber": 134
          },
          {
            "text": "            Edge(source=\"process1\", target=\"missing_node\")  # å­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰",
            "lineNumber": 135
          },
          {
            "text": "        ]",
            "lineNumber": 136
          },
          {
            "text": "        flowchart = Flowchart(nodes=nodes, edges=edges)",
            "lineNumber": 137
          },
          {
            "text": "        gaps = flowchart.detect_logic_gaps()",
            "lineNumber": 138
          },
          {
            "text": "        assert len(gaps) == 1",
            "lineNumber": 139
          },
          {
            "text": "        assert gaps[0].id == \"missing_missing_node\"",
            "lineNumber": 140
          },
          {
            "text": "        assert gaps[0].type == \"missing\"",
            "lineNumber": 141
          },
          {
            "lineNumber": 142
          },
          {
            "text": "    def test_to_mermaid(self):",
            "lineNumber": 143
          },
          {
            "text": "        nodes = [",
            "lineNumber": 144
          },
          {
            "text": "            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),",
            "lineNumber": 145
          },
          {
            "text": "            Node(id=\"process1\", label=\"å‡¦ç†\", type=\"process\"),",
            "lineNumber": 146
          },
          {
            "text": "            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")",
            "lineNumber": 147
          },
          {
            "text": "        ]",
            "lineNumber": 148
          },
          {
            "text": "        edges = [",
            "lineNumber": 149
          },
          {
            "text": "            Edge(source=\"start\", target=\"process1\"),",
            "lineNumber": 150
          },
          {
            "text": "            Edge(source=\"process1\", target=\"node_end\")",
            "lineNumber": 151
          },
          {
            "text": "        ]",
            "lineNumber": 152
          },
          {
            "text": "        flowchart = Flowchart(nodes=nodes, edges=edges)",
            "lineNumber": 153
          },
          {
            "text": "        mermaid = flowchart.to_mermaid()",
            "lineNumber": 154
          },
          {
            "text": "        assert \"graph TD\" in mermaid",
            "lineNumber": 155
          },
          {
            "text": "        assert 'start[\"é–‹å§‹\"]' in mermaid",
            "lineNumber": 156
          },
          {
            "text": "        assert 'process1[\"å‡¦ç†\"]' in mermaid",
            "lineNumber": 157
          },
          {
            "text": "        assert 'start--&gt;process1' in mermaid",
            "lineNumber": 158
          },
          {
            "lineNumber": 159
          },
          {
            "text": "    def test_to_toon_format(self):",
            "lineNumber": 160
          },
          {
            "text": "        nodes =",
            "lineNumber": 161
          }
        ]
      },
      "score": 0.21261674165725708
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\flow.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 47
          }
        },
        "contents": "&#96;&#96;&#96;mermaid\ngraph TD\n    start[\"é–‹å§‹\"]\n    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]\n    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]\n    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]\n    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}\n    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}\n    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]\n    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]\n    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]\n    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]\n    task10[\"æµå‹•ã«æˆ»ã™\"]\n    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}\n    node_end[\"çµ‚äº†\"]\n    \n    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼\n    start--&gt;task1\n    task1--&gt;task2\n    task2--&gt;decision1\n    \n    %% å†ç¾ã—ãªã„å ´åˆ\n    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10\n    task10--&gt;decision_recurrence\n    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1\n    \n    %% å†ç¾ã™ã‚‹å ´åˆ\n    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3\n    task3--&gt;decision2\n    \n    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²\n    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4\n    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8\n    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9\n    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other\n    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "&#96;&#96;&#96;mermaid",
            "lineNumber": 1
          },
          {
            "text": "graph TD",
            "lineNumber": 2
          },
          {
            "text": "    start[\"é–‹å§‹\"]",
            "lineNumber": 3
          },
          {
            "text": "    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]",
            "lineNumber": 4
          },
          {
            "text": "    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]",
            "lineNumber": 5
          },
          {
            "text": "    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 6
          },
          {
            "text": "    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]",
            "lineNumber": 7
          },
          {
            "text": "    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}",
            "lineNumber": 8
          },
          {
            "text": "    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 9
          },
          {
            "text": "    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}",
            "lineNumber": 10
          },
          {
            "text": "    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 11
          },
          {
            "text": "    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 12
          },
          {
            "text": "    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]",
            "lineNumber": 13
          },
          {
            "text": "    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]",
            "lineNumber": 14
          },
          {
            "text": "    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]",
            "lineNumber": 15
          },
          {
            "text": "    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]",
            "lineNumber": 16
          },
          {
            "text": "    task10[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 17
          },
          {
            "text": "    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}",
            "lineNumber": 18
          },
          {
            "text": "    node_end[\"çµ‚äº†\"]",
            "lineNumber": 19
          },
          {
            "text": "    ",
            "lineNumber": 20
          },
          {
            "text": "    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 21
          },
          {
            "text": "    start--&gt;task1",
            "lineNumber": 22
          },
          {
            "text": "    task1--&gt;task2",
            "lineNumber": 23
          },
          {
            "text": "    task2--&gt;decision1",
            "lineNumber": 24
          },
          {
            "text": "    ",
            "lineNumber": 25
          },
          {
            "text": "    %% å†ç¾ã—ãªã„å ´åˆ",
            "lineNumber": 26
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 27
          },
          {
            "text": "    task10--&gt;decision_recurrence",
            "lineNumber": 28
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end",
            "lineNumber": 29
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1",
            "lineNumber": 30
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2",
            "lineNumber": 31
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3",
            "lineNumber": 32
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4",
            "lineNumber": 33
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1",
            "lineNumber": 34
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1",
            "lineNumber": 35
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1",
            "lineNumber": 36
          },
          {
            "text": "    ",
            "lineNumber": 37
          },
          {
            "text": "    %% å†ç¾ã™ã‚‹å ´åˆ",
            "lineNumber": 38
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3",
            "lineNumber": 39
          },
          {
            "text": "    task3--&gt;decision2",
            "lineNumber": 40
          },
          {
            "text": "    ",
            "lineNumber": 41
          },
          {
            "text": "    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²",
            "lineNumber": 42
          },
          {
            "text": "    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4",
            "lineNumber": 43
          },
          {
            "text": "    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8",
            "lineNumber": 44
          },
          {
            "text": "    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9",
            "lineNumber": 45
          },
          {
            "text": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other",
            "lineNumber": 46
          },
          {
            "text": "    ",
            "lineNumber": 47
          }
        ]
      },
      "score": 0.20663370192050934
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\flow.md",
        "range": {
          "startPosition": {
            "line": 45
          },
          "endPosition": {
            "line": 87
          }
        },
        "contents": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other\n    \n    %% ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã¸ã®é€£çµ¡ï¼ˆå…¨ãƒ¢ãƒ¼ãƒ‰å…±é€šï¼‰\n    contact_manufacturer[\"ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã«é€£çµ¡\"]\n    \n    %% å†ç¾ã—ãªã‹ã£ãŸJARVISãŒ1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸå ´åˆã®ç¹°ã‚Šè¿”ã—å‡¦ç†ãƒ•ãƒ­ãƒ¼\n    subgraph flow5 [\"å†ç™ºæ™‚ã®æ®µéšçš„å¯¾å¿œãƒ•ãƒ­ãƒ¼\"]\n        check9_1[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check9_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check9_1_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task9_1[\"PGåŸºæ¿ã‚’äº¤æ›\"]\n        task9_2[\"æµå‹•ã«æˆ»ã™\"]\n        decision9_1{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}\n        check9_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check9_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check9_3_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task9_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›\"]\n        task9_4[\"æµå‹•ã«æˆ»ã™\"]\n        decision9_2{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}\n        check9_5[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check9_5{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check9_5_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task9_5[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›\"]\n        task9_6[\"æµå‹•ã«æˆ»ã™\"]\n        decision9_3{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}\n        check9_7[\"å†…éƒ¨ã®FFCã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check9_7{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check9_7_1{\"å†…éƒ¨ã®FFCã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task9_7[\"å†…éƒ¨ã®FFCã‚’äº¤æ›\"]\n        task9_8[\"æµå‹•ã«æˆ»ã™\"]\n        decision9_4{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}\n        task9_9[\"æ‹…å½“ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã«é€£çµ¡\"]\n        \n        task9--&gt;check9_1\n        check9_1--&gt;decision_check9_1\n        decision_check9_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_1_1\n        decision_check9_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_1\n        decision_check9_1_1--&gt;|\"æ­£å¸¸\"|task9_2\n        decision_check9_1_1--&gt;|\"ç•°å¸¸\"|task9_1\n        task9_1--&gt;task9_2\n        task9_2--&gt;decision9_1\n        decision9_1--&gt;|\"å‡ºã¦ããŸ\"|check9_3",
        "signatures": {},
        "detailedLines": [
          {
            "text": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other",
            "lineNumber": 46
          },
          {
            "text": "    ",
            "lineNumber": 47
          },
          {
            "text": "    %% ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã¸ã®é€£çµ¡ï¼ˆå…¨ãƒ¢ãƒ¼ãƒ‰å…±é€šï¼‰",
            "lineNumber": 48
          },
          {
            "text": "    contact_manufacturer[\"ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã«é€£çµ¡\"]",
            "lineNumber": 49
          },
          {
            "text": "    ",
            "lineNumber": 50
          },
          {
            "text": "    %% å†ç¾ã—ãªã‹ã£ãŸJARVISãŒ1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸå ´åˆã®ç¹°ã‚Šè¿”ã—å‡¦ç†ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 51
          },
          {
            "text": "    subgraph flow5 [\"å†ç™ºæ™‚ã®æ®µéšçš„å¯¾å¿œãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 52
          },
          {
            "text": "        check9_1[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 53
          },
          {
            "text": "        decision_check9_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 54
          },
          {
            "text": "        decision_check9_1_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 55
          },
          {
            "text": "        task9_1[\"PGåŸºæ¿ã‚’äº¤æ›\"]",
            "lineNumber": 56
          },
          {
            "text": "        task9_2[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 57
          },
          {
            "text": "        decision9_1{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}",
            "lineNumber": 58
          },
          {
            "text": "        check9_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 59
          },
          {
            "text": "        decision_check9_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 60
          },
          {
            "text": "        decision_check9_3_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 61
          },
          {
            "text": "        task9_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›\"]",
            "lineNumber": 62
          },
          {
            "text": "        task9_4[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 63
          },
          {
            "text": "        decision9_2{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}",
            "lineNumber": 64
          },
          {
            "text": "        check9_5[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 65
          },
          {
            "text": "        decision_check9_5{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 66
          },
          {
            "text": "        decision_check9_5_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 67
          },
          {
            "text": "        task9_5[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›\"]",
            "lineNumber": 68
          },
          {
            "text": "        task9_6[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 69
          },
          {
            "text": "        decision9_3{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}",
            "lineNumber": 70
          },
          {
            "text": "        check9_7[\"å†…éƒ¨ã®FFCã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 71
          },
          {
            "text": "        decision_check9_7{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 72
          },
          {
            "text": "        decision_check9_7_1{\"å†…éƒ¨ã®FFCã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 73
          },
          {
            "text": "        task9_7[\"å†…éƒ¨ã®FFCã‚’äº¤æ›\"]",
            "lineNumber": 74
          },
          {
            "text": "        task9_8[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 75
          },
          {
            "text": "        decision9_4{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}",
            "lineNumber": 76
          },
          {
            "text": "        task9_9[\"æ‹…å½“ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã«é€£çµ¡\"]",
            "lineNumber": 77
          },
          {
            "text": "        ",
            "lineNumber": 78
          },
          {
            "text": "        task9--&gt;check9_1",
            "lineNumber": 79
          },
          {
            "text": "        check9_1--&gt;decision_check9_1",
            "lineNumber": 80
          },
          {
            "text": "        decision_check9_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_1_1",
            "lineNumber": 81
          },
          {
            "text": "        decision_check9_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_1",
            "lineNumber": 82
          },
          {
            "text": "        decision_check9_1_1--&gt;|\"æ­£å¸¸\"|task9_2",
            "lineNumber": 83
          },
          {
            "text": "        decision_check9_1_1--&gt;|\"ç•°å¸¸\"|task9_1",
            "lineNumber": 84
          },
          {
            "text": "        task9_1--&gt;task9_2",
            "lineNumber": 85
          },
          {
            "text": "        task9_2--&gt;decision9_1",
            "lineNumber": 86
          },
          {
            "text": "        decision9_1--&gt;|\"å‡ºã¦ããŸ\"|check9_3",
            "lineNumber": 87
          }
        ]
      },
      "score": 0.205983504652977
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\storage\\toon_files\\flow_md.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 47
          }
        },
        "contents": "&#96;&#96;&#96;mermaid\ngraph TD\n    start[\"é–‹å§‹\"]\n    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]\n    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]\n    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]\n    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}\n    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}\n    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]\n    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]\n    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]\n    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]\n    task10[\"æµå‹•ã«æˆ»ã™\"]\n    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}\n    node_end[\"çµ‚äº†\"]\n    \n    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼\n    start--&gt;task1\n    task1--&gt;task2\n    task2--&gt;decision1\n    \n    %% å†ç¾ã—ãªã„å ´åˆ\n    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10\n    task10--&gt;decision_recurrence\n    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1\n    \n    %% å†ç¾ã™ã‚‹å ´åˆ\n    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3\n    task3--&gt;decision2\n    \n    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²\n    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4\n    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8\n    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9\n    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other\n    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "&#96;&#96;&#96;mermaid",
            "lineNumber": 1
          },
          {
            "text": "graph TD",
            "lineNumber": 2
          },
          {
            "text": "    start[\"é–‹å§‹\"]",
            "lineNumber": 3
          },
          {
            "text": "    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]",
            "lineNumber": 4
          },
          {
            "text": "    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]",
            "lineNumber": 5
          },
          {
            "text": "    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 6
          },
          {
            "text": "    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]",
            "lineNumber": 7
          },
          {
            "text": "    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}",
            "lineNumber": 8
          },
          {
            "text": "    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 9
          },
          {
            "text": "    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}",
            "lineNumber": 10
          },
          {
            "text": "    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 11
          },
          {
            "text": "    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 12
          },
          {
            "text": "    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]",
            "lineNumber": 13
          },
          {
            "text": "    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]",
            "lineNumber": 14
          },
          {
            "text": "    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]",
            "lineNumber": 15
          },
          {
            "text": "    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]",
            "lineNumber": 16
          },
          {
            "text": "    task10[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 17
          },
          {
            "text": "    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}",
            "lineNumber": 18
          },
          {
            "text": "    node_end[\"çµ‚äº†\"]",
            "lineNumber": 19
          },
          {
            "text": "    ",
            "lineNumber": 20
          },
          {
            "text": "    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 21
          },
          {
            "text": "    start--&gt;task1",
            "lineNumber": 22
          },
          {
            "text": "    task1--&gt;task2",
            "lineNumber": 23
          },
          {
            "text": "    task2--&gt;decision1",
            "lineNumber": 24
          },
          {
            "text": "    ",
            "lineNumber": 25
          },
          {
            "text": "    %% å†ç¾ã—ãªã„å ´åˆ",
            "lineNumber": 26
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 27
          },
          {
            "text": "    task10--&gt;decision_recurrence",
            "lineNumber": 28
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end",
            "lineNumber": 29
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1",
            "lineNumber": 30
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2",
            "lineNumber": 31
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3",
            "lineNumber": 32
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4",
            "lineNumber": 33
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1",
            "lineNumber": 34
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1",
            "lineNumber": 35
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1",
            "lineNumber": 36
          },
          {
            "text": "    ",
            "lineNumber": 37
          },
          {
            "text": "    %% å†ç¾ã™ã‚‹å ´åˆ",
            "lineNumber": 38
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3",
            "lineNumber": 39
          },
          {
            "text": "    task3--&gt;decision2",
            "lineNumber": 40
          },
          {
            "text": "    ",
            "lineNumber": 41
          },
          {
            "text": "    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²",
            "lineNumber": 42
          },
          {
            "text": "    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4",
            "lineNumber": 43
          },
          {
            "text": "    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8",
            "lineNumber": 44
          },
          {
            "text": "    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9",
            "lineNumber": 45
          },
          {
            "text": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other",
            "lineNumber": 46
          },
          {
            "text": "    ",
            "lineNumber": 47
          }
        ]
      },
      "score": 0.2027653008699417
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\program_base.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 43
          }
        },
        "contents": "1ãƒ•ã‚¡ã‚¤ãƒ«1è²¬ä»»ã®åŸå‰‡ï¼ˆSRPï¼‰ã«åŸºã¥ãã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç‹¬ç«‹ã•ã›ã‚‹ã“ã¨ã§ã€**ã€ŒAIã®æŒ™å‹•ã‚’å¤‰ãˆãŸã„ã¨ãã€**ã¨**ã€Œå›³ã®è¦‹ãŸç›®ï¼ˆMermaidï¼‰ã‚’å¤‰ãˆãŸã„ã¨ãã€**ã‚’å®Œå…¨ã«åˆ‡ã‚Šåˆ†ã‘ã¦ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã§ãã‚‹æ§‹é€ ã‚’ææ¡ˆã—ã¾ã™ã€‚\n\n---\n\n## 1. æ¨å¥¨ã•ã‚Œã‚‹ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ \n\næ‹¡å¼µæ€§ã¨è¦‹é€šã—ã®è‰¯ã•ã‚’é‡è¦–ã—ãŸæ§‹æˆã§ã™ã€‚\n\n&#96;&#96;&#96;text\ntoon-flow-visualizer/\nâ”œâ”€â”€ app.py                # ã€Entry Pointã€‘Streamlitã®ãƒ¡ã‚¤ãƒ³UIãƒ»çŠ¶æ…‹ç®¡ç†\nâ”œâ”€â”€ core/                 # ã€Logicã€‘å…±é€šåŸºç›¤ãƒ»ãƒ‡ãƒ¼ã‚¿å®šç¾©\nâ”‚   â””â”€â”€ models.py         # ãƒãƒ¼ãƒ‰ã‚„ã‚¨ãƒƒã‚¸ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€  (Pydanticç­‰)\nâ”œâ”€â”€ parser/               # ã€Responsibility: è§£æã€‘\nâ”‚   â””â”€â”€ toon_parser.py    # Markdown(TOON)ã‹ã‚‰å†…éƒ¨ãƒ¢ãƒ‡ãƒ«ã¸ã®å¤‰æ›\nâ”œâ”€â”€ generator/            # ã€Responsibility: æç”»ç”Ÿæˆã€‘\nâ”‚   â””â”€â”€ mermaid_gen.py    # å†…éƒ¨ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰Mermaidæ§‹æ–‡ã¸ã®å¤‰æ›\nâ”œâ”€â”€ llm/                  # ã€Responsibility: AIå¯¾è©±ã€‘\nâ”‚   â””â”€â”€ agent.py          # å¤§å‹LLMã¸ã®æŒ‡ç¤ºã€TOONå·®åˆ†å–å¾—\nâ”œâ”€â”€ schema/               # ã€Assetsã€‘\nâ”‚   â””â”€â”€ template.md       # LLMã«æ¸¡ã™TOONã®åŸºæœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ\nâ””â”€â”€ data/                 # ã€Storageã€‘\n    â””â”€â”€ sessions/         # ä¿å­˜ã•ã‚ŒãŸTOONãƒ•ã‚¡ã‚¤ãƒ«(.md)\n\n&#96;&#96;&#96;\n\n---\n\n## 2. å„ãƒ•ã‚¡ã‚¤ãƒ«ã®è²¬ä»»ç¯„å›²ï¼ˆè¦ä»¶å®šç¾©ï¼‰\n\n### â‘  &#96;core/models.py&#96;\n\n**è²¬ä»»ï¼šãƒ‡ãƒ¼ã‚¿ã®å‹å®šç¾©**\n\n* Pythonã® &#96;Dataclass&#96; ã‚„ &#96;Pydantic&#96; ã‚’ä½¿ã„ã€&#96;Node&#96; ã‚„ &#96;Edge&#96; ã®å±æ€§ï¼ˆID, Type, Label, Statusï¼‰ã‚’å³å¯†ã«å®šç¾©ã—ã¾ã™ã€‚\n* ã“ã“ã‚’å›ºå®šã™ã‚‹ã“ã¨ã§ã€ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«é–“ã§ã®ãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—ãƒŸã‚¹ã‚’é˜²ãã¾ã™ã€‚\n\n### â‘¡ &#96;parser/toon_parser.py&#96;\n\n**è²¬ä»»ï¼šTOONã®è§£é‡ˆï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰**\n\n* Markdownå½¢å¼ã®TOONã‚’æ­£è¦è¡¨ç¾ï¼ˆRegexï¼‰ãªã©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã€&#96;models.py&#96; ã§å®šç¾©ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚¹ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚\n* **ã€Œå·®åˆ†ï¼ˆLOGï¼‰ã€ã®åæ˜ ãƒ­ã‚¸ãƒƒã‚¯**ã‚‚ã“ã“ã«æŒã¡ã¾ã™ã€‚å¤ã„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«LOGã®å†…å®¹ã‚’ä¸Šæ›¸ãã—ã¦ã€æœ€æ–°ã®çŠ¶æ…‹ã‚’ä½œã‚‹è²¬ä»»è€…ã§ã™ã€‚",
        "signatures": {},
        "detailedLines": [
          {
            "text": "1ãƒ•ã‚¡ã‚¤ãƒ«1è²¬ä»»ã®åŸå‰‡ï¼ˆSRPï¼‰ã«åŸºã¥ãã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç‹¬ç«‹ã•ã›ã‚‹ã“ã¨ã§ã€**ã€ŒAIã®æŒ™å‹•ã‚’å¤‰ãˆãŸã„ã¨ãã€**ã¨**ã€Œå›³ã®è¦‹ãŸç›®ï¼ˆMermaidï¼‰ã‚’å¤‰ãˆãŸã„ã¨ãã€**ã‚’å®Œå…¨ã«åˆ‡ã‚Šåˆ†ã‘ã¦ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã§ãã‚‹æ§‹é€ ã‚’ææ¡ˆã—ã¾ã™ã€‚",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "---",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "## 1. æ¨å¥¨ã•ã‚Œã‚‹ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ ",
            "lineNumber": 5
          },
          {
            "lineNumber": 6
          },
          {
            "text": "æ‹¡å¼µæ€§ã¨è¦‹é€šã—ã®è‰¯ã•ã‚’é‡è¦–ã—ãŸæ§‹æˆã§ã™ã€‚",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "&#96;&#96;&#96;text",
            "lineNumber": 9
          },
          {
            "text": "toon-flow-visualizer/",
            "lineNumber": 10
          },
          {
            "text": "â”œâ”€â”€ app.py                # ã€Entry Pointã€‘Streamlitã®ãƒ¡ã‚¤ãƒ³UIãƒ»çŠ¶æ…‹ç®¡ç†",
            "lineNumber": 11
          },
          {
            "text": "â”œâ”€â”€ core/                 # ã€Logicã€‘å…±é€šåŸºç›¤ãƒ»ãƒ‡ãƒ¼ã‚¿å®šç¾©",
            "lineNumber": 12
          },
          {
            "text": "â”‚   â””â”€â”€ models.py         # ãƒãƒ¼ãƒ‰ã‚„ã‚¨ãƒƒã‚¸ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€  (Pydanticç­‰)",
            "lineNumber": 13
          },
          {
            "text": "â”œâ”€â”€ parser/               # ã€Responsibility: è§£æã€‘",
            "lineNumber": 14
          },
          {
            "text": "â”‚   â””â”€â”€ toon_parser.py    # Markdown(TOON)ã‹ã‚‰å†…éƒ¨ãƒ¢ãƒ‡ãƒ«ã¸ã®å¤‰æ›",
            "lineNumber": 15
          },
          {
            "text": "â”œâ”€â”€ generator/            # ã€Responsibility: æç”»ç”Ÿæˆã€‘",
            "lineNumber": 16
          },
          {
            "text": "â”‚   â””â”€â”€ mermaid_gen.py    # å†…éƒ¨ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰Mermaidæ§‹æ–‡ã¸ã®å¤‰æ›",
            "lineNumber": 17
          },
          {
            "text": "â”œâ”€â”€ llm/                  # ã€Responsibility: AIå¯¾è©±ã€‘",
            "lineNumber": 18
          },
          {
            "text": "â”‚   â””â”€â”€ agent.py          # å¤§å‹LLMã¸ã®æŒ‡ç¤ºã€TOONå·®åˆ†å–å¾—",
            "lineNumber": 19
          },
          {
            "text": "â”œâ”€â”€ schema/               # ã€Assetsã€‘",
            "lineNumber": 20
          },
          {
            "text": "â”‚   â””â”€â”€ template.md       # LLMã«æ¸¡ã™TOONã®åŸºæœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ",
            "lineNumber": 21
          },
          {
            "text": "â””â”€â”€ data/                 # ã€Storageã€‘",
            "lineNumber": 22
          },
          {
            "text": "    â””â”€â”€ sessions/         # ä¿å­˜ã•ã‚ŒãŸTOONãƒ•ã‚¡ã‚¤ãƒ«(.md)",
            "lineNumber": 23
          },
          {
            "lineNumber": 24
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "text": "---",
            "lineNumber": 27
          },
          {
            "lineNumber": 28
          },
          {
            "text": "## 2. å„ãƒ•ã‚¡ã‚¤ãƒ«ã®è²¬ä»»ç¯„å›²ï¼ˆè¦ä»¶å®šç¾©ï¼‰",
            "lineNumber": 29
          },
          {
            "lineNumber": 30
          },
          {
            "text": "### â‘  &#96;core/models.py&#96;",
            "lineNumber": 31
          },
          {
            "lineNumber": 32
          },
          {
            "text": "**è²¬ä»»ï¼šãƒ‡ãƒ¼ã‚¿ã®å‹å®šç¾©**",
            "lineNumber": 33
          },
          {
            "lineNumber": 34
          },
          {
            "text": "* Pythonã® &#96;Dataclass&#96; ã‚„ &#96;Pydantic&#96; ã‚’ä½¿ã„ã€&#96;Node&#96; ã‚„ &#96;Edge&#96; ã®å±æ€§ï¼ˆID, Type, Label, Statusï¼‰ã‚’å³å¯†ã«å®šç¾©ã—ã¾ã™ã€‚",
            "lineNumber": 35
          },
          {
            "text": "* ã“ã“ã‚’å›ºå®šã™ã‚‹ã“ã¨ã§ã€ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«é–“ã§ã®ãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—ãƒŸã‚¹ã‚’é˜²ãã¾ã™ã€‚",
            "lineNumber": 36
          },
          {
            "lineNumber": 37
          },
          {
            "text": "### â‘¡ &#96;parser/toon_parser.py&#96;",
            "lineNumber": 38
          },
          {
            "lineNumber": 39
          },
          {
            "text": "**è²¬ä»»ï¼šTOONã®è§£é‡ˆï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰**",
            "lineNumber": 40
          },
          {
            "lineNumber": 41
          },
          {
            "text": "* Markdownå½¢å¼ã®TOONã‚’æ­£è¦è¡¨ç¾ï¼ˆRegexï¼‰ãªã©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã€&#96;models.py&#96; ã§å®šç¾©ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚¹ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚",
            "lineNumber": 42
          },
          {
            "text": "* **ã€Œå·®åˆ†ï¼ˆLOGï¼‰ã€ã®åæ˜ ãƒ­ã‚¸ãƒƒã‚¯**ã‚‚ã“ã“ã«æŒã¡ã¾ã™ã€‚å¤ã„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«LOGã®å†…å®¹ã‚’ä¸Šæ›¸ãã—ã¦ã€æœ€æ–°ã®çŠ¶æ…‹ã‚’ä½œã‚‹è²¬ä»»è€…ã§ã™ã€‚",
            "lineNumber": 43
          }
        ]
      },
      "score": 0.19811183214187622
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ã®å®Ÿè£…æ–¹é‡ã‚’ç¢ºèªä¸­ã€‚ç¾çŠ¶ã®å®Ÿè£…ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚


---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "class Node|class Edge",
  "path": "core/schemas.py",
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "class Node|class Edge",
    "path": "core/schemas.py",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain": {
        "content": {
          "matches": [
            {
              "file": "core\\schemas.py",
              "matches": [
                {
                  "lineNumber": 8,
                  "content": "class NodeStatus(Enum):"
                },
                {
                  "lineNumber": 13,
                  "content": "class Node(BaseModel):"
                },
                {
                  "lineNumber": 19,
                  "content": "class Edge(BaseModel):"
                }
              ]
            }
          ],
          "totalLines": 3,
          "totalMatchedLines": 3
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/schemas.py</summary>

</details>
</tool-use>

---



---


æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ã®å®Ÿè£…æ–¹é‡ã«ã¤ã„ã¦ç¢ºèªã§ã™ã€‚ç¾çŠ¶ã€Mermaid.jsã§ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ãŒã€subgraphã®è‡ªå‹•ç”Ÿæˆã‚„æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ã¯æœªå®Ÿè£…ã§ã™ã€‚

å®Ÿè£…æ–¹é‡ã®é¸æŠè‚¢:


---

<tool-use data-tool-type="unknown" data-tool-name="ask_question">
<details>
<summary>Tool use: **ask_question**</summary>


Parameters:

```json
{
  "questions": [
    {
      "id": "collapse_approach",
      "prompt": "ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ã«ã¤ã„ã¦ã€ã©ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å¸Œæœ›ã—ã¾ã™ã‹ï¼Ÿ",
      "options": [
        {
          "id": "mermaid_subgraph",
          "label": "Mermaid.jsã®subgraphæ©Ÿèƒ½ã‚’æ´»ç”¨ã—ã€JavaScriptã§ã‚¯ãƒªãƒƒã‚¯ã—ã¦æŠ˜ã‚ŠãŸãŸã¿ï¼ˆå›³å†…ã§ç›´æ¥æ“ä½œï¼‰"
        },
        {
          "id": "streamlit_ui",
          "label": "Streamlitã®UIè¦ç´ ï¼ˆexpander/checkboxï¼‰ã§ã‚µãƒ–ãƒ•ãƒ­ãƒ¼ã‚’è¡¨ç¤º/éè¡¨ç¤ºï¼ˆå›³ã®å¤–ã§æ“ä½œï¼‰"
        },
        {
          "id": "hierarchical",
          "label": "éšå±¤çš„ãªè¡¨ç¤ºï¼ˆãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ã‚’è¡¨ç¤ºã—ã€ã‚µãƒ–ãƒ•ãƒ­ãƒ¼ã¯åˆ¥ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚„ãƒ¢ãƒ¼ãƒ€ãƒ«ã§å±•é–‹ï¼‰"
        },
        {
          "id": "hybrid",
          "label": "ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼ˆsubgraph + Streamlit UIã®ä¸¡æ–¹ï¼‰"
        }
      ]
    }
  ]
}
```
Additional data:

```json
{
  "status": "submitted"
}
```
Result:

```json
{
  "answers": [
    {
      "questionId": "collapse_approach",
      "freeformText": ""
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---

_**User**_

ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒã‚ãã«ãã„ãªã€‚ç°¡å˜ã«ä¾‹ã‚’å‡ºã—ã¦

---

_**Agent (model default, mode Agent)**_



---


æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ã®å‹•ä½œã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã€å…·ä½“ä¾‹ã§èª¬æ˜ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: flow.md</summary>

</details>
</tool-use>

---



---


æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ã®å‹•ä½œã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã€å…·ä½“ä¾‹ã§èª¬æ˜ã—ã¾ã™ã€‚

## ç¾åœ¨ã®çŠ¶æ…‹ï¼ˆæŠ˜ã‚ŠãŸãŸã¿ãªã—ï¼‰

ç¾åœ¨ã®`flow.md`ã§ã¯ã€ã™ã¹ã¦ã®subgraphãŒå¸¸ã«å±•é–‹ã•ã‚Œã¦ã„ã¾ã™ï¼š

```
é–‹å§‹ â†’ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«äº¤æ› â†’ ç—‡çŠ¶ç¢ºèª â†’ ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š
                                    â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â†“               â†“               â†“
            [è¡¨ç¤ºãŒãŠã‹ã—ã„]  [ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„]  [ãã®ä»–]
                    â†“
         [ä¸¡å´/ç‰‡å´/æ”¹å–„ã•ã‚Œãªã„]
                    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ä¸¡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ (subgraph)  â”‚ â† å¸¸ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹
    â”‚ - PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯                  â”‚
    â”‚ - ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯    â”‚
    â”‚ - ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯â”‚
    â”‚ ... (è©³ç´°ãŒå…¨éƒ¨è¦‹ãˆã‚‹)             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ã‚ã‚Šã®å ´åˆ

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ1: Mermaid.jsã®subgraphã‚’ã‚¯ãƒªãƒƒã‚¯ã§æŠ˜ã‚ŠãŸãŸã¿

```
é–‹å§‹ â†’ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«äº¤æ› â†’ ç—‡çŠ¶ç¢ºèª â†’ ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š
                                    â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â†“               â†“               â†“
            [è¡¨ç¤ºãŒãŠã‹ã—ã„]  [ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„]  [ãã®ä»–]
                    â†“
         [ä¸¡å´/ç‰‡å´/æ”¹å–„ã•ã‚Œãªã„]
                    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ â–¶ ä¸¡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼          â”‚ â† ã‚¯ãƒªãƒƒã‚¯ã§æŠ˜ã‚ŠãŸãŸã¿
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    [ã‚¯ãƒªãƒƒã‚¯å¾Œ]
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ â–¼ ä¸¡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼          â”‚ â† å±•é–‹æ¸ˆã¿
    â”‚ - PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯                  â”‚
    â”‚ - ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯    â”‚
    â”‚ ...                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ2: Streamlitã®UIã§åˆ¶å¾¡

ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®ä¸Šã«ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’é…ç½®ï¼š

```
[Streamlit UI]
â˜‘ ä¸¡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ã‚’è¡¨ç¤º
â˜‘ ç‰‡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ã‚’è¡¨ç¤º
â˜ ãƒ‡ãƒ¼ã‚¿ç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ã‚’è¡¨ç¤º  â† ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã™ã¨éè¡¨ç¤º

[ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤º]
é–‹å§‹ â†’ ... â†’ ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š
                    â†“
            [è¡¨ç¤ºãŒãŠã‹ã—ã„]
                    â†“
    [ä¸¡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼] â† ãƒã‚§ãƒƒã‚¯ãŒONãªã®ã§è¡¨ç¤º
    [ç‰‡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼] â† ãƒã‚§ãƒƒã‚¯ãŒONãªã®ã§è¡¨ç¤º
    [ãƒ‡ãƒ¼ã‚¿ç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼]   â† ãƒã‚§ãƒƒã‚¯ãŒOFFãªã®ã§éè¡¨ç¤º
```

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ3: éšå±¤çš„ãªè¡¨ç¤º

ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ã¯å¸¸ã«è¡¨ç¤ºã—ã€è©³ç´°ã¯åˆ¥ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§å±•é–‹ï¼š

```
[ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼]
é–‹å§‹ â†’ ... â†’ ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š
                    â†“
            [è¡¨ç¤ºãŒãŠã‹ã—ã„]
                    â†“
    [ä¸¡å´è¡¨ç¤ºç•°å¸¸] [è©³ç´°ã‚’è¦‹ã‚‹] â† ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
    [ç‰‡å´è¡¨ç¤ºç•°å¸¸] [è©³ç´°ã‚’è¦‹ã‚‹]
    
[ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸¡å´è¡¨ç¤ºç•°å¸¸ã®è©³ç´°ãƒ•ãƒ­ãƒ¼     â”‚ â† ãƒ¢ãƒ¼ãƒ€ãƒ«ã¾ãŸã¯åˆ¥ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦
â”‚ - PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯          â”‚
â”‚ - ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿...    â”‚
â”‚ [é–‰ã˜ã‚‹]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ã©ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒå¸Œæœ›ã«è¿‘ã„ã§ã™ã‹ï¼Ÿãã‚Œã¨ã‚‚åˆ¥ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒã‚ã‚Œã°æ•™ãˆã¦ãã ã•ã„ã€‚

---

_**User**_

1ã®ã‚¤ãƒ¡ãƒ¼ã‚¸

---

_**Agent (model default, mode Agent)**_



---


ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ1ï¼ˆMermaid.jsã®subgraphã‚’ã‚¯ãƒªãƒƒã‚¯ã§æŠ˜ã‚ŠãŸãŸã¿ï¼‰ã§å®Ÿè£…è¨ˆç”»ã‚’ä½œæˆã—ã¾ã™ã€‚ç¾çŠ¶ã‚’ç¢ºèªä¸­ã§ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/schemas.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: flow.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "How are subgraphs currently parsed or handled in TOON format?",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\mermaid_parser.py",
        "range": {
          "startPosition": {
            "line": 5
          },
          "endPosition": {
            "line": 178
          }
        },
        "contents": "class MermaidParser:\n@staticmethod\ndef parse(mermaid_text: str) -&gt; Flowchart:\n\n        for line in lines:\n            # ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—\n            if line.startswith('%%'):\n                continue\n            \n            # styleè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆå¾Œã§å‡¦ç†ï¼‰\n            if line.startswith('style '):\n                continue\n            \n            # subgraphã®é–‹å§‹/çµ‚äº†ã‚’æ¤œå‡º\n            if line.startswith('subgraph '):\n                in_subgraph = True\n                continue\n            if line.strip() == 'end':\n                in_subgraph = False\n                continue\n            \n            # ãƒãƒ¼ãƒ‰å®šç¾©: id[\"label\"] ã¾ãŸã¯ id{\"label\"} ã¾ãŸã¯ id[(\"label\")]\n            # ã‚ˆã‚ŠæŸ”è»Ÿãªãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°\n            node_patterns = [\n                r'(\\w+)\\[\\([\"\\']([^\"\\']+)[\"\\']\\)\\]',  # id[(\"label\")]\n                r'(\\w+)\\[/[\"\\']([^\"\\']+)[\"\\']/\\]',     # id[/\"label\"/]\n                r'(\\w+)\\[[\"\\']([^\"\\']+)[\"\\']\\]',       # id[\"label\"]\n                r'(\\w+)\\{[\"\\']([^\"\\']+)[\"\\']\\}',       # id{\"label\"}\n                r'(\\w+)\\[\\(([^)]+)\\)\\]',                # id[(label)]\n                r'(\\w+)\\[([^\\]]+)\\]',                   # id[label]\n                r'(\\w+)\\{([^}]+)\\}',                    # id{label}\n            ]\n            \n            node_found = False\n            for pattern in node_patterns:\n                node_match = re.match(pattern, line)",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 6,
                "column": 1
              },
              "endPosition": {
                "line": 7,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 9,
                "column": 5
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 10,
                "column": 5
              },
              "endPosition": {
                "line": 11,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class MermaidParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 9
          },
          {
            "text": "def parse(mermaid_text: str) -&gt; Flowchart:",
            "lineNumber": 10
          },
          {
            "lineNumber": 31
          },
          {
            "text": "        for line in lines:",
            "lineNumber": 32
          },
          {
            "text": "            # ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—",
            "lineNumber": 33
          },
          {
            "text": "            if line.startswith('%%'):",
            "lineNumber": 34
          },
          {
            "text": "                continue",
            "lineNumber": 35
          },
          {
            "text": "            ",
            "lineNumber": 36
          },
          {
            "text": "            # styleè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆå¾Œã§å‡¦ç†ï¼‰",
            "lineNumber": 37
          },
          {
            "text": "            if line.startswith('style '):",
            "lineNumber": 38
          },
          {
            "text": "                continue",
            "lineNumber": 39
          },
          {
            "text": "            ",
            "lineNumber": 40
          },
          {
            "text": "            # subgraphã®é–‹å§‹/çµ‚äº†ã‚’æ¤œå‡º",
            "lineNumber": 41
          },
          {
            "text": "            if line.startswith('subgraph '):",
            "lineNumber": 42
          },
          {
            "text": "                in_subgraph = True",
            "lineNumber": 43
          },
          {
            "text": "                continue",
            "lineNumber": 44
          },
          {
            "text": "            if line.strip() == 'end':",
            "lineNumber": 45
          },
          {
            "text": "                in_subgraph = False",
            "lineNumber": 46
          },
          {
            "text": "                continue",
            "lineNumber": 47
          },
          {
            "text": "            ",
            "lineNumber": 48
          },
          {
            "text": "            # ãƒãƒ¼ãƒ‰å®šç¾©: id[\"label\"] ã¾ãŸã¯ id{\"label\"} ã¾ãŸã¯ id[(\"label\")]",
            "lineNumber": 49
          },
          {
            "text": "            # ã‚ˆã‚ŠæŸ”è»Ÿãªãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°",
            "lineNumber": 50
          },
          {
            "text": "            node_patterns = [",
            "lineNumber": 51
          },
          {
            "text": "                r'(\\w+)\\[\\([\"\\']([^\"\\']+)[\"\\']\\)\\]',  # id[(\"label\")]",
            "lineNumber": 52
          },
          {
            "text": "                r'(\\w+)\\[/[\"\\']([^\"\\']+)[\"\\']/\\]',     # id[/\"label\"/]",
            "lineNumber": 53
          },
          {
            "text": "                r'(\\w+)\\[[\"\\']([^\"\\']+)[\"\\']\\]',       # id[\"label\"]",
            "lineNumber": 54
          },
          {
            "text": "                r'(\\w+)\\{[\"\\']([^\"\\']+)[\"\\']\\}',       # id{\"label\"}",
            "lineNumber": 55
          },
          {
            "text": "                r'(\\w+)\\[\\(([^)]+)\\)\\]',                # id[(label)]",
            "lineNumber": 56
          },
          {
            "text": "                r'(\\w+)\\[([^\\]]+)\\]',                   # id[label]",
            "lineNumber": 57
          },
          {
            "text": "                r'(\\w+)\\{([^}]+)\\}',                    # id{label}",
            "lineNumber": 58
          },
          {
            "text": "            ]",
            "lineNumber": 59
          },
          {
            "text": "            ",
            "lineNumber": 60
          },
          {
            "text": "            node_found = False",
            "lineNumber": 61
          },
          {
            "text": "            for pattern in node_patterns:",
            "lineNumber": 62
          },
          {
            "text": "                node_match = re.match(pattern, line)",
            "lineNumber": 63
          }
        ]
      },
      "score": 0.4193125069141388
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\toon_parser.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 61
          }
        },
        "contents": "import re\nfrom core.schemas import Node, Edge, Flowchart, NodeStatus\nfrom core.exceptions import TOONParseError\n\nclass TOONParser:\n    @staticmethod\n    def parse(text: str) -&gt; Flowchart:\n        # Markdownã®è£…é£¾ï¼ˆ&#96;&#96;&#96;toon...&#96;&#96;&#96;ï¼‰ãŒã‚ã‚Œã°é™¤å»\n        clean_text = re.sub(r'&#96;&#96;&#96;[a-zA-Z]*\\n?', '', text)\n        clean_text = clean_text.replace('&#96;&#96;&#96;', '').strip()\n\n        nodes = []\n        edges = []\n\n        # [Node]ã‚¿ã‚°ã§åˆ†å‰²ã—ã¦æŠ½å‡º\n        node_matches = re.split(r'\\[Node\\]', clean_text, flags=re.IGNORECASE)[1:]\n        for block in node_matches:\n            # æ¬¡ã®ã‚¿ã‚°ã®æ‰‹å‰ã¾ã§ã‚’ãƒ‘ãƒ¼ã‚¹\n            data = TOONParser._parse_block(re.split(r'\\[', block)[0])\n            if 'id' in data and 'label' in data:\n                raw_id = data['id'].strip()\n                safe_id = \"node_end\" if raw_id.lower() == \"end\" else raw_id\n                \n                # statusãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®èª­ã¿è¾¼ã¿\n                status = NodeStatus.ACTIVE  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤\n                if 'status' in data:\n                    try:\n                        status = NodeStatus(data['status'].strip().lower())\n                    except ValueError:\n                        # ç„¡åŠ¹ãªstatuså€¤ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨\n                        pass\n                \n                nodes.append(Node(\n                    id=safe_id,\n                    label=data['label'].strip(),\n                    type=data.get('type', 'process').strip().lower(),\n                    status=status\n                ))\n\n        # [Edge]ã‚¿ã‚°ã§åˆ†å‰²ã—ã¦æŠ½å‡º\n        edge_matches = re.split(r'\\[Edge\\]', clean_text, flags=re.IGNORECASE)[1:]\n        for block in edge_matches:\n            data =",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import re",
            "lineNumber": 1
          },
          {
            "text": "from core.schemas import Node, Edge, Flowchart, NodeStatus",
            "lineNumber": 2
          },
          {
            "text": "from core.exceptions import TOONParseError",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "class TOONParser:",
            "lineNumber": 5,
            "isSignature": true
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 6
          },
          {
            "text": "    def parse(text: str) -&gt; Flowchart:",
            "lineNumber": 7
          },
          {
            "text": "        # Markdownã®è£…é£¾ï¼ˆ&#96;&#96;&#96;toon...&#96;&#96;&#96;ï¼‰ãŒã‚ã‚Œã°é™¤å»",
            "lineNumber": 8
          },
          {
            "text": "        clean_text = re.sub(r'&#96;&#96;&#96;[a-zA-Z]*\\n?', '', text)",
            "lineNumber": 9
          },
          {
            "text": "        clean_text = clean_text.replace('&#96;&#96;&#96;', '').strip()",
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "text": "        nodes = []",
            "lineNumber": 12
          },
          {
            "text": "        edges = []",
            "lineNumber": 13
          },
          {
            "lineNumber": 14
          },
          {
            "text": "        # [Node]ã‚¿ã‚°ã§åˆ†å‰²ã—ã¦æŠ½å‡º",
            "lineNumber": 15
          },
          {
            "text": "        node_matches = re.split(r'\\[Node\\]', clean_text, flags=re.IGNORECASE)[1:]",
            "lineNumber": 16
          },
          {
            "text": "        for block in node_matches:",
            "lineNumber": 17
          },
          {
            "text": "            # æ¬¡ã®ã‚¿ã‚°ã®æ‰‹å‰ã¾ã§ã‚’ãƒ‘ãƒ¼ã‚¹",
            "lineNumber": 18
          },
          {
            "text": "            data = TOONParser._parse_block(re.split(r'\\[', block)[0])",
            "lineNumber": 19
          },
          {
            "text": "            if 'id' in data and 'label' in data:",
            "lineNumber": 20
          },
          {
            "text": "                raw_id = data['id'].strip()",
            "lineNumber": 21
          },
          {
            "text": "                safe_id = \"node_end\" if raw_id.lower() == \"end\" else raw_id",
            "lineNumber": 22
          },
          {
            "text": "                ",
            "lineNumber": 23
          },
          {
            "text": "                # statusãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®èª­ã¿è¾¼ã¿",
            "lineNumber": 24
          },
          {
            "text": "                status = NodeStatus.ACTIVE  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤",
            "lineNumber": 25
          },
          {
            "text": "                if 'status' in data:",
            "lineNumber": 26
          },
          {
            "text": "                    try:",
            "lineNumber": 27
          },
          {
            "text": "                        status = NodeStatus(data['status'].strip().lower())",
            "lineNumber": 28
          },
          {
            "text": "                    except ValueError:",
            "lineNumber": 29
          },
          {
            "text": "                        # ç„¡åŠ¹ãªstatuså€¤ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨",
            "lineNumber": 30
          },
          {
            "text": "                        pass",
            "lineNumber": 31
          },
          {
            "text": "                ",
            "lineNumber": 32
          },
          {
            "text": "                nodes.append(Node(",
            "lineNumber": 33
          },
          {
            "text": "                    id=safe_id,",
            "lineNumber": 34
          },
          {
            "text": "                    label=data['label'].strip(),",
            "lineNumber": 35
          },
          {
            "text": "                    type=data.get('type', 'process').strip().lower(),",
            "lineNumber": 36
          },
          {
            "text": "                    status=status",
            "lineNumber": 37
          },
          {
            "text": "                ))",
            "lineNumber": 38
          },
          {
            "lineNumber": 39
          },
          {
            "text": "        # [Edge]ã‚¿ã‚°ã§åˆ†å‰²ã—ã¦æŠ½å‡º",
            "lineNumber": 40
          },
          {
            "text": "        edge_matches = re.split(r'\\[Edge\\]', clean_text, flags=re.IGNORECASE)[1:]",
            "lineNumber": 41
          },
          {
            "text": "        for block in edge_matches:",
            "lineNumber": 42
          },
          {
            "text": "            data =",
            "lineNumber": 43
          }
        ]
      },
      "score": 0.4160262942314148
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\toon_parser.py",
        "range": {
          "startPosition": {
            "line": 4
          },
          "endPosition": {
            "line": 61,
            "column": 19
          }
        },
        "contents": "class TOONParser:\n@staticmethod\ndef parse(text: str) -&gt; Flowchart:\n        # Markdownã®è£…é£¾ï¼ˆ&#96;&#96;&#96;toon...&#96;&#96;&#96;ï¼‰ãŒã‚ã‚Œã°é™¤å»\n\n        for block in edge_matches:\n            data = TOONParser._parse_block(re.split(r'\\[', block)[0])\n            if 'source' in data and 'target' in data:\n                src = \"node_end\" if data['source'].strip().lower() == \"end\" else data['source'].strip()\n                tgt = \"node_end\" if data['target'].strip().lower() == \"end\" else data['target'].strip()\n                edges.append(Edge(source=src, target=tgt, label=data.get('label', '').strip() or None))\n\n        # æœ€çµ‚ãƒã‚§ãƒƒã‚¯ï¼šãƒãƒ¼ãƒ‰ãŒç©ºãªã‚‰ã“ã“ã§ä¾‹å¤–ã‚’æŠ•ã’ã¦ app.py ã§ã‚­ãƒ£ãƒƒãƒ\n        if not nodes:\n            raise TOONParseError(f\"æœ‰åŠ¹ãªTOONå½¢å¼ã®ãƒãƒ¼ãƒ‰ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚å†…å®¹ï¼š\\n{text[:100]}...\")\n\n        return Flowchart(nodes=nodes, edges=edges)\n\n    @staticmethod\n    def _parse_block(block: str) -&gt; dict:\n        data = {}\n        for line in block.strip().split('\\n'):\n            if ':' in line:\n                key, val = line.split(':', 1)\n                data[key.strip().lower()] = val.strip()\n        return data",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 5,
                "column": 1
              },
              "endPosition": {
                "line": 6,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 6,
                "column": 5
              },
              "endPosition": {
                "line": 7,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 7,
                "column": 5
              },
              "endPosition": {
                "line": 9,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class TOONParser:",
            "lineNumber": 5,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 6
          },
          {
            "text": "def parse(text: str) -&gt; Flowchart:",
            "lineNumber": 7
          },
          {
            "text": "        # Markdownã®è£…é£¾ï¼ˆ&#96;&#96;&#96;toon...&#96;&#96;&#96;ï¼‰ãŒã‚ã‚Œã°é™¤å»",
            "lineNumber": 8
          },
          {
            "lineNumber": 41
          },
          {
            "text": "        for block in edge_matches:",
            "lineNumber": 42
          },
          {
            "text": "            data = TOONParser._parse_block(re.split(r'\\[', block)[0])",
            "lineNumber": 43
          },
          {
            "text": "            if 'source' in data and 'target' in data:",
            "lineNumber": 44
          },
          {
            "text": "                src = \"node_end\" if data['source'].strip().lower() == \"end\" else data['source'].strip()",
            "lineNumber": 45
          },
          {
            "text": "                tgt = \"node_end\" if data['target'].strip().lower() == \"end\" else data['target'].strip()",
            "lineNumber": 46
          },
          {
            "text": "                edges.append(Edge(source=src, target=tgt, label=data.get('label', '').strip() or None))",
            "lineNumber": 47
          },
          {
            "lineNumber": 48
          },
          {
            "text": "        # æœ€çµ‚ãƒã‚§ãƒƒã‚¯ï¼šãƒãƒ¼ãƒ‰ãŒç©ºãªã‚‰ã“ã“ã§ä¾‹å¤–ã‚’æŠ•ã’ã¦ app.py ã§ã‚­ãƒ£ãƒƒãƒ",
            "lineNumber": 49
          },
          {
            "text": "        if not nodes:",
            "lineNumber": 50
          },
          {
            "text": "            raise TOONParseError(f\"æœ‰åŠ¹ãªTOONå½¢å¼ã®ãƒãƒ¼ãƒ‰ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚å†…å®¹ï¼š\\n{text[:100]}...\")",
            "lineNumber": 51
          },
          {
            "lineNumber": 52
          },
          {
            "text": "        return Flowchart(nodes=nodes, edges=edges)",
            "lineNumber": 53
          },
          {
            "lineNumber": 54
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 55
          },
          {
            "text": "    def _parse_block(block: str) -&gt; dict:",
            "lineNumber": 56
          },
          {
            "text": "        data = {}",
            "lineNumber": 57
          },
          {
            "text": "        for line in block.strip().split('\\n'):",
            "lineNumber": 58
          },
          {
            "text": "            if ':' in line:",
            "lineNumber": 59
          },
          {
            "text": "                key, val = line.split(':', 1)",
            "lineNumber": 60
          },
          {
            "text": "                data[key.strip().lower()] = val.strip()",
            "lineNumber": 61
          },
          {
            "text": "        return data",
            "lineNumber": 62,
            "isSignature": true
          }
        ]
      },
      "score": 0.38602960109710693
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\mermaid_parser.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 178
          }
        },
        "contents": "import re\nfrom typing import List, Dict, Tuple\nfrom core.schemas import Node, Edge, Flowchart, NodeStatus\nfrom core.exceptions import TOONParseError\n\nclass MermaidParser:\n    \"\"\"Mermaidå½¢å¼ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹ãƒ‘ãƒ¼ã‚µãƒ¼\"\"\"\n    \n    @staticmethod\n    def parse(mermaid_text: str) -&gt; Flowchart:\n        \"\"\"\n        Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚\n        \n        Args:\n            mermaid_text: Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆ\n            \n        Returns:\n            Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ\n        \"\"\"\n        # Markdownã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’é™¤å»\n        clean_text = re.sub(r'&#96;&#96;&#96;mermaid\\s*\\n?', '', mermaid_text)\n        clean_text = clean_text.replace('&#96;&#96;&#96;', '').strip()\n        \n        lines = [line.strip() for line in clean_text.split('\\n') if line.strip()]\n        \n        nodes = []\n        edges = []\n        node_map = {}  # ID -&gt; Node ã®ãƒãƒƒãƒ”ãƒ³ã‚°\n        \n        # ãƒãƒ¼ãƒ‰å®šç¾©ã¨ã‚¨ãƒƒã‚¸å®šç¾©ã‚’æŠ½å‡º\n        in_subgraph = False\n        for line in lines:\n            # ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—\n            if line.startswith('%%'):\n                continue",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import re",
            "lineNumber": 1
          },
          {
            "text": "from typing import List, Dict, Tuple",
            "lineNumber": 2
          },
          {
            "text": "from core.schemas import Node, Edge, Flowchart, NodeStatus",
            "lineNumber": 3
          },
          {
            "text": "from core.exceptions import TOONParseError",
            "lineNumber": 4
          },
          {
            "lineNumber": 5
          },
          {
            "text": "class MermaidParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "    \"\"\"Mermaidå½¢å¼ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹ãƒ‘ãƒ¼ã‚µãƒ¼\"\"\"",
            "lineNumber": 7
          },
          {
            "text": "    ",
            "lineNumber": 8
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 9
          },
          {
            "text": "    def parse(mermaid_text: str) -&gt; Flowchart:",
            "lineNumber": 10
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 11
          },
          {
            "text": "        Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚",
            "lineNumber": 12
          },
          {
            "text": "        ",
            "lineNumber": 13
          },
          {
            "text": "        Args:",
            "lineNumber": 14
          },
          {
            "text": "            mermaid_text: Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆ",
            "lineNumber": 15
          },
          {
            "text": "            ",
            "lineNumber": 16
          },
          {
            "text": "        Returns:",
            "lineNumber": 17
          },
          {
            "text": "            Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ",
            "lineNumber": 18
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 19
          },
          {
            "text": "        # Markdownã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’é™¤å»",
            "lineNumber": 20
          },
          {
            "text": "        clean_text = re.sub(r'&#96;&#96;&#96;mermaid\\s*\\n?', '', mermaid_text)",
            "lineNumber": 21
          },
          {
            "text": "        clean_text = clean_text.replace('&#96;&#96;&#96;', '').strip()",
            "lineNumber": 22
          },
          {
            "text": "        ",
            "lineNumber": 23
          },
          {
            "text": "        lines = [line.strip() for line in clean_text.split('\\n') if line.strip()]",
            "lineNumber": 24
          },
          {
            "text": "        ",
            "lineNumber": 25
          },
          {
            "text": "        nodes = []",
            "lineNumber": 26
          },
          {
            "text": "        edges = []",
            "lineNumber": 27
          },
          {
            "text": "        node_map = {}  # ID -&gt; Node ã®ãƒãƒƒãƒ”ãƒ³ã‚°",
            "lineNumber": 28
          },
          {
            "text": "        ",
            "lineNumber": 29
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰å®šç¾©ã¨ã‚¨ãƒƒã‚¸å®šç¾©ã‚’æŠ½å‡º",
            "lineNumber": 30
          },
          {
            "text": "        in_subgraph = False",
            "lineNumber": 31
          },
          {
            "text": "        for line in lines:",
            "lineNumber": 32
          },
          {
            "text": "            # ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—",
            "lineNumber": 33
          },
          {
            "text": "            if line.startswith('%%'):",
            "lineNumber": 34
          },
          {
            "text": "                continue",
            "lineNumber": 35
          }
        ]
      },
      "score": 0.37357690930366516
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 223,
            "column": 42
          },
          "endPosition": {
            "line": 253,
            "column": 75
          }
        },
        "contents": "                            else:\n                                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼\n                                is_valid, validation_message = client.validate_output_size(raw_toon_text)\n                                if not is_valid:\n                                    st.warning(validation_message)\n                                    st.info(\"ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã‹ã€ãƒ•ãƒ­ãƒ¼ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\")\n                                \n                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹æˆåŠŸæ™‚ã®ã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ\n                                st.session_state.conversation_context = None\n                                st.session_state.pending_questions = None\n                                st.session_state.question_responses = []\n                                \n                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹\n                                new_flow = TOONParser.parse(raw_toon_text)\n                                \n                                # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨\n                                new_flow = new_flow.apply_logic_gap_detection()\n                                \n                                # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ\n                                if append_mode_flag:\n                                    merged_flow = history_mgr.append_toon_log(session_name, new_flow)\n                                    st.session_state.history.append(merged_flow)\n                                    st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")\n                                else:\n                                    # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ \n                                    st.session_state.history.append(new_flow)\n                            \n                            st.rerun()\n                        except LLMAPIError as e:\n                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                            else:",
            "lineNumber": 225
          },
          {
            "text": "                                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼",
            "lineNumber": 226
          },
          {
            "text": "                                is_valid, validation_message = client.validate_output_size(raw_toon_text)",
            "lineNumber": 227
          },
          {
            "text": "                                if not is_valid:",
            "lineNumber": 228
          },
          {
            "text": "                                    st.warning(validation_message)",
            "lineNumber": 229
          },
          {
            "text": "                                    st.info(\"ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã‹ã€ãƒ•ãƒ­ãƒ¼ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 230
          },
          {
            "text": "                                ",
            "lineNumber": 231
          },
          {
            "text": "                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹æˆåŠŸæ™‚ã®ã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ",
            "lineNumber": 232
          },
          {
            "text": "                                st.session_state.conversation_context = None",
            "lineNumber": 233
          },
          {
            "text": "                                st.session_state.pending_questions = None",
            "lineNumber": 234
          },
          {
            "text": "                                st.session_state.question_responses = []",
            "lineNumber": 235
          },
          {
            "text": "                                ",
            "lineNumber": 236
          },
          {
            "text": "                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹",
            "lineNumber": 237
          },
          {
            "text": "                                new_flow = TOONParser.parse(raw_toon_text)",
            "lineNumber": 238
          },
          {
            "text": "                                ",
            "lineNumber": 239
          },
          {
            "text": "                                # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨",
            "lineNumber": 240
          },
          {
            "text": "                                new_flow = new_flow.apply_logic_gap_detection()",
            "lineNumber": 241
          },
          {
            "text": "                                ",
            "lineNumber": 242
          },
          {
            "text": "                                # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ",
            "lineNumber": 243
          },
          {
            "text": "                                if append_mode_flag:",
            "lineNumber": 244
          },
          {
            "text": "                                    merged_flow = history_mgr.append_toon_log(session_name, new_flow)",
            "lineNumber": 245
          },
          {
            "text": "                                    st.session_state.history.append(merged_flow)",
            "lineNumber": 246
          },
          {
            "text": "                                    st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")",
            "lineNumber": 247
          },
          {
            "text": "                                else:",
            "lineNumber": 248
          },
          {
            "text": "                                    # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ ",
            "lineNumber": 249
          },
          {
            "text": "                                    st.session_state.history.append(new_flow)",
            "lineNumber": 250
          },
          {
            "text": "                            ",
            "lineNumber": 251
          },
          {
            "text": "                            st.rerun()",
            "lineNumber": 252
          },
          {
            "text": "                        except LLMAPIError as e:",
            "lineNumber": 253
          },
          {
            "text": "                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ",
            "lineNumber": 254
          }
        ]
      },
      "score": 0.31191718578338623
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\TOON_BASE.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 46,
            "column": 13
          }
        },
        "contents": "# Output Format: TOON (Token-Oriented Object Notation)\n\nå›ç­”ã¯ä»¥ä¸‹ã®ãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ã®ã¿ã§æ§‹æˆã—ã¦ãã ã•ã„ã€‚è§£èª¬ã‚„å°å…¥æ–‡ã¯ä¸€åˆ‡ç¦æ­¢ã—ã¾ã™ã€‚\n\n## Output Size Guidelines\n- **ãƒãƒ¼ãƒ‰æ•°**: æœ€å¤§30å€‹ã¾ã§ï¼ˆStreamlitã§ã®è¡¨ç¤ºãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ï¼‰\n- **ã‚¨ãƒƒã‚¸æ•°**: æœ€å¤§50å€‹ã¾ã§\n- **éƒ¨åˆ†çš„ãªãƒ•ãƒ­ãƒ¼ã®ç”Ÿæˆ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã‚„éƒ¨åˆ†ã‚’æŒ‡å®šã—ã¦ã„ã‚‹å ´åˆã€ãã®éƒ¨åˆ†ã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚å…¨ãƒ«ãƒ¼ãƒˆã‚’å«ã‚€å¿…è¦ã¯ãªã„ã€‚\n- **è¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ã®å ´åˆ**: ã¾ãšä¸»è¦ãªãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆã—ã€è©³ç´°ã¯å¾Œã‹ã‚‰è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã™ã‚‹ã€‚\n\n[Node]\nid: (è‹±æ•°å­—ID)\nlabel: (å·¥ç¨‹å)\ntype: (start | end | process | decision | io_data | storage)\n\n[Edge]\nsource: (ç™ºä¿¡å…ƒID)\ntarget: (å®›å…ˆID)\nlabel: (åˆ†å²æ¡ä»¶ãŒã‚ã‚‹å ´åˆã®ã¿)\n\n## Examples\n[Node]\nid: start\nlabel: é–‹å§‹\ntype: start\n[Node]\nid: task1\nlabel: å‡¦ç†\ntype: process\n[Node]\nid: node_end\nlabel: çµ‚äº†\ntype: end\n[Edge]\nsource: start\ntarget: task1\n[Edge]\nsource: task1\ntarget: node_end\n[Node]\nid: input1\nlabel: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›\ntype: io_data\n[Node]\nid: db1\nlabel: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹\ntype: storage",
        "signatures": {},
        "detailedLines": [
          {
            "text": "# Output Format: TOON (Token-Oriented Object Notation)",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "å›ç­”ã¯ä»¥ä¸‹ã®ãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ã®ã¿ã§æ§‹æˆã—ã¦ãã ã•ã„ã€‚è§£èª¬ã‚„å°å…¥æ–‡ã¯ä¸€åˆ‡ç¦æ­¢ã—ã¾ã™ã€‚",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "## Output Size Guidelines",
            "lineNumber": 5
          },
          {
            "text": "- **ãƒãƒ¼ãƒ‰æ•°**: æœ€å¤§30å€‹ã¾ã§ï¼ˆStreamlitã§ã®è¡¨ç¤ºãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ï¼‰",
            "lineNumber": 6
          },
          {
            "text": "- **ã‚¨ãƒƒã‚¸æ•°**: æœ€å¤§50å€‹ã¾ã§",
            "lineNumber": 7
          },
          {
            "text": "- **éƒ¨åˆ†çš„ãªãƒ•ãƒ­ãƒ¼ã®ç”Ÿæˆ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã‚„éƒ¨åˆ†ã‚’æŒ‡å®šã—ã¦ã„ã‚‹å ´åˆã€ãã®éƒ¨åˆ†ã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚å…¨ãƒ«ãƒ¼ãƒˆã‚’å«ã‚€å¿…è¦ã¯ãªã„ã€‚",
            "lineNumber": 8
          },
          {
            "text": "- **è¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ã®å ´åˆ**: ã¾ãšä¸»è¦ãªãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆã—ã€è©³ç´°ã¯å¾Œã‹ã‚‰è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã™ã‚‹ã€‚",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "text": "[Node]",
            "lineNumber": 11
          },
          {
            "text": "id: (è‹±æ•°å­—ID)",
            "lineNumber": 12
          },
          {
            "text": "label: (å·¥ç¨‹å)",
            "lineNumber": 13
          },
          {
            "text": "type: (start | end | process | decision | io_data | storage)",
            "lineNumber": 14
          },
          {
            "lineNumber": 15
          },
          {
            "text": "[Edge]",
            "lineNumber": 16
          },
          {
            "text": "source: (ç™ºä¿¡å…ƒID)",
            "lineNumber": 17
          },
          {
            "text": "target: (å®›å…ˆID)",
            "lineNumber": 18
          },
          {
            "text": "label: (åˆ†å²æ¡ä»¶ãŒã‚ã‚‹å ´åˆã®ã¿)",
            "lineNumber": 19
          },
          {
            "lineNumber": 20
          },
          {
            "text": "## Examples",
            "lineNumber": 21
          },
          {
            "text": "[Node]",
            "lineNumber": 22
          },
          {
            "text": "id: start",
            "lineNumber": 23
          },
          {
            "text": "label: é–‹å§‹",
            "lineNumber": 24
          },
          {
            "text": "type: start",
            "lineNumber": 25
          },
          {
            "text": "[Node]",
            "lineNumber": 26
          },
          {
            "text": "id: task1",
            "lineNumber": 27
          },
          {
            "text": "label: å‡¦ç†",
            "lineNumber": 28
          },
          {
            "text": "type: process",
            "lineNumber": 29
          },
          {
            "text": "[Node]",
            "lineNumber": 30
          },
          {
            "text": "id: node_end",
            "lineNumber": 31
          },
          {
            "text": "label: çµ‚äº†",
            "lineNumber": 32
          },
          {
            "text": "type: end",
            "lineNumber": 33
          },
          {
            "text": "[Edge]",
            "lineNumber": 34
          },
          {
            "text": "source: start",
            "lineNumber": 35
          },
          {
            "text": "target: task1",
            "lineNumber": 36
          },
          {
            "text": "[Edge]",
            "lineNumber": 37
          },
          {
            "text": "source: task1",
            "lineNumber": 38
          },
          {
            "text": "target: node_end",
            "lineNumber": 39
          },
          {
            "text": "[Node]",
            "lineNumber": 40
          },
          {
            "text": "id: input1",
            "lineNumber": 41
          },
          {
            "text": "label: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›",
            "lineNumber": 42
          },
          {
            "text": "type: io_data",
            "lineNumber": 43
          },
          {
            "text": "[Node]",
            "lineNumber": 44
          },
          {
            "text": "id: db1",
            "lineNumber": 45
          },
          {
            "text": "label: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹",
            "lineNumber": 46
          },
          {
            "text": "type: storage",
            "lineNumber": 47
          }
        ]
      },
      "score": 0.30138444900512695
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 349,
            "column": 92
          },
          "endPosition": {
            "line": 385,
            "column": 54
          }
        },
        "contents": "                    \n                    # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯\n                    if client.is_question_response(raw_toon_text):\n                        # è³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜\n                        st.session_state.conversation_context = user_prompt\n                        st.session_state.pending_questions = raw_toon_text\n                        st.session_state.question_responses = []\n                        st.session_state.append_mode_for_question = append_mode  # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜\n                        st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n                        st.rerun()\n                    else:\n                        # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼\n                        is_valid, validation_message = client.validate_output_size(raw_toon_text)\n                        if not is_valid:\n                            st.warning(validation_message)\n                            st.info(\"ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã‹ã€ãƒ•ãƒ­ãƒ¼ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\")\n                        \n                        # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹\n                        new_flow = TOONParser.parse(raw_toon_text)\n                        \n                        # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨\n                        new_flow = new_flow.apply_logic_gap_detection()\n                        \n                        # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ\n                        if append_mode:\n                            merged_flow = history_mgr.append_toon_log(session_name, new_flow)\n                            st.session_state.history.append(merged_flow)\n                            st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")\n                        else:\n                            # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ \n                            st.session_state.history.append(new_flow)\n                        \n                        st.rerun()\n                except LLMAPIError as e:\n                    # LLM APIã‚¨ãƒ©ãƒ¼\n                    st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {e}\")",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                    ",
            "lineNumber": 351
          },
          {
            "text": "                    # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 352
          },
          {
            "text": "                    if client.is_question_response(raw_toon_text):",
            "lineNumber": 353
          },
          {
            "text": "                        # è³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜",
            "lineNumber": 354
          },
          {
            "text": "                        st.session_state.conversation_context = user_prompt",
            "lineNumber": 355
          },
          {
            "text": "                        st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 356
          },
          {
            "text": "                        st.session_state.question_responses = []",
            "lineNumber": 357
          },
          {
            "text": "                        st.session_state.append_mode_for_question = append_mode  # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜",
            "lineNumber": 358
          },
          {
            "text": "                        st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 359
          },
          {
            "text": "                        st.rerun()",
            "lineNumber": 360
          },
          {
            "text": "                    else:",
            "lineNumber": 361
          },
          {
            "text": "                        # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼",
            "lineNumber": 362
          },
          {
            "text": "                        is_valid, validation_message = client.validate_output_size(raw_toon_text)",
            "lineNumber": 363
          },
          {
            "text": "                        if not is_valid:",
            "lineNumber": 364
          },
          {
            "text": "                            st.warning(validation_message)",
            "lineNumber": 365
          },
          {
            "text": "                            st.info(\"ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã‹ã€ãƒ•ãƒ­ãƒ¼ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 366
          },
          {
            "text": "                        ",
            "lineNumber": 367
          },
          {
            "text": "                        # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹",
            "lineNumber": 368
          },
          {
            "text": "                        new_flow = TOONParser.parse(raw_toon_text)",
            "lineNumber": 369
          },
          {
            "text": "                        ",
            "lineNumber": 370
          },
          {
            "text": "                        # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨",
            "lineNumber": 371
          },
          {
            "text": "                        new_flow = new_flow.apply_logic_gap_detection()",
            "lineNumber": 372
          },
          {
            "text": "                        ",
            "lineNumber": 373
          },
          {
            "text": "                        # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ",
            "lineNumber": 374
          },
          {
            "text": "                        if append_mode:",
            "lineNumber": 375
          },
          {
            "text": "                            merged_flow = history_mgr.append_toon_log(session_name, new_flow)",
            "lineNumber": 376
          },
          {
            "text": "                            st.session_state.history.append(merged_flow)",
            "lineNumber": 377
          },
          {
            "text": "                            st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")",
            "lineNumber": 378
          },
          {
            "text": "                        else:",
            "lineNumber": 379
          },
          {
            "text": "                            # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ ",
            "lineNumber": 380
          },
          {
            "text": "                            st.session_state.history.append(new_flow)",
            "lineNumber": 381
          },
          {
            "text": "                        ",
            "lineNumber": 382
          },
          {
            "text": "                        st.rerun()",
            "lineNumber": 383
          },
          {
            "text": "                except LLMAPIError as e:",
            "lineNumber": 384
          },
          {
            "text": "                    # LLM APIã‚¨ãƒ©ãƒ¼",
            "lineNumber": 385
          },
          {
            "text": "                    st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {e}\")",
            "lineNumber": 386
          }
        ]
      },
      "score": 0.2918674945831299
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\tests\\test_toon_parser.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 111
          }
        },
        "contents": "\"\"\"TOONParserã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ\"\"\"\nimport pytest\nfrom core.toon_parser import TOONParser\nfrom core.schemas import NodeStatus\nfrom core.exceptions import TOONParseError\n\n\nclass TestTOONParser:\n    def test_parse_simple_flow(self):\n        toon_text = \"\"\"\n[Node]\nid: start\nlabel: é–‹å§‹\ntype: start\n[Node]\nid: task1\nlabel: å‡¦ç†\ntype: process\n[Node]\nid: node_end\nlabel: çµ‚äº†\ntype: end\n[Edge]\nsource: start\ntarget: task1\n[Edge]\nsource: task1\ntarget: node_end\n\"\"\"\n        flowchart = TOONParser.parse(toon_text)\n        assert len(flowchart.nodes) == 3\n        assert len(flowchart.edges) == 2\n\n    def test_parse_with_status(self):\n        toon_text = \"\"\"\n[Node]\nid: start\nlabel: é–‹å§‹\ntype: start\nstatus: completed\n[Node]\nid: node_end\nlabel: çµ‚äº†\ntype: end\n[Edge]\nsource: start\ntarget: node_end\n\"\"\"\n        flowchart = TOONParser.parse(toon_text)\n        assert flowchart.nodes[0].status == NodeStatus.COMPLETED\n\n    def test_parse_invalid_status(self):\n        toon_text = \"\"\"\n[Node]\nid: start\nlabel: é–‹å§‹\ntype: start\nstatus: invalid_status\n[Node]\nid: node_end\nlabel: çµ‚äº†\ntype: end\n[Edge]\nsource: start\ntarget: node_end\n\"\"\"\n        flowchart = TOONParser.parse(toon_text)\n        # ç„¡åŠ¹ãªstatusã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆACTIVEï¼‰ã«ãªã‚‹\n        assert flowchart.nodes[0].status == NodeStatus.ACTIVE\n\n    def test_parse_with_markdown_code_block(self):\n        toon_text = \"\"\"\n&#96;&#96;&#96;toon\n[Node]\nid: start\nlabel: é–‹å§‹\ntype: start\n[Node]\nid: node_end\nlabel: çµ‚äº†\ntype: end\n[Edge]\nsource: start\ntarget: node_end\n&#96;&#96;&#96;\n\"\"\"\n        flowchart = TOONParser.parse(toon_text)\n        assert len(flowchart.nodes) == 2\n        assert len(flowchart.edges) == 1\n\n    def test_parse_empty_nodes(self):\n        toon_text = \"[Edge]\\nsource: start\\ntarget: end\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "\"\"\"TOONParserã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ\"\"\"",
            "lineNumber": 1
          },
          {
            "text": "import pytest",
            "lineNumber": 2
          },
          {
            "text": "from core.toon_parser import TOONParser",
            "lineNumber": 3
          },
          {
            "text": "from core.schemas import NodeStatus",
            "lineNumber": 4
          },
          {
            "text": "from core.exceptions import TOONParseError",
            "lineNumber": 5
          },
          {
            "lineNumber": 6
          },
          {
            "lineNumber": 7
          },
          {
            "text": "class TestTOONParser:",
            "lineNumber": 8,
            "isSignature": true
          },
          {
            "text": "    def test_parse_simple_flow(self):",
            "lineNumber": 9
          },
          {
            "text": "        toon_text = \"\"\"",
            "lineNumber": 10
          },
          {
            "text": "[Node]",
            "lineNumber": 11
          },
          {
            "text": "id: start",
            "lineNumber": 12
          },
          {
            "text": "label: é–‹å§‹",
            "lineNumber": 13
          },
          {
            "text": "type: start",
            "lineNumber": 14
          },
          {
            "text": "[Node]",
            "lineNumber": 15
          },
          {
            "text": "id: task1",
            "lineNumber": 16
          },
          {
            "text": "label: å‡¦ç†",
            "lineNumber": 17
          },
          {
            "text": "type: process",
            "lineNumber": 18
          },
          {
            "text": "[Node]",
            "lineNumber": 19
          },
          {
            "text": "id: node_end",
            "lineNumber": 20
          },
          {
            "text": "label: çµ‚äº†",
            "lineNumber": 21
          },
          {
            "text": "type: end",
            "lineNumber": 22
          },
          {
            "text": "[Edge]",
            "lineNumber": 23
          },
          {
            "text": "source: start",
            "lineNumber": 24
          },
          {
            "text": "target: task1",
            "lineNumber": 25
          },
          {
            "text": "[Edge]",
            "lineNumber": 26
          },
          {
            "text": "source: task1",
            "lineNumber": 27
          },
          {
            "text": "target: node_end",
            "lineNumber": 28
          },
          {
            "text": "\"\"\"",
            "lineNumber": 29
          },
          {
            "text": "        flowchart = TOONParser.parse(toon_text)",
            "lineNumber": 30
          },
          {
            "text": "        assert len(flowchart.nodes) == 3",
            "lineNumber": 31
          },
          {
            "text": "        assert len(flowchart.edges) == 2",
            "lineNumber": 32
          },
          {
            "lineNumber": 33
          },
          {
            "text": "    def test_parse_with_status(self):",
            "lineNumber": 34
          },
          {
            "text": "        toon_text = \"\"\"",
            "lineNumber": 35
          },
          {
            "text": "[Node]",
            "lineNumber": 36
          },
          {
            "text": "id: start",
            "lineNumber": 37
          },
          {
            "text": "label: é–‹å§‹",
            "lineNumber": 38
          },
          {
            "text": "type: start",
            "lineNumber": 39
          },
          {
            "text": "status: completed",
            "lineNumber": 40
          },
          {
            "text": "[Node]",
            "lineNumber": 41
          },
          {
            "text": "id: node_end",
            "lineNumber": 42
          },
          {
            "text": "label: çµ‚äº†",
            "lineNumber": 43
          },
          {
            "text": "type: end",
            "lineNumber": 44
          },
          {
            "text": "[Edge]",
            "lineNumber": 45
          },
          {
            "text": "source: start",
            "lineNumber": 46
          },
          {
            "text": "target: node_end",
            "lineNumber": 47
          },
          {
            "text": "\"\"\"",
            "lineNumber": 48
          },
          {
            "text": "        flowchart = TOONParser.parse(toon_text)",
            "lineNumber": 49
          },
          {
            "text": "        assert flowchart.nodes[0].status == NodeStatus.COMPLETED",
            "lineNumber": 50
          },
          {
            "lineNumber": 51
          },
          {
            "text": "    def test_parse_invalid_status(self):",
            "lineNumber": 52
          },
          {
            "text": "        toon_text = \"\"\"",
            "lineNumber": 53
          },
          {
            "text": "[Node]",
            "lineNumber": 54
          },
          {
            "text": "id: start",
            "lineNumber": 55
          },
          {
            "text": "label: é–‹å§‹",
            "lineNumber": 56
          },
          {
            "text": "type: start",
            "lineNumber": 57
          },
          {
            "text": "status: invalid_status",
            "lineNumber": 58
          },
          {
            "text": "[Node]",
            "lineNumber": 59
          },
          {
            "text": "id: node_end",
            "lineNumber": 60
          },
          {
            "text": "label: çµ‚äº†",
            "lineNumber": 61
          },
          {
            "text": "type: end",
            "lineNumber": 62
          },
          {
            "text": "[Edge]",
            "lineNumber": 63
          },
          {
            "text": "source: start",
            "lineNumber": 64
          },
          {
            "text": "target: node_end",
            "lineNumber": 65
          },
          {
            "text": "\"\"\"",
            "lineNumber": 66
          },
          {
            "text": "        flowchart = TOONParser.parse(toon_text)",
            "lineNumber": 67
          },
          {
            "text": "        # ç„¡åŠ¹ãªstatusã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆACTIVEï¼‰ã«ãªã‚‹",
            "lineNumber": 68
          },
          {
            "text": "        assert flowchart.nodes[0].status == NodeStatus.ACTIVE",
            "lineNumber": 69
          },
          {
            "lineNumber": 70
          },
          {
            "text": "    def test_parse_with_markdown_code_block(self):",
            "lineNumber": 71
          },
          {
            "text": "        toon_text = \"\"\"",
            "lineNumber": 72
          },
          {
            "text": "&#96;&#96;&#96;toon",
            "lineNumber": 73
          },
          {
            "text": "[Node]",
            "lineNumber": 74
          },
          {
            "text": "id: start",
            "lineNumber": 75
          },
          {
            "text": "label: é–‹å§‹",
            "lineNumber": 76
          },
          {
            "text": "type: start",
            "lineNumber": 77
          },
          {
            "text": "[Node]",
            "lineNumber": 78
          },
          {
            "text": "id: node_end",
            "lineNumber": 79
          },
          {
            "text": "label: çµ‚äº†",
            "lineNumber": 80
          },
          {
            "text": "type: end",
            "lineNumber": 81
          },
          {
            "text": "[Edge]",
            "lineNumber": 82
          },
          {
            "text": "source: start",
            "lineNumber": 83
          },
          {
            "text": "target: node_end",
            "lineNumber": 84
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 85
          },
          {
            "text": "\"\"\"",
            "lineNumber": 86
          },
          {
            "text": "        flowchart = TOONParser.parse(toon_text)",
            "lineNumber": 87
          },
          {
            "text": "        assert len(flowchart.nodes) == 2",
            "lineNumber": 88
          },
          {
            "text": "        assert len(flowchart.edges) == 1",
            "lineNumber": 89
          },
          {
            "lineNumber": 90
          },
          {
            "text": "    def test_parse_empty_nodes(self):",
            "lineNumber": 91
          },
          {
            "text": "        toon_text = \"[Edge]\\nsource: start\\ntarget: end\"",
            "lineNumber": 92
          }
        ]
      },
      "score": 0.28263458609580994
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\convert_flow_to_json.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 52,
            "column": 26
          }
        },
        "contents": "#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\"\"\"\nflow.mdã‚’èª­ã¿è¾¼ã‚“ã§JSONå½¢å¼ã«å¤‰æ›ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ\n\"\"\"\nimport json\nimport sys\nfrom pathlib import Path\nfrom core.mermaid_parser import MermaidParser\nfrom core.history_mgr import HistoryManager\n\ndef convert_flow_to_json():\n    \"\"\"flow.mdã‚’èª­ã¿è¾¼ã‚“ã§JSONå½¢å¼ã«å¤‰æ›\"\"\"\n    # flow.mdã‚’èª­ã¿è¾¼ã‚€\n    flow_path = Path(\"flow.md\")\n    if not flow_path.exists():\n        print(f\"Error: {flow_path} not found\", file=sys.stderr)\n        return\n    \n    # Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚€\n    mermaid_text = flow_path.read_text(encoding=\"utf-8\")\n    \n    # Mermaidå½¢å¼ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›\n    try:\n        flowchart = MermaidParser.parse(mermaid_text)\n        print(\"OK: Mermaid parsing succeeded\")\n        print(f\"  Nodes: {len(flowchart.nodes)}\")\n        print(f\"  Edges: {len(flowchart.edges)}\")\n    except Exception as e:\n        print(f\"Error: Mermaid parsing failed: {e}\", file=sys.stderr)\n        import traceback\n        traceback.print_exc()\n        return\n    \n    # JSONå½¢å¼ã§ä¿å­˜\n    history_mgr = HistoryManager()\n    session_name = \"flow_md\"\n    \n    # ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ã—ã¦ä¿å­˜\n    history_mgr.save_session(session_name, [flowchart])\n    print(f\"OK: Saved as JSON: storage/sessions/{session_name}.json\")\n    \n    # TOONå½¢å¼ã§ã‚‚ä¿å­˜\n    history_mgr.save_toon_file(session_name, flowchart)\n    print(f\"OK: Saved as TOON: storage/toon_files/{session_name}.md\")\n    \n    # JSONãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’è¡¨ç¤º\n    json_path = history_mgr.storage_dir / f\"{session_name}.json\"\n    print(f\"\\nTo load:\")\n    print(f\"  Use session name '{session_name}' in Streamlit app\")\n\nif __name__ == \"__main__\":\n    convert_flow_to_json()",
        "signatures": {},
        "detailedLines": [
          {
            "text": "#!/usr/bin/env python3",
            "lineNumber": 1
          },
          {
            "text": "# -*- coding: utf-8 -*-",
            "lineNumber": 2
          },
          {
            "text": "\"\"\"",
            "lineNumber": 3
          },
          {
            "text": "flow.mdã‚’èª­ã¿è¾¼ã‚“ã§JSONå½¢å¼ã«å¤‰æ›ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ",
            "lineNumber": 4
          },
          {
            "text": "\"\"\"",
            "lineNumber": 5
          },
          {
            "text": "import json",
            "lineNumber": 6
          },
          {
            "text": "import sys",
            "lineNumber": 7
          },
          {
            "text": "from pathlib import Path",
            "lineNumber": 8
          },
          {
            "text": "from core.mermaid_parser import MermaidParser",
            "lineNumber": 9
          },
          {
            "text": "from core.history_mgr import HistoryManager",
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "text": "def convert_flow_to_json():",
            "lineNumber": 12,
            "isSignature": true
          },
          {
            "text": "    \"\"\"flow.mdã‚’èª­ã¿è¾¼ã‚“ã§JSONå½¢å¼ã«å¤‰æ›\"\"\"",
            "lineNumber": 13
          },
          {
            "text": "    # flow.mdã‚’èª­ã¿è¾¼ã‚€",
            "lineNumber": 14
          },
          {
            "text": "    flow_path = Path(\"flow.md\")",
            "lineNumber": 15
          },
          {
            "text": "    if not flow_path.exists():",
            "lineNumber": 16
          },
          {
            "text": "        print(f\"Error: {flow_path} not found\", file=sys.stderr)",
            "lineNumber": 17
          },
          {
            "text": "        return",
            "lineNumber": 18
          },
          {
            "text": "    ",
            "lineNumber": 19
          },
          {
            "text": "    # Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚€",
            "lineNumber": 20
          },
          {
            "text": "    mermaid_text = flow_path.read_text(encoding=\"utf-8\")",
            "lineNumber": 21
          },
          {
            "text": "    ",
            "lineNumber": 22
          },
          {
            "text": "    # Mermaidå½¢å¼ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›",
            "lineNumber": 23
          },
          {
            "text": "    try:",
            "lineNumber": 24
          },
          {
            "text": "        flowchart = MermaidParser.parse(mermaid_text)",
            "lineNumber": 25
          },
          {
            "text": "        print(\"OK: Mermaid parsing succeeded\")",
            "lineNumber": 26
          },
          {
            "text": "        print(f\"  Nodes: {len(flowchart.nodes)}\")",
            "lineNumber": 27
          },
          {
            "text": "        print(f\"  Edges: {len(flowchart.edges)}\")",
            "lineNumber": 28
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 29
          },
          {
            "text": "        print(f\"Error: Mermaid parsing failed: {e}\", file=sys.stderr)",
            "lineNumber": 30
          },
          {
            "text": "        import traceback",
            "lineNumber": 31
          },
          {
            "text": "        traceback.print_exc()",
            "lineNumber": 32
          },
          {
            "text": "        return",
            "lineNumber": 33
          },
          {
            "text": "    ",
            "lineNumber": 34
          },
          {
            "text": "    # JSONå½¢å¼ã§ä¿å­˜",
            "lineNumber": 35
          },
          {
            "text": "    history_mgr = HistoryManager()",
            "lineNumber": 36
          },
          {
            "text": "    session_name = \"flow_md\"",
            "lineNumber": 37
          },
          {
            "text": "    ",
            "lineNumber": 38
          },
          {
            "text": "    # ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ã—ã¦ä¿å­˜",
            "lineNumber": 39
          },
          {
            "text": "    history_mgr.save_session(session_name, [flowchart])",
            "lineNumber": 40
          },
          {
            "text": "    print(f\"OK: Saved as JSON: storage/sessions/{session_name}.json\")",
            "lineNumber": 41
          },
          {
            "text": "    ",
            "lineNumber": 42
          },
          {
            "text": "    # TOONå½¢å¼ã§ã‚‚ä¿å­˜",
            "lineNumber": 43
          },
          {
            "text": "    history_mgr.save_toon_file(session_name, flowchart)",
            "lineNumber": 44
          },
          {
            "text": "    print(f\"OK: Saved as TOON: storage/toon_files/{session_name}.md\")",
            "lineNumber": 45
          },
          {
            "text": "    ",
            "lineNumber": 46
          },
          {
            "text": "    # JSONãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’è¡¨ç¤º",
            "lineNumber": 47
          },
          {
            "text": "    json_path = history_mgr.storage_dir / f\"{session_name}.json\"",
            "lineNumber": 48
          },
          {
            "text": "    print(f\"\\nTo load:\")",
            "lineNumber": 49
          },
          {
            "text": "    print(f\"  Use session name '{session_name}' in Streamlit app\")",
            "lineNumber": 50,
            "isSignature": true
          },
          {
            "lineNumber": 51
          },
          {
            "text": "if __name__ == \"__main__\":",
            "lineNumber": 52
          },
          {
            "text": "    convert_flow_to_json()",
            "lineNumber": 53
          }
        ]
      },
      "score": 0.25902414321899414
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\mermaid_parser.py",
        "range": {
          "startPosition": {
            "line": 5
          },
          "endPosition": {
            "line": 178
          }
        },
        "contents": "class MermaidParser:\n@staticmethod\ndef parse(mermaid_text: str) -&gt; Flowchart:\n\n            \n            # ã‚¨ãƒƒã‚¸å®šç¾©: source--&gt;target ã¾ãŸã¯ source--&gt;|\"label\"|target\n            edge_patterns = [\n                r'(\\w+)\\s*--&gt;\\s*\\|\\s*[\"\\']([^\"\\']+)[\"\\']\\s*\\|\\s*(\\w+)',  # source--&gt;|\"label\"|target\n                r'(\\w+)\\s*--&gt;\\s*(\\w+)',                                   # source--&gt;target\n            ]\n            \n            for pattern in edge_patterns:\n                edge_match = re.match(pattern, line)\n                if edge_match:\n                    source_id = edge_match.group(1)\n                    if len(edge_match.groups()) == 3:\n                        label = edge_match.group(2)\n                        target_id = edge_match.group(3)\n                    else:\n                        label = None\n                        target_id = edge_match.group(2)\n                    \n                    # IDãŒ'end'ã®å ´åˆã¯'node_end'ã«å¤‰æ›\n                    safe_source = \"node_end\" if source_id.lower() == \"end\" else source_id\n                    safe_target = \"node_end\" if target_id.lower() == \"end\" else target_id\n                    \n                    edges.append(Edge(\n                        source=safe_source,\n                        target=safe_target,\n                        label=label.strip() if label else None\n                    ))\n                    break\n        \n        # ãƒãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼\n        if not nodes:\n            raise TOONParseError(f\"Mermaidå½¢å¼ã®ãƒãƒ¼ãƒ‰ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚å†…å®¹ï¼š\\n{mermaid_text[:200]}...\")\n        \n        # startãƒãƒ¼ãƒ‰ã¨endãƒãƒ¼ãƒ‰ã®å­˜åœ¨ç¢ºèª\n        node_types = {node.type for node in nodes}\n        if \"start\" not in node_types:\n            # startãƒãƒ¼ãƒ‰ãŒãªã„å ´åˆã€æœ€åˆã®ãƒãƒ¼ãƒ‰ã‚’startã«è¨­å®š\n            if nodes:\n                nodes[0].type = \"start\"\n        \n        if \"end\" not in node_types:",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 6,
                "column": 1
              },
              "endPosition": {
                "line": 7,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 9,
                "column": 5
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 10,
                "column": 5
              },
              "endPosition": {
                "line": 11,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class MermaidParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 9
          },
          {
            "text": "def parse(mermaid_text: str) -&gt; Flowchart:",
            "lineNumber": 10
          },
          {
            "lineNumber": 101
          },
          {
            "text": "            ",
            "lineNumber": 102
          },
          {
            "text": "            # ã‚¨ãƒƒã‚¸å®šç¾©: source--&gt;target ã¾ãŸã¯ source--&gt;|\"label\"|target",
            "lineNumber": 103
          },
          {
            "text": "            edge_patterns = [",
            "lineNumber": 104
          },
          {
            "text": "                r'(\\w+)\\s*--&gt;\\s*\\|\\s*[\"\\']([^\"\\']+)[\"\\']\\s*\\|\\s*(\\w+)',  # source--&gt;|\"label\"|target",
            "lineNumber": 105
          },
          {
            "text": "                r'(\\w+)\\s*--&gt;\\s*(\\w+)',                                   # source--&gt;target",
            "lineNumber": 106
          },
          {
            "text": "            ]",
            "lineNumber": 107
          },
          {
            "text": "            ",
            "lineNumber": 108
          },
          {
            "text": "            for pattern in edge_patterns:",
            "lineNumber": 109
          },
          {
            "text": "                edge_match = re.match(pattern, line)",
            "lineNumber": 110
          },
          {
            "text": "                if edge_match:",
            "lineNumber": 111
          },
          {
            "text": "                    source_id = edge_match.group(1)",
            "lineNumber": 112
          },
          {
            "text": "                    if len(edge_match.groups()) == 3:",
            "lineNumber": 113
          },
          {
            "text": "                        label = edge_match.group(2)",
            "lineNumber": 114
          },
          {
            "text": "                        target_id = edge_match.group(3)",
            "lineNumber": 115
          },
          {
            "text": "                    else:",
            "lineNumber": 116
          },
          {
            "text": "                        label = None",
            "lineNumber": 117
          },
          {
            "text": "                        target_id = edge_match.group(2)",
            "lineNumber": 118
          },
          {
            "text": "                    ",
            "lineNumber": 119
          },
          {
            "text": "                    # IDãŒ'end'ã®å ´åˆã¯'node_end'ã«å¤‰æ›",
            "lineNumber": 120
          },
          {
            "text": "                    safe_source = \"node_end\" if source_id.lower() == \"end\" else source_id",
            "lineNumber": 121
          },
          {
            "text": "                    safe_target = \"node_end\" if target_id.lower() == \"end\" else target_id",
            "lineNumber": 122
          },
          {
            "text": "                    ",
            "lineNumber": 123
          },
          {
            "text": "                    edges.append(Edge(",
            "lineNumber": 124
          },
          {
            "text": "                        source=safe_source,",
            "lineNumber": 125
          },
          {
            "text": "                        target=safe_target,",
            "lineNumber": 126
          },
          {
            "text": "                        label=label.strip() if label else None",
            "lineNumber": 127
          },
          {
            "text": "                    ))",
            "lineNumber": 128
          },
          {
            "text": "                    break",
            "lineNumber": 129
          },
          {
            "text": "        ",
            "lineNumber": 130
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼",
            "lineNumber": 131
          },
          {
            "text": "        if not nodes:",
            "lineNumber": 132
          },
          {
            "text": "            raise TOONParseError(f\"Mermaidå½¢å¼ã®ãƒãƒ¼ãƒ‰ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚å†…å®¹ï¼š\\n{mermaid_text[:200]}...\")",
            "lineNumber": 133
          },
          {
            "text": "        ",
            "lineNumber": 134
          },
          {
            "text": "        # startãƒãƒ¼ãƒ‰ã¨endãƒãƒ¼ãƒ‰ã®å­˜åœ¨ç¢ºèª",
            "lineNumber": 135
          },
          {
            "text": "        node_types = {node.type for node in nodes}",
            "lineNumber": 136
          },
          {
            "text": "        if \"start\" not in node_types:",
            "lineNumber": 137
          },
          {
            "text": "            # startãƒãƒ¼ãƒ‰ãŒãªã„å ´åˆã€æœ€åˆã®ãƒãƒ¼ãƒ‰ã‚’startã«è¨­å®š",
            "lineNumber": 138
          },
          {
            "text": "            if nodes:",
            "lineNumber": 139
          },
          {
            "text": "                nodes[0].type = \"start\"",
            "lineNumber": 140
          },
          {
            "text": "        ",
            "lineNumber": 141
          },
          {
            "text": "        if \"end\" not in node_types:",
            "lineNumber": 142
          }
        ]
      },
      "score": 0.25547030568122864
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\mermaid_parser.py",
        "range": {
          "startPosition": {
            "line": 5
          },
          "endPosition": {
            "line": 178
          }
        },
        "contents": "class MermaidParser:\n@staticmethod\ndef parse(mermaid_text: str) -&gt; Flowchart:\n\n            for pattern in node_patterns:\n                node_match = re.match(pattern, line)\n                if node_match:\n                    node_id = node_match.group(1)\n                    label = node_match.group(2)\n                    \n                    # å½¢çŠ¶ã‹ã‚‰ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š\n                    if '{' in line and '}' in line:\n                        node_type = \"decision\"\n                    elif '(' in line and ')' in line:\n                        # ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ã¾ãŸã¯å††ç­’å½¢\n                        if node_id == \"start\" or (not nodes and node_id != \"node_end\"):\n                            node_type = \"start\"\n                        elif node_id == \"node_end\" or node_id.endswith(\"_end\"):\n                            node_type = \"end\"\n                        else:\n                            node_type = \"process\"\n                    elif '/' in line:\n                        node_type = \"io_data\"\n                    else:\n                        node_type = \"process\"\n                    \n                    # IDãŒ'end'ã®å ´åˆã¯'node_end'ã«å¤‰æ›\n                    safe_id = \"node_end\" if node_id.lower() == \"end\" else node_id\n                    \n                    # æ—¢ã«å­˜åœ¨ã™ã‚‹ãƒãƒ¼ãƒ‰ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆé‡è¤‡ã‚’é˜²ãï¼‰\n                    if safe_id not in [n.id for n in nodes]:\n                        node = Node(\n                            id=safe_id,\n                            label=label.strip(),\n                            type=node_type,\n                            status=NodeStatus.ACTIVE\n                        )\n                        nodes.append(node)\n                        node_map[node_id] = node\n                    node_found = True\n                    break\n            \n            if node_found:\n                continue\n            \n            # ã‚¨ãƒƒã‚¸å®šç¾©: source--&gt;target ã¾ãŸã¯ source--&gt;|\"label\"|target",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 6,
                "column": 1
              },
              "endPosition": {
                "line": 7,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 9,
                "column": 5
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 10,
                "column": 5
              },
              "endPosition": {
                "line": 11,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class MermaidParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 9
          },
          {
            "text": "def parse(mermaid_text: str) -&gt; Flowchart:",
            "lineNumber": 10
          },
          {
            "lineNumber": 61
          },
          {
            "text": "            for pattern in node_patterns:",
            "lineNumber": 62
          },
          {
            "text": "                node_match = re.match(pattern, line)",
            "lineNumber": 63
          },
          {
            "text": "                if node_match:",
            "lineNumber": 64
          },
          {
            "text": "                    node_id = node_match.group(1)",
            "lineNumber": 65
          },
          {
            "text": "                    label = node_match.group(2)",
            "lineNumber": 66
          },
          {
            "text": "                    ",
            "lineNumber": 67
          },
          {
            "text": "                    # å½¢çŠ¶ã‹ã‚‰ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š",
            "lineNumber": 68
          },
          {
            "text": "                    if '{' in line and '}' in line:",
            "lineNumber": 69
          },
          {
            "text": "                        node_type = \"decision\"",
            "lineNumber": 70
          },
          {
            "text": "                    elif '(' in line and ')' in line:",
            "lineNumber": 71
          },
          {
            "text": "                        # ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ã¾ãŸã¯å††ç­’å½¢",
            "lineNumber": 72
          },
          {
            "text": "                        if node_id == \"start\" or (not nodes and node_id != \"node_end\"):",
            "lineNumber": 73
          },
          {
            "text": "                            node_type = \"start\"",
            "lineNumber": 74
          },
          {
            "text": "                        elif node_id == \"node_end\" or node_id.endswith(\"_end\"):",
            "lineNumber": 75
          },
          {
            "text": "                            node_type = \"end\"",
            "lineNumber": 76
          },
          {
            "text": "                        else:",
            "lineNumber": 77
          },
          {
            "text": "                            node_type = \"process\"",
            "lineNumber": 78
          },
          {
            "text": "                    elif '/' in line:",
            "lineNumber": 79
          },
          {
            "text": "                        node_type = \"io_data\"",
            "lineNumber": 80
          },
          {
            "text": "                    else:",
            "lineNumber": 81
          },
          {
            "text": "                        node_type = \"process\"",
            "lineNumber": 82
          },
          {
            "text": "                    ",
            "lineNumber": 83
          },
          {
            "text": "                    # IDãŒ'end'ã®å ´åˆã¯'node_end'ã«å¤‰æ›",
            "lineNumber": 84
          },
          {
            "text": "                    safe_id = \"node_end\" if node_id.lower() == \"end\" else node_id",
            "lineNumber": 85
          },
          {
            "text": "                    ",
            "lineNumber": 86
          },
          {
            "text": "                    # æ—¢ã«å­˜åœ¨ã™ã‚‹ãƒãƒ¼ãƒ‰ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆé‡è¤‡ã‚’é˜²ãï¼‰",
            "lineNumber": 87
          },
          {
            "text": "                    if safe_id not in [n.id for n in nodes]:",
            "lineNumber": 88
          },
          {
            "text": "                        node = Node(",
            "lineNumber": 89
          },
          {
            "text": "                            id=safe_id,",
            "lineNumber": 90
          },
          {
            "text": "                            label=label.strip(),",
            "lineNumber": 91
          },
          {
            "text": "                            type=node_type,",
            "lineNumber": 92
          },
          {
            "text": "                            status=NodeStatus.ACTIVE",
            "lineNumber": 93
          },
          {
            "text": "                        )",
            "lineNumber": 94
          },
          {
            "text": "                        nodes.append(node)",
            "lineNumber": 95
          },
          {
            "text": "                        node_map[node_id] = node",
            "lineNumber": 96
          },
          {
            "text": "                    node_found = True",
            "lineNumber": 97
          },
          {
            "text": "                    break",
            "lineNumber": 98
          },
          {
            "text": "            ",
            "lineNumber": 99
          },
          {
            "text": "            if node_found:",
            "lineNumber": 100
          },
          {
            "text": "                continue",
            "lineNumber": 101
          },
          {
            "text": "            ",
            "lineNumber": 102
          },
          {
            "text": "            # ã‚¨ãƒƒã‚¸å®šç¾©: source--&gt;target ã¾ãŸã¯ source--&gt;|\"label\"|target",
            "lineNumber": 103
          }
        ]
      },
      "score": 0.24846744537353516
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\Project.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 31
          }
        },
        "contents": "ã“ã‚Œã¾ã§ã®è­°è«–ã‚’çµ±åˆã—ã€æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¼ç”»ä»•æ§˜æ›¸ï¼ˆè¦ä»¶å®šç¾©æ›¸ï¼‰ã®åˆæ¡ˆã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€å®Ÿè£…ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ãŠã‚ˆã³ã€å…¬é–‹æ™‚ã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã®è§£èª¬è³‡æ–™ã¨ã—ã¦ã‚‚æ´»ç”¨ã§ãã‚‹æ§‹æˆã«ã—ã¦ã„ã¾ã™ã€‚\n\n---\n\n# ä¼ç”»ä»•æ§˜æ›¸ï¼šTOON-Flow Visualizer (ä»®)\n\n**ã€œAIã«ã‚ˆã‚‹å¯¾è©±å‹ãƒ­ã‚¸ãƒƒã‚¯æ§‹é€ åŒ–ãƒ»è¦–è¦šåŒ–ã‚·ã‚¹ãƒ†ãƒ ã€œ**\n\n## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èƒŒæ™¯ã¨ç›®çš„\n\nè‡ªç„¶è¨€èªã«ã‚ˆã‚‹æŒ‡ç¤ºã‚„çŠ¶æ³èª¬æ˜ï¼ˆä¾‹ï¼šã€ŒJARVISãŒãŠã‹ã—ã„ã€ï¼‰ã¯æ›–æ˜§ã§ã‚ã‚Šã€è«–ç†çš„ãªæ¬ è½ã‚„çŸ›ç›¾ã‚’å«ã¿ã‚„ã™ã„ã€‚æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€AIã¨ã®å¯¾è©±ã‚’é€šã˜ã¦ã“ã‚Œã‚‰ã®æ›–æ˜§ãªæƒ…å ±ã‚’**TOONï¼ˆToken-Oriented Object Notationï¼‰**å½¢å¼ã§æ§‹é€ åŒ–ã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆåŒ–ã™ã‚‹ã“ã¨ã§ã€**ã€Œæ€è€ƒã®ãƒã‚°ï¼ˆæœªå®Ÿè£…ãƒ»çŸ›ç›¾ï¼‰ã€ã‚’è¦–è¦šçš„ã«ç‰¹å®šãƒ»è§£æ¶ˆã™ã‚‹**ã“ã¨ã‚’ç›®çš„ã¨ã™ã‚‹ã€‚\n\n## 2. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£\n\nä¿¡é ¼æ€§ã¨åŠ¹ç‡ã‚’ä¸¡ç«‹ã•ã›ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®2æ®µéšAIãƒ—ãƒ­ã‚»ã‚¹ã‚’æ¡ç”¨ã™ã‚‹ã€‚\n\n1. **Semantic Layer (å¤§å‹LLM):** ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‡ªç”±å…¥åŠ›ã‚’å—ã‘å–ã‚Šã€æ–‡è„ˆã‚’ç†è§£ã—ã¦TOONå½¢å¼ï¼ˆMarkdownãƒ™ãƒ¼ã‚¹ï¼‰ã®ãƒ­ã‚°ã‚’ç”Ÿæˆãƒ»è¿½è¨˜ã™ã‚‹ã€‚\n2. **Structural Layer (è»½é‡LLM/Gemmaç­‰):** TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æã—ã€ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã®é–¢ä¿‚ã‚’æŠ½å‡ºã—ã¦JSONãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›ã™ã‚‹ã€‚\n3. **Visualization Layer (ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹):** æŠ½å‡ºã•ã‚ŒãŸJSONã«åŸºã¥ãã€å®šç¾©ã•ã‚ŒãŸå¯¾å¿œè¡¨ï¼ˆTOON-Mermaidå¯¾å¿œè¡¨ï¼‰ã«å¾“ã£ã¦Mermaid.jsã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã€Streamlitä¸Šã«æç”»ã™ã‚‹ã€‚\n\n---\n\n## 3. æ©Ÿèƒ½è¦ä»¶\n\n### 3.1 å¯¾è©±å‹TOONæ§‹ç¯‰æ©Ÿèƒ½\n\n* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®ãƒãƒ£ãƒƒãƒˆã‚’é€šã˜ã¦æƒ…å ±ã‚’åé›†ã—ã€Markdownãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ&#96;.md&#96;ï¼‰ã«å·®åˆ†è¿½è¨˜ï¼ˆLoggingï¼‰ã™ã‚‹ã€‚\n* ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã«æ—¢å­˜ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€éå»ã®æ–‡è„ˆã‚’ç¶­æŒã™ã‚‹ã€‚\n\n### 3.2 è¦–è¦šçš„æ‹¡å¼µï¼ˆå›³è§£ï¼‰æ©Ÿèƒ½",
        "signatures": {},
        "detailedLines": [
          {
            "text": "ã“ã‚Œã¾ã§ã®è­°è«–ã‚’çµ±åˆã—ã€æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¼ç”»ä»•æ§˜æ›¸ï¼ˆè¦ä»¶å®šç¾©æ›¸ï¼‰ã®åˆæ¡ˆã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€å®Ÿè£…ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ãŠã‚ˆã³ã€å…¬é–‹æ™‚ã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã®è§£èª¬è³‡æ–™ã¨ã—ã¦ã‚‚æ´»ç”¨ã§ãã‚‹æ§‹æˆã«ã—ã¦ã„ã¾ã™ã€‚",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "---",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "# ä¼ç”»ä»•æ§˜æ›¸ï¼šTOON-Flow Visualizer (ä»®)",
            "lineNumber": 5
          },
          {
            "lineNumber": 6
          },
          {
            "text": "**ã€œAIã«ã‚ˆã‚‹å¯¾è©±å‹ãƒ­ã‚¸ãƒƒã‚¯æ§‹é€ åŒ–ãƒ»è¦–è¦šåŒ–ã‚·ã‚¹ãƒ†ãƒ ã€œ**",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èƒŒæ™¯ã¨ç›®çš„",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "text": "è‡ªç„¶è¨€èªã«ã‚ˆã‚‹æŒ‡ç¤ºã‚„çŠ¶æ³èª¬æ˜ï¼ˆä¾‹ï¼šã€ŒJARVISãŒãŠã‹ã—ã„ã€ï¼‰ã¯æ›–æ˜§ã§ã‚ã‚Šã€è«–ç†çš„ãªæ¬ è½ã‚„çŸ›ç›¾ã‚’å«ã¿ã‚„ã™ã„ã€‚æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€AIã¨ã®å¯¾è©±ã‚’é€šã˜ã¦ã“ã‚Œã‚‰ã®æ›–æ˜§ãªæƒ…å ±ã‚’**TOONï¼ˆToken-Oriented Object Notationï¼‰**å½¢å¼ã§æ§‹é€ åŒ–ã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆåŒ–ã™ã‚‹ã“ã¨ã§ã€**ã€Œæ€è€ƒã®ãƒã‚°ï¼ˆæœªå®Ÿè£…ãƒ»çŸ›ç›¾ï¼‰ã€ã‚’è¦–è¦šçš„ã«ç‰¹å®šãƒ»è§£æ¶ˆã™ã‚‹**ã“ã¨ã‚’ç›®çš„ã¨ã™ã‚‹ã€‚",
            "lineNumber": 11
          },
          {
            "lineNumber": 12
          },
          {
            "text": "## 2. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£",
            "lineNumber": 13
          },
          {
            "lineNumber": 14
          },
          {
            "text": "ä¿¡é ¼æ€§ã¨åŠ¹ç‡ã‚’ä¸¡ç«‹ã•ã›ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®2æ®µéšAIãƒ—ãƒ­ã‚»ã‚¹ã‚’æ¡ç”¨ã™ã‚‹ã€‚",
            "lineNumber": 15
          },
          {
            "lineNumber": 16
          },
          {
            "text": "1. **Semantic Layer (å¤§å‹LLM):** ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‡ªç”±å…¥åŠ›ã‚’å—ã‘å–ã‚Šã€æ–‡è„ˆã‚’ç†è§£ã—ã¦TOONå½¢å¼ï¼ˆMarkdownãƒ™ãƒ¼ã‚¹ï¼‰ã®ãƒ­ã‚°ã‚’ç”Ÿæˆãƒ»è¿½è¨˜ã™ã‚‹ã€‚",
            "lineNumber": 17
          },
          {
            "text": "2. **Structural Layer (è»½é‡LLM/Gemmaç­‰):** TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æã—ã€ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã®é–¢ä¿‚ã‚’æŠ½å‡ºã—ã¦JSONãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›ã™ã‚‹ã€‚",
            "lineNumber": 18
          },
          {
            "text": "3. **Visualization Layer (ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹):** æŠ½å‡ºã•ã‚ŒãŸJSONã«åŸºã¥ãã€å®šç¾©ã•ã‚ŒãŸå¯¾å¿œè¡¨ï¼ˆTOON-Mermaidå¯¾å¿œè¡¨ï¼‰ã«å¾“ã£ã¦Mermaid.jsã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã€Streamlitä¸Šã«æç”»ã™ã‚‹ã€‚",
            "lineNumber": 19
          },
          {
            "lineNumber": 20
          },
          {
            "text": "---",
            "lineNumber": 21
          },
          {
            "lineNumber": 22
          },
          {
            "text": "## 3. æ©Ÿèƒ½è¦ä»¶",
            "lineNumber": 23
          },
          {
            "lineNumber": 24
          },
          {
            "text": "### 3.1 å¯¾è©±å‹TOONæ§‹ç¯‰æ©Ÿèƒ½",
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "text": "* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®ãƒãƒ£ãƒƒãƒˆã‚’é€šã˜ã¦æƒ…å ±ã‚’åé›†ã—ã€Markdownãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ&#96;.md&#96;ï¼‰ã«å·®åˆ†è¿½è¨˜ï¼ˆLoggingï¼‰ã™ã‚‹ã€‚",
            "lineNumber": 27
          },
          {
            "text": "* ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã«æ—¢å­˜ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€éå»ã®æ–‡è„ˆã‚’ç¶­æŒã™ã‚‹ã€‚",
            "lineNumber": 28
          },
          {
            "lineNumber": 29
          },
          {
            "text": "### 3.2 è¦–è¦šçš„æ‹¡å¼µï¼ˆå›³è§£ï¼‰æ©Ÿèƒ½",
            "lineNumber": 30
          }
        ]
      },
      "score": 0.2368219494819641
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\history_mgr.py",
        "range": {
          "startPosition": {
            "line": 6
          },
          "endPosition": {
            "line": 175
          }
        },
        "contents": "class HistoryManager:\n\n\n    def load_toon_file(self, session_id: str) -&gt; Optional[Flowchart]:\n        \"\"\"ä¿å­˜ã•ã‚ŒãŸTOONå½¢å¼ï¼ˆMarkdownï¼‰ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰Flowchartã‚’å¾©å…ƒã—ã¾ã™ã€‚\"\"\"\n        file_path = self.toon_dir / f\"{session_id}.md\"\n        if not file_path.exists():\n            return None\n        \n        try:\n            with open(file_path, \"r\", encoding=\"utf-8\") as f:\n                toon_text = f.read()\n            return TOONParser.parse(toon_text)\n        except Exception as e:\n            raise ValueError(f\"TOONãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\") from e\n\n    def list_toon_files(self) -&gt; List[str]:\n        \"\"\"ä¿å­˜ã•ã‚Œã¦ã„ã‚‹TOONãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¹ãƒˆã‚’è¿”ã—ã¾ã™ã€‚\"\"\"\n        return [f.stem for f in self.toon_dir.glob(\"*.md\")]\n    \n    def list_sessions(self) -&gt; List[str]:\n        \"\"\"ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆJSONãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã®ãƒªã‚¹ãƒˆã‚’è¿”ã—ã¾ã™ã€‚\"\"\"\n        return [f.stem for f in self.storage_dir.glob(\"*.json\") if not f.name.endswith('.broken')]\n\n    def append_toon_log(self, session_id: str, new_flowchart: Flowchart) -&gt; Flowchart:\n        ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 7,
                "column": 1
              },
              "endPosition": {
                "line": 8,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class HistoryManager:",
            "lineNumber": 7,
            "isSignature": true
          },
          {
            "lineNumber": 82
          },
          {
            "lineNumber": 83
          },
          {
            "text": "    def load_toon_file(self, session_id: str) -&gt; Optional[Flowchart]:",
            "lineNumber": 84
          },
          {
            "text": "        \"\"\"ä¿å­˜ã•ã‚ŒãŸTOONå½¢å¼ï¼ˆMarkdownï¼‰ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰Flowchartã‚’å¾©å…ƒã—ã¾ã™ã€‚\"\"\"",
            "lineNumber": 85
          },
          {
            "text": "        file_path = self.toon_dir / f\"{session_id}.md\"",
            "lineNumber": 86
          },
          {
            "text": "        if not file_path.exists():",
            "lineNumber": 87
          },
          {
            "text": "            return None",
            "lineNumber": 88
          },
          {
            "text": "        ",
            "lineNumber": 89
          },
          {
            "text": "        try:",
            "lineNumber": 90
          },
          {
            "text": "            with open(file_path, \"r\", encoding=\"utf-8\") as f:",
            "lineNumber": 91
          },
          {
            "text": "                toon_text = f.read()",
            "lineNumber": 92
          },
          {
            "text": "            return TOONParser.parse(toon_text)",
            "lineNumber": 93
          },
          {
            "text": "        except Exception as e:",
            "lineNumber": 94
          },
          {
            "text": "            raise ValueError(f\"TOONãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\") from e",
            "lineNumber": 95
          },
          {
            "lineNumber": 96
          },
          {
            "text": "    def list_toon_files(self) -&gt; List[str]:",
            "lineNumber": 97
          },
          {
            "text": "        \"\"\"ä¿å­˜ã•ã‚Œã¦ã„ã‚‹TOONãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¹ãƒˆã‚’è¿”ã—ã¾ã™ã€‚\"\"\"",
            "lineNumber": 98
          },
          {
            "text": "        return [f.stem for f in self.toon_dir.glob(\"*.md\")]",
            "lineNumber": 99
          },
          {
            "text": "    ",
            "lineNumber": 100
          },
          {
            "text": "    def list_sessions(self) -&gt; List[str]:",
            "lineNumber": 101
          },
          {
            "text": "        \"\"\"ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆJSONãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã®ãƒªã‚¹ãƒˆã‚’è¿”ã—ã¾ã™ã€‚\"\"\"",
            "lineNumber": 102
          },
          {
            "text": "        return [f.stem for f in self.storage_dir.glob(\"*.json\") if not f.name.endswith('.broken')]",
            "lineNumber": 103
          },
          {
            "lineNumber": 104
          },
          {
            "text": "    def append_toon_log(self, session_id: str, new_flowchart: Flowchart) -&gt; Flowchart:",
            "lineNumber": 105
          },
          {
            "text": "        ",
            "lineNumber": 106
          }
        ]
      },
      "score": 0.22625553607940674
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\program_base.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 43
          }
        },
        "contents": "1ãƒ•ã‚¡ã‚¤ãƒ«1è²¬ä»»ã®åŸå‰‡ï¼ˆSRPï¼‰ã«åŸºã¥ãã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç‹¬ç«‹ã•ã›ã‚‹ã“ã¨ã§ã€**ã€ŒAIã®æŒ™å‹•ã‚’å¤‰ãˆãŸã„ã¨ãã€**ã¨**ã€Œå›³ã®è¦‹ãŸç›®ï¼ˆMermaidï¼‰ã‚’å¤‰ãˆãŸã„ã¨ãã€**ã‚’å®Œå…¨ã«åˆ‡ã‚Šåˆ†ã‘ã¦ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã§ãã‚‹æ§‹é€ ã‚’ææ¡ˆã—ã¾ã™ã€‚\n\n---\n\n## 1. æ¨å¥¨ã•ã‚Œã‚‹ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ \n\næ‹¡å¼µæ€§ã¨è¦‹é€šã—ã®è‰¯ã•ã‚’é‡è¦–ã—ãŸæ§‹æˆã§ã™ã€‚\n\n&#96;&#96;&#96;text\ntoon-flow-visualizer/\nâ”œâ”€â”€ app.py                # ã€Entry Pointã€‘Streamlitã®ãƒ¡ã‚¤ãƒ³UIãƒ»çŠ¶æ…‹ç®¡ç†\nâ”œâ”€â”€ core/                 # ã€Logicã€‘å…±é€šåŸºç›¤ãƒ»ãƒ‡ãƒ¼ã‚¿å®šç¾©\nâ”‚   â””â”€â”€ models.py         # ãƒãƒ¼ãƒ‰ã‚„ã‚¨ãƒƒã‚¸ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€  (Pydanticç­‰)\nâ”œâ”€â”€ parser/               # ã€Responsibility: è§£æã€‘\nâ”‚   â””â”€â”€ toon_parser.py    # Markdown(TOON)ã‹ã‚‰å†…éƒ¨ãƒ¢ãƒ‡ãƒ«ã¸ã®å¤‰æ›\nâ”œâ”€â”€ generator/            # ã€Responsibility: æç”»ç”Ÿæˆã€‘\nâ”‚   â””â”€â”€ mermaid_gen.py    # å†…éƒ¨ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰Mermaidæ§‹æ–‡ã¸ã®å¤‰æ›\nâ”œâ”€â”€ llm/                  # ã€Responsibility: AIå¯¾è©±ã€‘\nâ”‚   â””â”€â”€ agent.py          # å¤§å‹LLMã¸ã®æŒ‡ç¤ºã€TOONå·®åˆ†å–å¾—\nâ”œâ”€â”€ schema/               # ã€Assetsã€‘\nâ”‚   â””â”€â”€ template.md       # LLMã«æ¸¡ã™TOONã®åŸºæœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ\nâ””â”€â”€ data/                 # ã€Storageã€‘\n    â””â”€â”€ sessions/         # ä¿å­˜ã•ã‚ŒãŸTOONãƒ•ã‚¡ã‚¤ãƒ«(.md)\n\n&#96;&#96;&#96;\n\n---\n\n## 2. å„ãƒ•ã‚¡ã‚¤ãƒ«ã®è²¬ä»»ç¯„å›²ï¼ˆè¦ä»¶å®šç¾©ï¼‰\n\n### â‘  &#96;core/models.py&#96;\n\n**è²¬ä»»ï¼šãƒ‡ãƒ¼ã‚¿ã®å‹å®šç¾©**\n\n* Pythonã® &#96;Dataclass&#96; ã‚„ &#96;Pydantic&#96; ã‚’ä½¿ã„ã€&#96;Node&#96; ã‚„ &#96;Edge&#96; ã®å±æ€§ï¼ˆID, Type, Label, Statusï¼‰ã‚’å³å¯†ã«å®šç¾©ã—ã¾ã™ã€‚\n* ã“ã“ã‚’å›ºå®šã™ã‚‹ã“ã¨ã§ã€ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«é–“ã§ã®ãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—ãƒŸã‚¹ã‚’é˜²ãã¾ã™ã€‚\n\n### â‘¡ &#96;parser/toon_parser.py&#96;\n\n**è²¬ä»»ï¼šTOONã®è§£é‡ˆï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰**\n\n* Markdownå½¢å¼ã®TOONã‚’æ­£è¦è¡¨ç¾ï¼ˆRegexï¼‰ãªã©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã€&#96;models.py&#96; ã§å®šç¾©ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚¹ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚\n* **ã€Œå·®åˆ†ï¼ˆLOGï¼‰ã€ã®åæ˜ ãƒ­ã‚¸ãƒƒã‚¯**ã‚‚ã“ã“ã«æŒã¡ã¾ã™ã€‚å¤ã„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«LOGã®å†…å®¹ã‚’ä¸Šæ›¸ãã—ã¦ã€æœ€æ–°ã®çŠ¶æ…‹ã‚’ä½œã‚‹è²¬ä»»è€…ã§ã™ã€‚",
        "signatures": {},
        "detailedLines": [
          {
            "text": "1ãƒ•ã‚¡ã‚¤ãƒ«1è²¬ä»»ã®åŸå‰‡ï¼ˆSRPï¼‰ã«åŸºã¥ãã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç‹¬ç«‹ã•ã›ã‚‹ã“ã¨ã§ã€**ã€ŒAIã®æŒ™å‹•ã‚’å¤‰ãˆãŸã„ã¨ãã€**ã¨**ã€Œå›³ã®è¦‹ãŸç›®ï¼ˆMermaidï¼‰ã‚’å¤‰ãˆãŸã„ã¨ãã€**ã‚’å®Œå…¨ã«åˆ‡ã‚Šåˆ†ã‘ã¦ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã§ãã‚‹æ§‹é€ ã‚’ææ¡ˆã—ã¾ã™ã€‚",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "---",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "## 1. æ¨å¥¨ã•ã‚Œã‚‹ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ ",
            "lineNumber": 5
          },
          {
            "lineNumber": 6
          },
          {
            "text": "æ‹¡å¼µæ€§ã¨è¦‹é€šã—ã®è‰¯ã•ã‚’é‡è¦–ã—ãŸæ§‹æˆã§ã™ã€‚",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "&#96;&#96;&#96;text",
            "lineNumber": 9
          },
          {
            "text": "toon-flow-visualizer/",
            "lineNumber": 10
          },
          {
            "text": "â”œâ”€â”€ app.py                # ã€Entry Pointã€‘Streamlitã®ãƒ¡ã‚¤ãƒ³UIãƒ»çŠ¶æ…‹ç®¡ç†",
            "lineNumber": 11
          },
          {
            "text": "â”œâ”€â”€ core/                 # ã€Logicã€‘å…±é€šåŸºç›¤ãƒ»ãƒ‡ãƒ¼ã‚¿å®šç¾©",
            "lineNumber": 12
          },
          {
            "text": "â”‚   â””â”€â”€ models.py         # ãƒãƒ¼ãƒ‰ã‚„ã‚¨ãƒƒã‚¸ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€  (Pydanticç­‰)",
            "lineNumber": 13
          },
          {
            "text": "â”œâ”€â”€ parser/               # ã€Responsibility: è§£æã€‘",
            "lineNumber": 14
          },
          {
            "text": "â”‚   â””â”€â”€ toon_parser.py    # Markdown(TOON)ã‹ã‚‰å†…éƒ¨ãƒ¢ãƒ‡ãƒ«ã¸ã®å¤‰æ›",
            "lineNumber": 15
          },
          {
            "text": "â”œâ”€â”€ generator/            # ã€Responsibility: æç”»ç”Ÿæˆã€‘",
            "lineNumber": 16
          },
          {
            "text": "â”‚   â””â”€â”€ mermaid_gen.py    # å†…éƒ¨ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰Mermaidæ§‹æ–‡ã¸ã®å¤‰æ›",
            "lineNumber": 17
          },
          {
            "text": "â”œâ”€â”€ llm/                  # ã€Responsibility: AIå¯¾è©±ã€‘",
            "lineNumber": 18
          },
          {
            "text": "â”‚   â””â”€â”€ agent.py          # å¤§å‹LLMã¸ã®æŒ‡ç¤ºã€TOONå·®åˆ†å–å¾—",
            "lineNumber": 19
          },
          {
            "text": "â”œâ”€â”€ schema/               # ã€Assetsã€‘",
            "lineNumber": 20
          },
          {
            "text": "â”‚   â””â”€â”€ template.md       # LLMã«æ¸¡ã™TOONã®åŸºæœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ",
            "lineNumber": 21
          },
          {
            "text": "â””â”€â”€ data/                 # ã€Storageã€‘",
            "lineNumber": 22
          },
          {
            "text": "    â””â”€â”€ sessions/         # ä¿å­˜ã•ã‚ŒãŸTOONãƒ•ã‚¡ã‚¤ãƒ«(.md)",
            "lineNumber": 23
          },
          {
            "lineNumber": 24
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "text": "---",
            "lineNumber": 27
          },
          {
            "lineNumber": 28
          },
          {
            "text": "## 2. å„ãƒ•ã‚¡ã‚¤ãƒ«ã®è²¬ä»»ç¯„å›²ï¼ˆè¦ä»¶å®šç¾©ï¼‰",
            "lineNumber": 29
          },
          {
            "lineNumber": 30
          },
          {
            "text": "### â‘  &#96;core/models.py&#96;",
            "lineNumber": 31
          },
          {
            "lineNumber": 32
          },
          {
            "text": "**è²¬ä»»ï¼šãƒ‡ãƒ¼ã‚¿ã®å‹å®šç¾©**",
            "lineNumber": 33
          },
          {
            "lineNumber": 34
          },
          {
            "text": "* Pythonã® &#96;Dataclass&#96; ã‚„ &#96;Pydantic&#96; ã‚’ä½¿ã„ã€&#96;Node&#96; ã‚„ &#96;Edge&#96; ã®å±æ€§ï¼ˆID, Type, Label, Statusï¼‰ã‚’å³å¯†ã«å®šç¾©ã—ã¾ã™ã€‚",
            "lineNumber": 35
          },
          {
            "text": "* ã“ã“ã‚’å›ºå®šã™ã‚‹ã“ã¨ã§ã€ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«é–“ã§ã®ãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—ãƒŸã‚¹ã‚’é˜²ãã¾ã™ã€‚",
            "lineNumber": 36
          },
          {
            "lineNumber": 37
          },
          {
            "text": "### â‘¡ &#96;parser/toon_parser.py&#96;",
            "lineNumber": 38
          },
          {
            "lineNumber": 39
          },
          {
            "text": "**è²¬ä»»ï¼šTOONã®è§£é‡ˆï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰**",
            "lineNumber": 40
          },
          {
            "lineNumber": 41
          },
          {
            "text": "* Markdownå½¢å¼ã®TOONã‚’æ­£è¦è¡¨ç¾ï¼ˆRegexï¼‰ãªã©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã€&#96;models.py&#96; ã§å®šç¾©ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚¹ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚",
            "lineNumber": 42
          },
          {
            "text": "* **ã€Œå·®åˆ†ï¼ˆLOGï¼‰ã€ã®åæ˜ ãƒ­ã‚¸ãƒƒã‚¯**ã‚‚ã“ã“ã«æŒã¡ã¾ã™ã€‚å¤ã„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«LOGã®å†…å®¹ã‚’ä¸Šæ›¸ãã—ã¦ã€æœ€æ–°ã®çŠ¶æ…‹ã‚’ä½œã‚‹è²¬ä»»è€…ã§ã™ã€‚",
            "lineNumber": 43
          }
        ]
      },
      "score": 0.22335049510002136
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\llm_client.py",
        "range": {
          "startPosition": {
            "line": 8
          },
          "endPosition": {
            "line": 268
          }
        },
        "contents": "class LLMClient:\n\n\n    @staticmethod\n    def is_question_response(response_text: str) -&gt; bool:\n        \"\"\"\n        LLMã®å¿œç­”ãŒè³ªå•å½¢å¼ã‹TOONå½¢å¼ã‹ã‚’åˆ¤å®šã—ã¾ã™ã€‚\n        \n        Args:\n            response_text: LLMã‹ã‚‰ã®å¿œç­”ãƒ†ã‚­ã‚¹ãƒˆ\n            \n        Returns:\n            True: è³ªå•å½¢å¼ã®å ´åˆ\n            False: TOONå½¢å¼ã®å ´åˆ\n        \"\"\"\n        # TOONå½¢å¼ã®ç‰¹å¾´ã‚’ãƒã‚§ãƒƒã‚¯\n        # [Node]ã‚¿ã‚°ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯TOONå½¢å¼ã¨åˆ¤æ–­\n        if re.search(r'\\[Node\\]', response_text, re.IGNORECASE):\n            return False\n        \n        # [Edge]ã‚¿ã‚°ãŒå­˜åœ¨ã™ã‚‹å ´åˆã‚‚TOONå½¢å¼ã¨åˆ¤æ–­\n        if re.search(r'\\[Edge\\]', response_text, re.IGNORECASE):\n            return False\n        \n        # è³ªå•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯\n        question_patterns = [\n            r'æ•™ãˆã¦ãã ã•ã„',\n            r'ä½•ã§ã™ã‹[ï¼Ÿ?]',\n            r'ã©ã®ã‚ˆã†[ãªã«]',\n            r'ã©ã‚Œ[ãŒã‚’]',\n            r'ã„ã¤[ãŒã‚’]',\n            r'ã©ã“[ãŒã‚’]',\n            r'ãªãœ',\n            r'ã©ã†ã—ã¦',\n            r'[ï¼Ÿ?]\\s*$',  # æ–‡æœ«ãŒ?ã§çµ‚ã‚ã‚‹\n            r'ä»¥ä¸‹ã®æƒ…å ±',\n            r'è³ªå•',\n            r'ç¢ºèª',\n        ]\n        \n        # è³ªå•ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯\n        for pattern in question_patterns:\n            if re.search(pattern, response_text, re.IGNORECASE):\n                return True\n        \n        # æ•°å­—ä»˜ãã®è³ªå•ãƒªã‚¹ãƒˆå½¢å¼ï¼ˆä¾‹ï¼šã€Œ1. ...ã§ã™ã‹ï¼Ÿã€ï¼‰\n        numbered_question_pattern = r'\\d+[\\.ï¼]\\s*[^ã€‚\\n]*[ï¼Ÿ?]'\n        if re.search(numbered_question_pattern, response_text):\n            return True\n        \n        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯TOONå½¢å¼ã¨åˆ¤æ–­ï¼ˆè³ªå•å½¢å¼ã§ã¯ãªã„ï¼‰\n        return False\n\n    def validate_output_size(self, toon_text: str) -&gt; tuple[bool, str]:\n        ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 9,
                "column": 1
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class LLMClient:",
            "lineNumber": 9,
            "isSignature": true
          },
          {
            "lineNumber": 64
          },
          {
            "lineNumber": 65
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 66
          },
          {
            "text": "    def is_question_response(response_text: str) -&gt; bool:",
            "lineNumber": 67
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 68
          },
          {
            "text": "        LLMã®å¿œç­”ãŒè³ªå•å½¢å¼ã‹TOONå½¢å¼ã‹ã‚’åˆ¤å®šã—ã¾ã™ã€‚",
            "lineNumber": 69
          },
          {
            "text": "        ",
            "lineNumber": 70
          },
          {
            "text": "        Args:",
            "lineNumber": 71
          },
          {
            "text": "            response_text: LLMã‹ã‚‰ã®å¿œç­”ãƒ†ã‚­ã‚¹ãƒˆ",
            "lineNumber": 72
          },
          {
            "text": "            ",
            "lineNumber": 73
          },
          {
            "text": "        Returns:",
            "lineNumber": 74
          },
          {
            "text": "            True: è³ªå•å½¢å¼ã®å ´åˆ",
            "lineNumber": 75
          },
          {
            "text": "            False: TOONå½¢å¼ã®å ´åˆ",
            "lineNumber": 76
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 77
          },
          {
            "text": "        # TOONå½¢å¼ã®ç‰¹å¾´ã‚’ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 78
          },
          {
            "text": "        # [Node]ã‚¿ã‚°ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯TOONå½¢å¼ã¨åˆ¤æ–­",
            "lineNumber": 79
          },
          {
            "text": "        if re.search(r'\\[Node\\]', response_text, re.IGNORECASE):",
            "lineNumber": 80
          },
          {
            "text": "            return False",
            "lineNumber": 81
          },
          {
            "text": "        ",
            "lineNumber": 82
          },
          {
            "text": "        # [Edge]ã‚¿ã‚°ãŒå­˜åœ¨ã™ã‚‹å ´åˆã‚‚TOONå½¢å¼ã¨åˆ¤æ–­",
            "lineNumber": 83
          },
          {
            "text": "        if re.search(r'\\[Edge\\]', response_text, re.IGNORECASE):",
            "lineNumber": 84
          },
          {
            "text": "            return False",
            "lineNumber": 85
          },
          {
            "text": "        ",
            "lineNumber": 86
          },
          {
            "text": "        # è³ªå•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 87
          },
          {
            "text": "        question_patterns = [",
            "lineNumber": 88
          },
          {
            "text": "            r'æ•™ãˆã¦ãã ã•ã„',",
            "lineNumber": 89
          },
          {
            "text": "            r'ä½•ã§ã™ã‹[ï¼Ÿ?]',",
            "lineNumber": 90
          },
          {
            "text": "            r'ã©ã®ã‚ˆã†[ãªã«]',",
            "lineNumber": 91
          },
          {
            "text": "            r'ã©ã‚Œ[ãŒã‚’]',",
            "lineNumber": 92
          },
          {
            "text": "            r'ã„ã¤[ãŒã‚’]',",
            "lineNumber": 93
          },
          {
            "text": "            r'ã©ã“[ãŒã‚’]',",
            "lineNumber": 94
          },
          {
            "text": "            r'ãªãœ',",
            "lineNumber": 95
          },
          {
            "text": "            r'ã©ã†ã—ã¦',",
            "lineNumber": 96
          },
          {
            "text": "            r'[ï¼Ÿ?]\\s*$',  # æ–‡æœ«ãŒ?ã§çµ‚ã‚ã‚‹",
            "lineNumber": 97
          },
          {
            "text": "            r'ä»¥ä¸‹ã®æƒ…å ±',",
            "lineNumber": 98
          },
          {
            "text": "            r'è³ªå•',",
            "lineNumber": 99
          },
          {
            "text": "            r'ç¢ºèª',",
            "lineNumber": 100
          },
          {
            "text": "        ]",
            "lineNumber": 101
          },
          {
            "text": "        ",
            "lineNumber": 102
          },
          {
            "text": "        # è³ªå•ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 103
          },
          {
            "text": "        for pattern in question_patterns:",
            "lineNumber": 104
          },
          {
            "text": "            if re.search(pattern, response_text, re.IGNORECASE):",
            "lineNumber": 105
          },
          {
            "text": "                return True",
            "lineNumber": 106
          },
          {
            "text": "        ",
            "lineNumber": 107
          },
          {
            "text": "        # æ•°å­—ä»˜ãã®è³ªå•ãƒªã‚¹ãƒˆå½¢å¼ï¼ˆä¾‹ï¼šã€Œ1. ...ã§ã™ã‹ï¼Ÿã€ï¼‰",
            "lineNumber": 108
          },
          {
            "text": "        numbered_question_pattern = r'\\d+[\\.ï¼]\\s*[^ã€‚\\n]*[ï¼Ÿ?]'",
            "lineNumber": 109
          },
          {
            "text": "        if re.search(numbered_question_pattern, response_text):",
            "lineNumber": 110
          },
          {
            "text": "            return True",
            "lineNumber": 111
          },
          {
            "text": "        ",
            "lineNumber": 112
          },
          {
            "text": "        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯TOONå½¢å¼ã¨åˆ¤æ–­ï¼ˆè³ªå•å½¢å¼ã§ã¯ãªã„ï¼‰",
            "lineNumber": 113
          },
          {
            "text": "        return False",
            "lineNumber": 114
          },
          {
            "lineNumber": 115
          },
          {
            "text": "    def validate_output_size(self, toon_text: str) -&gt; tuple[bool, str]:",
            "lineNumber": 116
          },
          {
            "text": "        ",
            "lineNumber": 117
          }
        ]
      },
      "score": 0.22205069661140442
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\Project.md",
        "range": {
          "startPosition": {
            "line": 28
          },
          "endPosition": {
            "line": 71
          }
        },
        "contents": "### 3.2 è¦–è¦šçš„æ‹¡å¼µï¼ˆå›³è§£ï¼‰æ©Ÿèƒ½\n\n* **Mermaid.jsã«ã‚ˆã‚‹æç”»:** TOONã®å„ã‚¿ã‚¤ãƒ—ã‚’ç‰¹å®šã®å½¢çŠ¶ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦è¡¨ç¤ºã™ã‚‹ã€‚\n* **ã€Œè«–ç†ã®ç©´ã€ã®æ¤œçŸ¥:** å‡ºå£ã®ãªã„åˆ†å²ã‚„ã€æ¥ç¶šå…ˆãŒæœªå®šç¾©ã®ãƒãƒ¼ãƒ‰ã‚’ &#96;MISSING&#96;ï¼ˆå…­è§’å½¢ãƒ»èµ¤è‰²ï¼‰ã¨ã—ã¦å¼·èª¿è¡¨ç¤ºã™ã‚‹ã€‚\n* **ã‚¹ã‚¿ã‚¤ãƒ«åˆ¶å¾¡:** ç¾åœ¨é€²è¡Œä¸­ã®ãƒãƒ¼ãƒ‰ã‚„å®Œäº†ã—ãŸå·¥ç¨‹ã‚’è‰²åˆ†ã‘ã—ã¦è¦–è¦šçš„ã«å¼·èª¿ã™ã‚‹ã€‚\n\n### 3.3 çŠ¶æ…‹ç®¡ç†æ©Ÿèƒ½\n\n* Streamlitã® &#96;session_state&#96; ã‚’åˆ©ç”¨ã—ã€å¯¾è©±ã®é€²æ—ã¨TOONã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’åŒæœŸã™ã‚‹ã€‚\n\n---\n\n## 4. ãƒ‡ãƒ¼ã‚¿å®šç¾©ï¼ˆTOON-Mermaid ãƒãƒƒãƒ”ãƒ³ã‚°ï¼‰\n\nç¾å ´ä½œæ¥­ã§ã®ã€Œè¦‹ã‚„ã™ã•ã€ã¨ã€Œç›´æ„Ÿæ€§ã€ã‚’é‡è¦–ã—ãŸå®šç¾©ã‚’æ¡ç”¨ã™ã‚‹ã€‚\n\n| ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ— | Mermaidå½¢çŠ¶ | è¨˜æ³• | æ„å‘³ãƒ»å½¹å‰² |\n| --- | --- | --- | --- |\n| **START/END** | ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ | &#96;([ ])&#96; | ãƒ•ãƒ­ãƒ¼ã®èµ·ç‚¹ãƒ»çµ‚ç€ç‚¹ã€‚ |\n| **PROCESS** | é•·æ–¹å½¢ | &#96;[ ]&#96; | å…·ä½“çš„ãªä½œæ¥­å†…å®¹ã‚„å‘½ä»¤ã€‚ |\n| **DECISION** | è±å½¢ | &#96;{ }&#96; | æ¡ä»¶åˆ†å²ã€‚Yes/Noãªã©ã®ãƒ«ãƒ¼ãƒˆåˆ†ã‘ã€‚ |\n| **IO_DATA** | å¹³è¡Œå››è¾ºå½¢ | &#96;[/ /]&#96; | ç”»é¢å…¥åŠ›ã‚„æ‰‹å‹•æ“ä½œã€‚ |\n| **STORAGE** | å††ç­’å½¢ | &#96;[( )]&#96; | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ“ä½œã€‚ |\n| **MISSING** | å…­è§’å½¢ï¼ˆèµ¤ï¼‰ | &#96;{{ }}&#96; | **æœªå®Ÿè£…ãƒ»è¦æ¤œè¨ç®‡æ‰€ã€‚** |\n\n---\n\n## 5. UI/UX è¨­è¨ˆæ¡ˆ\n\nç¾å ´ã§ã®ä½œæ¥­åŠ¹ç‡ã‚’æœ€å¤§åŒ–ã™ã‚‹ã€Œ3ãƒšã‚¤ãƒ³æ§‹æˆã€ã‚’æƒ³å®šã™ã‚‹ã€‚\n\n1. **å·¦ãƒšã‚¤ãƒ³ï¼ˆChatï¼‰:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒAIã¨å¯¾è©±ã™ã‚‹ã‚¨ãƒªã‚¢ã€‚\n2. **ä¸­å¤®ãƒšã‚¤ãƒ³ï¼ˆFlowchartï¼‰:** Mermaid.jsã«ã‚ˆã£ã¦æç”»ã•ã‚Œã‚‹å‹•çš„ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã€‚\n3. **å³ãƒšã‚¤ãƒ³ï¼ˆSourceï¼‰:** ç¾åœ¨ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã€‚\n\n---\n\n## 6. éæ©Ÿèƒ½è¦ä»¶\n\n* **æ‹¡å¼µæ€§:** TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…±é€šè¨€èªã¨ã™ã‚‹ã“ã¨ã§ã€å°†æ¥çš„ã«Pythonã‚³ãƒ¼ãƒ‰ã®è‡ªå‹•ç”Ÿæˆæ©Ÿèƒ½ãªã©ã‚’è¿½åŠ å¯èƒ½ã«ã™ã‚‹ã€‚\n* **å …ç‰¢æ€§:** è»½é‡LLMãŒãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ãŸå ´åˆã§ã‚‚ã€ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ã«ã‚ˆã£ã¦å›³è§£ãŒå´©ã‚Œã‚‹ã®ã‚’é˜²æ­¢ã™ã‚‹ã€‚\n* **è»½é‡åŒ–:** 2æ®µéšç›®ã®è§£æã«Gemma:4bç­‰ã®å°å‹ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®é«˜é€ŸåŒ–ã‚’å›³ã‚‹ã€‚",
        "signatures": {},
        "detailedLines": [
          {
            "text": "### 3.2 è¦–è¦šçš„æ‹¡å¼µï¼ˆå›³è§£ï¼‰æ©Ÿèƒ½",
            "lineNumber": 30
          },
          {
            "lineNumber": 31
          },
          {
            "text": "* **Mermaid.jsã«ã‚ˆã‚‹æç”»:** TOONã®å„ã‚¿ã‚¤ãƒ—ã‚’ç‰¹å®šã®å½¢çŠ¶ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦è¡¨ç¤ºã™ã‚‹ã€‚",
            "lineNumber": 32
          },
          {
            "text": "* **ã€Œè«–ç†ã®ç©´ã€ã®æ¤œçŸ¥:** å‡ºå£ã®ãªã„åˆ†å²ã‚„ã€æ¥ç¶šå…ˆãŒæœªå®šç¾©ã®ãƒãƒ¼ãƒ‰ã‚’ &#96;MISSING&#96;ï¼ˆå…­è§’å½¢ãƒ»èµ¤è‰²ï¼‰ã¨ã—ã¦å¼·èª¿è¡¨ç¤ºã™ã‚‹ã€‚",
            "lineNumber": 33
          },
          {
            "text": "* **ã‚¹ã‚¿ã‚¤ãƒ«åˆ¶å¾¡:** ç¾åœ¨é€²è¡Œä¸­ã®ãƒãƒ¼ãƒ‰ã‚„å®Œäº†ã—ãŸå·¥ç¨‹ã‚’è‰²åˆ†ã‘ã—ã¦è¦–è¦šçš„ã«å¼·èª¿ã™ã‚‹ã€‚",
            "lineNumber": 34
          },
          {
            "lineNumber": 35
          },
          {
            "text": "### 3.3 çŠ¶æ…‹ç®¡ç†æ©Ÿèƒ½",
            "lineNumber": 36
          },
          {
            "lineNumber": 37
          },
          {
            "text": "* Streamlitã® &#96;session_state&#96; ã‚’åˆ©ç”¨ã—ã€å¯¾è©±ã®é€²æ—ã¨TOONã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’åŒæœŸã™ã‚‹ã€‚",
            "lineNumber": 38
          },
          {
            "lineNumber": 39
          },
          {
            "text": "---",
            "lineNumber": 40
          },
          {
            "lineNumber": 41
          },
          {
            "text": "## 4. ãƒ‡ãƒ¼ã‚¿å®šç¾©ï¼ˆTOON-Mermaid ãƒãƒƒãƒ”ãƒ³ã‚°ï¼‰",
            "lineNumber": 42
          },
          {
            "lineNumber": 43
          },
          {
            "text": "ç¾å ´ä½œæ¥­ã§ã®ã€Œè¦‹ã‚„ã™ã•ã€ã¨ã€Œç›´æ„Ÿæ€§ã€ã‚’é‡è¦–ã—ãŸå®šç¾©ã‚’æ¡ç”¨ã™ã‚‹ã€‚",
            "lineNumber": 44
          },
          {
            "lineNumber": 45
          },
          {
            "text": "| ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ— | Mermaidå½¢çŠ¶ | è¨˜æ³• | æ„å‘³ãƒ»å½¹å‰² |",
            "lineNumber": 46
          },
          {
            "text": "| --- | --- | --- | --- |",
            "lineNumber": 47
          },
          {
            "text": "| **START/END** | ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ | &#96;([ ])&#96; | ãƒ•ãƒ­ãƒ¼ã®èµ·ç‚¹ãƒ»çµ‚ç€ç‚¹ã€‚ |",
            "lineNumber": 48
          },
          {
            "text": "| **PROCESS** | é•·æ–¹å½¢ | &#96;[ ]&#96; | å…·ä½“çš„ãªä½œæ¥­å†…å®¹ã‚„å‘½ä»¤ã€‚ |",
            "lineNumber": 49
          },
          {
            "text": "| **DECISION** | è±å½¢ | &#96;{ }&#96; | æ¡ä»¶åˆ†å²ã€‚Yes/Noãªã©ã®ãƒ«ãƒ¼ãƒˆåˆ†ã‘ã€‚ |",
            "lineNumber": 50
          },
          {
            "text": "| **IO_DATA** | å¹³è¡Œå››è¾ºå½¢ | &#96;[/ /]&#96; | ç”»é¢å…¥åŠ›ã‚„æ‰‹å‹•æ“ä½œã€‚ |",
            "lineNumber": 51
          },
          {
            "text": "| **STORAGE** | å††ç­’å½¢ | &#96;[( )]&#96; | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ“ä½œã€‚ |",
            "lineNumber": 52
          },
          {
            "text": "| **MISSING** | å…­è§’å½¢ï¼ˆèµ¤ï¼‰ | &#96;{{ }}&#96; | **æœªå®Ÿè£…ãƒ»è¦æ¤œè¨ç®‡æ‰€ã€‚** |",
            "lineNumber": 53
          },
          {
            "lineNumber": 54
          },
          {
            "text": "---",
            "lineNumber": 55
          },
          {
            "lineNumber": 56
          },
          {
            "text": "## 5. UI/UX è¨­è¨ˆæ¡ˆ",
            "lineNumber": 57
          },
          {
            "lineNumber": 58
          },
          {
            "text": "ç¾å ´ã§ã®ä½œæ¥­åŠ¹ç‡ã‚’æœ€å¤§åŒ–ã™ã‚‹ã€Œ3ãƒšã‚¤ãƒ³æ§‹æˆã€ã‚’æƒ³å®šã™ã‚‹ã€‚",
            "lineNumber": 59
          },
          {
            "lineNumber": 60
          },
          {
            "text": "1. **å·¦ãƒšã‚¤ãƒ³ï¼ˆChatï¼‰:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒAIã¨å¯¾è©±ã™ã‚‹ã‚¨ãƒªã‚¢ã€‚",
            "lineNumber": 61
          },
          {
            "text": "2. **ä¸­å¤®ãƒšã‚¤ãƒ³ï¼ˆFlowchartï¼‰:** Mermaid.jsã«ã‚ˆã£ã¦æç”»ã•ã‚Œã‚‹å‹•çš„ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã€‚",
            "lineNumber": 62
          },
          {
            "text": "3. **å³ãƒšã‚¤ãƒ³ï¼ˆSourceï¼‰:** ç¾åœ¨ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã€‚",
            "lineNumber": 63
          },
          {
            "lineNumber": 64
          },
          {
            "text": "---",
            "lineNumber": 65
          },
          {
            "lineNumber": 66
          },
          {
            "text": "## 6. éæ©Ÿèƒ½è¦ä»¶",
            "lineNumber": 67
          },
          {
            "lineNumber": 68
          },
          {
            "text": "* **æ‹¡å¼µæ€§:** TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…±é€šè¨€èªã¨ã™ã‚‹ã“ã¨ã§ã€å°†æ¥çš„ã«Pythonã‚³ãƒ¼ãƒ‰ã®è‡ªå‹•ç”Ÿæˆæ©Ÿèƒ½ãªã©ã‚’è¿½åŠ å¯èƒ½ã«ã™ã‚‹ã€‚",
            "lineNumber": 69
          },
          {
            "text": "* **å …ç‰¢æ€§:** è»½é‡LLMãŒãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ãŸå ´åˆã§ã‚‚ã€ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ã«ã‚ˆã£ã¦å›³è§£ãŒå´©ã‚Œã‚‹ã®ã‚’é˜²æ­¢ã™ã‚‹ã€‚",
            "lineNumber": 70
          },
          {
            "text": "* **è»½é‡åŒ–:** 2æ®µéšç›®ã®è§£æã«Gemma:4bç­‰ã®å°å‹ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®é«˜é€ŸåŒ–ã‚’å›³ã‚‹ã€‚",
            "lineNumber": 71
          }
        ]
      },
      "score": 0.21806365251541138
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 445,
            "column": 62
          },
          "endPosition": {
            "line": 492,
            "column": 25
          }
        },
        "contents": "with col_flow:\n    st.subheader(\"ğŸ“Š ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ\")\n    # Mermaidæç”»å‡¦ç†\n    mermaid_code = current_flow.to_mermaid()\n    b64_mermaid = base64.b64encode(mermaid_code.encode('utf-8')).decode('utf-8')\n\n    html_path = Path(\"frontend/index.html\")\n    if html_path.exists():\n        html_content = html_path.read_text(encoding='utf-8')\n        components.html(\n            f\"\"\"\n            {html_content}\n            &lt;script&gt;\n                window.onload = () =&gt; {{\n                    window.postMessage({{ \n                        type: \"render\", \n                        base64Code: \"{b64_mermaid}\" \n                    }}, \"*\");\n                }};\n            &lt;/script&gt;\n            \"\"\",\n            height=800,\n            scrolling=True,\n        )\n    else:\n        st.error(\"frontend/index.html ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\")\n\nwith col_source:\n    st.subheader(\"ğŸ“„ TOONå½¢å¼ï¼ˆSourceï¼‰\")\n    \n    # TOONå½¢å¼ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ\n    toon_text = current_flow.to_toon_format()\n    \n    with st.expander(\"TOONå½¢å¼ã‚’è¡¨ç¤º\", expanded=True):\n        st.code(toon_text, language=\"markdown\")\n    \n    # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³\n    st.download_button(\n        label=\"ğŸ“¥ TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\",\n        data=toon_text,\n        file_name=f\"{session_name}_toon.md\",\n        mime=\"text/markdown\"\n    )\n\nwith st.sidebar.expander(\"ç¾åœ¨ã®Mermaidã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤º\"):\n    st.code(mermaid_code)",
        "signatures": {},
        "detailedLines": [
          {
            "text": "with col_flow:",
            "lineNumber": 448
          },
          {
            "text": "    st.subheader(\"ğŸ“Š ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ\")",
            "lineNumber": 449
          },
          {
            "text": "    # Mermaidæç”»å‡¦ç†",
            "lineNumber": 450
          },
          {
            "text": "    mermaid_code = current_flow.to_mermaid()",
            "lineNumber": 451
          },
          {
            "text": "    b64_mermaid = base64.b64encode(mermaid_code.encode('utf-8')).decode('utf-8')",
            "lineNumber": 452
          },
          {
            "lineNumber": 453
          },
          {
            "text": "    html_path = Path(\"frontend/index.html\")",
            "lineNumber": 454
          },
          {
            "text": "    if html_path.exists():",
            "lineNumber": 455
          },
          {
            "text": "        html_content = html_path.read_text(encoding='utf-8')",
            "lineNumber": 456
          },
          {
            "text": "        components.html(",
            "lineNumber": 457
          },
          {
            "text": "            f\"\"\"",
            "lineNumber": 458
          },
          {
            "text": "            {html_content}",
            "lineNumber": 459
          },
          {
            "text": "            &lt;script&gt;",
            "lineNumber": 460
          },
          {
            "text": "                window.onload = () =&gt; {{",
            "lineNumber": 461
          },
          {
            "text": "                    window.postMessage({{ ",
            "lineNumber": 462
          },
          {
            "text": "                        type: \"render\", ",
            "lineNumber": 463
          },
          {
            "text": "                        base64Code: \"{b64_mermaid}\" ",
            "lineNumber": 464
          },
          {
            "text": "                    }}, \"*\");",
            "lineNumber": 465
          },
          {
            "text": "                }};",
            "lineNumber": 466
          },
          {
            "text": "            &lt;/script&gt;",
            "lineNumber": 467
          },
          {
            "text": "            \"\"\",",
            "lineNumber": 468
          },
          {
            "text": "            height=800,",
            "lineNumber": 469
          },
          {
            "text": "            scrolling=True,",
            "lineNumber": 470
          },
          {
            "text": "        )",
            "lineNumber": 471
          },
          {
            "text": "    else:",
            "lineNumber": 472
          },
          {
            "text": "        st.error(\"frontend/index.html ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\")",
            "lineNumber": 473
          },
          {
            "lineNumber": 474
          },
          {
            "text": "with col_source:",
            "lineNumber": 475
          },
          {
            "text": "    st.subheader(\"ğŸ“„ TOONå½¢å¼ï¼ˆSourceï¼‰\")",
            "lineNumber": 476
          },
          {
            "text": "    ",
            "lineNumber": 477
          },
          {
            "text": "    # TOONå½¢å¼ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ",
            "lineNumber": 478
          },
          {
            "text": "    toon_text = current_flow.to_toon_format()",
            "lineNumber": 479
          },
          {
            "text": "    ",
            "lineNumber": 480
          },
          {
            "text": "    with st.expander(\"TOONå½¢å¼ã‚’è¡¨ç¤º\", expanded=True):",
            "lineNumber": 481
          },
          {
            "text": "        st.code(toon_text, language=\"markdown\")",
            "lineNumber": 482
          },
          {
            "text": "    ",
            "lineNumber": 483
          },
          {
            "text": "    # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³",
            "lineNumber": 484
          },
          {
            "text": "    st.download_button(",
            "lineNumber": 485
          },
          {
            "text": "        label=\"ğŸ“¥ TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\",",
            "lineNumber": 486
          },
          {
            "text": "        data=toon_text,",
            "lineNumber": 487
          },
          {
            "text": "        file_name=f\"{session_name}_toon.md\",",
            "lineNumber": 488
          },
          {
            "text": "        mime=\"text/markdown\"",
            "lineNumber": 489
          },
          {
            "text": "    )",
            "lineNumber": 490
          },
          {
            "lineNumber": 491
          },
          {
            "text": "with st.sidebar.expander(\"ç¾åœ¨ã®Mermaidã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤º\"):",
            "lineNumber": 492
          },
          {
            "text": "    st.code(mermaid_code)",
            "lineNumber": 493
          }
        ]
      },
      "score": 0.2156984955072403
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 23
          },
          "endPosition": {
            "line": 271,
            "column": 31
          }
        },
        "contents": "class Flowchart(BaseModel):\ndef to_mermaid(self) -&gt; str:\n\n        \n        # ã‚¨ãƒƒã‚¸å®šç¾©\n        for e in self.edges:\n            # ã‚¨ãƒƒã‚¸ï¼ˆæ¥ç¶šç·šï¼‰ã®IDã‚‚åŒæ§˜ã«å¤‰æ›\n            src = f\"n_{e.source}\" if e.source == \"end\" else e.source\n            tgt = f\"n_{e.target}\" if e.target == \"end\" else e.target\n            \n            if e.label:\n                lines.append(f'{src}--&gt;|\"{e.label}\"|{tgt}')\n            else:\n                lines.append(f'{src}--&gt;{tgt}')\n        \n        # ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©ã‚’è¿½åŠ \n        if style_lines:\n            lines.append(\"\")\n            lines.extend(style_lines)\n            \n        return \"\\n\".join(lines)\n\n    def to_toon_format(self) -&gt; str:\n        \"\"\"Flowchartã‚’TOONå½¢å¼ï¼ˆMarkdownï¼‰ã«å¤‰æ›\"\"\"\n        lines = []\n        \n        # ãƒãƒ¼ãƒ‰å®šç¾©\n        for node in self.nodes:\n            lines.append(\"[Node]\")\n            lines.append(f\"id: {node.id}\")\n            lines.append(f\"label: {node.label}\")\n            lines.append(f\"type: {node.type}\")\n            if node.status != NodeStatus.ACTIVE:\n                lines.append(f\"status: {node.status.value}\")\n            lines.append(\"\")\n        \n        # ã‚¨ãƒƒã‚¸å®šç¾©\n        for edge in self.edges:\n            lines.append(\"[Edge]\")\n            lines.append(f\"source: {edge.source}\")\n            lines.append(f\"target: {edge.target}\")\n            if edge.label:\n                lines.append(f\"label: {edge.label}\")\n            lines.append(\"\")\n        \n        return \"\\n\".join(lines)",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 24,
                "column": 1
              },
              "endPosition": {
                "line": 25,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 199,
                "column": 5
              },
              "endPosition": {
                "line": 200,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 24,
            "isSignature": true
          },
          {
            "text": "def to_mermaid(self) -&gt; str:",
            "lineNumber": 199
          },
          {
            "lineNumber": 229
          },
          {
            "text": "        ",
            "lineNumber": 230
          },
          {
            "text": "        # ã‚¨ãƒƒã‚¸å®šç¾©",
            "lineNumber": 231
          },
          {
            "text": "        for e in self.edges:",
            "lineNumber": 232
          },
          {
            "text": "            # ã‚¨ãƒƒã‚¸ï¼ˆæ¥ç¶šç·šï¼‰ã®IDã‚‚åŒæ§˜ã«å¤‰æ›",
            "lineNumber": 233
          },
          {
            "text": "            src = f\"n_{e.source}\" if e.source == \"end\" else e.source",
            "lineNumber": 234
          },
          {
            "text": "            tgt = f\"n_{e.target}\" if e.target == \"end\" else e.target",
            "lineNumber": 235
          },
          {
            "text": "            ",
            "lineNumber": 236
          },
          {
            "text": "            if e.label:",
            "lineNumber": 237
          },
          {
            "text": "                lines.append(f'{src}--&gt;|\"{e.label}\"|{tgt}')",
            "lineNumber": 238
          },
          {
            "text": "            else:",
            "lineNumber": 239
          },
          {
            "text": "                lines.append(f'{src}--&gt;{tgt}')",
            "lineNumber": 240
          },
          {
            "text": "        ",
            "lineNumber": 241
          },
          {
            "text": "        # ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©ã‚’è¿½åŠ ",
            "lineNumber": 242
          },
          {
            "text": "        if style_lines:",
            "lineNumber": 243
          },
          {
            "text": "            lines.append(\"\")",
            "lineNumber": 244
          },
          {
            "text": "            lines.extend(style_lines)",
            "lineNumber": 245
          },
          {
            "text": "            ",
            "lineNumber": 246
          },
          {
            "text": "        return \"\\n\".join(lines)",
            "lineNumber": 247
          },
          {
            "lineNumber": 248
          },
          {
            "text": "    def to_toon_format(self) -&gt; str:",
            "lineNumber": 249
          },
          {
            "text": "        \"\"\"Flowchartã‚’TOONå½¢å¼ï¼ˆMarkdownï¼‰ã«å¤‰æ›\"\"\"",
            "lineNumber": 250
          },
          {
            "text": "        lines = []",
            "lineNumber": 251
          },
          {
            "text": "        ",
            "lineNumber": 252
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰å®šç¾©",
            "lineNumber": 253
          },
          {
            "text": "        for node in self.nodes:",
            "lineNumber": 254
          },
          {
            "text": "            lines.append(\"[Node]\")",
            "lineNumber": 255
          },
          {
            "text": "            lines.append(f\"id: {node.id}\")",
            "lineNumber": 256
          },
          {
            "text": "            lines.append(f\"label: {node.label}\")",
            "lineNumber": 257
          },
          {
            "text": "            lines.append(f\"type: {node.type}\")",
            "lineNumber": 258
          },
          {
            "text": "            if node.status != NodeStatus.ACTIVE:",
            "lineNumber": 259
          },
          {
            "text": "                lines.append(f\"status: {node.status.value}\")",
            "lineNumber": 260
          },
          {
            "text": "            lines.append(\"\")",
            "lineNumber": 261
          },
          {
            "text": "        ",
            "lineNumber": 262
          },
          {
            "text": "        # ã‚¨ãƒƒã‚¸å®šç¾©",
            "lineNumber": 263
          },
          {
            "text": "        for edge in self.edges:",
            "lineNumber": 264
          },
          {
            "text": "            lines.append(\"[Edge]\")",
            "lineNumber": 265
          },
          {
            "text": "            lines.append(f\"source: {edge.source}\")",
            "lineNumber": 266
          },
          {
            "text": "            lines.append(f\"target: {edge.target}\")",
            "lineNumber": 267
          },
          {
            "text": "            if edge.label:",
            "lineNumber": 268
          },
          {
            "text": "                lines.append(f\"label: {edge.label}\")",
            "lineNumber": 269
          },
          {
            "text": "            lines.append(\"\")",
            "lineNumber": 270
          },
          {
            "text": "        ",
            "lineNumber": 271
          },
          {
            "text": "        return \"\\n\".join(lines)",
            "lineNumber": 272,
            "isSignature": true
          }
        ]
      },
      "score": 0.21216213703155518
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\program_base.md",
        "range": {
          "startPosition": {
            "line": 40
          },
          "endPosition": {
            "line": 93
          }
        },
        "contents": "* Markdownå½¢å¼ã®TOONã‚’æ­£è¦è¡¨ç¾ï¼ˆRegexï¼‰ãªã©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã€&#96;models.py&#96; ã§å®šç¾©ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚¹ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚\n* **ã€Œå·®åˆ†ï¼ˆLOGï¼‰ã€ã®åæ˜ ãƒ­ã‚¸ãƒƒã‚¯**ã‚‚ã“ã“ã«æŒã¡ã¾ã™ã€‚å¤ã„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«LOGã®å†…å®¹ã‚’ä¸Šæ›¸ãã—ã¦ã€æœ€æ–°ã®çŠ¶æ…‹ã‚’ä½œã‚‹è²¬ä»»è€…ã§ã™ã€‚\n\n### â‘¢ &#96;generator/mermaid_gen.py&#96;\n\n**è²¬ä»»ï¼šè¦–è¦šåŒ–ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰**\n\n* &#96;models.py&#96; ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å—ã‘å–ã‚Šã€è¦å®šã—ãŸå¯¾å¿œè¡¨ã«åŸºã¥ã„ã¦ Mermaid æ§‹æ–‡ï¼ˆ&#96;([ ])&#96;, &#96;{ }&#96;ãªã©ï¼‰ã®æ–‡å­—åˆ—ã‚’çµ„ã¿ç«‹ã¦ã¾ã™ã€‚\n* ãƒãƒ¼ãƒ‰ã®è‰²ä»˜ã‘ï¼ˆ&#96;style&#96; æ§‹æ–‡ï¼‰ã®æ³¨å…¥ã‚‚ã“ã“ã§è¡Œã„ã¾ã™ã€‚\n\n### â‘£ &#96;llm/agent.py&#96;\n\n**è²¬ä»»ï¼šAIã¨ã®æ„æ€ç–é€š**\n\n* å¤§å‹LLMï¼ˆGPT-4oç­‰ï¼‰ã«å¯¾ã—ã€ç¾åœ¨ã®TOONã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’æ¸¡ã—ã€**ã€Œæ–°ã—ã„TOONã®å·®åˆ†è¡Œã€**ã‚’ç”Ÿæˆã•ã›ã¾ã™ã€‚\n* ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ç®¡ç†ã‚‚ã“ã“ã§è¡Œã„ã¾ã™ã€‚\n\n### â‘¤ &#96;app.py&#96;\n\n**è²¬ä»»ï¼šUIè¡¨ç¤ºã¨çŠ¶æ…‹ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**\n\n* Streamlitã®ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€‚\n* &#96;st.session_state&#96; ã‚’ä½¿ã„ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’å—ã‘ã¦ &#96;agent&#96; â†’ &#96;parser&#96; â†’ &#96;generator&#96; ã®é †ã«å‘¼ã³å‡ºã™å¸ä»¤å¡”ã§ã™ã€‚\n\n---\n\n## 3. ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å‹•ä½œãƒ•ãƒ­ãƒ¼ï¼ˆå›³è§£ï¼‰\n\n1ãƒ•ã‚¡ã‚¤ãƒ«1è²¬ä»»ã‚’å¾¹åº•ã™ã‚‹ã“ã¨ã§ã€æƒ…å ±ã®æµã‚ŒãŒä¸€æœ¬é“ã«ãªã‚Šã€ãƒ‡ãƒãƒƒã‚°ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚\n\n&#96;&#96;&#96;mermaid\ngraph LR\n    User([ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›]) --&gt; App[app.py]\n    App --&gt; Agent[llm/agent.py]\n    Agent --&gt;|TOONå·®åˆ†| Parser[parser/toon_parser.py]\n    Parser --&gt;|æœ€æ–°ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«| App\n    App --&gt; Gen[generator/mermaid_gen.py]\n    Gen --&gt;|Mermaidæ–‡å­—åˆ—| App\n    App --&gt; UI[ğŸ–¥ï¸ Streamlitè¡¨ç¤º]\n\n    subgraph Data\n        Parser -.-&gt; Snapshot[(TOON.md)]\n    end\n\n&#96;&#96;&#96;\n\n---\n\n## 4. ã“ã®æ§‹é€ ã®ãƒ¡ãƒªãƒƒãƒˆ\n\n* **äº¤æ›å¯èƒ½æ€§:** ã€ŒMermaidã§ã¯ãªãåˆ¥ã®å›³è§£ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã„ãŸã„ã€ã¨æ€ã£ãŸã‚‰ã€&#96;mermaid_gen.py&#96; ã ã‘ã‚’æ›¸ãæ›ãˆã‚Œã°æ¸ˆã¿ã¾ã™ã€‚\n* **ãƒ†ã‚¹ãƒˆã®å®¹æ˜“ã•:** AIãŒã„ãªãã¦ã‚‚ã€&#96;template.md&#96; ã‚’ &#96;toon_parser.py&#96; ã«èª­ã¿è¾¼ã¾ã›ã‚‹ã ã‘ã§ã€å›³è§£ãƒ­ã‚¸ãƒƒã‚¯ãŒæ­£ã—ã„ã‹ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚",
        "signatures": {},
        "detailedLines": [
          {
            "text": "* Markdownå½¢å¼ã®TOONã‚’æ­£è¦è¡¨ç¾ï¼ˆRegexï¼‰ãªã©ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã€&#96;models.py&#96; ã§å®šç¾©ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚¹ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚",
            "lineNumber": 42
          },
          {
            "text": "* **ã€Œå·®åˆ†ï¼ˆLOGï¼‰ã€ã®åæ˜ ãƒ­ã‚¸ãƒƒã‚¯**ã‚‚ã“ã“ã«æŒã¡ã¾ã™ã€‚å¤ã„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«LOGã®å†…å®¹ã‚’ä¸Šæ›¸ãã—ã¦ã€æœ€æ–°ã®çŠ¶æ…‹ã‚’ä½œã‚‹è²¬ä»»è€…ã§ã™ã€‚",
            "lineNumber": 43
          },
          {
            "lineNumber": 44
          },
          {
            "text": "### â‘¢ &#96;generator/mermaid_gen.py&#96;",
            "lineNumber": 45
          },
          {
            "lineNumber": 46
          },
          {
            "text": "**è²¬ä»»ï¼šè¦–è¦šåŒ–ã‚³ãƒ¼ãƒ‰ã®å‡ºåŠ›ï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰**",
            "lineNumber": 47
          },
          {
            "lineNumber": 48
          },
          {
            "text": "* &#96;models.py&#96; ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å—ã‘å–ã‚Šã€è¦å®šã—ãŸå¯¾å¿œè¡¨ã«åŸºã¥ã„ã¦ Mermaid æ§‹æ–‡ï¼ˆ&#96;([ ])&#96;, &#96;{ }&#96;ãªã©ï¼‰ã®æ–‡å­—åˆ—ã‚’çµ„ã¿ç«‹ã¦ã¾ã™ã€‚",
            "lineNumber": 49
          },
          {
            "text": "* ãƒãƒ¼ãƒ‰ã®è‰²ä»˜ã‘ï¼ˆ&#96;style&#96; æ§‹æ–‡ï¼‰ã®æ³¨å…¥ã‚‚ã“ã“ã§è¡Œã„ã¾ã™ã€‚",
            "lineNumber": 50
          },
          {
            "lineNumber": 51
          },
          {
            "text": "### â‘£ &#96;llm/agent.py&#96;",
            "lineNumber": 52
          },
          {
            "lineNumber": 53
          },
          {
            "text": "**è²¬ä»»ï¼šAIã¨ã®æ„æ€ç–é€š**",
            "lineNumber": 54
          },
          {
            "lineNumber": 55
          },
          {
            "text": "* å¤§å‹LLMï¼ˆGPT-4oç­‰ï¼‰ã«å¯¾ã—ã€ç¾åœ¨ã®TOONã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’æ¸¡ã—ã€**ã€Œæ–°ã—ã„TOONã®å·®åˆ†è¡Œã€**ã‚’ç”Ÿæˆã•ã›ã¾ã™ã€‚",
            "lineNumber": 56
          },
          {
            "text": "* ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ç®¡ç†ã‚‚ã“ã“ã§è¡Œã„ã¾ã™ã€‚",
            "lineNumber": 57
          },
          {
            "lineNumber": 58
          },
          {
            "text": "### â‘¤ &#96;app.py&#96;",
            "lineNumber": 59
          },
          {
            "lineNumber": 60
          },
          {
            "text": "**è²¬ä»»ï¼šUIè¡¨ç¤ºã¨çŠ¶æ…‹ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**",
            "lineNumber": 61
          },
          {
            "lineNumber": 62
          },
          {
            "text": "* Streamlitã®ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€‚",
            "lineNumber": 63
          },
          {
            "text": "* &#96;st.session_state&#96; ã‚’ä½¿ã„ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’å—ã‘ã¦ &#96;agent&#96; â†’ &#96;parser&#96; â†’ &#96;generator&#96; ã®é †ã«å‘¼ã³å‡ºã™å¸ä»¤å¡”ã§ã™ã€‚",
            "lineNumber": 64
          },
          {
            "lineNumber": 65
          },
          {
            "text": "---",
            "lineNumber": 66
          },
          {
            "lineNumber": 67
          },
          {
            "text": "## 3. ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å‹•ä½œãƒ•ãƒ­ãƒ¼ï¼ˆå›³è§£ï¼‰",
            "lineNumber": 68
          },
          {
            "lineNumber": 69
          },
          {
            "text": "1ãƒ•ã‚¡ã‚¤ãƒ«1è²¬ä»»ã‚’å¾¹åº•ã™ã‚‹ã“ã¨ã§ã€æƒ…å ±ã®æµã‚ŒãŒä¸€æœ¬é“ã«ãªã‚Šã€ãƒ‡ãƒãƒƒã‚°ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚",
            "lineNumber": 70
          },
          {
            "lineNumber": 71
          },
          {
            "text": "&#96;&#96;&#96;mermaid",
            "lineNumber": 72
          },
          {
            "text": "graph LR",
            "lineNumber": 73
          },
          {
            "text": "    User([ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›]) --&gt; App[app.py]",
            "lineNumber": 74
          },
          {
            "text": "    App --&gt; Agent[llm/agent.py]",
            "lineNumber": 75
          },
          {
            "text": "    Agent --&gt;|TOONå·®åˆ†| Parser[parser/toon_parser.py]",
            "lineNumber": 76
          },
          {
            "text": "    Parser --&gt;|æœ€æ–°ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«| App",
            "lineNumber": 77
          },
          {
            "text": "    App --&gt; Gen[generator/mermaid_gen.py]",
            "lineNumber": 78
          },
          {
            "text": "    Gen --&gt;|Mermaidæ–‡å­—åˆ—| App",
            "lineNumber": 79
          },
          {
            "text": "    App --&gt; UI[ğŸ–¥ï¸ Streamlitè¡¨ç¤º]",
            "lineNumber": 80
          },
          {
            "lineNumber": 81
          },
          {
            "text": "    subgraph Data",
            "lineNumber": 82
          },
          {
            "text": "        Parser -.-&gt; Snapshot[(TOON.md)]",
            "lineNumber": 83
          },
          {
            "text": "    end",
            "lineNumber": 84
          },
          {
            "lineNumber": 85
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 86
          },
          {
            "lineNumber": 87
          },
          {
            "text": "---",
            "lineNumber": 88
          },
          {
            "lineNumber": 89
          },
          {
            "text": "## 4. ã“ã®æ§‹é€ ã®ãƒ¡ãƒªãƒƒãƒˆ",
            "lineNumber": 90
          },
          {
            "lineNumber": 91
          },
          {
            "text": "* **äº¤æ›å¯èƒ½æ€§:** ã€ŒMermaidã§ã¯ãªãåˆ¥ã®å›³è§£ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã„ãŸã„ã€ã¨æ€ã£ãŸã‚‰ã€&#96;mermaid_gen.py&#96; ã ã‘ã‚’æ›¸ãæ›ãˆã‚Œã°æ¸ˆã¿ã¾ã™ã€‚",
            "lineNumber": 92
          },
          {
            "text": "* **ãƒ†ã‚¹ãƒˆã®å®¹æ˜“ã•:** AIãŒã„ãªãã¦ã‚‚ã€&#96;template.md&#96; ã‚’ &#96;toon_parser.py&#96; ã«èª­ã¿è¾¼ã¾ã›ã‚‹ã ã‘ã§ã€å›³è§£ãƒ­ã‚¸ãƒƒã‚¯ãŒæ­£ã—ã„ã‹ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚",
            "lineNumber": 93
          }
        ]
      },
      "score": 0.2097530961036682
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\history_mgr.py",
        "range": {
          "startPosition": {
            "line": 6
          },
          "endPosition": {
            "line": 175
          }
        },
        "contents": "class HistoryManager:\ndef load_session(self, session_id: str) -&gt; List[Flowchart]:\n\n                except Exception as e:\n                    # å€‹åˆ¥ã®Flowchartã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ãŸå ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—\n                    import warnings\n                    warnings.warn(f\"Flowchartã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")\n                    continue\n            \n            return flowcharts\n        except json.JSONDecodeError as e:\n            # JSONãƒ•ã‚¡ã‚¤ãƒ«ãŒç ´æã—ã¦ã„ã‚‹å ´åˆ\n            error_msg = f\"JSONãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«ãŒç ´æã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™: {e}\"\n            # ç ´æã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦å‰Šé™¤\n            try:\n                backup_path = file_path.with_suffix('.json.broken')\n                file_path.rename(backup_path)\n                error_msg += f\"\\nç ´æã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ '{backup_path}' ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸã€‚\"\n            except Exception:\n                pass\n            raise ValueError(error_msg) from e\n        except Exception as e:\n            raise ValueError(f\"ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\") from e\n\n    def save_toon_file(self, session_id: str, flowchart: Flowchart):\n        \"\"\"ç¾åœ¨ã®Flowchartã‚’TOONå½¢å¼ï¼ˆMarkdownï¼‰ã§ä¿å­˜ã—ã¾ã™ã€‚\"\"\"\n        file_path = self.toon_dir / f\"{session_id}.md\"\n        toon_text = flowchart.to_toon_format()\n        with open(file_path, \"w\", encoding=\"utf-8\") as f:\n            f.write(toon_text)\n\n    def load_toon_file(self, session_id: str) -&gt; Optional[Flowchart]:\n        \"\"\"",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 7,
                "column": 1
              },
              "endPosition": {
                "line": 8,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 22,
                "column": 5
              },
              "endPosition": {
                "line": 23,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class HistoryManager:",
            "lineNumber": 7,
            "isSignature": true
          },
          {
            "text": "def load_session(self, session_id: str) -&gt; List[Flowchart]:",
            "lineNumber": 22
          },
          {
            "lineNumber": 55
          },
          {
            "text": "                except Exception as e:",
            "lineNumber": 56
          },
          {
            "text": "                    # å€‹åˆ¥ã®Flowchartã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ãŸå ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—",
            "lineNumber": 57
          },
          {
            "text": "                    import warnings",
            "lineNumber": 58
          },
          {
            "text": "                    warnings.warn(f\"Flowchartã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 59
          },
          {
            "text": "                    continue",
            "lineNumber": 60
          },
          {
            "text": "            ",
            "lineNumber": 61
          },
          {
            "text": "            return flowcharts",
            "lineNumber": 62
          },
          {
            "text": "        except json.JSONDecodeError as e:",
            "lineNumber": 63
          },
          {
            "text": "            # JSONãƒ•ã‚¡ã‚¤ãƒ«ãŒç ´æã—ã¦ã„ã‚‹å ´åˆ",
            "lineNumber": 64
          },
          {
            "text": "            error_msg = f\"JSONãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«ãŒç ´æã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™: {e}\"",
            "lineNumber": 65
          },
          {
            "text": "            # ç ´æã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦å‰Šé™¤",
            "lineNumber": 66
          },
          {
            "text": "            try:",
            "lineNumber": 67
          },
          {
            "text": "                backup_path = file_path.with_suffix('.json.broken')",
            "lineNumber": 68
          },
          {
            "text": "                file_path.rename(backup_path)",
            "lineNumber": 69
          },
          {
            "text": "                error_msg += f\"\\nç ´æã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ '{backup_path}' ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸã€‚\"",
            "lineNumber": 70
          },
          {
            "text": "            except Exception:",
            "lineNumber": 71
          },
          {
            "text": "                pass",
            "lineNumber": 72
          },
          {
            "text": "            raise ValueError(error_msg) from e",
            "lineNumber": 73
          },
          {
            "text": "        except Exception as e:",
            "lineNumber": 74
          },
          {
            "text": "            raise ValueError(f\"ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\") from e",
            "lineNumber": 75
          },
          {
            "lineNumber": 76
          },
          {
            "text": "    def save_toon_file(self, session_id: str, flowchart: Flowchart):",
            "lineNumber": 77
          },
          {
            "text": "        \"\"\"ç¾åœ¨ã®Flowchartã‚’TOONå½¢å¼ï¼ˆMarkdownï¼‰ã§ä¿å­˜ã—ã¾ã™ã€‚\"\"\"",
            "lineNumber": 78
          },
          {
            "text": "        file_path = self.toon_dir / f\"{session_id}.md\"",
            "lineNumber": 79
          },
          {
            "text": "        toon_text = flowchart.to_toon_format()",
            "lineNumber": 80
          },
          {
            "text": "        with open(file_path, \"w\", encoding=\"utf-8\") as f:",
            "lineNumber": 81
          },
          {
            "text": "            f.write(toon_text)",
            "lineNumber": 82
          },
          {
            "lineNumber": 83
          },
          {
            "text": "    def load_toon_file(self, session_id: str) -&gt; Optional[Flowchart]:",
            "lineNumber": 84
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 85
          }
        ]
      },
      "score": 0.20710766315460205
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\tests\\test_toon_parser.py",
        "range": {
          "startPosition": {
            "line": 7
          },
          "endPosition": {
            "line": 111,
            "column": 69
          }
        },
        "contents": "class TestTOONParser:\n\n\n    def test_parse_empty_nodes(self):\n        toon_text = \"[Edge]\\nsource: start\\ntarget: end\"\n        with pytest.raises(TOONParseError, match=\"æœ‰åŠ¹ãªTOONå½¢å¼ã®ãƒãƒ¼ãƒ‰ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ\"):\n            TOONParser.parse(toon_text)\n\n    def test_parse_end_node_id_protection(self):\n        toon_text = \"\"\"\n[Node]\nid: end\nlabel: çµ‚äº†\ntype: end\n[Node]\nid: start\nlabel: é–‹å§‹\ntype: start\n[Edge]\nsource: start\ntarget: end\n\"\"\"\n        flowchart = TOONParser.parse(toon_text)\n        # 'end'ã¯'node_end'ã«å¤‰æ›ã•ã‚Œã‚‹\n        assert any(node.id == \"node_end\" for node in flowchart.nodes)",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 8,
                "column": 1
              },
              "endPosition": {
                "line": 9,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class TestTOONParser:",
            "lineNumber": 8,
            "isSignature": true
          },
          {
            "lineNumber": 89
          },
          {
            "lineNumber": 90
          },
          {
            "text": "    def test_parse_empty_nodes(self):",
            "lineNumber": 91
          },
          {
            "text": "        toon_text = \"[Edge]\\nsource: start\\ntarget: end\"",
            "lineNumber": 92
          },
          {
            "text": "        with pytest.raises(TOONParseError, match=\"æœ‰åŠ¹ãªTOONå½¢å¼ã®ãƒãƒ¼ãƒ‰ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ\"):",
            "lineNumber": 93
          },
          {
            "text": "            TOONParser.parse(toon_text)",
            "lineNumber": 94
          },
          {
            "lineNumber": 95
          },
          {
            "text": "    def test_parse_end_node_id_protection(self):",
            "lineNumber": 96
          },
          {
            "text": "        toon_text = \"\"\"",
            "lineNumber": 97
          },
          {
            "text": "[Node]",
            "lineNumber": 98
          },
          {
            "text": "id: end",
            "lineNumber": 99
          },
          {
            "text": "label: çµ‚äº†",
            "lineNumber": 100
          },
          {
            "text": "type: end",
            "lineNumber": 101
          },
          {
            "text": "[Node]",
            "lineNumber": 102
          },
          {
            "text": "id: start",
            "lineNumber": 103
          },
          {
            "text": "label: é–‹å§‹",
            "lineNumber": 104
          },
          {
            "text": "type: start",
            "lineNumber": 105
          },
          {
            "text": "[Edge]",
            "lineNumber": 106
          },
          {
            "text": "source: start",
            "lineNumber": 107
          },
          {
            "text": "target: end",
            "lineNumber": 108
          },
          {
            "text": "\"\"\"",
            "lineNumber": 109
          },
          {
            "text": "        flowchart = TOONParser.parse(toon_text)",
            "lineNumber": 110
          },
          {
            "text": "        # 'end'ã¯'node_end'ã«å¤‰æ›ã•ã‚Œã‚‹",
            "lineNumber": 111
          },
          {
            "text": "        assert any(node.id == \"node_end\" for node in flowchart.nodes)",
            "lineNumber": 112,
            "isSignature": true
          }
        ]
      },
      "score": 0.20618219673633575
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 382,
            "column": 34
          },
          "endPosition": {
            "line": 408,
            "column": 112
          }
        },
        "contents": "                except LLMAPIError as e:\n                    # LLM APIã‚¨ãƒ©ãƒ¼\n                    st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {e}\")\n                    st.info(\"OllamaãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ã€ãƒ¢ãƒ‡ãƒ«ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚\")\n                except TOONParseError as e:\n                    # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼\n                    # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯\n                    if 'raw_toon_text' in locals() and raw_toon_text:\n                        client = LLMClient()\n                        if client.is_question_response(raw_toon_text):\n                            # è³ªå•å½¢å¼ã®å¿œç­”ã ã£ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜\n                            st.session_state.conversation_context = user_prompt\n                            st.session_state.pending_questions = raw_toon_text\n                            st.session_state.question_responses = []\n                            st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n                            st.rerun()\n                        else:\n                            # æœ¬å½“ã«ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã®å ´åˆ\n                            st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")\n                            with st.expander(\"ğŸ” LLMã®ç”Ÿå‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰\", expanded=True):\n                                st.info(\"ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’TOONå½¢å¼ã¨ã—ã¦è§£é‡ˆã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€å¤±æ•—ã—ã¾ã—ãŸã€‚\")\n                                st.code(raw_toon_text)\n                    else:\n                        st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")\n                except FlowchartValidationError as e:\n                    # Flowchartãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ï¼ˆè­¦å‘Šã¨ã—ã¦è¡¨ç¤ºã€è‡ªå‹•ä¿®æ­£ã‚’è©¦è¡Œï¼‰",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                except LLMAPIError as e:",
            "lineNumber": 384
          },
          {
            "text": "                    # LLM APIã‚¨ãƒ©ãƒ¼",
            "lineNumber": 385
          },
          {
            "text": "                    st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {e}\")",
            "lineNumber": 386
          },
          {
            "text": "                    st.info(\"OllamaãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ã€ãƒ¢ãƒ‡ãƒ«ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 387
          },
          {
            "text": "                except TOONParseError as e:",
            "lineNumber": 388
          },
          {
            "text": "                    # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼",
            "lineNumber": 389
          },
          {
            "text": "                    # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 390
          },
          {
            "text": "                    if 'raw_toon_text' in locals() and raw_toon_text:",
            "lineNumber": 391
          },
          {
            "text": "                        client = LLMClient()",
            "lineNumber": 392
          },
          {
            "text": "                        if client.is_question_response(raw_toon_text):",
            "lineNumber": 393
          },
          {
            "text": "                            # è³ªå•å½¢å¼ã®å¿œç­”ã ã£ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜",
            "lineNumber": 394
          },
          {
            "text": "                            st.session_state.conversation_context = user_prompt",
            "lineNumber": 395
          },
          {
            "text": "                            st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 396
          },
          {
            "text": "                            st.session_state.question_responses = []",
            "lineNumber": 397
          },
          {
            "text": "                            st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 398
          },
          {
            "text": "                            st.rerun()",
            "lineNumber": 399
          },
          {
            "text": "                        else:",
            "lineNumber": 400
          },
          {
            "text": "                            # æœ¬å½“ã«ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã®å ´åˆ",
            "lineNumber": 401
          },
          {
            "text": "                            st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 402
          },
          {
            "text": "                            with st.expander(\"ğŸ” LLMã®ç”Ÿå‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰\", expanded=True):",
            "lineNumber": 403
          },
          {
            "text": "                                st.info(\"ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’TOONå½¢å¼ã¨ã—ã¦è§£é‡ˆã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€å¤±æ•—ã—ã¾ã—ãŸã€‚\")",
            "lineNumber": 404
          },
          {
            "text": "                                st.code(raw_toon_text)",
            "lineNumber": 405
          },
          {
            "text": "                    else:",
            "lineNumber": 406
          },
          {
            "text": "                        st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 407
          },
          {
            "text": "                except FlowchartValidationError as e:",
            "lineNumber": 408
          },
          {
            "text": "                    # Flowchartãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ï¼ˆè­¦å‘Šã¨ã—ã¦è¡¨ç¤ºã€è‡ªå‹•ä¿®æ­£ã‚’è©¦è¡Œï¼‰",
            "lineNumber": 409
          }
        ]
      },
      "score": 0.2028474062681198
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\history_mgr.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 175
          }
        },
        "contents": "import json\nfrom pathlib import Path\nfrom typing import List, Optional\nfrom core.schemas import Flowchart\nfrom core.toon_parser import TOONParser\n\nclass HistoryManager:\n    def __init__(self, storage_dir: str = \"storage/sessions\", toon_dir: str = \"storage/toon_files\"):\n        self.storage_dir = Path(storage_dir)\n        self.storage_dir.mkdir(parents=True, exist_ok=True)\n        self.toon_dir = Path(toon_dir)\n        self.toon_dir.mkdir(parents=True, exist_ok=True)\n\n    def save_session(self, session_id: str, history: List[Flowchart]):\n        \"\"\"ç¾åœ¨ã®å±¥æ­´ã‚¹ã‚¿ãƒƒã‚¯ã‚’JSONãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚\"\"\"\n        file_path = self.storage_dir / f\"{session_id}.json\"\n        # Pydanticãƒ¢ãƒ‡ãƒ«ã‚’è¾æ›¸å½¢å¼ã«ã—ã¦ä¿å­˜ï¼ˆEnumã‚’JSONã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºå¯èƒ½ãªå½¢å¼ã«å¤‰æ›ï¼‰\n        data = [flow.model_dump(mode='json') for flow in history]\n        with open(file_path, \"w\", encoding=\"utf-8\") as f:\n            json.dump(data, f, ensure_ascii=False, indent=4)\n\n    def load_session(self, session_id: str) -&gt; List[Flowchart]:\n        \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import json",
            "lineNumber": 1
          },
          {
            "text": "from pathlib import Path",
            "lineNumber": 2
          },
          {
            "text": "from typing import List, Optional",
            "lineNumber": 3
          },
          {
            "text": "from core.schemas import Flowchart",
            "lineNumber": 4
          },
          {
            "text": "from core.toon_parser import TOONParser",
            "lineNumber": 5
          },
          {
            "lineNumber": 6
          },
          {
            "text": "class HistoryManager:",
            "lineNumber": 7,
            "isSignature": true
          },
          {
            "text": "    def __init__(self, storage_dir: str = \"storage/sessions\", toon_dir: str = \"storage/toon_files\"):",
            "lineNumber": 8
          },
          {
            "text": "        self.storage_dir = Path(storage_dir)",
            "lineNumber": 9
          },
          {
            "text": "        self.storage_dir.mkdir(parents=True, exist_ok=True)",
            "lineNumber": 10
          },
          {
            "text": "        self.toon_dir = Path(toon_dir)",
            "lineNumber": 11
          },
          {
            "text": "        self.toon_dir.mkdir(parents=True, exist_ok=True)",
            "lineNumber": 12
          },
          {
            "lineNumber": 13
          },
          {
            "text": "    def save_session(self, session_id: str, history: List[Flowchart]):",
            "lineNumber": 14
          },
          {
            "text": "        \"\"\"ç¾åœ¨ã®å±¥æ­´ã‚¹ã‚¿ãƒƒã‚¯ã‚’JSONãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚\"\"\"",
            "lineNumber": 15
          },
          {
            "text": "        file_path = self.storage_dir / f\"{session_id}.json\"",
            "lineNumber": 16
          },
          {
            "text": "        # Pydanticãƒ¢ãƒ‡ãƒ«ã‚’è¾æ›¸å½¢å¼ã«ã—ã¦ä¿å­˜ï¼ˆEnumã‚’JSONã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºå¯èƒ½ãªå½¢å¼ã«å¤‰æ›ï¼‰",
            "lineNumber": 17
          },
          {
            "text": "        data = [flow.model_dump(mode='json') for flow in history]",
            "lineNumber": 18
          },
          {
            "text": "        with open(file_path, \"w\", encoding=\"utf-8\") as f:",
            "lineNumber": 19
          },
          {
            "text": "            json.dump(data, f, ensure_ascii=False, indent=4)",
            "lineNumber": 20
          },
          {
            "lineNumber": 21
          },
          {
            "text": "    def load_session(self, session_id: str) -&gt; List[Flowchart]:",
            "lineNumber": 22
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 23
          }
        ]
      },
      "score": 0.199904203414917
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


å®Ÿè£…è¨ˆç”»ã‚’ä½œæˆä¸­ã§ã™ã€‚


---

Cancelled

---

_**User**_

Implement the plan as specified, it is attached for your reference. Do NOT edit the plan file itself.

To-do's from the plan have already been created. Do not create them again. Mark them as in_progress as you work, starting with the first one. Don't stop until you have completed all the to-dos.

---

_**Agent (model default, mode Agent)**_



---


è¨ˆç”»ã«æ²¿ã£ã¦å®Ÿè£…ã‚’é–‹å§‹ã€‚æœ€åˆã®ã‚¿ã‚¹ã‚¯ã‹ã‚‰é€²ã‚ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: frontend/index.html</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/toon_parser.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/schemas.py</summary>

</details>
</tool-use>

---



---


ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã®æ‹¡å¼µã‹ã‚‰é–‹å§‹ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: core/schemas.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: core/schemas.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: core/schemas.py</summary>

</details>

</tool-use>

---



---


`to_mermaid()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ‹¡å¼µã—ã€subgraphã‚’ç”Ÿæˆã—ã¾ã™ã€‚


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: core/schemas.py</summary>

</details>

</tool-use>

---



---


`to_toon_format()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ›´æ–°ã—ã€subgraphæƒ…å ±ã‚’å‡ºåŠ›ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: core/schemas.py</summary>

</details>

</tool-use>

---



---


TOONParserã‚’æ‹¡å¼µã—ã€subgraphæƒ…å ±ã‚’ãƒ‘ãƒ¼ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: core/toon_parser.py</summary>

</details>

</tool-use>

---



---


`apply_logic_gap_detection()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ›´æ–°ã—ã€subgraphæƒ…å ±ã‚’ä¿æŒã—ã¾ã™ã€‚


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: core/schemas.py</summary>

</details>

</tool-use>

---



---


ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®JavaScriptã‚’æ‹¡å¼µã—ã€subgraphã®æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: frontend/index.html</summary>

</details>

</tool-use>

---



---


Mermaid.jsã®SVGæ§‹é€ ã«åˆã‚ã›ã¦ã€ã‚ˆã‚Šç¢ºå®Ÿã«å‹•ä½œã™ã‚‹ã‚ˆã†ã«å®Ÿè£…ã‚’æ”¹å–„ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: frontend/index.html</summary>

</details>

</tool-use>

---



---


TOON_BASE.mdã‚’æ›´æ–°ã—ã€subgraphã®å½¢å¼ã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: TOON_BASE.md</summary>

</details>
</tool-use>

---



---





---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: TOON_BASE.md</summary>

</details>

</tool-use>

---



---


rules.mdã‚’æ›´æ–°ã—ã€LLMãŒsubgraphã‚’ç”Ÿæˆã™ã‚‹ã‚ˆã†æ¨å¥¨ã™ã‚‹æŒ‡ç¤ºã‚’è¿½åŠ ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: rules.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: rules.md</summary>

</details>

</tool-use>

---



---


ãƒªãƒ³ã‚¿ãƒ¼ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèªä¸­ã€‚


---

<tool-use data-tool-type="unknown" data-tool-name="read_lints">
<details>
<summary>Tool use: **read_lints**</summary>


Parameters:

```json
{
  "paths": [
    "core/schemas.py",
    "core/toon_parser.py"
  ]
}
```
Result:

```json
{
  "linterErrorsByFile": [
    {
      "relativeWorkspacePath": "core/schemas.py"
    },
    {
      "relativeWorkspacePath": "core/toon_parser.py"
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


å®Ÿè£…ã¯å®Œäº†ã€‚å¾Œæ–¹äº’æ›æ€§ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã€subgraphæƒ…å ±ãŒãªã„å ´åˆã®å‹•ä½œã‚’ç¢ºèªä¸­ã€‚


---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "Flowchart\\(",
  "path": "core",
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "Flowchart\\(",
    "path": "core",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain": {
        "content": {
          "matches": [
            {
              "file": "core\\schemas.py",
              "matches": [
                {
                  "lineNumber": 25,
                  "content": "class Flowchart(BaseModel):"
                },
                {
                  "lineNumber": 176,
                  "content": "        return Flowchart(nodes=new_nodes, edges=new_edges, subgraphs=self.subgraphs)"
                }
              ]
            },
            {
              "file": "core\\toon_parser.py",
              "matches": [
                {
                  "lineNumber": 72,
                  "content": "        return Flowchart(nodes=nodes, edges=edges, subgraphs=subgraphs)"
                }
              ]
            },
            {
              "file": "core\\history_mgr.py",
              "matches": [
                {
                  "lineNumber": 55,
                  "content": "                    flowcharts.append(Flowchart(**item))"
                },
                {
                  "lineNumber": 168,
                  "content": "        merged_flow = Flowchart(nodes=merged_nodes, edges=merged_edges)"
                }
              ]
            },
            {
              "file": "core\\mermaid_parser.py",
              "matches": [
                {
                  "lineNumber": 152,
                  "content": "        return Flowchart(nodes=nodes, edges=edges)"
                }
              ]
            }
          ],
          "totalLines": 6,
          "totalMatchedLines": 6
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/schemas.py</summary>

</details>
</tool-use>

---



---


ä»–ã®Flowchartç”Ÿæˆç®‡æ‰€ã‚’ç¢ºèªã—ã€subgraphæƒ…å ±ã‚’ä¿æŒã™ã‚‹ã‚ˆã†ã«æ›´æ–°ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/history_mgr.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/history_mgr.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/mermaid_parser.py</summary>

</details>
</tool-use>

---



---


ä»–ã®Flowchartç”Ÿæˆç®‡æ‰€ã‚’æ›´æ–°ä¸­ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/history_mgr.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: core/history_mgr.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: core/mermaid_parser.py</summary>

</details>

</tool-use>

---



---


æœ€çµ‚ç¢ºèªã¨ã—ã¦ã€ãƒªãƒ³ã‚¿ãƒ¼ã‚¨ãƒ©ãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯ä¸­ã€‚


---

<tool-use data-tool-type="unknown" data-tool-name="read_lints">
<details>
<summary>Tool use: **read_lints**</summary>


Parameters:

```json
{
  "paths": [
    "core"
  ]
}
```
Result:

```json
{
  "linterErrorsByFile": [
    {
      "relativeWorkspacePath": "core"
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


å®Ÿè£…ã‚’å®Œäº†ã—ã¾ã—ãŸã€‚ä»¥ä¸‹ã®å¤‰æ›´ã‚’è¡Œã„ã¾ã—ãŸã€‚

## å®Ÿè£…å®Œäº†å†…å®¹

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã®æ‹¡å¼µ
- `Node`ã‚¯ãƒ©ã‚¹ã«`subgraph_id`å±æ€§ã‚’è¿½åŠ ï¼ˆOptionalï¼‰
- `Flowchart`ã‚¯ãƒ©ã‚¹ã«`subgraphs`å±æ€§ã‚’è¿½åŠ ï¼ˆOptional[Dict[str, str]]ï¼‰

### 2. Mermaidç”Ÿæˆã®æ‹¡å¼µ
- `to_mermaid()`ãƒ¡ã‚½ãƒƒãƒ‰ã§subgraphæ§‹æ–‡ã‚’ç”Ÿæˆ
- subgraphã«å±ã™ã‚‹ãƒãƒ¼ãƒ‰ã‚’é©åˆ‡ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
- subgraphãŒãªã„å ´åˆã¯å¾“æ¥é€šã‚Šå‹•ä½œï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰

### 3. TOONå½¢å¼ã®æ‹¡å¼µ
- `to_toon_format()`ãƒ¡ã‚½ãƒƒãƒ‰ã§subgraphæƒ…å ±ã‚’å‡ºåŠ›
- `TOONParser`ã§`[Subgraph]`ãƒ–ãƒ­ãƒƒã‚¯ã¨Nodeã®`subgraph`å±æ€§ã‚’ãƒ‘ãƒ¼ã‚¹

### 4. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½
- Mermaid.jsãŒç”Ÿæˆã™ã‚‹SVGã®subgraphè¦ç´ ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
- subgraphã®å¢ƒç•Œç·šï¼ˆrectï¼‰ã¨ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆtextï¼‰ã‚’ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«
- ã‚¯ãƒªãƒƒã‚¯æ™‚ã«subgraphå†…ã®è¦ç´ ã‚’è¡¨ç¤º/éè¡¨ç¤ºã«åˆ‡ã‚Šæ›¿ãˆ
- æŠ˜ã‚ŠãŸãŸã¿çŠ¶æ…‹ã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆé€æ˜åº¦å¤‰æ›´ï¼‰

### 5. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°
- `TOON_BASE.md`ã«subgraphã®å½¢å¼ã¨ä¾‹ã‚’è¿½åŠ 
- `rules.md`ã«subgraphä½¿ç”¨ã®æ¨å¥¨äº‹é …ã‚’è¿½åŠ 

### 6. äº’æ›æ€§ã®ç¢ºä¿
- `history_mgr.py`ã¨`mermaid_parser.py`ã§ã‚‚subgraphæƒ…å ±ã‚’ä¿æŒ
- æ—¢å­˜ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆsubgraphæƒ…å ±ãªã—ï¼‰ã‚‚æ­£å¸¸ã«å‹•ä½œ

ã“ã‚Œã§ã€subgraphã‚’å«ã‚€ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã€ã‚¯ãƒªãƒƒã‚¯ã§æŠ˜ã‚ŠãŸãŸã¿/å±•é–‹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

---

_**User**_

@flow.md ã®å·¨å¤§ãƒ•ãƒ­ãƒ¼ã‚’ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã§å®Ÿç¾ã™ã‚‹ã€‚è³ªå•ã¯è‡ªç„¶è¨€èªã‚’LLMã§è¦ç´„ã—ã€ã©ã®ã‚±ãƒ¼ã‚¹ãŒè¿‘ã„ã‹æŒ¯ã‚Šåˆ†ã‘ã‚‹ã“ã¨ã‚’è€ƒãˆã‚‹ã€‚ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®è¦–ç‚¹ã‹ã‚‰ç§ãŒæ±ºã‚ã‚‹ã¹ãã“ã¨ã‚’æ•™ãˆã¦ãã ã•ã„

---

_**Agent (model default, mode Agent)**_



---


flow.mdã®å†…å®¹ã‚’ç¢ºèªã—ã€ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…ã§æ±ºã‚ã‚‹ã¹ãäº‹é …ã‚’æ•´ç†ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: flow.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: flow.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: app.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "How does the chatbot currently handle user questions and route to different flows?",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\llm_client.py",
        "range": {
          "startPosition": {
            "line": 8
          },
          "endPosition": {
            "line": 268
          }
        },
        "contents": "class LLMClient:\n\n\n    def generate_flow(self, user_input: str, current_flowchart: Optional[Flowchart] = None) -&gt; str:\n        \"\"\"\n        ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’å—ã‘å–ã‚Šã€Ollamaã‹ã‚‰TOONå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚\n        \n        Args:\n            user_input: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ\n            current_flowchart: æ—¢å­˜ã®Flowchartï¼ˆæ–‡è„ˆã¨ã—ã¦æ¸¡ã™ï¼‰\n        \n        Raises:\n            ValueError: ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰æœ‰åŠ¹ãªå¿œç­”ãŒå¾—ã‚‰ã‚Œãªã„å ´åˆ\n            LLMAPIError: Ollama APIã¨ã®é€šä¿¡ã«å¤±æ•—ã—ãŸå ´åˆ\n        \"\"\"\n        try:\n            # æ—¢å­˜ã®FlowchartãŒã‚ã‚‹å ´åˆã€TOONå½¢å¼ã«å¤‰æ›ã—ã¦ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦è¿½åŠ \n            if current_flowchart:\n                context = f\"æ—¢å­˜ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ:\\n{current_flowchart.to_toon_format()}\\n\\n\"\n                enhanced_input = context + f\"ä¸Šè¨˜ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’å‚è€ƒã«ã€ä»¥ä¸‹ã®æŒ‡ç¤ºã«å¾“ã£ã¦ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’ç”Ÿæˆã¾ãŸã¯æ›´æ–°ã—ã¦ãã ã•ã„:\\n{user_input}\"\n            else:\n                enhanced_input = user_input\n            \n            # ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã«è³ªå•ã‚’ä¿ƒã™ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹ã‹ãƒã‚§ãƒƒã‚¯\n            question_keywords = [\"å•ã„ã‹ã‘ã¦\", \"è³ªå•ã—ã¦\", \"èã„ã¦\", \"ç¢ºèªã—ã¦\"]\n            requires_questions = any(keyword in user_input for keyword in question_keywords)\n            \n            # ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¿½åŠ ã®å¼·èª¿ã‚’åŠ ãˆã‚‹\n            if requires_questions:\n                additional_instruction = \"\\n\\nã€é‡è¦ã€‘ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æƒ…å ±ä¸è¶³æ™‚ã«è³ªå•ã™ã‚‹ã“ã¨ã‚’æ˜ç¤ºçš„ã«è¦æ±‚ã—ã¦ã„ã¾ã™ã€‚æ¨æ¸¬ã›ãšã€å¿…è¦ãªæƒ…å ±ã‚’è³ªå•ã—ã¦ãã ã•ã„ã€‚\"\n                system_prompt = self.system_instruction + additional_instruction\n            else:\n                system_prompt = self.system_instruction\n            \n            # Ollama HTTP APIã‚’ç›´æ¥å‘¼ã³å‡ºã—\n            payload",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 9,
                "column": 1
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class LLMClient:",
            "lineNumber": 9,
            "isSignature": true
          },
          {
            "lineNumber": 143
          },
          {
            "lineNumber": 144
          },
          {
            "text": "    def generate_flow(self, user_input: str, current_flowchart: Optional[Flowchart] = None) -&gt; str:",
            "lineNumber": 145
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 146
          },
          {
            "text": "        ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’å—ã‘å–ã‚Šã€Ollamaã‹ã‚‰TOONå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚",
            "lineNumber": 147
          },
          {
            "text": "        ",
            "lineNumber": 148
          },
          {
            "text": "        Args:",
            "lineNumber": 149
          },
          {
            "text": "            user_input: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ",
            "lineNumber": 150
          },
          {
            "text": "            current_flowchart: æ—¢å­˜ã®Flowchartï¼ˆæ–‡è„ˆã¨ã—ã¦æ¸¡ã™ï¼‰",
            "lineNumber": 151
          },
          {
            "text": "        ",
            "lineNumber": 152
          },
          {
            "text": "        Raises:",
            "lineNumber": 153
          },
          {
            "text": "            ValueError: ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰æœ‰åŠ¹ãªå¿œç­”ãŒå¾—ã‚‰ã‚Œãªã„å ´åˆ",
            "lineNumber": 154
          },
          {
            "text": "            LLMAPIError: Ollama APIã¨ã®é€šä¿¡ã«å¤±æ•—ã—ãŸå ´åˆ",
            "lineNumber": 155
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 156
          },
          {
            "text": "        try:",
            "lineNumber": 157
          },
          {
            "text": "            # æ—¢å­˜ã®FlowchartãŒã‚ã‚‹å ´åˆã€TOONå½¢å¼ã«å¤‰æ›ã—ã¦ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦è¿½åŠ ",
            "lineNumber": 158
          },
          {
            "text": "            if current_flowchart:",
            "lineNumber": 159
          },
          {
            "text": "                context = f\"æ—¢å­˜ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ:\\n{current_flowchart.to_toon_format()}\\n\\n\"",
            "lineNumber": 160
          },
          {
            "text": "                enhanced_input = context + f\"ä¸Šè¨˜ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’å‚è€ƒã«ã€ä»¥ä¸‹ã®æŒ‡ç¤ºã«å¾“ã£ã¦ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’ç”Ÿæˆã¾ãŸã¯æ›´æ–°ã—ã¦ãã ã•ã„:\\n{user_input}\"",
            "lineNumber": 161
          },
          {
            "text": "            else:",
            "lineNumber": 162
          },
          {
            "text": "                enhanced_input = user_input",
            "lineNumber": 163
          },
          {
            "text": "            ",
            "lineNumber": 164
          },
          {
            "text": "            # ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã«è³ªå•ã‚’ä¿ƒã™ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹ã‹ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 165
          },
          {
            "text": "            question_keywords = [\"å•ã„ã‹ã‘ã¦\", \"è³ªå•ã—ã¦\", \"èã„ã¦\", \"ç¢ºèªã—ã¦\"]",
            "lineNumber": 166
          },
          {
            "text": "            requires_questions = any(keyword in user_input for keyword in question_keywords)",
            "lineNumber": 167
          },
          {
            "text": "            ",
            "lineNumber": 168
          },
          {
            "text": "            # ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¿½åŠ ã®å¼·èª¿ã‚’åŠ ãˆã‚‹",
            "lineNumber": 169
          },
          {
            "text": "            if requires_questions:",
            "lineNumber": 170
          },
          {
            "text": "                additional_instruction = \"\\n\\nã€é‡è¦ã€‘ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æƒ…å ±ä¸è¶³æ™‚ã«è³ªå•ã™ã‚‹ã“ã¨ã‚’æ˜ç¤ºçš„ã«è¦æ±‚ã—ã¦ã„ã¾ã™ã€‚æ¨æ¸¬ã›ãšã€å¿…è¦ãªæƒ…å ±ã‚’è³ªå•ã—ã¦ãã ã•ã„ã€‚\"",
            "lineNumber": 171
          },
          {
            "text": "                system_prompt = self.system_instruction + additional_instruction",
            "lineNumber": 172
          },
          {
            "text": "            else:",
            "lineNumber": 173
          },
          {
            "text": "                system_prompt = self.system_instruction",
            "lineNumber": 174
          },
          {
            "text": "            ",
            "lineNumber": 175
          },
          {
            "text": "            # Ollama HTTP APIã‚’ç›´æ¥å‘¼ã³å‡ºã—",
            "lineNumber": 176
          },
          {
            "text": "            payload",
            "lineNumber": 177
          }
        ]
      },
      "score": 0.4001270532608032
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 349,
            "column": 92
          },
          "endPosition": {
            "line": 385,
            "column": 54
          }
        },
        "contents": "                    \n                    # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯\n                    if client.is_question_response(raw_toon_text):\n                        # è³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜\n                        st.session_state.conversation_context = user_prompt\n                        st.session_state.pending_questions = raw_toon_text\n                        st.session_state.question_responses = []\n                        st.session_state.append_mode_for_question = append_mode  # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜\n                        st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n                        st.rerun()\n                    else:\n                        # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼\n                        is_valid, validation_message = client.validate_output_size(raw_toon_text)\n                        if not is_valid:\n                            st.warning(validation_message)\n                            st.info(\"ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã‹ã€ãƒ•ãƒ­ãƒ¼ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\")\n                        \n                        # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹\n                        new_flow = TOONParser.parse(raw_toon_text)\n                        \n                        # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨\n                        new_flow = new_flow.apply_logic_gap_detection()\n                        \n                        # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ\n                        if append_mode:\n                            merged_flow = history_mgr.append_toon_log(session_name, new_flow)\n                            st.session_state.history.append(merged_flow)\n                            st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")\n                        else:\n                            # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ \n                            st.session_state.history.append(new_flow)\n                        \n                        st.rerun()\n                except LLMAPIError as e:\n                    # LLM APIã‚¨ãƒ©ãƒ¼\n                    st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {e}\")",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                    ",
            "lineNumber": 351
          },
          {
            "text": "                    # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 352
          },
          {
            "text": "                    if client.is_question_response(raw_toon_text):",
            "lineNumber": 353
          },
          {
            "text": "                        # è³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜",
            "lineNumber": 354
          },
          {
            "text": "                        st.session_state.conversation_context = user_prompt",
            "lineNumber": 355
          },
          {
            "text": "                        st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 356
          },
          {
            "text": "                        st.session_state.question_responses = []",
            "lineNumber": 357
          },
          {
            "text": "                        st.session_state.append_mode_for_question = append_mode  # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜",
            "lineNumber": 358
          },
          {
            "text": "                        st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 359
          },
          {
            "text": "                        st.rerun()",
            "lineNumber": 360
          },
          {
            "text": "                    else:",
            "lineNumber": 361
          },
          {
            "text": "                        # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼",
            "lineNumber": 362
          },
          {
            "text": "                        is_valid, validation_message = client.validate_output_size(raw_toon_text)",
            "lineNumber": 363
          },
          {
            "text": "                        if not is_valid:",
            "lineNumber": 364
          },
          {
            "text": "                            st.warning(validation_message)",
            "lineNumber": 365
          },
          {
            "text": "                            st.info(\"ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã‹ã€ãƒ•ãƒ­ãƒ¼ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 366
          },
          {
            "text": "                        ",
            "lineNumber": 367
          },
          {
            "text": "                        # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹",
            "lineNumber": 368
          },
          {
            "text": "                        new_flow = TOONParser.parse(raw_toon_text)",
            "lineNumber": 369
          },
          {
            "text": "                        ",
            "lineNumber": 370
          },
          {
            "text": "                        # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨",
            "lineNumber": 371
          },
          {
            "text": "                        new_flow = new_flow.apply_logic_gap_detection()",
            "lineNumber": 372
          },
          {
            "text": "                        ",
            "lineNumber": 373
          },
          {
            "text": "                        # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ",
            "lineNumber": 374
          },
          {
            "text": "                        if append_mode:",
            "lineNumber": 375
          },
          {
            "text": "                            merged_flow = history_mgr.append_toon_log(session_name, new_flow)",
            "lineNumber": 376
          },
          {
            "text": "                            st.session_state.history.append(merged_flow)",
            "lineNumber": 377
          },
          {
            "text": "                            st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")",
            "lineNumber": 378
          },
          {
            "text": "                        else:",
            "lineNumber": 379
          },
          {
            "text": "                            # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ ",
            "lineNumber": 380
          },
          {
            "text": "                            st.session_state.history.append(new_flow)",
            "lineNumber": 381
          },
          {
            "text": "                        ",
            "lineNumber": 382
          },
          {
            "text": "                        st.rerun()",
            "lineNumber": 383
          },
          {
            "text": "                except LLMAPIError as e:",
            "lineNumber": 384
          },
          {
            "text": "                    # LLM APIã‚¨ãƒ©ãƒ¼",
            "lineNumber": 385
          },
          {
            "text": "                    st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {e}\")",
            "lineNumber": 386
          }
        ]
      },
      "score": 0.3664484918117523
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 207,
            "column": 79
          },
          "endPosition": {
            "line": 226,
            "column": 60
          }
        },
        "contents": "                    \n                    # å†é€ä¿¡å‡¦ç†\n                    with st.spinner(\"LLMãŒãƒ•ãƒ­ãƒ¼ã‚’è¨­è¨ˆä¸­...\"):\n                        raw_toon_text = \"\"\n                        try:\n                            client = LLMClient()\n                            raw_toon_text = client.generate_flow(combined_prompt, current_flow if append_mode_flag else None)\n                            \n                            # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯\n                            if client.is_question_response(raw_toon_text):\n                                # å†åº¦è³ªå•ãŒæ¥ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°\n                                st.session_state.conversation_context = combined_prompt\n                                st.session_state.pending_questions = raw_toon_text\n                                st.session_state.question_responses = []  # æ–°ã—ã„è³ªå•ãªã®ã§å›ç­”ã‚’ãƒªã‚»ãƒƒãƒˆ\n                                st.info(\"LLMã‹ã‚‰è¿½åŠ ã®è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n                                st.rerun()\n                            else:\n                                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼\n                                is_valid, validation_message",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                    ",
            "lineNumber": 209
          },
          {
            "text": "                    # å†é€ä¿¡å‡¦ç†",
            "lineNumber": 210
          },
          {
            "text": "                    with st.spinner(\"LLMãŒãƒ•ãƒ­ãƒ¼ã‚’è¨­è¨ˆä¸­...\"):",
            "lineNumber": 211
          },
          {
            "text": "                        raw_toon_text = \"\"",
            "lineNumber": 212
          },
          {
            "text": "                        try:",
            "lineNumber": 213
          },
          {
            "text": "                            client = LLMClient()",
            "lineNumber": 214
          },
          {
            "text": "                            raw_toon_text = client.generate_flow(combined_prompt, current_flow if append_mode_flag else None)",
            "lineNumber": 215
          },
          {
            "text": "                            ",
            "lineNumber": 216
          },
          {
            "text": "                            # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 217
          },
          {
            "text": "                            if client.is_question_response(raw_toon_text):",
            "lineNumber": 218
          },
          {
            "text": "                                # å†åº¦è³ªå•ãŒæ¥ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°",
            "lineNumber": 219
          },
          {
            "text": "                                st.session_state.conversation_context = combined_prompt",
            "lineNumber": 220
          },
          {
            "text": "                                st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 221
          },
          {
            "text": "                                st.session_state.question_responses = []  # æ–°ã—ã„è³ªå•ãªã®ã§å›ç­”ã‚’ãƒªã‚»ãƒƒãƒˆ",
            "lineNumber": 222
          },
          {
            "text": "                                st.info(\"LLMã‹ã‚‰è¿½åŠ ã®è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 223
          },
          {
            "text": "                                st.rerun()",
            "lineNumber": 224
          },
          {
            "text": "                            else:",
            "lineNumber": 225
          },
          {
            "text": "                                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼",
            "lineNumber": 226
          },
          {
            "text": "                                is_valid, validation_message",
            "lineNumber": 227
          }
        ]
      },
      "score": 0.350783109664917
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 330,
            "column": 117
          },
          "endPosition": {
            "line": 351,
            "column": 20
          }
        },
        "contents": "\",\n        height=150\n    )\n    \n    if st.button(\"ãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆ\", type=\"primary\", use_container_width=True):\n        if user_prompt:\n            with st.spinner(\"LLMãŒãƒ•ãƒ­ãƒ¼ã‚’è¨­è¨ˆä¸­...\"):\n                raw_toon_text = \"\"\n                try:\n                    # LLMã¨ã®é€šä¿¡\n                    client = LLMClient()\n                    # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯æ—¢å­˜ã®Flowchartã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦æ¸¡ã™\n                    context_flowchart = current_flow if append_mode else None\n                    \n                    # éƒ¨åˆ†ãƒ•ãƒ­ãƒ¼ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¿½åŠ æŒ‡ç¤ºã‚’ä»˜ä¸\n                    enhanced_prompt = user_prompt\n                    if partial_mode:\n                        enhanced_prompt = user_prompt + \"\\n\\nã€é‡è¦ã€‘ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚å…¨ãƒ«ãƒ¼ãƒˆã‚’å«ã‚€å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒãƒ¼ãƒ‰æ•°ã¯30å€‹ä»¥ä¸‹ã€ã‚¨ãƒƒã‚¸æ•°ã¯50å€‹ä»¥ä¸‹ã«ã—ã¦ãã ã•ã„ã€‚\"\n                    \n                    raw_toon_text = client.generate_flow(enhanced_prompt, context_flowchart)\n                    \n                    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "\",",
            "lineNumber": 331
          },
          {
            "text": "        height=150",
            "lineNumber": 332
          },
          {
            "text": "    )",
            "lineNumber": 333
          },
          {
            "text": "    ",
            "lineNumber": 334
          },
          {
            "text": "    if st.button(\"ãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆ\", type=\"primary\", use_container_width=True):",
            "lineNumber": 335
          },
          {
            "text": "        if user_prompt:",
            "lineNumber": 336
          },
          {
            "text": "            with st.spinner(\"LLMãŒãƒ•ãƒ­ãƒ¼ã‚’è¨­è¨ˆä¸­...\"):",
            "lineNumber": 337
          },
          {
            "text": "                raw_toon_text = \"\"",
            "lineNumber": 338
          },
          {
            "text": "                try:",
            "lineNumber": 339
          },
          {
            "text": "                    # LLMã¨ã®é€šä¿¡",
            "lineNumber": 340
          },
          {
            "text": "                    client = LLMClient()",
            "lineNumber": 341
          },
          {
            "text": "                    # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯æ—¢å­˜ã®Flowchartã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦æ¸¡ã™",
            "lineNumber": 342
          },
          {
            "text": "                    context_flowchart = current_flow if append_mode else None",
            "lineNumber": 343
          },
          {
            "text": "                    ",
            "lineNumber": 344
          },
          {
            "text": "                    # éƒ¨åˆ†ãƒ•ãƒ­ãƒ¼ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¿½åŠ æŒ‡ç¤ºã‚’ä»˜ä¸",
            "lineNumber": 345
          },
          {
            "text": "                    enhanced_prompt = user_prompt",
            "lineNumber": 346
          },
          {
            "text": "                    if partial_mode:",
            "lineNumber": 347
          },
          {
            "text": "                        enhanced_prompt = user_prompt + \"\\n\\nã€é‡è¦ã€‘ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚å…¨ãƒ«ãƒ¼ãƒˆã‚’å«ã‚€å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒãƒ¼ãƒ‰æ•°ã¯30å€‹ä»¥ä¸‹ã€ã‚¨ãƒƒã‚¸æ•°ã¯50å€‹ä»¥ä¸‹ã«ã—ã¦ãã ã•ã„ã€‚\"",
            "lineNumber": 348
          },
          {
            "text": "                    ",
            "lineNumber": 349
          },
          {
            "text": "                    raw_toon_text = client.generate_flow(enhanced_prompt, context_flowchart)",
            "lineNumber": 350
          },
          {
            "text": "                    ",
            "lineNumber": 351
          },
          {
            "text": "                    ",
            "lineNumber": 352
          }
        ]
      },
      "score": 0.31181129813194275
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 49,
            "column": 53
          }
        },
        "contents": "import streamlit as st\nimport streamlit.components.v1 as components\nimport base64\nfrom core.schemas import Node, Edge, Flowchart\nfrom core.llm_client import LLMClient\nfrom core.toon_parser import TOONParser\nfrom core.history_mgr import HistoryManager\nfrom core.exceptions import LLMAPIError, TOONParseError, FlowchartValidationError\nfrom pathlib import Path\n\nst.set_page_config(layout=\"wide\")\nst.title(\"Flowchart Generator &amp; History Manager\")\n\n# 1. ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–\nhistory_mgr = HistoryManager()\n\n# 2. ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´ã®åˆæœŸåŒ–\nif 'history' not in st.session_state:\n    # åˆæœŸçŠ¶æ…‹ï¼šé–‹å§‹ã¨çµ‚äº†ã®ã¿ã®æ§‹æˆ\n    initial_flow = Flowchart(\n        nodes=[\n            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),\n            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")\n        ],\n        edges=[Edge(source=\"start\", target=\"node_end\")]\n    )\n    st.session_state.history = [initial_flow]\n\n# 3. è³ªå•å¿œç­”ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®åˆæœŸåŒ–\nif 'conversation_context' not in st.session_state:\n    st.session_state.conversation_context = None  # å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\nif 'pending_questions' not in st.session_state:\n    st.session_state.pending_questions = None  # ç¾åœ¨ã®è³ªå•ãƒ†ã‚­ã‚¹ãƒˆ\nif 'question_responses' not in st.session_state:\n    st.session_state.question_responses = []  # å›ç­”ã®ãƒªã‚¹ãƒˆ\nif 'append_mode_for_question' not in st.session_state:\n    st.session_state.append_mode_for_question = False  # è³ªå•æ™‚ã®å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®š\n\n# --- ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼šã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† ---\nst.sidebar.header(\"ğŸ’¾ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†\")\n\n# ä¿å­˜æ¸ˆã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä¸€è¦§ã‚’å–å¾—\nsaved_sessions = history_mgr.list_sessions()\n\n# ã‚»ãƒƒã‚·ãƒ§ãƒ³åã®å…¥åŠ›ï¼ˆæ–°è¦ä½œæˆç”¨ï¼‰\nsession_name = st.sidebar.text_input(\"ã‚»ãƒƒã‚·ãƒ§ãƒ³åï¼ˆæ–°è¦ä½œæˆ/ä¿å­˜ç”¨ï¼‰\", value=\"default_session\")\n\ncol_save, col_load = st.sidebar.columns(2)\nwith col_save:\n    if st.button(\"ä¿å­˜\", use_container_width=True):",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import streamlit as st",
            "lineNumber": 1
          },
          {
            "text": "import streamlit.components.v1 as components",
            "lineNumber": 2
          },
          {
            "text": "import base64",
            "lineNumber": 3
          },
          {
            "text": "from core.schemas import Node, Edge, Flowchart",
            "lineNumber": 4
          },
          {
            "text": "from core.llm_client import LLMClient",
            "lineNumber": 5
          },
          {
            "text": "from core.toon_parser import TOONParser",
            "lineNumber": 6
          },
          {
            "text": "from core.history_mgr import HistoryManager",
            "lineNumber": 7
          },
          {
            "text": "from core.exceptions import LLMAPIError, TOONParseError, FlowchartValidationError",
            "lineNumber": 8
          },
          {
            "text": "from pathlib import Path",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "text": "st.set_page_config(layout=\"wide\")",
            "lineNumber": 11
          },
          {
            "text": "st.title(\"Flowchart Generator &amp; History Manager\")",
            "lineNumber": 12
          },
          {
            "lineNumber": 13
          },
          {
            "text": "# 1. ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–",
            "lineNumber": 14
          },
          {
            "text": "history_mgr = HistoryManager()",
            "lineNumber": 15
          },
          {
            "lineNumber": 16
          },
          {
            "text": "# 2. ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´ã®åˆæœŸåŒ–",
            "lineNumber": 17
          },
          {
            "text": "if 'history' not in st.session_state:",
            "lineNumber": 18
          },
          {
            "text": "    # åˆæœŸçŠ¶æ…‹ï¼šé–‹å§‹ã¨çµ‚äº†ã®ã¿ã®æ§‹æˆ",
            "lineNumber": 19
          },
          {
            "text": "    initial_flow = Flowchart(",
            "lineNumber": 20
          },
          {
            "text": "        nodes=[",
            "lineNumber": 21
          },
          {
            "text": "            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),",
            "lineNumber": 22
          },
          {
            "text": "            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")",
            "lineNumber": 23
          },
          {
            "text": "        ],",
            "lineNumber": 24
          },
          {
            "text": "        edges=[Edge(source=\"start\", target=\"node_end\")]",
            "lineNumber": 25
          },
          {
            "text": "    )",
            "lineNumber": 26
          },
          {
            "text": "    st.session_state.history = [initial_flow]",
            "lineNumber": 27
          },
          {
            "lineNumber": 28
          },
          {
            "text": "# 3. è³ªå•å¿œç­”ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®åˆæœŸåŒ–",
            "lineNumber": 29
          },
          {
            "text": "if 'conversation_context' not in st.session_state:",
            "lineNumber": 30
          },
          {
            "text": "    st.session_state.conversation_context = None  # å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ",
            "lineNumber": 31
          },
          {
            "text": "if 'pending_questions' not in st.session_state:",
            "lineNumber": 32
          },
          {
            "text": "    st.session_state.pending_questions = None  # ç¾åœ¨ã®è³ªå•ãƒ†ã‚­ã‚¹ãƒˆ",
            "lineNumber": 33
          },
          {
            "text": "if 'question_responses' not in st.session_state:",
            "lineNumber": 34
          },
          {
            "text": "    st.session_state.question_responses = []  # å›ç­”ã®ãƒªã‚¹ãƒˆ",
            "lineNumber": 35
          },
          {
            "text": "if 'append_mode_for_question' not in st.session_state:",
            "lineNumber": 36
          },
          {
            "text": "    st.session_state.append_mode_for_question = False  # è³ªå•æ™‚ã®å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®š",
            "lineNumber": 37
          },
          {
            "lineNumber": 38
          },
          {
            "text": "# --- ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼šã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† ---",
            "lineNumber": 39
          },
          {
            "text": "st.sidebar.header(\"ğŸ’¾ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†\")",
            "lineNumber": 40
          },
          {
            "lineNumber": 41
          },
          {
            "text": "# ä¿å­˜æ¸ˆã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä¸€è¦§ã‚’å–å¾—",
            "lineNumber": 42
          },
          {
            "text": "saved_sessions = history_mgr.list_sessions()",
            "lineNumber": 43
          },
          {
            "lineNumber": 44
          },
          {
            "text": "# ã‚»ãƒƒã‚·ãƒ§ãƒ³åã®å…¥åŠ›ï¼ˆæ–°è¦ä½œæˆç”¨ï¼‰",
            "lineNumber": 45
          },
          {
            "text": "session_name = st.sidebar.text_input(\"ã‚»ãƒƒã‚·ãƒ§ãƒ³åï¼ˆæ–°è¦ä½œæˆ/ä¿å­˜ç”¨ï¼‰\", value=\"default_session\")",
            "lineNumber": 46
          },
          {
            "lineNumber": 47
          },
          {
            "text": "col_save, col_load = st.sidebar.columns(2)",
            "lineNumber": 48
          },
          {
            "text": "with col_save:",
            "lineNumber": 49
          },
          {
            "text": "    if st.button(\"ä¿å­˜\", use_container_width=True):",
            "lineNumber": 50
          }
        ]
      },
      "score": 0.30305999517440796
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\flow.md",
        "range": {
          "startPosition": {
            "line": 232
          },
          "endPosition": {
            "line": 273
          }
        },
        "contents": "    subgraph flow4 [\"ãƒ‡ãƒ¼ã‚¿ç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]\n        check11_3[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check11_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check11_3_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task11_3[\"PGåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        check12_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check12_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check12_3_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task12_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        task14_2[\"JARVISå†…éƒ¨ã®FFCã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]\n        task15_2[\"è£å´ã®ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]\n        task16_2[\"JARVISå†…éƒ¨ã®ã‚±ãƒ¼ãƒ–ãƒ«ã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]\n        task17_2[\"MK.â…¡(ä¿¡å·ç™ºç”Ÿæ©Ÿ)ã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„ã€‚\"]\n        task10_4[\"æµå‹•ã«æˆ»ã™\"]\n        decision1_4{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n        \n        task8--&gt;check11_3\n        check11_3--&gt;decision_check11_3\n        decision_check11_3--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check11_3_1\n        decision_check11_3--&gt;|\"åˆ¤å®šã§ããªã„\"|task11_3\n        decision_check11_3_1--&gt;|\"æ­£å¸¸\"|check12_3\n        decision_check11_3_1--&gt;|\"ç•°å¸¸\"|task11_3\n        task11_3--&gt;check12_3\n        check12_3--&gt;decision_check12_3\n        decision_check12_3--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check12_3_1\n        decision_check12_3--&gt;|\"åˆ¤å®šã§ããªã„\"|task12_3\n        decision_check12_3_1--&gt;|\"æ­£å¸¸\"|task14_2\n        decision_check12_3_1--&gt;|\"ç•°å¸¸\"|task12_3\n        task12_3--&gt;task14_2\n        task14_2--&gt;task15_2\n        task15_2--&gt;task16_2\n        task16_2--&gt;task17_2\n        task17_2--&gt;task10_4\n        task10_4--&gt;decision1_4\n        decision1_4--&gt;|\"å†ç¾ã—ãªã„\"|task10\n        decision1_4--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer\n    end\n    \n    %% ã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\n    subgraph flow6 [\"ãã®ä»–ã®ç—‡çŠ¶ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]\n        task_other_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã®FFCã‚’äº¤æ›ã™ã‚‹\"]",
        "signatures": {},
        "detailedLines": [
          {
            "text": "    subgraph flow4 [\"ãƒ‡ãƒ¼ã‚¿ç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 233
          },
          {
            "text": "        check11_3[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 234
          },
          {
            "text": "        decision_check11_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 235
          },
          {
            "text": "        decision_check11_3_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 236
          },
          {
            "text": "        task11_3[\"PGåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 237
          },
          {
            "text": "        check12_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 238
          },
          {
            "text": "        decision_check12_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 239
          },
          {
            "text": "        decision_check12_3_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 240
          },
          {
            "text": "        task12_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 241
          },
          {
            "text": "        task14_2[\"JARVISå†…éƒ¨ã®FFCã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]",
            "lineNumber": 242
          },
          {
            "text": "        task15_2[\"è£å´ã®ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]",
            "lineNumber": 243
          },
          {
            "text": "        task16_2[\"JARVISå†…éƒ¨ã®ã‚±ãƒ¼ãƒ–ãƒ«ã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]",
            "lineNumber": 244
          },
          {
            "text": "        task17_2[\"MK.â…¡(ä¿¡å·ç™ºç”Ÿæ©Ÿ)ã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„ã€‚\"]",
            "lineNumber": 245
          },
          {
            "text": "        task10_4[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 246
          },
          {
            "text": "        decision1_4{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 247
          },
          {
            "text": "        ",
            "lineNumber": 248
          },
          {
            "text": "        task8--&gt;check11_3",
            "lineNumber": 249
          },
          {
            "text": "        check11_3--&gt;decision_check11_3",
            "lineNumber": 250
          },
          {
            "text": "        decision_check11_3--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check11_3_1",
            "lineNumber": 251
          },
          {
            "text": "        decision_check11_3--&gt;|\"åˆ¤å®šã§ããªã„\"|task11_3",
            "lineNumber": 252
          },
          {
            "text": "        decision_check11_3_1--&gt;|\"æ­£å¸¸\"|check12_3",
            "lineNumber": 253
          },
          {
            "text": "        decision_check11_3_1--&gt;|\"ç•°å¸¸\"|task11_3",
            "lineNumber": 254
          },
          {
            "text": "        task11_3--&gt;check12_3",
            "lineNumber": 255
          },
          {
            "text": "        check12_3--&gt;decision_check12_3",
            "lineNumber": 256
          },
          {
            "text": "        decision_check12_3--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check12_3_1",
            "lineNumber": 257
          },
          {
            "text": "        decision_check12_3--&gt;|\"åˆ¤å®šã§ããªã„\"|task12_3",
            "lineNumber": 258
          },
          {
            "text": "        decision_check12_3_1--&gt;|\"æ­£å¸¸\"|task14_2",
            "lineNumber": 259
          },
          {
            "text": "        decision_check12_3_1--&gt;|\"ç•°å¸¸\"|task12_3",
            "lineNumber": 260
          },
          {
            "text": "        task12_3--&gt;task14_2",
            "lineNumber": 261
          },
          {
            "text": "        task14_2--&gt;task15_2",
            "lineNumber": 262
          },
          {
            "text": "        task15_2--&gt;task16_2",
            "lineNumber": 263
          },
          {
            "text": "        task16_2--&gt;task17_2",
            "lineNumber": 264
          },
          {
            "text": "        task17_2--&gt;task10_4",
            "lineNumber": 265
          },
          {
            "text": "        task10_4--&gt;decision1_4",
            "lineNumber": 266
          },
          {
            "text": "        decision1_4--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 267
          },
          {
            "text": "        decision1_4--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer",
            "lineNumber": 268
          },
          {
            "text": "    end",
            "lineNumber": 269
          },
          {
            "text": "    ",
            "lineNumber": 270
          },
          {
            "text": "    %% ã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 271
          },
          {
            "text": "    subgraph flow6 [\"ãã®ä»–ã®ç—‡çŠ¶ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 272
          },
          {
            "text": "        task_other_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã®FFCã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 273
          }
        ]
      },
      "score": 0.29976123571395874
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\flow.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 47
          }
        },
        "contents": "&#96;&#96;&#96;mermaid\ngraph TD\n    start[\"é–‹å§‹\"]\n    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]\n    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]\n    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]\n    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}\n    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}\n    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]\n    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]\n    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]\n    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]\n    task10[\"æµå‹•ã«æˆ»ã™\"]\n    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}\n    node_end[\"çµ‚äº†\"]\n    \n    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼\n    start--&gt;task1\n    task1--&gt;task2\n    task2--&gt;decision1\n    \n    %% å†ç¾ã—ãªã„å ´åˆ\n    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10\n    task10--&gt;decision_recurrence\n    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1\n    \n    %% å†ç¾ã™ã‚‹å ´åˆ\n    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3\n    task3--&gt;decision2\n    \n    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²\n    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4\n    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8\n    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9\n    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other\n    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "&#96;&#96;&#96;mermaid",
            "lineNumber": 1
          },
          {
            "text": "graph TD",
            "lineNumber": 2
          },
          {
            "text": "    start[\"é–‹å§‹\"]",
            "lineNumber": 3
          },
          {
            "text": "    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]",
            "lineNumber": 4
          },
          {
            "text": "    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]",
            "lineNumber": 5
          },
          {
            "text": "    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 6
          },
          {
            "text": "    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]",
            "lineNumber": 7
          },
          {
            "text": "    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}",
            "lineNumber": 8
          },
          {
            "text": "    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 9
          },
          {
            "text": "    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}",
            "lineNumber": 10
          },
          {
            "text": "    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 11
          },
          {
            "text": "    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 12
          },
          {
            "text": "    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]",
            "lineNumber": 13
          },
          {
            "text": "    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]",
            "lineNumber": 14
          },
          {
            "text": "    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]",
            "lineNumber": 15
          },
          {
            "text": "    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]",
            "lineNumber": 16
          },
          {
            "text": "    task10[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 17
          },
          {
            "text": "    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}",
            "lineNumber": 18
          },
          {
            "text": "    node_end[\"çµ‚äº†\"]",
            "lineNumber": 19
          },
          {
            "text": "    ",
            "lineNumber": 20
          },
          {
            "text": "    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 21
          },
          {
            "text": "    start--&gt;task1",
            "lineNumber": 22
          },
          {
            "text": "    task1--&gt;task2",
            "lineNumber": 23
          },
          {
            "text": "    task2--&gt;decision1",
            "lineNumber": 24
          },
          {
            "text": "    ",
            "lineNumber": 25
          },
          {
            "text": "    %% å†ç¾ã—ãªã„å ´åˆ",
            "lineNumber": 26
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 27
          },
          {
            "text": "    task10--&gt;decision_recurrence",
            "lineNumber": 28
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end",
            "lineNumber": 29
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1",
            "lineNumber": 30
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2",
            "lineNumber": 31
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3",
            "lineNumber": 32
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4",
            "lineNumber": 33
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1",
            "lineNumber": 34
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1",
            "lineNumber": 35
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1",
            "lineNumber": 36
          },
          {
            "text": "    ",
            "lineNumber": 37
          },
          {
            "text": "    %% å†ç¾ã™ã‚‹å ´åˆ",
            "lineNumber": 38
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3",
            "lineNumber": 39
          },
          {
            "text": "    task3--&gt;decision2",
            "lineNumber": 40
          },
          {
            "text": "    ",
            "lineNumber": 41
          },
          {
            "text": "    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²",
            "lineNumber": 42
          },
          {
            "text": "    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4",
            "lineNumber": 43
          },
          {
            "text": "    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8",
            "lineNumber": 44
          },
          {
            "text": "    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9",
            "lineNumber": 45
          },
          {
            "text": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other",
            "lineNumber": 46
          },
          {
            "text": "    ",
            "lineNumber": 47
          }
        ]
      },
      "score": 0.2923536002635956
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\flow.md",
        "range": {
          "startPosition": {
            "line": 132
          },
          "endPosition": {
            "line": 174,
            "column": 8
          }
        },
        "contents": "    subgraph flow1 [\"ä¸¡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]\n        check11_1[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check11_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check11_1_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task11_1[\"PGåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        check12_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check12_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check12_1_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task12_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        check13_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check13_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check13_1_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task13_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        task10_1[\"æµå‹•ã«æˆ»ã™\"]\n        decision1_1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n        \n        task5--&gt;check11_1\n        check11_1--&gt;decision_check11_1\n        decision_check11_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check11_1_1\n        decision_check11_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task11_1\n        decision_check11_1_1--&gt;|\"æ­£å¸¸\"|check12_1\n        decision_check11_1_1--&gt;|\"ç•°å¸¸\"|task11_1\n        task11_1--&gt;check12_1\n        check12_1--&gt;decision_check12_1\n        decision_check12_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check12_1_1\n        decision_check12_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task12_1\n        decision_check12_1_1--&gt;|\"æ­£å¸¸\"|check13_1\n        decision_check12_1_1--&gt;|\"ç•°å¸¸\"|task12_1\n        task12_1--&gt;check13_1\n        check13_1--&gt;decision_check13_1\n        decision_check13_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check13_1_1\n        decision_check13_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task13_1\n        decision_check13_1_1--&gt;|\"æ­£å¸¸\"|task10_1\n        decision_check13_1_1--&gt;|\"ç•°å¸¸\"|task13_1\n        task13_1--&gt;task10_1\n        task10_1--&gt;decision1_1\n        decision1_1--&gt;|\"å†ç¾ã—ãªã„\"|task10\n        decision1_1--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer\n    end\n    \n    %% ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\n    subgraph flow2 [\"ç‰‡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]\n        ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "    subgraph flow1 [\"ä¸¡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 133
          },
          {
            "text": "        check11_1[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 134
          },
          {
            "text": "        decision_check11_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 135
          },
          {
            "text": "        decision_check11_1_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 136
          },
          {
            "text": "        task11_1[\"PGåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 137
          },
          {
            "text": "        check12_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 138
          },
          {
            "text": "        decision_check12_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 139
          },
          {
            "text": "        decision_check12_1_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 140
          },
          {
            "text": "        task12_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 141
          },
          {
            "text": "        check13_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 142
          },
          {
            "text": "        decision_check13_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 143
          },
          {
            "text": "        decision_check13_1_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 144
          },
          {
            "text": "        task13_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 145
          },
          {
            "text": "        task10_1[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 146
          },
          {
            "text": "        decision1_1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 147
          },
          {
            "text": "        ",
            "lineNumber": 148
          },
          {
            "text": "        task5--&gt;check11_1",
            "lineNumber": 149
          },
          {
            "text": "        check11_1--&gt;decision_check11_1",
            "lineNumber": 150
          },
          {
            "text": "        decision_check11_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check11_1_1",
            "lineNumber": 151
          },
          {
            "text": "        decision_check11_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task11_1",
            "lineNumber": 152
          },
          {
            "text": "        decision_check11_1_1--&gt;|\"æ­£å¸¸\"|check12_1",
            "lineNumber": 153
          },
          {
            "text": "        decision_check11_1_1--&gt;|\"ç•°å¸¸\"|task11_1",
            "lineNumber": 154
          },
          {
            "text": "        task11_1--&gt;check12_1",
            "lineNumber": 155
          },
          {
            "text": "        check12_1--&gt;decision_check12_1",
            "lineNumber": 156
          },
          {
            "text": "        decision_check12_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check12_1_1",
            "lineNumber": 157
          },
          {
            "text": "        decision_check12_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task12_1",
            "lineNumber": 158
          },
          {
            "text": "        decision_check12_1_1--&gt;|\"æ­£å¸¸\"|check13_1",
            "lineNumber": 159
          },
          {
            "text": "        decision_check12_1_1--&gt;|\"ç•°å¸¸\"|task12_1",
            "lineNumber": 160
          },
          {
            "text": "        task12_1--&gt;check13_1",
            "lineNumber": 161
          },
          {
            "text": "        check13_1--&gt;decision_check13_1",
            "lineNumber": 162
          },
          {
            "text": "        decision_check13_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check13_1_1",
            "lineNumber": 163
          },
          {
            "text": "        decision_check13_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task13_1",
            "lineNumber": 164
          },
          {
            "text": "        decision_check13_1_1--&gt;|\"æ­£å¸¸\"|task10_1",
            "lineNumber": 165
          },
          {
            "text": "        decision_check13_1_1--&gt;|\"ç•°å¸¸\"|task13_1",
            "lineNumber": 166
          },
          {
            "text": "        task13_1--&gt;task10_1",
            "lineNumber": 167
          },
          {
            "text": "        task10_1--&gt;decision1_1",
            "lineNumber": 168
          },
          {
            "text": "        decision1_1--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 169
          },
          {
            "text": "        decision1_1--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer",
            "lineNumber": 170
          },
          {
            "text": "    end",
            "lineNumber": 171
          },
          {
            "text": "    ",
            "lineNumber": 172
          },
          {
            "text": "    %% ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 173
          },
          {
            "text": "    subgraph flow2 [\"ç‰‡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 174
          },
          {
            "text": "        ",
            "lineNumber": 175
          }
        ]
      },
      "score": 0.28918689489364624
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\flow.md",
        "range": {
          "startPosition": {
            "line": 45
          },
          "endPosition": {
            "line": 87
          }
        },
        "contents": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other\n    \n    %% ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã¸ã®é€£çµ¡ï¼ˆå…¨ãƒ¢ãƒ¼ãƒ‰å…±é€šï¼‰\n    contact_manufacturer[\"ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã«é€£çµ¡\"]\n    \n    %% å†ç¾ã—ãªã‹ã£ãŸJARVISãŒ1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸå ´åˆã®ç¹°ã‚Šè¿”ã—å‡¦ç†ãƒ•ãƒ­ãƒ¼\n    subgraph flow5 [\"å†ç™ºæ™‚ã®æ®µéšçš„å¯¾å¿œãƒ•ãƒ­ãƒ¼\"]\n        check9_1[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check9_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check9_1_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task9_1[\"PGåŸºæ¿ã‚’äº¤æ›\"]\n        task9_2[\"æµå‹•ã«æˆ»ã™\"]\n        decision9_1{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}\n        check9_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check9_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check9_3_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task9_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›\"]\n        task9_4[\"æµå‹•ã«æˆ»ã™\"]\n        decision9_2{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}\n        check9_5[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check9_5{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check9_5_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task9_5[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›\"]\n        task9_6[\"æµå‹•ã«æˆ»ã™\"]\n        decision9_3{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}\n        check9_7[\"å†…éƒ¨ã®FFCã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check9_7{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check9_7_1{\"å†…éƒ¨ã®FFCã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task9_7[\"å†…éƒ¨ã®FFCã‚’äº¤æ›\"]\n        task9_8[\"æµå‹•ã«æˆ»ã™\"]\n        decision9_4{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}\n        task9_9[\"æ‹…å½“ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã«é€£çµ¡\"]\n        \n        task9--&gt;check9_1\n        check9_1--&gt;decision_check9_1\n        decision_check9_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_1_1\n        decision_check9_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_1\n        decision_check9_1_1--&gt;|\"æ­£å¸¸\"|task9_2\n        decision_check9_1_1--&gt;|\"ç•°å¸¸\"|task9_1\n        task9_1--&gt;task9_2\n        task9_2--&gt;decision9_1\n        decision9_1--&gt;|\"å‡ºã¦ããŸ\"|check9_3",
        "signatures": {},
        "detailedLines": [
          {
            "text": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other",
            "lineNumber": 46
          },
          {
            "text": "    ",
            "lineNumber": 47
          },
          {
            "text": "    %% ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã¸ã®é€£çµ¡ï¼ˆå…¨ãƒ¢ãƒ¼ãƒ‰å…±é€šï¼‰",
            "lineNumber": 48
          },
          {
            "text": "    contact_manufacturer[\"ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã«é€£çµ¡\"]",
            "lineNumber": 49
          },
          {
            "text": "    ",
            "lineNumber": 50
          },
          {
            "text": "    %% å†ç¾ã—ãªã‹ã£ãŸJARVISãŒ1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸå ´åˆã®ç¹°ã‚Šè¿”ã—å‡¦ç†ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 51
          },
          {
            "text": "    subgraph flow5 [\"å†ç™ºæ™‚ã®æ®µéšçš„å¯¾å¿œãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 52
          },
          {
            "text": "        check9_1[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 53
          },
          {
            "text": "        decision_check9_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 54
          },
          {
            "text": "        decision_check9_1_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 55
          },
          {
            "text": "        task9_1[\"PGåŸºæ¿ã‚’äº¤æ›\"]",
            "lineNumber": 56
          },
          {
            "text": "        task9_2[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 57
          },
          {
            "text": "        decision9_1{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}",
            "lineNumber": 58
          },
          {
            "text": "        check9_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 59
          },
          {
            "text": "        decision_check9_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 60
          },
          {
            "text": "        decision_check9_3_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 61
          },
          {
            "text": "        task9_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›\"]",
            "lineNumber": 62
          },
          {
            "text": "        task9_4[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 63
          },
          {
            "text": "        decision9_2{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}",
            "lineNumber": 64
          },
          {
            "text": "        check9_5[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 65
          },
          {
            "text": "        decision_check9_5{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 66
          },
          {
            "text": "        decision_check9_5_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 67
          },
          {
            "text": "        task9_5[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›\"]",
            "lineNumber": 68
          },
          {
            "text": "        task9_6[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 69
          },
          {
            "text": "        decision9_3{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}",
            "lineNumber": 70
          },
          {
            "text": "        check9_7[\"å†…éƒ¨ã®FFCã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 71
          },
          {
            "text": "        decision_check9_7{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 72
          },
          {
            "text": "        decision_check9_7_1{\"å†…éƒ¨ã®FFCã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 73
          },
          {
            "text": "        task9_7[\"å†…éƒ¨ã®FFCã‚’äº¤æ›\"]",
            "lineNumber": 74
          },
          {
            "text": "        task9_8[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 75
          },
          {
            "text": "        decision9_4{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}",
            "lineNumber": 76
          },
          {
            "text": "        task9_9[\"æ‹…å½“ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã«é€£çµ¡\"]",
            "lineNumber": 77
          },
          {
            "text": "        ",
            "lineNumber": 78
          },
          {
            "text": "        task9--&gt;check9_1",
            "lineNumber": 79
          },
          {
            "text": "        check9_1--&gt;decision_check9_1",
            "lineNumber": 80
          },
          {
            "text": "        decision_check9_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_1_1",
            "lineNumber": 81
          },
          {
            "text": "        decision_check9_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_1",
            "lineNumber": 82
          },
          {
            "text": "        decision_check9_1_1--&gt;|\"æ­£å¸¸\"|task9_2",
            "lineNumber": 83
          },
          {
            "text": "        decision_check9_1_1--&gt;|\"ç•°å¸¸\"|task9_1",
            "lineNumber": 84
          },
          {
            "text": "        task9_1--&gt;task9_2",
            "lineNumber": 85
          },
          {
            "text": "        task9_2--&gt;decision9_1",
            "lineNumber": 86
          },
          {
            "text": "        decision9_1--&gt;|\"å‡ºã¦ããŸ\"|check9_3",
            "lineNumber": 87
          }
        ]
      },
      "score": 0.2884403467178345
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\storage\\toon_files\\flow_md.md",
        "range": {
          "startPosition": {
            "line": 232
          },
          "endPosition": {
            "line": 273
          }
        },
        "contents": "    subgraph flow4 [\"ãƒ‡ãƒ¼ã‚¿ç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]\n        check11_3[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check11_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check11_3_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task11_3[\"PGåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        check12_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check12_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check12_3_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task12_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        task14_2[\"JARVISå†…éƒ¨ã®FFCã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]\n        task15_2[\"è£å´ã®ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]\n        task16_2[\"JARVISå†…éƒ¨ã®ã‚±ãƒ¼ãƒ–ãƒ«ã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]\n        task17_2[\"MK.â…¡(ä¿¡å·ç™ºç”Ÿæ©Ÿ)ã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„ã€‚\"]\n        task10_4[\"æµå‹•ã«æˆ»ã™\"]\n        decision1_4{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n        \n        task8--&gt;check11_3\n        check11_3--&gt;decision_check11_3\n        decision_check11_3--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check11_3_1\n        decision_check11_3--&gt;|\"åˆ¤å®šã§ããªã„\"|task11_3\n        decision_check11_3_1--&gt;|\"æ­£å¸¸\"|check12_3\n        decision_check11_3_1--&gt;|\"ç•°å¸¸\"|task11_3\n        task11_3--&gt;check12_3\n        check12_3--&gt;decision_check12_3\n        decision_check12_3--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check12_3_1\n        decision_check12_3--&gt;|\"åˆ¤å®šã§ããªã„\"|task12_3\n        decision_check12_3_1--&gt;|\"æ­£å¸¸\"|task14_2\n        decision_check12_3_1--&gt;|\"ç•°å¸¸\"|task12_3\n        task12_3--&gt;task14_2\n        task14_2--&gt;task15_2\n        task15_2--&gt;task16_2\n        task16_2--&gt;task17_2\n        task17_2--&gt;task10_4\n        task10_4--&gt;decision1_4\n        decision1_4--&gt;|\"å†ç¾ã—ãªã„\"|task10\n        decision1_4--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer\n    end\n    \n    %% ã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\n    subgraph flow6 [\"ãã®ä»–ã®ç—‡çŠ¶ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]\n        task_other_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã®FFCã‚’äº¤æ›ã™ã‚‹\"]",
        "signatures": {},
        "detailedLines": [
          {
            "text": "    subgraph flow4 [\"ãƒ‡ãƒ¼ã‚¿ç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 233
          },
          {
            "text": "        check11_3[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 234
          },
          {
            "text": "        decision_check11_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 235
          },
          {
            "text": "        decision_check11_3_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 236
          },
          {
            "text": "        task11_3[\"PGåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 237
          },
          {
            "text": "        check12_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 238
          },
          {
            "text": "        decision_check12_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 239
          },
          {
            "text": "        decision_check12_3_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 240
          },
          {
            "text": "        task12_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 241
          },
          {
            "text": "        task14_2[\"JARVISå†…éƒ¨ã®FFCã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]",
            "lineNumber": 242
          },
          {
            "text": "        task15_2[\"è£å´ã®ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]",
            "lineNumber": 243
          },
          {
            "text": "        task16_2[\"JARVISå†…éƒ¨ã®ã‚±ãƒ¼ãƒ–ãƒ«ã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]",
            "lineNumber": 244
          },
          {
            "text": "        task17_2[\"MK.â…¡(ä¿¡å·ç™ºç”Ÿæ©Ÿ)ã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„ã€‚\"]",
            "lineNumber": 245
          },
          {
            "text": "        task10_4[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 246
          },
          {
            "text": "        decision1_4{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 247
          },
          {
            "text": "        ",
            "lineNumber": 248
          },
          {
            "text": "        task8--&gt;check11_3",
            "lineNumber": 249
          },
          {
            "text": "        check11_3--&gt;decision_check11_3",
            "lineNumber": 250
          },
          {
            "text": "        decision_check11_3--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check11_3_1",
            "lineNumber": 251
          },
          {
            "text": "        decision_check11_3--&gt;|\"åˆ¤å®šã§ããªã„\"|task11_3",
            "lineNumber": 252
          },
          {
            "text": "        decision_check11_3_1--&gt;|\"æ­£å¸¸\"|check12_3",
            "lineNumber": 253
          },
          {
            "text": "        decision_check11_3_1--&gt;|\"ç•°å¸¸\"|task11_3",
            "lineNumber": 254
          },
          {
            "text": "        task11_3--&gt;check12_3",
            "lineNumber": 255
          },
          {
            "text": "        check12_3--&gt;decision_check12_3",
            "lineNumber": 256
          },
          {
            "text": "        decision_check12_3--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check12_3_1",
            "lineNumber": 257
          },
          {
            "text": "        decision_check12_3--&gt;|\"åˆ¤å®šã§ããªã„\"|task12_3",
            "lineNumber": 258
          },
          {
            "text": "        decision_check12_3_1--&gt;|\"æ­£å¸¸\"|task14_2",
            "lineNumber": 259
          },
          {
            "text": "        decision_check12_3_1--&gt;|\"ç•°å¸¸\"|task12_3",
            "lineNumber": 260
          },
          {
            "text": "        task12_3--&gt;task14_2",
            "lineNumber": 261
          },
          {
            "text": "        task14_2--&gt;task15_2",
            "lineNumber": 262
          },
          {
            "text": "        task15_2--&gt;task16_2",
            "lineNumber": 263
          },
          {
            "text": "        task16_2--&gt;task17_2",
            "lineNumber": 264
          },
          {
            "text": "        task17_2--&gt;task10_4",
            "lineNumber": 265
          },
          {
            "text": "        task10_4--&gt;decision1_4",
            "lineNumber": 266
          },
          {
            "text": "        decision1_4--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 267
          },
          {
            "text": "        decision1_4--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer",
            "lineNumber": 268
          },
          {
            "text": "    end",
            "lineNumber": 269
          },
          {
            "text": "    ",
            "lineNumber": 270
          },
          {
            "text": "    %% ã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 271
          },
          {
            "text": "    subgraph flow6 [\"ãã®ä»–ã®ç—‡çŠ¶ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 272
          },
          {
            "text": "        task_other_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã®FFCã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 273
          }
        ]
      },
      "score": 0.27814391255378723
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\llm_client.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 268
          }
        },
        "contents": "import os\nimport requests\nimport re\nfrom pathlib import Path\nfrom typing import Optional\nfrom core.exceptions import LLMAPIError\nfrom core.schemas import Flowchart\n\nclass LLMClient:\n    def __init__(self):\n        # Streamlitã®secretsã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã‚€ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ä»˜ãï¼‰\n        try:\n            import streamlit as st\n            # st.secretsãŒåˆ©ç”¨å¯èƒ½ãªå ´åˆï¼ˆStreamlitå®Ÿè¡Œç’°å¢ƒï¼‰\n            ollama_config = st.secrets.get(\"ollama\", {})\n            self.base_url = ollama_config.get(\"base_url\", \"http://localhost:11434\")\n            self.model = ollama_config.get(\"model\", \"llama3.2\")\n        except (AttributeError, FileNotFoundError, ImportError, RuntimeError):\n            # secrets.tomlãŒå­˜åœ¨ã—ãªã„å ´åˆã€ã¾ãŸã¯Streamlitå¤–ã§å®Ÿè¡Œã•ã‚Œã‚‹å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯\n            # ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã‚€ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒãªã©ï¼‰\n            self.base_url = os.getenv(\"OLLAMA_BASE_URL\", \"http://localhost:11434\")\n            self.model = os.getenv(\"OLLAMA_MODEL\", \"llama3.2\")\n        \n        # APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ\n        self.api_url = f\"{self.base_url}/api/chat\"\n\n        # rules.md (Skills) ã¨ TOON_BASE.md (Format) ã‚’èª­ã¿è¾¼ã‚€\n        # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‚’æ˜ç¤ºçš„ã«æŒ‡å®šï¼ˆStreamlitã®å®Ÿè¡Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¾å­˜ã—ãªã„ï¼‰\n        base_dir = Path(__file__).parent.parent\n        rules_path = base_dir / \"rules.md\"\n        base_path = base_dir / \"TOON_BASE.md\"\n        \n        rules_text = self._load_file(rules_path, \"Skills: Standard Flow Logic\")\n        base_text = self._load_file(base_path, \"Format: TOON Output\")\n        \n        # æƒ…å ±åé›†ã®æŒ‡ç¤ºã‚’è¿½åŠ \n        information_gathering_instruction",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import os",
            "lineNumber": 1
          },
          {
            "text": "import requests",
            "lineNumber": 2
          },
          {
            "text": "import re",
            "lineNumber": 3
          },
          {
            "text": "from pathlib import Path",
            "lineNumber": 4
          },
          {
            "text": "from typing import Optional",
            "lineNumber": 5
          },
          {
            "text": "from core.exceptions import LLMAPIError",
            "lineNumber": 6
          },
          {
            "text": "from core.schemas import Flowchart",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "class LLMClient:",
            "lineNumber": 9,
            "isSignature": true
          },
          {
            "text": "    def __init__(self):",
            "lineNumber": 10
          },
          {
            "text": "        # Streamlitã®secretsã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã‚€ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ä»˜ãï¼‰",
            "lineNumber": 11
          },
          {
            "text": "        try:",
            "lineNumber": 12
          },
          {
            "text": "            import streamlit as st",
            "lineNumber": 13
          },
          {
            "text": "            # st.secretsãŒåˆ©ç”¨å¯èƒ½ãªå ´åˆï¼ˆStreamlitå®Ÿè¡Œç’°å¢ƒï¼‰",
            "lineNumber": 14
          },
          {
            "text": "            ollama_config = st.secrets.get(\"ollama\", {})",
            "lineNumber": 15
          },
          {
            "text": "            self.base_url = ollama_config.get(\"base_url\", \"http://localhost:11434\")",
            "lineNumber": 16
          },
          {
            "text": "            self.model = ollama_config.get(\"model\", \"llama3.2\")",
            "lineNumber": 17
          },
          {
            "text": "        except (AttributeError, FileNotFoundError, ImportError, RuntimeError):",
            "lineNumber": 18
          },
          {
            "text": "            # secrets.tomlãŒå­˜åœ¨ã—ãªã„å ´åˆã€ã¾ãŸã¯Streamlitå¤–ã§å®Ÿè¡Œã•ã‚Œã‚‹å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯",
            "lineNumber": 19
          },
          {
            "text": "            # ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã‚€ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒãªã©ï¼‰",
            "lineNumber": 20
          },
          {
            "text": "            self.base_url = os.getenv(\"OLLAMA_BASE_URL\", \"http://localhost:11434\")",
            "lineNumber": 21
          },
          {
            "text": "            self.model = os.getenv(\"OLLAMA_MODEL\", \"llama3.2\")",
            "lineNumber": 22
          },
          {
            "text": "        ",
            "lineNumber": 23
          },
          {
            "text": "        # APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ",
            "lineNumber": 24
          },
          {
            "text": "        self.api_url = f\"{self.base_url}/api/chat\"",
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "text": "        # rules.md (Skills) ã¨ TOON_BASE.md (Format) ã‚’èª­ã¿è¾¼ã‚€",
            "lineNumber": 27
          },
          {
            "text": "        # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‚’æ˜ç¤ºçš„ã«æŒ‡å®šï¼ˆStreamlitã®å®Ÿè¡Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¾å­˜ã—ãªã„ï¼‰",
            "lineNumber": 28
          },
          {
            "text": "        base_dir = Path(__file__).parent.parent",
            "lineNumber": 29
          },
          {
            "text": "        rules_path = base_dir / \"rules.md\"",
            "lineNumber": 30
          },
          {
            "text": "        base_path = base_dir / \"TOON_BASE.md\"",
            "lineNumber": 31
          },
          {
            "text": "        ",
            "lineNumber": 32
          },
          {
            "text": "        rules_text = self._load_file(rules_path, \"Skills: Standard Flow Logic\")",
            "lineNumber": 33
          },
          {
            "text": "        base_text = self._load_file(base_path, \"Format: TOON Output\")",
            "lineNumber": 34
          },
          {
            "text": "        ",
            "lineNumber": 35
          },
          {
            "text": "        # æƒ…å ±åé›†ã®æŒ‡ç¤ºã‚’è¿½åŠ ",
            "lineNumber": 36
          },
          {
            "text": "        information_gathering_instruction",
            "lineNumber": 37
          }
        ]
      },
      "score": 0.27562621235847473
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 153,
            "column": 54
          },
          "endPosition": {
            "line": 187,
            "column": 24
          }
        },
        "contents": "with col_chat:\n    st.subheader(\"ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ\")\n    \n    # è³ªå•ãŒä¿ç•™ä¸­ã®å ´åˆã¯è³ªå•ã‚’è¡¨ç¤ºã—ã€å›ç­”å…¥åŠ›æ¬„ã‚’è¡¨ç¤º\n    if st.session_state.pending_questions:\n        # è³ªå•ã¨å›ç­”ã®å±¥æ­´ã‚’è¡¨ç¤º\n        if st.session_state.conversation_context:\n            with st.expander(\"ğŸ“ ä¼šè©±å±¥æ­´\", expanded=False):\n                st.markdown(\"**å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:**\")\n                st.text(st.session_state.conversation_context)\n                \n                if st.session_state.question_responses:\n                    st.markdown(\"**ã“ã‚Œã¾ã§ã®å›ç­”:**\")\n                    for i, response in enumerate(st.session_state.question_responses, 1):\n                        st.markdown(f\"{i}. {response}\")\n        \n        st.info(\"ğŸ“‹ LLMã‹ã‚‰ã®è³ªå•:\")\n        st.markdown(st.session_state.pending_questions)\n        \n        st.divider()\n        st.subheader(\"ğŸ’­ å›ç­”ã‚’å…¥åŠ›\")\n        \n        # å›ç­”å…¥åŠ›æ¬„\n        user_answer = st.text_area(\n            \"è³ªå•ã«å¯¾ã™ã‚‹å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\",\n            placeholder=\"å›ç­”ã‚’å…¥åŠ›...\",\n            height=100,\n            key=\"answer_input\"\n        )\n        \n        col_answer, col_cancel = st.columns([2, 1])\n        with col_answer:\n            if st.button",
        "signatures": {},
        "detailedLines": [
          {
            "text": "with col_chat:",
            "lineNumber": 156
          },
          {
            "text": "    st.subheader(\"ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ\")",
            "lineNumber": 157
          },
          {
            "text": "    ",
            "lineNumber": 158
          },
          {
            "text": "    # è³ªå•ãŒä¿ç•™ä¸­ã®å ´åˆã¯è³ªå•ã‚’è¡¨ç¤ºã—ã€å›ç­”å…¥åŠ›æ¬„ã‚’è¡¨ç¤º",
            "lineNumber": 159
          },
          {
            "text": "    if st.session_state.pending_questions:",
            "lineNumber": 160
          },
          {
            "text": "        # è³ªå•ã¨å›ç­”ã®å±¥æ­´ã‚’è¡¨ç¤º",
            "lineNumber": 161
          },
          {
            "text": "        if st.session_state.conversation_context:",
            "lineNumber": 162
          },
          {
            "text": "            with st.expander(\"ğŸ“ ä¼šè©±å±¥æ­´\", expanded=False):",
            "lineNumber": 163
          },
          {
            "text": "                st.markdown(\"**å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:**\")",
            "lineNumber": 164
          },
          {
            "text": "                st.text(st.session_state.conversation_context)",
            "lineNumber": 165
          },
          {
            "text": "                ",
            "lineNumber": 166
          },
          {
            "text": "                if st.session_state.question_responses:",
            "lineNumber": 167
          },
          {
            "text": "                    st.markdown(\"**ã“ã‚Œã¾ã§ã®å›ç­”:**\")",
            "lineNumber": 168
          },
          {
            "text": "                    for i, response in enumerate(st.session_state.question_responses, 1):",
            "lineNumber": 169
          },
          {
            "text": "                        st.markdown(f\"{i}. {response}\")",
            "lineNumber": 170
          },
          {
            "text": "        ",
            "lineNumber": 171
          },
          {
            "text": "        st.info(\"ğŸ“‹ LLMã‹ã‚‰ã®è³ªå•:\")",
            "lineNumber": 172
          },
          {
            "text": "        st.markdown(st.session_state.pending_questions)",
            "lineNumber": 173
          },
          {
            "text": "        ",
            "lineNumber": 174
          },
          {
            "text": "        st.divider()",
            "lineNumber": 175
          },
          {
            "text": "        st.subheader(\"ğŸ’­ å›ç­”ã‚’å…¥åŠ›\")",
            "lineNumber": 176
          },
          {
            "text": "        ",
            "lineNumber": 177
          },
          {
            "text": "        # å›ç­”å…¥åŠ›æ¬„",
            "lineNumber": 178
          },
          {
            "text": "        user_answer = st.text_area(",
            "lineNumber": 179
          },
          {
            "text": "            \"è³ªå•ã«å¯¾ã™ã‚‹å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\",",
            "lineNumber": 180
          },
          {
            "text": "            placeholder=\"å›ç­”ã‚’å…¥åŠ›...\",",
            "lineNumber": 181
          },
          {
            "text": "            height=100,",
            "lineNumber": 182
          },
          {
            "text": "            key=\"answer_input\"",
            "lineNumber": 183
          },
          {
            "text": "        )",
            "lineNumber": 184
          },
          {
            "text": "        ",
            "lineNumber": 185
          },
          {
            "text": "        col_answer, col_cancel = st.columns([2, 1])",
            "lineNumber": 186
          },
          {
            "text": "        with col_answer:",
            "lineNumber": 187
          },
          {
            "text": "            if st.button",
            "lineNumber": 188
          }
        ]
      },
      "score": 0.26747938990592957
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\storage\\toon_files\\flow_md.md",
        "range": {
          "startPosition": {
            "line": 45
          },
          "endPosition": {
            "line": 87
          }
        },
        "contents": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other\n    \n    %% ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã¸ã®é€£çµ¡ï¼ˆå…¨ãƒ¢ãƒ¼ãƒ‰å…±é€šï¼‰\n    contact_manufacturer[\"ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã«é€£çµ¡\"]\n    \n    %% å†ç¾ã—ãªã‹ã£ãŸJARVISãŒ1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸå ´åˆã®ç¹°ã‚Šè¿”ã—å‡¦ç†ãƒ•ãƒ­ãƒ¼\n    subgraph flow5 [\"å†ç™ºæ™‚ã®æ®µéšçš„å¯¾å¿œãƒ•ãƒ­ãƒ¼\"]\n        check9_1[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check9_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check9_1_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task9_1[\"PGåŸºæ¿ã‚’äº¤æ›\"]\n        task9_2[\"æµå‹•ã«æˆ»ã™\"]\n        decision9_1{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}\n        check9_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check9_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check9_3_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task9_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›\"]\n        task9_4[\"æµå‹•ã«æˆ»ã™\"]\n        decision9_2{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}\n        check9_5[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check9_5{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check9_5_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task9_5[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›\"]\n        task9_6[\"æµå‹•ã«æˆ»ã™\"]\n        decision9_3{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}\n        check9_7[\"å†…éƒ¨ã®FFCã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check9_7{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check9_7_1{\"å†…éƒ¨ã®FFCã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task9_7[\"å†…éƒ¨ã®FFCã‚’äº¤æ›\"]\n        task9_8[\"æµå‹•ã«æˆ»ã™\"]\n        decision9_4{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}\n        task9_9[\"æ‹…å½“ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã«é€£çµ¡\"]\n        \n        task9--&gt;check9_1\n        check9_1--&gt;decision_check9_1\n        decision_check9_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_1_1\n        decision_check9_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_1\n        decision_check9_1_1--&gt;|\"æ­£å¸¸\"|task9_2\n        decision_check9_1_1--&gt;|\"ç•°å¸¸\"|task9_1\n        task9_1--&gt;task9_2\n        task9_2--&gt;decision9_1\n        decision9_1--&gt;|\"å‡ºã¦ããŸ\"|check9_3",
        "signatures": {},
        "detailedLines": [
          {
            "text": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other",
            "lineNumber": 46
          },
          {
            "text": "    ",
            "lineNumber": 47
          },
          {
            "text": "    %% ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã¸ã®é€£çµ¡ï¼ˆå…¨ãƒ¢ãƒ¼ãƒ‰å…±é€šï¼‰",
            "lineNumber": 48
          },
          {
            "text": "    contact_manufacturer[\"ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã«é€£çµ¡\"]",
            "lineNumber": 49
          },
          {
            "text": "    ",
            "lineNumber": 50
          },
          {
            "text": "    %% å†ç¾ã—ãªã‹ã£ãŸJARVISãŒ1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸå ´åˆã®ç¹°ã‚Šè¿”ã—å‡¦ç†ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 51
          },
          {
            "text": "    subgraph flow5 [\"å†ç™ºæ™‚ã®æ®µéšçš„å¯¾å¿œãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 52
          },
          {
            "text": "        check9_1[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 53
          },
          {
            "text": "        decision_check9_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 54
          },
          {
            "text": "        decision_check9_1_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 55
          },
          {
            "text": "        task9_1[\"PGåŸºæ¿ã‚’äº¤æ›\"]",
            "lineNumber": 56
          },
          {
            "text": "        task9_2[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 57
          },
          {
            "text": "        decision9_1{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}",
            "lineNumber": 58
          },
          {
            "text": "        check9_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 59
          },
          {
            "text": "        decision_check9_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 60
          },
          {
            "text": "        decision_check9_3_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 61
          },
          {
            "text": "        task9_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›\"]",
            "lineNumber": 62
          },
          {
            "text": "        task9_4[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 63
          },
          {
            "text": "        decision9_2{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}",
            "lineNumber": 64
          },
          {
            "text": "        check9_5[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 65
          },
          {
            "text": "        decision_check9_5{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 66
          },
          {
            "text": "        decision_check9_5_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 67
          },
          {
            "text": "        task9_5[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›\"]",
            "lineNumber": 68
          },
          {
            "text": "        task9_6[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 69
          },
          {
            "text": "        decision9_3{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}",
            "lineNumber": 70
          },
          {
            "text": "        check9_7[\"å†…éƒ¨ã®FFCã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 71
          },
          {
            "text": "        decision_check9_7{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 72
          },
          {
            "text": "        decision_check9_7_1{\"å†…éƒ¨ã®FFCã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 73
          },
          {
            "text": "        task9_7[\"å†…éƒ¨ã®FFCã‚’äº¤æ›\"]",
            "lineNumber": 74
          },
          {
            "text": "        task9_8[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 75
          },
          {
            "text": "        decision9_4{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}",
            "lineNumber": 76
          },
          {
            "text": "        task9_9[\"æ‹…å½“ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã«é€£çµ¡\"]",
            "lineNumber": 77
          },
          {
            "text": "        ",
            "lineNumber": 78
          },
          {
            "text": "        task9--&gt;check9_1",
            "lineNumber": 79
          },
          {
            "text": "        check9_1--&gt;decision_check9_1",
            "lineNumber": 80
          },
          {
            "text": "        decision_check9_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_1_1",
            "lineNumber": 81
          },
          {
            "text": "        decision_check9_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_1",
            "lineNumber": 82
          },
          {
            "text": "        decision_check9_1_1--&gt;|\"æ­£å¸¸\"|task9_2",
            "lineNumber": 83
          },
          {
            "text": "        decision_check9_1_1--&gt;|\"ç•°å¸¸\"|task9_1",
            "lineNumber": 84
          },
          {
            "text": "        task9_1--&gt;task9_2",
            "lineNumber": 85
          },
          {
            "text": "        task9_2--&gt;decision9_1",
            "lineNumber": 86
          },
          {
            "text": "        decision9_1--&gt;|\"å‡ºã¦ããŸ\"|check9_3",
            "lineNumber": 87
          }
        ]
      },
      "score": 0.26475128531455994
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\storage\\toon_files\\flow_md.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 47
          }
        },
        "contents": "&#96;&#96;&#96;mermaid\ngraph TD\n    start[\"é–‹å§‹\"]\n    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]\n    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]\n    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]\n    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}\n    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}\n    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]\n    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]\n    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]\n    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]\n    task10[\"æµå‹•ã«æˆ»ã™\"]\n    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}\n    node_end[\"çµ‚äº†\"]\n    \n    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼\n    start--&gt;task1\n    task1--&gt;task2\n    task2--&gt;decision1\n    \n    %% å†ç¾ã—ãªã„å ´åˆ\n    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10\n    task10--&gt;decision_recurrence\n    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1\n    \n    %% å†ç¾ã™ã‚‹å ´åˆ\n    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3\n    task3--&gt;decision2\n    \n    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²\n    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4\n    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8\n    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9\n    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other\n    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "&#96;&#96;&#96;mermaid",
            "lineNumber": 1
          },
          {
            "text": "graph TD",
            "lineNumber": 2
          },
          {
            "text": "    start[\"é–‹å§‹\"]",
            "lineNumber": 3
          },
          {
            "text": "    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]",
            "lineNumber": 4
          },
          {
            "text": "    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]",
            "lineNumber": 5
          },
          {
            "text": "    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 6
          },
          {
            "text": "    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]",
            "lineNumber": 7
          },
          {
            "text": "    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}",
            "lineNumber": 8
          },
          {
            "text": "    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 9
          },
          {
            "text": "    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}",
            "lineNumber": 10
          },
          {
            "text": "    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 11
          },
          {
            "text": "    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 12
          },
          {
            "text": "    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]",
            "lineNumber": 13
          },
          {
            "text": "    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]",
            "lineNumber": 14
          },
          {
            "text": "    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]",
            "lineNumber": 15
          },
          {
            "text": "    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]",
            "lineNumber": 16
          },
          {
            "text": "    task10[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 17
          },
          {
            "text": "    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}",
            "lineNumber": 18
          },
          {
            "text": "    node_end[\"çµ‚äº†\"]",
            "lineNumber": 19
          },
          {
            "text": "    ",
            "lineNumber": 20
          },
          {
            "text": "    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 21
          },
          {
            "text": "    start--&gt;task1",
            "lineNumber": 22
          },
          {
            "text": "    task1--&gt;task2",
            "lineNumber": 23
          },
          {
            "text": "    task2--&gt;decision1",
            "lineNumber": 24
          },
          {
            "text": "    ",
            "lineNumber": 25
          },
          {
            "text": "    %% å†ç¾ã—ãªã„å ´åˆ",
            "lineNumber": 26
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 27
          },
          {
            "text": "    task10--&gt;decision_recurrence",
            "lineNumber": 28
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end",
            "lineNumber": 29
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1",
            "lineNumber": 30
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2",
            "lineNumber": 31
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3",
            "lineNumber": 32
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4",
            "lineNumber": 33
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1",
            "lineNumber": 34
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1",
            "lineNumber": 35
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1",
            "lineNumber": 36
          },
          {
            "text": "    ",
            "lineNumber": 37
          },
          {
            "text": "    %% å†ç¾ã™ã‚‹å ´åˆ",
            "lineNumber": 38
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3",
            "lineNumber": 39
          },
          {
            "text": "    task3--&gt;decision2",
            "lineNumber": 40
          },
          {
            "text": "    ",
            "lineNumber": 41
          },
          {
            "text": "    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²",
            "lineNumber": 42
          },
          {
            "text": "    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4",
            "lineNumber": 43
          },
          {
            "text": "    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8",
            "lineNumber": 44
          },
          {
            "text": "    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9",
            "lineNumber": 45
          },
          {
            "text": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other",
            "lineNumber": 46
          },
          {
            "text": "    ",
            "lineNumber": 47
          }
        ]
      },
      "score": 0.26380690932273865
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\llm_client.py",
        "range": {
          "startPosition": {
            "line": 8
          },
          "endPosition": {
            "line": 268
          }
        },
        "contents": "class LLMClient:\ndef generate_flow(self, user_input: str, current_flowchart: Optional[Flowchart] = None) -&gt; str:\n\n            \n            # Ollama HTTP APIã‚’ç›´æ¥å‘¼ã³å‡ºã—\n            payload = {\n                \"model\": self.model,\n                \"messages\": [\n                    {\"role\": \"system\", \"content\": system_prompt},\n                    {\"role\": \"user\", \"content\": enhanced_input}\n                ],\n                \"options\": {\n                    \"temperature\": 0.7\n                },\n                \"stream\": False\n            }\n            \n            # localhostã¸ã®æ¥ç¶šã§ã¯ãƒ—ãƒ­ã‚­ã‚·ã‚’ä½¿ç”¨ã—ãªã„\n            proxies = {\"http\": None, \"https\": None} if \"localhost\" in self.base_url or \"127.0.0.1\" in self.base_url else None\n            \n            response = requests.post(\n                self.api_url,\n                json=payload,\n                timeout=300,  # 5åˆ†ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ\n                proxies=proxies\n            )\n            \n            # HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯\n            response.raise_for_status()\n            \n            # JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è§£æ\n            result = response.json()\n            \n            if result and 'message' in result and 'content' in result['message']:\n                toon_text = result['message']['content']\n                \n                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼ï¼ˆè³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰\n                if not self.is_question_response(toon_text):\n                    is_valid, validation_message = self.validate_output_size(toon_text)\n                    if not is_valid:\n                        # è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’TOONå½¢å¼ã®å‰ã«è¿½åŠ ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆå½¢å¼ï¼‰\n                        warning_comment = f\"&lt;!-- {validation_message} --&gt;\\n\"\n                        toon_text = warning_comment + toon_text\n                \n                return toon_text\n            else:\n                raise ValueError(\"ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰æœ‰åŠ¹ãªå¿œç­”ãŒå¾—ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚\")\n                \n        except ValueError:\n            # å†ç™ºç”Ÿã•ã›ã‚‹\n            raise\n        except requests.exceptions.ConnectionError as e:\n            # æ¥ç¶šã‚¨ãƒ©ãƒ¼ã®å ´åˆ\n            raise",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 9,
                "column": 1
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 145,
                "column": 5
              },
              "endPosition": {
                "line": 146,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class LLMClient:",
            "lineNumber": 9,
            "isSignature": true
          },
          {
            "text": "def generate_flow(self, user_input: str, current_flowchart: Optional[Flowchart] = None) -&gt; str:",
            "lineNumber": 145
          },
          {
            "lineNumber": 174
          },
          {
            "text": "            ",
            "lineNumber": 175
          },
          {
            "text": "            # Ollama HTTP APIã‚’ç›´æ¥å‘¼ã³å‡ºã—",
            "lineNumber": 176
          },
          {
            "text": "            payload = {",
            "lineNumber": 177
          },
          {
            "text": "                \"model\": self.model,",
            "lineNumber": 178
          },
          {
            "text": "                \"messages\": [",
            "lineNumber": 179
          },
          {
            "text": "                    {\"role\": \"system\", \"content\": system_prompt},",
            "lineNumber": 180
          },
          {
            "text": "                    {\"role\": \"user\", \"content\": enhanced_input}",
            "lineNumber": 181
          },
          {
            "text": "                ],",
            "lineNumber": 182
          },
          {
            "text": "                \"options\": {",
            "lineNumber": 183
          },
          {
            "text": "                    \"temperature\": 0.7",
            "lineNumber": 184
          },
          {
            "text": "                },",
            "lineNumber": 185
          },
          {
            "text": "                \"stream\": False",
            "lineNumber": 186
          },
          {
            "text": "            }",
            "lineNumber": 187
          },
          {
            "text": "            ",
            "lineNumber": 188
          },
          {
            "text": "            # localhostã¸ã®æ¥ç¶šã§ã¯ãƒ—ãƒ­ã‚­ã‚·ã‚’ä½¿ç”¨ã—ãªã„",
            "lineNumber": 189
          },
          {
            "text": "            proxies = {\"http\": None, \"https\": None} if \"localhost\" in self.base_url or \"127.0.0.1\" in self.base_url else None",
            "lineNumber": 190
          },
          {
            "text": "            ",
            "lineNumber": 191
          },
          {
            "text": "            response = requests.post(",
            "lineNumber": 192
          },
          {
            "text": "                self.api_url,",
            "lineNumber": 193
          },
          {
            "text": "                json=payload,",
            "lineNumber": 194
          },
          {
            "text": "                timeout=300,  # 5åˆ†ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ",
            "lineNumber": 195
          },
          {
            "text": "                proxies=proxies",
            "lineNumber": 196
          },
          {
            "text": "            )",
            "lineNumber": 197
          },
          {
            "text": "            ",
            "lineNumber": 198
          },
          {
            "text": "            # HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 199
          },
          {
            "text": "            response.raise_for_status()",
            "lineNumber": 200
          },
          {
            "text": "            ",
            "lineNumber": 201
          },
          {
            "text": "            # JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è§£æ",
            "lineNumber": 202
          },
          {
            "text": "            result = response.json()",
            "lineNumber": 203
          },
          {
            "text": "            ",
            "lineNumber": 204
          },
          {
            "text": "            if result and 'message' in result and 'content' in result['message']:",
            "lineNumber": 205
          },
          {
            "text": "                toon_text = result['message']['content']",
            "lineNumber": 206
          },
          {
            "text": "                ",
            "lineNumber": 207
          },
          {
            "text": "                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼ï¼ˆè³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰",
            "lineNumber": 208
          },
          {
            "text": "                if not self.is_question_response(toon_text):",
            "lineNumber": 209
          },
          {
            "text": "                    is_valid, validation_message = self.validate_output_size(toon_text)",
            "lineNumber": 210
          },
          {
            "text": "                    if not is_valid:",
            "lineNumber": 211
          },
          {
            "text": "                        # è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’TOONå½¢å¼ã®å‰ã«è¿½åŠ ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆå½¢å¼ï¼‰",
            "lineNumber": 212
          },
          {
            "text": "                        warning_comment = f\"&lt;!-- {validation_message} --&gt;\\n\"",
            "lineNumber": 213
          },
          {
            "text": "                        toon_text = warning_comment + toon_text",
            "lineNumber": 214
          },
          {
            "text": "                ",
            "lineNumber": 215
          },
          {
            "text": "                return toon_text",
            "lineNumber": 216
          },
          {
            "text": "            else:",
            "lineNumber": 217
          },
          {
            "text": "                raise ValueError(\"ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰æœ‰åŠ¹ãªå¿œç­”ãŒå¾—ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚\")",
            "lineNumber": 218
          },
          {
            "text": "                ",
            "lineNumber": 219
          },
          {
            "text": "        except ValueError:",
            "lineNumber": 220
          },
          {
            "text": "            # å†ç™ºç”Ÿã•ã›ã‚‹",
            "lineNumber": 221
          },
          {
            "text": "            raise",
            "lineNumber": 222
          },
          {
            "text": "        except requests.exceptions.ConnectionError as e:",
            "lineNumber": 223
          },
          {
            "text": "            # æ¥ç¶šã‚¨ãƒ©ãƒ¼ã®å ´åˆ",
            "lineNumber": 224
          },
          {
            "text": "            raise",
            "lineNumber": 225
          }
        ]
      },
      "score": 0.2630546987056732
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 119,
            "column": 43
          },
          "endPosition": {
            "line": 156,
            "column": 37
          }
        },
        "contents": "try:\n    ollama_config = st.secrets.get(\"ollama\", {})\n    base_url = ollama_config.get(\"base_url\", \"http://localhost:11434\")\n    model = ollama_config.get(\"model\", \"llama3.2\")\n    config_source = \"secrets.toml\"\nexcept (AttributeError, FileNotFoundError, ImportError, RuntimeError):\n    import os\n    base_url = os.getenv(\"OLLAMA_BASE_URL\", \"http://localhost:11434\")\n    model = os.getenv(\"OLLAMA_MODEL\", \"llama3.2\")\n    config_source = \"ç’°å¢ƒå¤‰æ•°\"\n\nst.sidebar.text(f\"è¨­å®šå…ƒ: {config_source}\")\nst.sidebar.text(f\"ãƒ™ãƒ¼ã‚¹URL: {base_url}\")\nst.sidebar.text(f\"ãƒ¢ãƒ‡ãƒ«: {model}\")\n\n# --- æç”»ã¨å±¥æ­´ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ ---\nst.divider()\n\n# å±¥æ­´ã‚’é¡ã‚‹ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼\nif len(st.session_state.history) &gt; 1:\n    history_index = st.sidebar.slider(\n        \"å±¥æ­´ã‚’é¡ã‚‹\", \n        min_value=0, \n        max_value=len(st.session_state.history) - 1, \n        value=len(st.session_state.history) - 1\n    )\nelse:\n    history_index = 0\n    st.sidebar.info(\"ç¾åœ¨ã¯åˆæœŸçŠ¶æ…‹ã§ã™ã€‚\")\n\ncurrent_flow = st.session_state.history[history_index]\n\n# 3ãƒšã‚¤ãƒ³æ§‹æˆ: å·¦ï¼ˆChat/Inputï¼‰ã€ä¸­å¤®ï¼ˆFlowchartï¼‰ã€å³ï¼ˆSourceï¼‰\ncol_chat, col_flow, col_source = st.columns([1, 2, 1])\n\nwith col_chat:\n    st.subheader(\"ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ\")",
        "signatures": {},
        "detailedLines": [
          {
            "text": "try:",
            "lineNumber": 121
          },
          {
            "text": "    ollama_config = st.secrets.get(\"ollama\", {})",
            "lineNumber": 122
          },
          {
            "text": "    base_url = ollama_config.get(\"base_url\", \"http://localhost:11434\")",
            "lineNumber": 123
          },
          {
            "text": "    model = ollama_config.get(\"model\", \"llama3.2\")",
            "lineNumber": 124
          },
          {
            "text": "    config_source = \"secrets.toml\"",
            "lineNumber": 125
          },
          {
            "text": "except (AttributeError, FileNotFoundError, ImportError, RuntimeError):",
            "lineNumber": 126
          },
          {
            "text": "    import os",
            "lineNumber": 127
          },
          {
            "text": "    base_url = os.getenv(\"OLLAMA_BASE_URL\", \"http://localhost:11434\")",
            "lineNumber": 128
          },
          {
            "text": "    model = os.getenv(\"OLLAMA_MODEL\", \"llama3.2\")",
            "lineNumber": 129
          },
          {
            "text": "    config_source = \"ç’°å¢ƒå¤‰æ•°\"",
            "lineNumber": 130
          },
          {
            "lineNumber": 131
          },
          {
            "text": "st.sidebar.text(f\"è¨­å®šå…ƒ: {config_source}\")",
            "lineNumber": 132
          },
          {
            "text": "st.sidebar.text(f\"ãƒ™ãƒ¼ã‚¹URL: {base_url}\")",
            "lineNumber": 133
          },
          {
            "text": "st.sidebar.text(f\"ãƒ¢ãƒ‡ãƒ«: {model}\")",
            "lineNumber": 134
          },
          {
            "lineNumber": 135
          },
          {
            "text": "# --- æç”»ã¨å±¥æ­´ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ ---",
            "lineNumber": 136
          },
          {
            "text": "st.divider()",
            "lineNumber": 137
          },
          {
            "lineNumber": 138
          },
          {
            "text": "# å±¥æ­´ã‚’é¡ã‚‹ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼",
            "lineNumber": 139
          },
          {
            "text": "if len(st.session_state.history) &gt; 1:",
            "lineNumber": 140
          },
          {
            "text": "    history_index = st.sidebar.slider(",
            "lineNumber": 141
          },
          {
            "text": "        \"å±¥æ­´ã‚’é¡ã‚‹\", ",
            "lineNumber": 142
          },
          {
            "text": "        min_value=0, ",
            "lineNumber": 143
          },
          {
            "text": "        max_value=len(st.session_state.history) - 1, ",
            "lineNumber": 144
          },
          {
            "text": "        value=len(st.session_state.history) - 1",
            "lineNumber": 145
          },
          {
            "text": "    )",
            "lineNumber": 146
          },
          {
            "text": "else:",
            "lineNumber": 147
          },
          {
            "text": "    history_index = 0",
            "lineNumber": 148
          },
          {
            "text": "    st.sidebar.info(\"ç¾åœ¨ã¯åˆæœŸçŠ¶æ…‹ã§ã™ã€‚\")",
            "lineNumber": 149
          },
          {
            "lineNumber": 150
          },
          {
            "text": "current_flow = st.session_state.history[history_index]",
            "lineNumber": 151
          },
          {
            "lineNumber": 152
          },
          {
            "text": "# 3ãƒšã‚¤ãƒ³æ§‹æˆ: å·¦ï¼ˆChat/Inputï¼‰ã€ä¸­å¤®ï¼ˆFlowchartï¼‰ã€å³ï¼ˆSourceï¼‰",
            "lineNumber": 153
          },
          {
            "text": "col_chat, col_flow, col_source = st.columns([1, 2, 1])",
            "lineNumber": 154
          },
          {
            "lineNumber": 155
          },
          {
            "text": "with col_chat:",
            "lineNumber": 156
          },
          {
            "text": "    st.subheader(\"ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ\")",
            "lineNumber": 157
          }
        ]
      },
      "score": 0.25980615615844727
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\storage\\toon_files\\flow_md.md",
        "range": {
          "startPosition": {
            "line": 132
          },
          "endPosition": {
            "line": 174,
            "column": 8
          }
        },
        "contents": "    subgraph flow1 [\"ä¸¡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]\n        check11_1[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check11_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check11_1_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task11_1[\"PGåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        check12_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check12_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check12_1_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task12_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        check13_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check13_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check13_1_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task13_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        task10_1[\"æµå‹•ã«æˆ»ã™\"]\n        decision1_1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n        \n        task5--&gt;check11_1\n        check11_1--&gt;decision_check11_1\n        decision_check11_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check11_1_1\n        decision_check11_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task11_1\n        decision_check11_1_1--&gt;|\"æ­£å¸¸\"|check12_1\n        decision_check11_1_1--&gt;|\"ç•°å¸¸\"|task11_1\n        task11_1--&gt;check12_1\n        check12_1--&gt;decision_check12_1\n        decision_check12_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check12_1_1\n        decision_check12_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task12_1\n        decision_check12_1_1--&gt;|\"æ­£å¸¸\"|check13_1\n        decision_check12_1_1--&gt;|\"ç•°å¸¸\"|task12_1\n        task12_1--&gt;check13_1\n        check13_1--&gt;decision_check13_1\n        decision_check13_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check13_1_1\n        decision_check13_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task13_1\n        decision_check13_1_1--&gt;|\"æ­£å¸¸\"|task10_1\n        decision_check13_1_1--&gt;|\"ç•°å¸¸\"|task13_1\n        task13_1--&gt;task10_1\n        task10_1--&gt;decision1_1\n        decision1_1--&gt;|\"å†ç¾ã—ãªã„\"|task10\n        decision1_1--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer\n    end\n    \n    %% ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\n    subgraph flow2 [\"ç‰‡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]\n        ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "    subgraph flow1 [\"ä¸¡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 133
          },
          {
            "text": "        check11_1[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 134
          },
          {
            "text": "        decision_check11_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 135
          },
          {
            "text": "        decision_check11_1_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 136
          },
          {
            "text": "        task11_1[\"PGåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 137
          },
          {
            "text": "        check12_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 138
          },
          {
            "text": "        decision_check12_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 139
          },
          {
            "text": "        decision_check12_1_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 140
          },
          {
            "text": "        task12_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 141
          },
          {
            "text": "        check13_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 142
          },
          {
            "text": "        decision_check13_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 143
          },
          {
            "text": "        decision_check13_1_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 144
          },
          {
            "text": "        task13_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 145
          },
          {
            "text": "        task10_1[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 146
          },
          {
            "text": "        decision1_1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 147
          },
          {
            "text": "        ",
            "lineNumber": 148
          },
          {
            "text": "        task5--&gt;check11_1",
            "lineNumber": 149
          },
          {
            "text": "        check11_1--&gt;decision_check11_1",
            "lineNumber": 150
          },
          {
            "text": "        decision_check11_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check11_1_1",
            "lineNumber": 151
          },
          {
            "text": "        decision_check11_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task11_1",
            "lineNumber": 152
          },
          {
            "text": "        decision_check11_1_1--&gt;|\"æ­£å¸¸\"|check12_1",
            "lineNumber": 153
          },
          {
            "text": "        decision_check11_1_1--&gt;|\"ç•°å¸¸\"|task11_1",
            "lineNumber": 154
          },
          {
            "text": "        task11_1--&gt;check12_1",
            "lineNumber": 155
          },
          {
            "text": "        check12_1--&gt;decision_check12_1",
            "lineNumber": 156
          },
          {
            "text": "        decision_check12_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check12_1_1",
            "lineNumber": 157
          },
          {
            "text": "        decision_check12_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task12_1",
            "lineNumber": 158
          },
          {
            "text": "        decision_check12_1_1--&gt;|\"æ­£å¸¸\"|check13_1",
            "lineNumber": 159
          },
          {
            "text": "        decision_check12_1_1--&gt;|\"ç•°å¸¸\"|task12_1",
            "lineNumber": 160
          },
          {
            "text": "        task12_1--&gt;check13_1",
            "lineNumber": 161
          },
          {
            "text": "        check13_1--&gt;decision_check13_1",
            "lineNumber": 162
          },
          {
            "text": "        decision_check13_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check13_1_1",
            "lineNumber": 163
          },
          {
            "text": "        decision_check13_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task13_1",
            "lineNumber": 164
          },
          {
            "text": "        decision_check13_1_1--&gt;|\"æ­£å¸¸\"|task10_1",
            "lineNumber": 165
          },
          {
            "text": "        decision_check13_1_1--&gt;|\"ç•°å¸¸\"|task13_1",
            "lineNumber": 166
          },
          {
            "text": "        task13_1--&gt;task10_1",
            "lineNumber": 167
          },
          {
            "text": "        task10_1--&gt;decision1_1",
            "lineNumber": 168
          },
          {
            "text": "        decision1_1--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 169
          },
          {
            "text": "        decision1_1--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer",
            "lineNumber": 170
          },
          {
            "text": "    end",
            "lineNumber": 171
          },
          {
            "text": "    ",
            "lineNumber": 172
          },
          {
            "text": "    %% ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 173
          },
          {
            "text": "    subgraph flow2 [\"ç‰‡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 174
          },
          {
            "text": "        ",
            "lineNumber": 175
          }
        ]
      },
      "score": 0.2594654858112335
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 223,
            "column": 42
          },
          "endPosition": {
            "line": 253,
            "column": 75
          }
        },
        "contents": "                            else:\n                                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼\n                                is_valid, validation_message = client.validate_output_size(raw_toon_text)\n                                if not is_valid:\n                                    st.warning(validation_message)\n                                    st.info(\"ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã‹ã€ãƒ•ãƒ­ãƒ¼ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\")\n                                \n                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹æˆåŠŸæ™‚ã®ã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ\n                                st.session_state.conversation_context = None\n                                st.session_state.pending_questions = None\n                                st.session_state.question_responses = []\n                                \n                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹\n                                new_flow = TOONParser.parse(raw_toon_text)\n                                \n                                # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨\n                                new_flow = new_flow.apply_logic_gap_detection()\n                                \n                                # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ\n                                if append_mode_flag:\n                                    merged_flow = history_mgr.append_toon_log(session_name, new_flow)\n                                    st.session_state.history.append(merged_flow)\n                                    st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")\n                                else:\n                                    # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ \n                                    st.session_state.history.append(new_flow)\n                            \n                            st.rerun()\n                        except LLMAPIError as e:\n                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                            else:",
            "lineNumber": 225
          },
          {
            "text": "                                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼",
            "lineNumber": 226
          },
          {
            "text": "                                is_valid, validation_message = client.validate_output_size(raw_toon_text)",
            "lineNumber": 227
          },
          {
            "text": "                                if not is_valid:",
            "lineNumber": 228
          },
          {
            "text": "                                    st.warning(validation_message)",
            "lineNumber": 229
          },
          {
            "text": "                                    st.info(\"ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã‹ã€ãƒ•ãƒ­ãƒ¼ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 230
          },
          {
            "text": "                                ",
            "lineNumber": 231
          },
          {
            "text": "                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹æˆåŠŸæ™‚ã®ã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ",
            "lineNumber": 232
          },
          {
            "text": "                                st.session_state.conversation_context = None",
            "lineNumber": 233
          },
          {
            "text": "                                st.session_state.pending_questions = None",
            "lineNumber": 234
          },
          {
            "text": "                                st.session_state.question_responses = []",
            "lineNumber": 235
          },
          {
            "text": "                                ",
            "lineNumber": 236
          },
          {
            "text": "                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹",
            "lineNumber": 237
          },
          {
            "text": "                                new_flow = TOONParser.parse(raw_toon_text)",
            "lineNumber": 238
          },
          {
            "text": "                                ",
            "lineNumber": 239
          },
          {
            "text": "                                # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨",
            "lineNumber": 240
          },
          {
            "text": "                                new_flow = new_flow.apply_logic_gap_detection()",
            "lineNumber": 241
          },
          {
            "text": "                                ",
            "lineNumber": 242
          },
          {
            "text": "                                # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ",
            "lineNumber": 243
          },
          {
            "text": "                                if append_mode_flag:",
            "lineNumber": 244
          },
          {
            "text": "                                    merged_flow = history_mgr.append_toon_log(session_name, new_flow)",
            "lineNumber": 245
          },
          {
            "text": "                                    st.session_state.history.append(merged_flow)",
            "lineNumber": 246
          },
          {
            "text": "                                    st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")",
            "lineNumber": 247
          },
          {
            "text": "                                else:",
            "lineNumber": 248
          },
          {
            "text": "                                    # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ ",
            "lineNumber": 249
          },
          {
            "text": "                                    st.session_state.history.append(new_flow)",
            "lineNumber": 250
          },
          {
            "text": "                            ",
            "lineNumber": 251
          },
          {
            "text": "                            st.rerun()",
            "lineNumber": 252
          },
          {
            "text": "                        except LLMAPIError as e:",
            "lineNumber": 253
          },
          {
            "text": "                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ",
            "lineNumber": 254
          }
        ]
      },
      "score": 0.2588444948196411
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\storage\\sessions\\flow_md.json",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 65
          }
        },
        "contents": "[\n    {\n        \"nodes\": [\n            {\n                \"id\": \"start\",\n                \"label\": \"é–‹å§‹\",\n                \"type\": \"start\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"task1\",\n                \"label\": \"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\",\n                \"type\": \"process\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"task2\",\n                \"label\": \"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\",\n                \"type\": \"process\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"decision1\",\n                \"label\": \"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\",\n                \"type\": \"decision\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"task3\",\n                \"label\": \"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\",\n                \"type\": \"process\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"decision2\",\n                \"label\": \"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\",\n                \"type\": \"decision\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"task4\",\n                \"label\": \"è¡¨ç¤ºãŒãŠã‹ã—ã„\",\n                \"type\": \"process\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"decision3\",\n                \"label\": \"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\",\n                \"type\": \"decision\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"task5\",\n                \"label\": \"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\",\n                \"type\": \"process\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"task6\",\n                \"label\": \"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\",\n                \"type\": \"process\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"task7\",",
        "signatures": {},
        "detailedLines": [
          {
            "text": "[",
            "lineNumber": 1
          },
          {
            "text": "    {",
            "lineNumber": 2
          },
          {
            "text": "        \"nodes\": [",
            "lineNumber": 3
          },
          {
            "text": "            {",
            "lineNumber": 4
          },
          {
            "text": "                \"id\": \"start\",",
            "lineNumber": 5
          },
          {
            "text": "                \"label\": \"é–‹å§‹\",",
            "lineNumber": 6
          },
          {
            "text": "                \"type\": \"start\",",
            "lineNumber": 7
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 8
          },
          {
            "text": "            },",
            "lineNumber": 9
          },
          {
            "text": "            {",
            "lineNumber": 10
          },
          {
            "text": "                \"id\": \"task1\",",
            "lineNumber": 11
          },
          {
            "text": "                \"label\": \"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\",",
            "lineNumber": 12
          },
          {
            "text": "                \"type\": \"process\",",
            "lineNumber": 13
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 14
          },
          {
            "text": "            },",
            "lineNumber": 15
          },
          {
            "text": "            {",
            "lineNumber": 16
          },
          {
            "text": "                \"id\": \"task2\",",
            "lineNumber": 17
          },
          {
            "text": "                \"label\": \"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\",",
            "lineNumber": 18
          },
          {
            "text": "                \"type\": \"process\",",
            "lineNumber": 19
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 20
          },
          {
            "text": "            },",
            "lineNumber": 21
          },
          {
            "text": "            {",
            "lineNumber": 22
          },
          {
            "text": "                \"id\": \"decision1\",",
            "lineNumber": 23
          },
          {
            "text": "                \"label\": \"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\",",
            "lineNumber": 24
          },
          {
            "text": "                \"type\": \"decision\",",
            "lineNumber": 25
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 26
          },
          {
            "text": "            },",
            "lineNumber": 27
          },
          {
            "text": "            {",
            "lineNumber": 28
          },
          {
            "text": "                \"id\": \"task3\",",
            "lineNumber": 29
          },
          {
            "text": "                \"label\": \"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\",",
            "lineNumber": 30
          },
          {
            "text": "                \"type\": \"process\",",
            "lineNumber": 31
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 32
          },
          {
            "text": "            },",
            "lineNumber": 33
          },
          {
            "text": "            {",
            "lineNumber": 34
          },
          {
            "text": "                \"id\": \"decision2\",",
            "lineNumber": 35
          },
          {
            "text": "                \"label\": \"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\",",
            "lineNumber": 36
          },
          {
            "text": "                \"type\": \"decision\",",
            "lineNumber": 37
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 38
          },
          {
            "text": "            },",
            "lineNumber": 39
          },
          {
            "text": "            {",
            "lineNumber": 40
          },
          {
            "text": "                \"id\": \"task4\",",
            "lineNumber": 41
          },
          {
            "text": "                \"label\": \"è¡¨ç¤ºãŒãŠã‹ã—ã„\",",
            "lineNumber": 42
          },
          {
            "text": "                \"type\": \"process\",",
            "lineNumber": 43
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 44
          },
          {
            "text": "            },",
            "lineNumber": 45
          },
          {
            "text": "            {",
            "lineNumber": 46
          },
          {
            "text": "                \"id\": \"decision3\",",
            "lineNumber": 47
          },
          {
            "text": "                \"label\": \"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\",",
            "lineNumber": 48
          },
          {
            "text": "                \"type\": \"decision\",",
            "lineNumber": 49
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 50
          },
          {
            "text": "            },",
            "lineNumber": 51
          },
          {
            "text": "            {",
            "lineNumber": 52
          },
          {
            "text": "                \"id\": \"task5\",",
            "lineNumber": 53
          },
          {
            "text": "                \"label\": \"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\",",
            "lineNumber": 54
          },
          {
            "text": "                \"type\": \"process\",",
            "lineNumber": 55
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 56
          },
          {
            "text": "            },",
            "lineNumber": 57
          },
          {
            "text": "            {",
            "lineNumber": 58
          },
          {
            "text": "                \"id\": \"task6\",",
            "lineNumber": 59
          },
          {
            "text": "                \"label\": \"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\",",
            "lineNumber": 60
          },
          {
            "text": "                \"type\": \"process\",",
            "lineNumber": 61
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 62
          },
          {
            "text": "            },",
            "lineNumber": 63
          },
          {
            "text": "            {",
            "lineNumber": 64
          },
          {
            "text": "                \"id\": \"task7\",",
            "lineNumber": 65
          }
        ]
      },
      "score": 0.25076308846473694
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\flow.md",
        "range": {
          "startPosition": {
            "line": 83
          },
          "endPosition": {
            "line": 135
          }
        },
        "contents": "        decision_check9_1_1--&gt;|\"ç•°å¸¸\"|task9_1\n        task9_1--&gt;task9_2\n        task9_2--&gt;decision9_1\n        decision9_1--&gt;|\"å‡ºã¦ããŸ\"|check9_3\n        decision9_1--&gt;|\"å‡ºã¦ã“ãªã„\"|task10\n        \n        check9_3--&gt;decision_check9_3\n        decision_check9_3--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_3_1\n        decision_check9_3--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_3\n        decision_check9_3_1--&gt;|\"æ­£å¸¸\"|task9_4\n        decision_check9_3_1--&gt;|\"ç•°å¸¸\"|task9_3\n        task9_3--&gt;task9_4\n        task9_4--&gt;decision9_2\n        decision9_2--&gt;|\"å‡ºã¦ããŸ\"|check9_5\n        decision9_2--&gt;|\"å‡ºã¦ã“ãªã„\"|task10\n        \n        check9_5--&gt;decision_check9_5\n        decision_check9_5--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_5_1\n        decision_check9_5--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_5\n        decision_check9_5_1--&gt;|\"æ­£å¸¸\"|task9_6\n        decision_check9_5_1--&gt;|\"ç•°å¸¸\"|task9_5\n        task9_5--&gt;task9_6\n        task9_6--&gt;decision9_3\n        decision9_3--&gt;|\"å‡ºã¦ããŸ\"|check9_7\n        decision9_3--&gt;|\"å‡ºã¦ã“ãªã„\"|task10\n        \n        check9_7--&gt;decision_check9_7\n        decision_check9_7--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_7_1\n        decision_check9_7--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_7\n        decision_check9_7_1--&gt;|\"æ­£å¸¸\"|task9_8\n        decision_check9_7_1--&gt;|\"ç•°å¸¸\"|task9_7\n        task9_7--&gt;task9_8\n        task9_8--&gt;decision9_4\n        decision9_4--&gt;|\"å‡ºã¦ããŸ\"|task9_9\n        decision9_4--&gt;|\"å‡ºã¦ã“ãªã„\"|task10\n        \n        task9_9--&gt;contact_manufacturer\n    end\n    \n    %% ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã¸ã®é€£çµ¡ï¼ˆå…¨ãƒ¢ãƒ¼ãƒ‰å…±é€šï¼‰\n    contact_manufacturer--&gt;node_end\n    \n    %% è¡¨ç¤ºãŒãŠã‹ã—ã„å ´åˆã®åˆ†å²\n    task4--&gt;decision3\n    decision3--&gt;|\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"|task5\n    decision3--&gt;|\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"|task6\n    decision3--&gt;|\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"|task7\n    \n    %% ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\n    subgraph flow1 [\"ä¸¡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]\n        check11_1[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check11_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "        decision_check9_1_1--&gt;|\"ç•°å¸¸\"|task9_1",
            "lineNumber": 84
          },
          {
            "text": "        task9_1--&gt;task9_2",
            "lineNumber": 85
          },
          {
            "text": "        task9_2--&gt;decision9_1",
            "lineNumber": 86
          },
          {
            "text": "        decision9_1--&gt;|\"å‡ºã¦ããŸ\"|check9_3",
            "lineNumber": 87
          },
          {
            "text": "        decision9_1--&gt;|\"å‡ºã¦ã“ãªã„\"|task10",
            "lineNumber": 88
          },
          {
            "text": "        ",
            "lineNumber": 89
          },
          {
            "text": "        check9_3--&gt;decision_check9_3",
            "lineNumber": 90
          },
          {
            "text": "        decision_check9_3--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_3_1",
            "lineNumber": 91
          },
          {
            "text": "        decision_check9_3--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_3",
            "lineNumber": 92
          },
          {
            "text": "        decision_check9_3_1--&gt;|\"æ­£å¸¸\"|task9_4",
            "lineNumber": 93
          },
          {
            "text": "        decision_check9_3_1--&gt;|\"ç•°å¸¸\"|task9_3",
            "lineNumber": 94
          },
          {
            "text": "        task9_3--&gt;task9_4",
            "lineNumber": 95
          },
          {
            "text": "        task9_4--&gt;decision9_2",
            "lineNumber": 96
          },
          {
            "text": "        decision9_2--&gt;|\"å‡ºã¦ããŸ\"|check9_5",
            "lineNumber": 97
          },
          {
            "text": "        decision9_2--&gt;|\"å‡ºã¦ã“ãªã„\"|task10",
            "lineNumber": 98
          },
          {
            "text": "        ",
            "lineNumber": 99
          },
          {
            "text": "        check9_5--&gt;decision_check9_5",
            "lineNumber": 100
          },
          {
            "text": "        decision_check9_5--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_5_1",
            "lineNumber": 101
          },
          {
            "text": "        decision_check9_5--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_5",
            "lineNumber": 102
          },
          {
            "text": "        decision_check9_5_1--&gt;|\"æ­£å¸¸\"|task9_6",
            "lineNumber": 103
          },
          {
            "text": "        decision_check9_5_1--&gt;|\"ç•°å¸¸\"|task9_5",
            "lineNumber": 104
          },
          {
            "text": "        task9_5--&gt;task9_6",
            "lineNumber": 105
          },
          {
            "text": "        task9_6--&gt;decision9_3",
            "lineNumber": 106
          },
          {
            "text": "        decision9_3--&gt;|\"å‡ºã¦ããŸ\"|check9_7",
            "lineNumber": 107
          },
          {
            "text": "        decision9_3--&gt;|\"å‡ºã¦ã“ãªã„\"|task10",
            "lineNumber": 108
          },
          {
            "text": "        ",
            "lineNumber": 109
          },
          {
            "text": "        check9_7--&gt;decision_check9_7",
            "lineNumber": 110
          },
          {
            "text": "        decision_check9_7--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_7_1",
            "lineNumber": 111
          },
          {
            "text": "        decision_check9_7--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_7",
            "lineNumber": 112
          },
          {
            "text": "        decision_check9_7_1--&gt;|\"æ­£å¸¸\"|task9_8",
            "lineNumber": 113
          },
          {
            "text": "        decision_check9_7_1--&gt;|\"ç•°å¸¸\"|task9_7",
            "lineNumber": 114
          },
          {
            "text": "        task9_7--&gt;task9_8",
            "lineNumber": 115
          },
          {
            "text": "        task9_8--&gt;decision9_4",
            "lineNumber": 116
          },
          {
            "text": "        decision9_4--&gt;|\"å‡ºã¦ããŸ\"|task9_9",
            "lineNumber": 117
          },
          {
            "text": "        decision9_4--&gt;|\"å‡ºã¦ã“ãªã„\"|task10",
            "lineNumber": 118
          },
          {
            "text": "        ",
            "lineNumber": 119
          },
          {
            "text": "        task9_9--&gt;contact_manufacturer",
            "lineNumber": 120
          },
          {
            "text": "    end",
            "lineNumber": 121
          },
          {
            "text": "    ",
            "lineNumber": 122
          },
          {
            "text": "    %% ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã¸ã®é€£çµ¡ï¼ˆå…¨ãƒ¢ãƒ¼ãƒ‰å…±é€šï¼‰",
            "lineNumber": 123
          },
          {
            "text": "    contact_manufacturer--&gt;node_end",
            "lineNumber": 124
          },
          {
            "text": "    ",
            "lineNumber": 125
          },
          {
            "text": "    %% è¡¨ç¤ºãŒãŠã‹ã—ã„å ´åˆã®åˆ†å²",
            "lineNumber": 126
          },
          {
            "text": "    task4--&gt;decision3",
            "lineNumber": 127
          },
          {
            "text": "    decision3--&gt;|\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"|task5",
            "lineNumber": 128
          },
          {
            "text": "    decision3--&gt;|\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"|task6",
            "lineNumber": 129
          },
          {
            "text": "    decision3--&gt;|\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"|task7",
            "lineNumber": 130
          },
          {
            "text": "    ",
            "lineNumber": 131
          },
          {
            "text": "    %% ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 132
          },
          {
            "text": "    subgraph flow1 [\"ä¸¡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 133
          },
          {
            "text": "        check11_1[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 134
          },
          {
            "text": "        decision_check11_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 135
          }
        ]
      },
      "score": 0.24940499663352966
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\llm_client.py",
        "range": {
          "startPosition": {
            "line": 8
          },
          "endPosition": {
            "line": 268
          }
        },
        "contents": "class LLMClient:\n\n\n    @staticmethod\n    def is_question_response(response_text: str) -&gt; bool:\n        \"\"\"\n        LLMã®å¿œç­”ãŒè³ªå•å½¢å¼ã‹TOONå½¢å¼ã‹ã‚’åˆ¤å®šã—ã¾ã™ã€‚\n        \n        Args:\n            response_text: LLMã‹ã‚‰ã®å¿œç­”ãƒ†ã‚­ã‚¹ãƒˆ\n            \n        Returns:\n            True: è³ªå•å½¢å¼ã®å ´åˆ\n            False: TOONå½¢å¼ã®å ´åˆ\n        \"\"\"\n        # TOONå½¢å¼ã®ç‰¹å¾´ã‚’ãƒã‚§ãƒƒã‚¯\n        # [Node]ã‚¿ã‚°ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯TOONå½¢å¼ã¨åˆ¤æ–­\n        if re.search(r'\\[Node\\]', response_text, re.IGNORECASE):\n            return False\n        \n        # [Edge]ã‚¿ã‚°ãŒå­˜åœ¨ã™ã‚‹å ´åˆã‚‚TOONå½¢å¼ã¨åˆ¤æ–­\n        if re.search(r'\\[Edge\\]', response_text, re.IGNORECASE):\n            return False\n        \n        # è³ªå•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯\n        question_patterns = [\n            r'æ•™ãˆã¦ãã ã•ã„',\n            r'ä½•ã§ã™ã‹[ï¼Ÿ?]',\n            r'ã©ã®ã‚ˆã†[ãªã«]',\n            r'ã©ã‚Œ[ãŒã‚’]',\n            r'ã„ã¤[ãŒã‚’]',\n            r'ã©ã“[ãŒã‚’]',\n            r'ãªãœ',\n            r'ã©ã†ã—ã¦',\n            r'[ï¼Ÿ?]\\s*$',  # æ–‡æœ«ãŒ?ã§çµ‚ã‚ã‚‹\n            r'ä»¥ä¸‹ã®æƒ…å ±',\n            r'è³ªå•',\n            r'ç¢ºèª',\n        ]\n        \n        # è³ªå•ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯\n        for pattern in question_patterns:\n            if re.search(pattern, response_text, re.IGNORECASE):\n                return True\n        \n        # æ•°å­—ä»˜ãã®è³ªå•ãƒªã‚¹ãƒˆå½¢å¼ï¼ˆä¾‹ï¼šã€Œ1. ...ã§ã™ã‹ï¼Ÿã€ï¼‰\n        numbered_question_pattern = r'\\d+[\\.ï¼]\\s*[^ã€‚\\n]*[ï¼Ÿ?]'\n        if re.search(numbered_question_pattern, response_text):\n            return True\n        \n        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯TOONå½¢å¼ã¨åˆ¤æ–­ï¼ˆè³ªå•å½¢å¼ã§ã¯ãªã„ï¼‰\n        return False\n\n    def validate_output_size(self, toon_text: str) -&gt; tuple[bool, str]:\n        ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 9,
                "column": 1
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class LLMClient:",
            "lineNumber": 9,
            "isSignature": true
          },
          {
            "lineNumber": 64
          },
          {
            "lineNumber": 65
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 66
          },
          {
            "text": "    def is_question_response(response_text: str) -&gt; bool:",
            "lineNumber": 67
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 68
          },
          {
            "text": "        LLMã®å¿œç­”ãŒè³ªå•å½¢å¼ã‹TOONå½¢å¼ã‹ã‚’åˆ¤å®šã—ã¾ã™ã€‚",
            "lineNumber": 69
          },
          {
            "text": "        ",
            "lineNumber": 70
          },
          {
            "text": "        Args:",
            "lineNumber": 71
          },
          {
            "text": "            response_text: LLMã‹ã‚‰ã®å¿œç­”ãƒ†ã‚­ã‚¹ãƒˆ",
            "lineNumber": 72
          },
          {
            "text": "            ",
            "lineNumber": 73
          },
          {
            "text": "        Returns:",
            "lineNumber": 74
          },
          {
            "text": "            True: è³ªå•å½¢å¼ã®å ´åˆ",
            "lineNumber": 75
          },
          {
            "text": "            False: TOONå½¢å¼ã®å ´åˆ",
            "lineNumber": 76
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 77
          },
          {
            "text": "        # TOONå½¢å¼ã®ç‰¹å¾´ã‚’ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 78
          },
          {
            "text": "        # [Node]ã‚¿ã‚°ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯TOONå½¢å¼ã¨åˆ¤æ–­",
            "lineNumber": 79
          },
          {
            "text": "        if re.search(r'\\[Node\\]', response_text, re.IGNORECASE):",
            "lineNumber": 80
          },
          {
            "text": "            return False",
            "lineNumber": 81
          },
          {
            "text": "        ",
            "lineNumber": 82
          },
          {
            "text": "        # [Edge]ã‚¿ã‚°ãŒå­˜åœ¨ã™ã‚‹å ´åˆã‚‚TOONå½¢å¼ã¨åˆ¤æ–­",
            "lineNumber": 83
          },
          {
            "text": "        if re.search(r'\\[Edge\\]', response_text, re.IGNORECASE):",
            "lineNumber": 84
          },
          {
            "text": "            return False",
            "lineNumber": 85
          },
          {
            "text": "        ",
            "lineNumber": 86
          },
          {
            "text": "        # è³ªå•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 87
          },
          {
            "text": "        question_patterns = [",
            "lineNumber": 88
          },
          {
            "text": "            r'æ•™ãˆã¦ãã ã•ã„',",
            "lineNumber": 89
          },
          {
            "text": "            r'ä½•ã§ã™ã‹[ï¼Ÿ?]',",
            "lineNumber": 90
          },
          {
            "text": "            r'ã©ã®ã‚ˆã†[ãªã«]',",
            "lineNumber": 91
          },
          {
            "text": "            r'ã©ã‚Œ[ãŒã‚’]',",
            "lineNumber": 92
          },
          {
            "text": "            r'ã„ã¤[ãŒã‚’]',",
            "lineNumber": 93
          },
          {
            "text": "            r'ã©ã“[ãŒã‚’]',",
            "lineNumber": 94
          },
          {
            "text": "            r'ãªãœ',",
            "lineNumber": 95
          },
          {
            "text": "            r'ã©ã†ã—ã¦',",
            "lineNumber": 96
          },
          {
            "text": "            r'[ï¼Ÿ?]\\s*$',  # æ–‡æœ«ãŒ?ã§çµ‚ã‚ã‚‹",
            "lineNumber": 97
          },
          {
            "text": "            r'ä»¥ä¸‹ã®æƒ…å ±',",
            "lineNumber": 98
          },
          {
            "text": "            r'è³ªå•',",
            "lineNumber": 99
          },
          {
            "text": "            r'ç¢ºèª',",
            "lineNumber": 100
          },
          {
            "text": "        ]",
            "lineNumber": 101
          },
          {
            "text": "        ",
            "lineNumber": 102
          },
          {
            "text": "        # è³ªå•ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 103
          },
          {
            "text": "        for pattern in question_patterns:",
            "lineNumber": 104
          },
          {
            "text": "            if re.search(pattern, response_text, re.IGNORECASE):",
            "lineNumber": 105
          },
          {
            "text": "                return True",
            "lineNumber": 106
          },
          {
            "text": "        ",
            "lineNumber": 107
          },
          {
            "text": "        # æ•°å­—ä»˜ãã®è³ªå•ãƒªã‚¹ãƒˆå½¢å¼ï¼ˆä¾‹ï¼šã€Œ1. ...ã§ã™ã‹ï¼Ÿã€ï¼‰",
            "lineNumber": 108
          },
          {
            "text": "        numbered_question_pattern = r'\\d+[\\.ï¼]\\s*[^ã€‚\\n]*[ï¼Ÿ?]'",
            "lineNumber": 109
          },
          {
            "text": "        if re.search(numbered_question_pattern, response_text):",
            "lineNumber": 110
          },
          {
            "text": "            return True",
            "lineNumber": 111
          },
          {
            "text": "        ",
            "lineNumber": 112
          },
          {
            "text": "        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯TOONå½¢å¼ã¨åˆ¤æ–­ï¼ˆè³ªå•å½¢å¼ã§ã¯ãªã„ï¼‰",
            "lineNumber": 113
          },
          {
            "text": "        return False",
            "lineNumber": 114
          },
          {
            "lineNumber": 115
          },
          {
            "text": "    def validate_output_size(self, toon_text: str) -&gt; tuple[bool, str]:",
            "lineNumber": 116
          },
          {
            "text": "        ",
            "lineNumber": 117
          }
        ]
      },
      "score": 0.2465427964925766
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 185,
            "column": 51
          },
          "endPosition": {
            "line": 209,
            "column": 20
          }
        },
        "contents": "        with col_answer:\n            if st.button(\"å›ç­”ã‚’é€ä¿¡\", type=\"primary\", use_container_width=True):\n                if user_answer:\n                    # å›ç­”ã‚’åé›†\n                    st.session_state.question_responses.append(user_answer)\n                    \n                    # å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€è³ªå•ã€å›ç­”ã‚’çµ„ã¿åˆã‚ã›ã¦å†é€ä¿¡\n                    combined_prompt = st.session_state.conversation_context\n                    if st.session_state.pending_questions:\n                        combined_prompt += f\"\\n\\nè³ªå•:\\n{st.session_state.pending_questions}\\n\"\n                    if st.session_state.question_responses:\n                        combined_prompt += \"\\n\\nå›ç­”:\\n\"\n                        for i, response in enumerate(st.session_state.question_responses, 1):\n                            combined_prompt += f\"{i}. {response}\\n\"\n                    \n                    # è³ªå•æ™‚ã®å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜\n                    append_mode_flag = st.session_state.append_mode_for_question\n                    \n                    # ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ä¸€æ™‚çš„ã«ä¿å­˜ï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ã«å¾©å…ƒã™ã‚‹ãŸã‚ï¼‰\n                    temp_context = st.session_state.conversation_context\n                    temp_questions = st.session_state.pending_questions\n                    temp_responses = st.session_state.question_responses.copy()\n                    \n                    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "        with col_answer:",
            "lineNumber": 187
          },
          {
            "text": "            if st.button(\"å›ç­”ã‚’é€ä¿¡\", type=\"primary\", use_container_width=True):",
            "lineNumber": 188
          },
          {
            "text": "                if user_answer:",
            "lineNumber": 189
          },
          {
            "text": "                    # å›ç­”ã‚’åé›†",
            "lineNumber": 190
          },
          {
            "text": "                    st.session_state.question_responses.append(user_answer)",
            "lineNumber": 191
          },
          {
            "text": "                    ",
            "lineNumber": 192
          },
          {
            "text": "                    # å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€è³ªå•ã€å›ç­”ã‚’çµ„ã¿åˆã‚ã›ã¦å†é€ä¿¡",
            "lineNumber": 193
          },
          {
            "text": "                    combined_prompt = st.session_state.conversation_context",
            "lineNumber": 194
          },
          {
            "text": "                    if st.session_state.pending_questions:",
            "lineNumber": 195
          },
          {
            "text": "                        combined_prompt += f\"\\n\\nè³ªå•:\\n{st.session_state.pending_questions}\\n\"",
            "lineNumber": 196
          },
          {
            "text": "                    if st.session_state.question_responses:",
            "lineNumber": 197
          },
          {
            "text": "                        combined_prompt += \"\\n\\nå›ç­”:\\n\"",
            "lineNumber": 198
          },
          {
            "text": "                        for i, response in enumerate(st.session_state.question_responses, 1):",
            "lineNumber": 199
          },
          {
            "text": "                            combined_prompt += f\"{i}. {response}\\n\"",
            "lineNumber": 200
          },
          {
            "text": "                    ",
            "lineNumber": 201
          },
          {
            "text": "                    # è³ªå•æ™‚ã®å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜",
            "lineNumber": 202
          },
          {
            "text": "                    append_mode_flag = st.session_state.append_mode_for_question",
            "lineNumber": 203
          },
          {
            "text": "                    ",
            "lineNumber": 204
          },
          {
            "text": "                    # ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ä¸€æ™‚çš„ã«ä¿å­˜ï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ã«å¾©å…ƒã™ã‚‹ãŸã‚ï¼‰",
            "lineNumber": 205
          },
          {
            "text": "                    temp_context = st.session_state.conversation_context",
            "lineNumber": 206
          },
          {
            "text": "                    temp_questions = st.session_state.pending_questions",
            "lineNumber": 207
          },
          {
            "text": "                    temp_responses = st.session_state.question_responses.copy()",
            "lineNumber": 208
          },
          {
            "text": "                    ",
            "lineNumber": 209
          },
          {
            "text": "                    ",
            "lineNumber": 210
          }
        ]
      },
      "score": 0.24565154314041138
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\flow.md",
        "range": {
          "startPosition": {
            "line": 271
          },
          "endPosition": {
            "line": 321
          }
        },
        "contents": "    subgraph flow6 [\"ãã®ä»–ã®ç—‡çŠ¶ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]\n        task_other_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã®FFCã‚’äº¤æ›ã™ã‚‹\"]\n        task_other_2[\"PGåŸºæ¿ã‚’ç¢ºèª\"]\n        decision_other_2{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task_other_2_1[\"PGåŸºæ¿ã‚’äº¤æ›\"]\n        task_other_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ç¢ºèª\"]\n        decision_other_3{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task_other_3_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›\"]\n        task_other_4[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›\"]\n        task_other_5[\"ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›\"]\n        task_other_6[\"JARVISå†…éƒ¨ã®FFCã‚’äº¤æ›\"]\n        task_other_7[\"JARVISå†…éƒ¨ã®ã‚±ãƒ¼ãƒ–ãƒ«ã‚’äº¤æ›\"]\n        task_other_8[\"æµå‹•ã«æˆ»ã™\"]\n        decision_other_1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n        \n        task_other--&gt;task_other_1\n        task_other_1--&gt;task_other_2\n        task_other_2--&gt;decision_other_2\n        decision_other_2--&gt;|\"æ­£å¸¸\"|task_other_3\n        decision_other_2--&gt;|\"ç•°å¸¸\"|task_other_2_1\n        task_other_2_1--&gt;task_other_3\n        task_other_3--&gt;decision_other_3\n        decision_other_3--&gt;|\"æ­£å¸¸\"|task_other_4\n        decision_other_3--&gt;|\"ç•°å¸¸\"|task_other_3_1\n        task_other_3_1--&gt;task_other_4\n        task_other_4--&gt;task_other_5\n        task_other_5--&gt;task_other_6\n        task_other_6--&gt;task_other_7\n        task_other_7--&gt;task_other_8\n        task_other_8--&gt;decision_other_1\n        decision_other_1--&gt;|\"å†ç¾ã—ãªã„\"|task10\n        decision_other_1--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer\n    end\n    \n    style start fill:#90EE90\n    style task1 fill:#90EE90\n    style task2 fill:#90EE90\n    style decision1 fill:#90EE90\n    style task3 fill:#90EE90\n    style decision2 fill:#90EE90\n    style task4 fill:#90EE90\n    style decision3 fill:#90EE90\n    style task5 fill:#90EE90\n    style task6 fill:#90EE90\n    style task7 fill:#90EE90\n    style task8 fill:#90EE90\n    style task9 fill:#90EE90\n    style task_other fill:#90EE90\n    style task10 fill:#90EE90\n    style decision_recurrence fill:#90EE90",
        "signatures": {},
        "detailedLines": [
          {
            "text": "    subgraph flow6 [\"ãã®ä»–ã®ç—‡çŠ¶ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 272
          },
          {
            "text": "        task_other_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã®FFCã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 273
          },
          {
            "text": "        task_other_2[\"PGåŸºæ¿ã‚’ç¢ºèª\"]",
            "lineNumber": 274
          },
          {
            "text": "        decision_other_2{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 275
          },
          {
            "text": "        task_other_2_1[\"PGåŸºæ¿ã‚’äº¤æ›\"]",
            "lineNumber": 276
          },
          {
            "text": "        task_other_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ç¢ºèª\"]",
            "lineNumber": 277
          },
          {
            "text": "        decision_other_3{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 278
          },
          {
            "text": "        task_other_3_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›\"]",
            "lineNumber": 279
          },
          {
            "text": "        task_other_4[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›\"]",
            "lineNumber": 280
          },
          {
            "text": "        task_other_5[\"ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›\"]",
            "lineNumber": 281
          },
          {
            "text": "        task_other_6[\"JARVISå†…éƒ¨ã®FFCã‚’äº¤æ›\"]",
            "lineNumber": 282
          },
          {
            "text": "        task_other_7[\"JARVISå†…éƒ¨ã®ã‚±ãƒ¼ãƒ–ãƒ«ã‚’äº¤æ›\"]",
            "lineNumber": 283
          },
          {
            "text": "        task_other_8[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 284
          },
          {
            "text": "        decision_other_1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 285
          },
          {
            "text": "        ",
            "lineNumber": 286
          },
          {
            "text": "        task_other--&gt;task_other_1",
            "lineNumber": 287
          },
          {
            "text": "        task_other_1--&gt;task_other_2",
            "lineNumber": 288
          },
          {
            "text": "        task_other_2--&gt;decision_other_2",
            "lineNumber": 289
          },
          {
            "text": "        decision_other_2--&gt;|\"æ­£å¸¸\"|task_other_3",
            "lineNumber": 290
          },
          {
            "text": "        decision_other_2--&gt;|\"ç•°å¸¸\"|task_other_2_1",
            "lineNumber": 291
          },
          {
            "text": "        task_other_2_1--&gt;task_other_3",
            "lineNumber": 292
          },
          {
            "text": "        task_other_3--&gt;decision_other_3",
            "lineNumber": 293
          },
          {
            "text": "        decision_other_3--&gt;|\"æ­£å¸¸\"|task_other_4",
            "lineNumber": 294
          },
          {
            "text": "        decision_other_3--&gt;|\"ç•°å¸¸\"|task_other_3_1",
            "lineNumber": 295
          },
          {
            "text": "        task_other_3_1--&gt;task_other_4",
            "lineNumber": 296
          },
          {
            "text": "        task_other_4--&gt;task_other_5",
            "lineNumber": 297
          },
          {
            "text": "        task_other_5--&gt;task_other_6",
            "lineNumber": 298
          },
          {
            "text": "        task_other_6--&gt;task_other_7",
            "lineNumber": 299
          },
          {
            "text": "        task_other_7--&gt;task_other_8",
            "lineNumber": 300
          },
          {
            "text": "        task_other_8--&gt;decision_other_1",
            "lineNumber": 301
          },
          {
            "text": "        decision_other_1--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 302
          },
          {
            "text": "        decision_other_1--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer",
            "lineNumber": 303
          },
          {
            "text": "    end",
            "lineNumber": 304
          },
          {
            "text": "    ",
            "lineNumber": 305
          },
          {
            "text": "    style start fill:#90EE90",
            "lineNumber": 306
          },
          {
            "text": "    style task1 fill:#90EE90",
            "lineNumber": 307
          },
          {
            "text": "    style task2 fill:#90EE90",
            "lineNumber": 308
          },
          {
            "text": "    style decision1 fill:#90EE90",
            "lineNumber": 309
          },
          {
            "text": "    style task3 fill:#90EE90",
            "lineNumber": 310
          },
          {
            "text": "    style decision2 fill:#90EE90",
            "lineNumber": 311
          },
          {
            "text": "    style task4 fill:#90EE90",
            "lineNumber": 312
          },
          {
            "text": "    style decision3 fill:#90EE90",
            "lineNumber": 313
          },
          {
            "text": "    style task5 fill:#90EE90",
            "lineNumber": 314
          },
          {
            "text": "    style task6 fill:#90EE90",
            "lineNumber": 315
          },
          {
            "text": "    style task7 fill:#90EE90",
            "lineNumber": 316
          },
          {
            "text": "    style task8 fill:#90EE90",
            "lineNumber": 317
          },
          {
            "text": "    style task9 fill:#90EE90",
            "lineNumber": 318
          },
          {
            "text": "    style task_other fill:#90EE90",
            "lineNumber": 319
          },
          {
            "text": "    style task10 fill:#90EE90",
            "lineNumber": 320
          },
          {
            "text": "    style decision_recurrence fill:#90EE90",
            "lineNumber": 321
          }
        ]
      },
      "score": 0.23953354358673096
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\storage\\toon_files\\flow_md.md",
        "range": {
          "startPosition": {
            "line": 83
          },
          "endPosition": {
            "line": 135
          }
        },
        "contents": "        decision_check9_1_1--&gt;|\"ç•°å¸¸\"|task9_1\n        task9_1--&gt;task9_2\n        task9_2--&gt;decision9_1\n        decision9_1--&gt;|\"å‡ºã¦ããŸ\"|check9_3\n        decision9_1--&gt;|\"å‡ºã¦ã“ãªã„\"|task10\n        \n        check9_3--&gt;decision_check9_3\n        decision_check9_3--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_3_1\n        decision_check9_3--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_3\n        decision_check9_3_1--&gt;|\"æ­£å¸¸\"|task9_4\n        decision_check9_3_1--&gt;|\"ç•°å¸¸\"|task9_3\n        task9_3--&gt;task9_4\n        task9_4--&gt;decision9_2\n        decision9_2--&gt;|\"å‡ºã¦ããŸ\"|check9_5\n        decision9_2--&gt;|\"å‡ºã¦ã“ãªã„\"|task10\n        \n        check9_5--&gt;decision_check9_5\n        decision_check9_5--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_5_1\n        decision_check9_5--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_5\n        decision_check9_5_1--&gt;|\"æ­£å¸¸\"|task9_6\n        decision_check9_5_1--&gt;|\"ç•°å¸¸\"|task9_5\n        task9_5--&gt;task9_6\n        task9_6--&gt;decision9_3\n        decision9_3--&gt;|\"å‡ºã¦ããŸ\"|check9_7\n        decision9_3--&gt;|\"å‡ºã¦ã“ãªã„\"|task10\n        \n        check9_7--&gt;decision_check9_7\n        decision_check9_7--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_7_1\n        decision_check9_7--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_7\n        decision_check9_7_1--&gt;|\"æ­£å¸¸\"|task9_8\n        decision_check9_7_1--&gt;|\"ç•°å¸¸\"|task9_7\n        task9_7--&gt;task9_8\n        task9_8--&gt;decision9_4\n        decision9_4--&gt;|\"å‡ºã¦ããŸ\"|task9_9\n        decision9_4--&gt;|\"å‡ºã¦ã“ãªã„\"|task10\n        \n        task9_9--&gt;contact_manufacturer\n    end\n    \n    %% ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã¸ã®é€£çµ¡ï¼ˆå…¨ãƒ¢ãƒ¼ãƒ‰å…±é€šï¼‰\n    contact_manufacturer--&gt;node_end\n    \n    %% è¡¨ç¤ºãŒãŠã‹ã—ã„å ´åˆã®åˆ†å²\n    task4--&gt;decision3\n    decision3--&gt;|\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"|task5\n    decision3--&gt;|\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"|task6\n    decision3--&gt;|\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"|task7\n    \n    %% ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\n    subgraph flow1 [\"ä¸¡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]\n        check11_1[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check11_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "        decision_check9_1_1--&gt;|\"ç•°å¸¸\"|task9_1",
            "lineNumber": 84
          },
          {
            "text": "        task9_1--&gt;task9_2",
            "lineNumber": 85
          },
          {
            "text": "        task9_2--&gt;decision9_1",
            "lineNumber": 86
          },
          {
            "text": "        decision9_1--&gt;|\"å‡ºã¦ããŸ\"|check9_3",
            "lineNumber": 87
          },
          {
            "text": "        decision9_1--&gt;|\"å‡ºã¦ã“ãªã„\"|task10",
            "lineNumber": 88
          },
          {
            "text": "        ",
            "lineNumber": 89
          },
          {
            "text": "        check9_3--&gt;decision_check9_3",
            "lineNumber": 90
          },
          {
            "text": "        decision_check9_3--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_3_1",
            "lineNumber": 91
          },
          {
            "text": "        decision_check9_3--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_3",
            "lineNumber": 92
          },
          {
            "text": "        decision_check9_3_1--&gt;|\"æ­£å¸¸\"|task9_4",
            "lineNumber": 93
          },
          {
            "text": "        decision_check9_3_1--&gt;|\"ç•°å¸¸\"|task9_3",
            "lineNumber": 94
          },
          {
            "text": "        task9_3--&gt;task9_4",
            "lineNumber": 95
          },
          {
            "text": "        task9_4--&gt;decision9_2",
            "lineNumber": 96
          },
          {
            "text": "        decision9_2--&gt;|\"å‡ºã¦ããŸ\"|check9_5",
            "lineNumber": 97
          },
          {
            "text": "        decision9_2--&gt;|\"å‡ºã¦ã“ãªã„\"|task10",
            "lineNumber": 98
          },
          {
            "text": "        ",
            "lineNumber": 99
          },
          {
            "text": "        check9_5--&gt;decision_check9_5",
            "lineNumber": 100
          },
          {
            "text": "        decision_check9_5--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_5_1",
            "lineNumber": 101
          },
          {
            "text": "        decision_check9_5--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_5",
            "lineNumber": 102
          },
          {
            "text": "        decision_check9_5_1--&gt;|\"æ­£å¸¸\"|task9_6",
            "lineNumber": 103
          },
          {
            "text": "        decision_check9_5_1--&gt;|\"ç•°å¸¸\"|task9_5",
            "lineNumber": 104
          },
          {
            "text": "        task9_5--&gt;task9_6",
            "lineNumber": 105
          },
          {
            "text": "        task9_6--&gt;decision9_3",
            "lineNumber": 106
          },
          {
            "text": "        decision9_3--&gt;|\"å‡ºã¦ããŸ\"|check9_7",
            "lineNumber": 107
          },
          {
            "text": "        decision9_3--&gt;|\"å‡ºã¦ã“ãªã„\"|task10",
            "lineNumber": 108
          },
          {
            "text": "        ",
            "lineNumber": 109
          },
          {
            "text": "        check9_7--&gt;decision_check9_7",
            "lineNumber": 110
          },
          {
            "text": "        decision_check9_7--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_7_1",
            "lineNumber": 111
          },
          {
            "text": "        decision_check9_7--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_7",
            "lineNumber": 112
          },
          {
            "text": "        decision_check9_7_1--&gt;|\"æ­£å¸¸\"|task9_8",
            "lineNumber": 113
          },
          {
            "text": "        decision_check9_7_1--&gt;|\"ç•°å¸¸\"|task9_7",
            "lineNumber": 114
          },
          {
            "text": "        task9_7--&gt;task9_8",
            "lineNumber": 115
          },
          {
            "text": "        task9_8--&gt;decision9_4",
            "lineNumber": 116
          },
          {
            "text": "        decision9_4--&gt;|\"å‡ºã¦ããŸ\"|task9_9",
            "lineNumber": 117
          },
          {
            "text": "        decision9_4--&gt;|\"å‡ºã¦ã“ãªã„\"|task10",
            "lineNumber": 118
          },
          {
            "text": "        ",
            "lineNumber": 119
          },
          {
            "text": "        task9_9--&gt;contact_manufacturer",
            "lineNumber": 120
          },
          {
            "text": "    end",
            "lineNumber": 121
          },
          {
            "text": "    ",
            "lineNumber": 122
          },
          {
            "text": "    %% ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã¸ã®é€£çµ¡ï¼ˆå…¨ãƒ¢ãƒ¼ãƒ‰å…±é€šï¼‰",
            "lineNumber": 123
          },
          {
            "text": "    contact_manufacturer--&gt;node_end",
            "lineNumber": 124
          },
          {
            "text": "    ",
            "lineNumber": 125
          },
          {
            "text": "    %% è¡¨ç¤ºãŒãŠã‹ã—ã„å ´åˆã®åˆ†å²",
            "lineNumber": 126
          },
          {
            "text": "    task4--&gt;decision3",
            "lineNumber": 127
          },
          {
            "text": "    decision3--&gt;|\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"|task5",
            "lineNumber": 128
          },
          {
            "text": "    decision3--&gt;|\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"|task6",
            "lineNumber": 129
          },
          {
            "text": "    decision3--&gt;|\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"|task7",
            "lineNumber": 130
          },
          {
            "text": "    ",
            "lineNumber": 131
          },
          {
            "text": "    %% ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 132
          },
          {
            "text": "    subgraph flow1 [\"ä¸¡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 133
          },
          {
            "text": "        check11_1[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 134
          },
          {
            "text": "        decision_check11_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 135
          }
        ]
      },
      "score": 0.23144680261611938
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\flow.md",
        "range": {
          "startPosition": {
            "line": 172
          },
          "endPosition": {
            "line": 213
          }
        },
        "contents": "    %% ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\n    subgraph flow2 [\"ç‰‡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]\n        check13_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check13_2{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check13_2_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task13_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        check11_2[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check11_2{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check11_2_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task11_2[\"PGåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        check12_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check12_2{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check12_2_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task12_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        task10_2[\"æµå‹•ã«æˆ»ã™\"]\n        decision1_2{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n        \n        task6--&gt;check13_2\n        check13_2--&gt;decision_check13_2\n        decision_check13_2--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check13_2_1\n        decision_check13_2--&gt;|\"åˆ¤å®šã§ããªã„\"|task13_2\n        decision_check13_2_1--&gt;|\"æ­£å¸¸\"|check11_2\n        decision_check13_2_1--&gt;|\"ç•°å¸¸\"|task13_2\n        task13_2--&gt;check11_2\n        check11_2--&gt;decision_check11_2\n        decision_check11_2--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check11_2_1\n        decision_check11_2--&gt;|\"åˆ¤å®šã§ããªã„\"|task11_2\n        decision_check11_2_1--&gt;|\"æ­£å¸¸\"|check12_2\n        decision_check11_2_1--&gt;|\"ç•°å¸¸\"|task11_2\n        task11_2--&gt;check12_2\n        check12_2--&gt;decision_check12_2\n        decision_check12_2--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check12_2_1\n        decision_check12_2--&gt;|\"åˆ¤å®šã§ããªã„\"|task12_2\n        decision_check12_2_1--&gt;|\"æ­£å¸¸\"|task10_2\n        decision_check12_2_1--&gt;|\"ç•°å¸¸\"|task12_2\n        task12_2--&gt;task10_2\n        task10_2--&gt;decision1_2\n        decision1_2--&gt;|\"å†ç¾ã—ãªã„\"|task10\n        decision1_2--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer\n    end\n    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "    %% ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 173
          },
          {
            "text": "    subgraph flow2 [\"ç‰‡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 174
          },
          {
            "text": "        check13_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 175
          },
          {
            "text": "        decision_check13_2{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 176
          },
          {
            "text": "        decision_check13_2_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 177
          },
          {
            "text": "        task13_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 178
          },
          {
            "text": "        check11_2[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 179
          },
          {
            "text": "        decision_check11_2{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 180
          },
          {
            "text": "        decision_check11_2_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 181
          },
          {
            "text": "        task11_2[\"PGåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 182
          },
          {
            "text": "        check12_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 183
          },
          {
            "text": "        decision_check12_2{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 184
          },
          {
            "text": "        decision_check12_2_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 185
          },
          {
            "text": "        task12_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 186
          },
          {
            "text": "        task10_2[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 187
          },
          {
            "text": "        decision1_2{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 188
          },
          {
            "text": "        ",
            "lineNumber": 189
          },
          {
            "text": "        task6--&gt;check13_2",
            "lineNumber": 190
          },
          {
            "text": "        check13_2--&gt;decision_check13_2",
            "lineNumber": 191
          },
          {
            "text": "        decision_check13_2--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check13_2_1",
            "lineNumber": 192
          },
          {
            "text": "        decision_check13_2--&gt;|\"åˆ¤å®šã§ããªã„\"|task13_2",
            "lineNumber": 193
          },
          {
            "text": "        decision_check13_2_1--&gt;|\"æ­£å¸¸\"|check11_2",
            "lineNumber": 194
          },
          {
            "text": "        decision_check13_2_1--&gt;|\"ç•°å¸¸\"|task13_2",
            "lineNumber": 195
          },
          {
            "text": "        task13_2--&gt;check11_2",
            "lineNumber": 196
          },
          {
            "text": "        check11_2--&gt;decision_check11_2",
            "lineNumber": 197
          },
          {
            "text": "        decision_check11_2--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check11_2_1",
            "lineNumber": 198
          },
          {
            "text": "        decision_check11_2--&gt;|\"åˆ¤å®šã§ããªã„\"|task11_2",
            "lineNumber": 199
          },
          {
            "text": "        decision_check11_2_1--&gt;|\"æ­£å¸¸\"|check12_2",
            "lineNumber": 200
          },
          {
            "text": "        decision_check11_2_1--&gt;|\"ç•°å¸¸\"|task11_2",
            "lineNumber": 201
          },
          {
            "text": "        task11_2--&gt;check12_2",
            "lineNumber": 202
          },
          {
            "text": "        check12_2--&gt;decision_check12_2",
            "lineNumber": 203
          },
          {
            "text": "        decision_check12_2--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check12_2_1",
            "lineNumber": 204
          },
          {
            "text": "        decision_check12_2--&gt;|\"åˆ¤å®šã§ããªã„\"|task12_2",
            "lineNumber": 205
          },
          {
            "text": "        decision_check12_2_1--&gt;|\"æ­£å¸¸\"|task10_2",
            "lineNumber": 206
          },
          {
            "text": "        decision_check12_2_1--&gt;|\"ç•°å¸¸\"|task12_2",
            "lineNumber": 207
          },
          {
            "text": "        task12_2--&gt;task10_2",
            "lineNumber": 208
          },
          {
            "text": "        task10_2--&gt;decision1_2",
            "lineNumber": 209
          },
          {
            "text": "        decision1_2--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 210
          },
          {
            "text": "        decision1_2--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer",
            "lineNumber": 211
          },
          {
            "text": "    end",
            "lineNumber": 212
          },
          {
            "text": "    ",
            "lineNumber": 213
          }
        ]
      },
      "score": 0.23067045211791992
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


flow.mdã®æ§‹é€ ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…ã§æ±ºã‚ã‚‹ã¹ãäº‹é …ã‚’æ•´ç†ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: flow.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: flow.md</summary>

</details>
</tool-use>

---



---


flow.mdã®æ§‹é€ ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…ã§æ±ºã‚ã‚‹ã¹ãäº‹é …ã‚’æ•´ç†ã—ã¾ã™ã€‚ã¾ãšã€æ„æ€æ±ºå®šã«å¿…è¦ãªæƒ…å ±ã‚’ç¢ºèªã—ã¾ã™ã€‚


---

<tool-use data-tool-type="unknown" data-tool-name="ask_question">
<details>
<summary>Tool use: **ask_question**</summary>


Parameters:

```json
{
  "questions": [
    {
      "id": "chatbot_mode",
      "prompt": "ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã®å‹•ä½œãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ãã ã•ã„",
      "options": [
        {
          "id": "interactive",
          "label": "å¯¾è©±å‹ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«å¿œã˜ã¦æ®µéšçš„ã«ãƒ•ãƒ­ãƒ¼ã‚’æ¡ˆå†…ï¼ˆä¾‹ï¼šã€Œç—‡çŠ¶ã‚’æ•™ãˆã¦ãã ã•ã„ã€â†’ã€Œè¡¨ç¤ºãŒãŠã‹ã—ã„ã§ã™ã€â†’è©²å½“ãƒ•ãƒ­ãƒ¼ã‚’è¡¨ç¤ºï¼‰"
        },
        {
          "id": "classification",
          "label": "åˆ†é¡å‹ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã‚’ä¸€åº¦ã«åˆ†æã—ã€æœ€ã‚‚è¿‘ã„ã‚±ãƒ¼ã‚¹ã‚’ç‰¹å®šã—ã¦è©²å½“ãƒ•ãƒ­ãƒ¼ã‚’è¡¨ç¤º"
        },
        {
          "id": "hybrid",
          "label": "ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼šæœ€åˆã«åˆ†é¡ã—ã€å¿…è¦ã«å¿œã˜ã¦è¿½åŠ è³ªå•ã§è©³ç´°ã‚’ç¢ºèª"
        }
      ]
    },
    {
      "id": "flow_loading",
      "prompt": "flow.mdã®å·¨å¤§ãƒ•ãƒ­ãƒ¼ã‚’ã©ã®ã‚ˆã†ã«æ‰±ã„ã¾ã™ã‹ï¼Ÿ",
      "options": [
        {
          "id": "preload",
          "label": "äº‹å‰èª­ã¿è¾¼ã¿ï¼šflow.mdã‚’TOONå½¢å¼ã«å¤‰æ›ã—ã¦äº‹å‰ã«èª­ã¿è¾¼ã‚€"
        },
        {
          "id": "dynamic",
          "label": "å‹•çš„ç”Ÿæˆï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«åŸºã¥ã„ã¦LLMãŒè©²å½“éƒ¨åˆ†ã®ãƒ•ãƒ­ãƒ¼ã‚’å‹•çš„ã«ç”Ÿæˆ"
        },
        {
          "id": "hybrid_flow",
          "label": "ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼šflow.mdã‚’ãƒ™ãƒ¼ã‚¹ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«å¿œã˜ã¦è©²å½“éƒ¨åˆ†ã‚’æŠ½å‡ºãƒ»è¡¨ç¤º"
        }
      ]
    }
  ]
}
```
Additional data:

```json
{
  "status": "submitted"
}
```
Result:

```json
{
  "answers": [
    {
      "questionId": "chatbot_mode",
      "selectedOptionIds": [
        "interactive"
      ],
      "freeformText": ""
    },
    {
      "questionId": "flow_loading",
      "selectedOptionIds": [
        "hybrid_flow"
      ],
      "freeformText": ""
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


é¸æŠå†…å®¹ã‚’åæ˜ ã—ã€ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼è¦–ç‚¹ã§æ±ºã‚ã‚‹ã¹ãäº‹é …ã‚’æ•´ç†ã—ãŸè¨ˆç”»ã‚’ä½œæˆã—ã¾ã™ã€‚


---

Cancelled

---

_**User**_

ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã€ã“ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆä½œæˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¨ã¯ç‹¬ç«‹ã—ã¦ã„ã‚‹ã€‚
ã‚ˆã£ã¦æŠ€è¡“ä½“ç³»ã‚„æ€æƒ³ã‚‚å…¨ãç•°ãªã£ã¦ã‚ˆã„ã€‚
ã‚€ã—ã‚æ—¢å­˜ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«è¿½åŠ ã—ãªã„ã§ãã ã•ã„

---

_**Agent (model default, mode Agent)**_



---


æ—¢å­˜ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¨ã¯ç‹¬ç«‹ã—ãŸåˆ¥ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¨ã—ã¦è¨­è¨ˆã—ç›´ã—ã¾ã™ã€‚è¨ˆç”»ã‚’æ›´æ–°ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: c:\Users\btsi1\.cursor\plans\flow.mdãƒ™ãƒ¼ã‚¹ã®å¯¾è©±å‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…_673b0640.plan.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="list_dir_v2">
<details>
<summary>Tool use: **list_dir_v2**</summary>


Parameters:

```json
{
  "targetDirectory": "."
}
```
Result:

```json
{
  "directoryTreeRoot": {
    "absPath": "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain",
    "childrenDirs": [
      {
        "absPath": "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain\\.specstory",
        "childrenDirs": [
          {
            "absPath": "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain\\.specstory\\history",
            "childrenFiles": [
              {
                "name": "2026-01-21_01-37Z-@project-md-@toon-base-md-@program-base-md-ã«åŸºã¥ããƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’å¯è¦–åŒ–ã™ã‚‹streamlitã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è€ƒãˆã¦ã„ã‚‹ã€‚ã“ã®å®Ÿè£…è¨ˆç”»ã‚’ä¸­ç«‹ãªè¦–ç‚¹ã§è©•ä¾¡ã—ã¦ãã ã•ã„ã€‚æ­£ç›´ã«è©•ä¾¡ã—ã¦éš ã•ãªã„ã§ãã ã•ã„ã€‚ä¸è¶³ã—ã¦ã„ã‚‹ã¨æ€ã†ã“ã¨ã«ã¤ã„ã¦ã‚‚æ­£ç›´ã«æ•™ãˆã¦ãã ã•ã„ã€‚.md"
              },
              {
                "name": "2026-01-21_21-57Z-å®Ÿè£…è¨ˆç”»æ›¸ã®æ¸…æ›¸.md"
              },
              {
                "name": "2026-01-25_09-59Z-ãƒãƒ¼ãƒ¡ã‚¤ãƒ‰å›³ã®æ•´ç†.md"
              }
            ],
            "childrenWereProcessed": true
          }
        ],
        "childrenFiles": [
          {
            "name": ".gitignore"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain\\.streamlit",
        "childrenFiles": [
          {
            "name": "config.toml"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain\\core",
        "childrenFiles": [
          {
            "name": "__init__.py"
          },
          {
            "name": "exceptions.py"
          },
          {
            "name": "history_mgr.py"
          },
          {
            "name": "llm_client.py"
          },
          {
            "name": "mermaid_parser.py"
          },
          {
            "name": "schemas.py"
          },
          {
            "name": "toon_parser.py"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain\\frontend",
        "childrenFiles": [
          {
            "name": "index.html"
          },
          {
            "name": "styles.css"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain\\storage",
        "childrenDirs": [
          {
            "absPath": "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain\\storage\\sessions",
            "childrenFiles": [
              {
                "name": "default_session.json"
              },
              {
                "name": "flow_md.json"
              }
            ],
            "childrenWereProcessed": true
          },
          {
            "absPath": "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain\\storage\\toon_files",
            "childrenFiles": [
              {
                "name": "default_session.md"
              },
              {
                "name": "flow_md.md"
              }
            ],
            "childrenWereProcessed": true
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain\\tests",
        "childrenFiles": [
          {
            "name": "__init__.py"
          },
          {
            "name": "test_history_mgr.py"
          },
          {
            "name": "test_schemas.py"
          },
          {
            "name": "test_toon_parser.py"
          }
        ],
        "childrenWereProcessed": true
      }
    ],
    "childrenFiles": [
      {
        "name": ".cursorindexingignore"
      },
      {
        "name": ".gitignore"
      },
      {
        "name": ".python-version"
      },
      {
        "name": "app.py"
      },
      {
        "name": "check.py"
      },
      {
        "name": "convert_flow_to_json.py"
      },
      {
        "name": "flow.md"
      },
      {
        "name": "program_base.md"
      },
      {
        "name": "Project.md"
      },
      {
        "name": "pyproject.toml"
      },
      {
        "name": "pytest.ini"
      },
      {
        "name": "README.md"
      },
      {
        "name": "requirements.txt"
      },
      {
        "name": "rules.md"
      },
      {
        "name": "TOON_BASE.md"
      },
      {
        "name": "uv.lock"
      }
    ],
    "childrenWereProcessed": true
  }
}
```
Status: **completed**


</details>
</tool-use>

---



---


æ—¢å­˜ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¨ã¯ç‹¬ç«‹ã—ãŸåˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦è¨ˆç”»ã‚’æ›´æ–°ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: c:\Users\btsi1\.cursor\plans\flow.mdãƒ™ãƒ¼ã‚¹ã®å¯¾è©±å‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…_673b0640.plan.md</summary>

</details>

</tool-use>

---



---


è¨ˆç”»ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚æ—¢å­˜ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆä½œæˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¨ã¯å®Œå…¨ã«ç‹¬ç«‹ã—ãŸåˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦è¨­è¨ˆã—ã¦ã„ã¾ã™ã€‚

## ä¸»ãªå¤‰æ›´ç‚¹

1. **ç‹¬ç«‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ **: `chatbot_flow/`ã¨ã„ã†æ–°ã—ã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®
2. **ç‹¬è‡ªã®æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**: æ—¢å­˜ã®`core/`ã‚„`app.py`ã¯ä½¿ç”¨ã›ãšã€æ–°è¦å®Ÿè£…
3. **æŸ”è»ŸãªæŠ€è¡“é¸æŠ**: å¿…è¦ã«å¿œã˜ã¦ç•°ãªã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æ¡ç”¨å¯èƒ½

è¨ˆç”»ã®è¦ç‚¹:

- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ **: ç‹¬ç«‹ã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
- **ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒæ±ºã‚ã‚‹ã¹ãäº‹é …**: æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€UI/UXè¨­è¨ˆãªã©
- **å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º**: Phase 1ã‹ã‚‰Phase 5ã¾ã§æ®µéšçš„ã«å®Ÿè£…

ã“ã®è¨ˆç”»ã§é€²ã‚ã¦å•é¡Œãªã„ã‹ã€è¿½åŠ ã§æ±ºã‚ã‚‹ã¹ãäº‹é …ãŒã‚ã‚Œã°æ•™ãˆã¦ãã ã•ã„ã€‚

---

_**User**_

1-1.Streamlitã¯ä¸æ¡ç”¨ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚‚é‹ç”¨ã™ã‚‹ã€‚ä¼šç¤¾ã‚„æ¥­å‹™ã§åˆ©ç”¨ã™ã‚‹ã“ã¨ã‚’è€ƒæ…®ã—ã€Windows Aplicationã¨ã—ã¦C#ã§ä½œã‚‹ã‹ã€Rustã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã™ã‚‹ã‹ç­‰ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åŒ–ãŒäº‰ç‚¹ã§ã‚ã‚‹ã€‚
1-2.Flow.mdã‚’Mermaidå½¢å¼ã®ã¾ã¾ä¿æŒã—ã€ãƒ‘ãƒ¼ã‚¹ã—ã¦JSONã®æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›ã™ã‚‹å°‚ç”¨ã®æ©Ÿèƒ½ã‚’ç”¨æ„ã™ã‚‹ã€‚
1-3.ãƒ—ã‚·ãƒ§ãƒ³D:ã‚’é¸æŠã—ãŸã„ã®ã§2ã§JSONå½¢å¼ã§èª­ã¿è¾¼ã¿ãŸã„ã€‚
2-1.ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ã®åˆ†å²ã¾ã§
2-2.å¿…é ˆæƒ…å ±ã¯ä»¥ä¸‹2ã¤
ãƒ»ç—‡çŠ¶ã®ç¨®é¡ï¼ˆè¡¨ç¤º/ãƒ‡ãƒ¼ã‚¿/å†ç™º/ãã®ä»–ï¼‰
ãƒ»ç—‡çŠ¶ã®è©³ç´°ï¼ˆä¸¡å´/ç‰‡å´ãªã©ï¼‰
æ¨å¥¨æƒ…å ±ã¨ã—ã¦
ãƒ»éå»ã®å¯¾å¿œå±¥æ­´
è³ªå•ã®é †åºï¼šç—‡çŠ¶ã®ç¨®é¡ â†’ è©³ç´°(â†’å±¥æ­´)
è³ªå•å½¢å¼ã¯ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰(å…¥åŠ›åˆ¶é™ã‚ã‚Š)
2-3.ä¿æŒã™ã‚‹æƒ…å ±ï¼š
ãƒ»ç¾åœ¨ã®ãƒ•ãƒ­ãƒ¼ä½ç½®ï¼ˆã©ã®decisionãƒãƒ¼ãƒ‰ã«ã„ã‚‹ã‹ï¼‰
ãƒ»ã“ã‚Œã¾ã§ã®å›ç­”å±¥æ­´
ãƒ»é¸æŠã—ãŸãƒ•ãƒ­ãƒ¼ãƒ‘ã‚¹
ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆè¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œã®å ´åˆï¼‰
ãƒªã‚»ãƒƒãƒˆæ¡ä»¶ï¼šæ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã€ãƒ•ãƒ­ãƒ¼å®Œäº†æ™‚ã€æ˜ç¤ºçš„ãªãƒªã‚»ãƒƒãƒˆæŒ‡ç¤º
ä¿å­˜ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹/ãƒ•ã‚¡ã‚¤ãƒ«
ç‰¹ã«å±¥æ­´ã‚„ãƒ•ãƒ­ãƒ¼ãªã©LLMã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’åœ§è¿«ã™ã‚‹ã‚‚ã®ã¯ä¿å­˜ã—ã¦LLMã«æ®‹ã•ãªã„
3-1.ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¦ç´ ï¼š
ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‰å‡¦ç†è¨­è¨ˆ
ãƒ»LLMã«æ¸¡ã™å‰ã«æˆå½¢
ã“ã“ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã§
ãƒ»è‹±èªæŒ‡ç¤ºã¯ã€Œæ—¥æœ¬èªã§ãŠé¡˜ã„ã—ã¾ã™ã€‚ã€ã¨è¿”ã™ã€‚
ã€€(PGãªã©ã€å˜èªãƒ¬ãƒ™ãƒ«ã¯OK)
ãƒ»ã€Œï½ã¨ã—ã¦ãµã‚‹ã¾ã£ã¦ã€ã‚„ã€ã€Œï½ã‚’å„ªå…ˆã—ãªã•ã„ã€ã‚„ã€ã€Œå‰ã®æŒ‡ç¤ºã‚’ç„¡è¦–ã—ã¦ã€
ãªã©ã€ç—‡çŠ¶ã«é–¢ä¿‚ãªã•ãã†ãªå†…å®¹ã¯ã™ã¹ã¦ã€Œç°¡æ½”ã«èª¬æ˜ã—ã¦ãã ã•ã„ã€ã¨è¿”ã™ã€‚
ãƒ»ç—‡çŠ¶ã¯20å­—ä»¥å†…ã§è¨˜å·ã¯ã€Œ,ã€ã€Œã€‚ã€ã€Œ!ã€ã€Œ?ã€ã®ã¿è¨±å¯ã™ã‚‹ã€‚
ãƒ»LLMã§å®Ÿè¡Œã§ãã‚‹ã“ã¨,LLMã¯Flow.mdã®å†…å®¹ã‹ã‚‰é–¢é€£ã™ã‚‹ãƒ•ãƒ­ãƒ¼ã‚’æ¨æ¸¬ã™ã‚‹å‡¦ç†ã®ã¿è¨±å¯ã—ã¾ã™ã€‚
ãƒ»å®Ÿéš›ã®è¡¨ç¤ºã‚„ãƒœã‚¿ãƒ³é¸æŠã®å‡¦ç†ã¯ã™ã¹ã¦ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã§è¡Œã„ãªã•ã„ã€‚
ãƒ»LLMã®ã‚­ãƒ¼ã¯Masterã‚¢ã‚«ã‚¦ãƒ³ãƒˆä»¥å¤–ã§å¤‰æ›´ä¸å¯èƒ½ã¨ã—ã¦ãã ã•ã„ã€‚
ãƒ»LLMã«ã‚ˆã‚‹ãƒãƒƒã‚·ãƒ¥ã‚„ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆç­‰ã¯å®Ÿè¡Œä¸å¯ã¨ã—ã¾ã™ã€‚(ã‚ãã¾ã§ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«æƒ…å ±ã‚’æ¸¡ã™ã®ã¿)

flow.mdã®æ§‹é€ èª¬æ˜ï¼ˆdecision2ã®4ã¤ã®åˆ†å²ï¼‰
å„åˆ†å²ã®ç‰¹å¾´èª¬æ˜
åˆ†é¡ã‚¿ã‚¹ã‚¯ã®æŒ‡ç¤º
å‡ºåŠ›å½¢å¼ã®æŒ‡å®šï¼ˆJSONå½¢å¼ã§åˆ†é¡çµæœã‚’è¿”ã™ï¼‰
æ¨å¥¨å½¢å¼:
{
  "category": "è¡¨ç¤ºãŒãŠã‹ã—ã„|ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„|å†ç™º|ãã®ä»–",
  "confidence": 0.0-1.0,
  "details": "è©³ç´°æƒ…å ±ï¼ˆä¸¡å´/ç‰‡å´ãªã©ï¼‰",
  "needs_clarification": true/false,
  "clarification_questions": ["è³ªå•1", "è³ªå•2"]

---

_**Agent (model default, mode Agent)**_



---


è¦ä»¶ã‚’åæ˜ ã—ã¦è¨ˆç”»ã‚’æ›´æ–°ä¸­ã§ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: c:\Users\btsi1\.cursor\plans\flow.mdãƒ™ãƒ¼ã‚¹ã®å¯¾è©±å‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…_673b0640.plan.md</summary>

</details>
</tool-use>

---



---


è¦ä»¶ã‚’åæ˜ ã—ã¦è¨ˆç”»ã‚’æ›´æ–°ä¸­ã§ã™ã€‚


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: c:\Users\btsi1\.cursor\plans\flow.mdãƒ™ãƒ¼ã‚¹ã®å¯¾è©±å‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…_673b0640.plan.md</summary>

</details>

</tool-use>

---



---


è¨ˆç”»ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚è¦ä»¶ã‚’åæ˜ ã—ã¦ã„ã¾ã™ã€‚

## ä¸»ãªæ›´æ–°å†…å®¹

1. **æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**: Streamlitä¸æ¡ç”¨ â†’ C#ã¾ãŸã¯Rustã§Windowsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
2. **ãƒ•ãƒ­ãƒ¼ç®¡ç†**: flow.mdã‚’Mermaidå½¢å¼ã®ã¾ã¾ä¿æŒã—ã€JSONå¤‰æ›å°‚ç”¨æ©Ÿèƒ½ã‚’å®Ÿè£…
3. **æŠ½å‡ºãƒ­ã‚¸ãƒƒã‚¯**: ã‚ªãƒ—ã‚·ãƒ§ãƒ³Dï¼ˆãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼‰ã‚’é¸æŠã€JSONå½¢å¼ã§èª­ã¿è¾¼ã¿
4. **è³ªå•åˆ†é¡**: ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ã®åˆ†å²ï¼ˆdecision2ï¼‰ã¾ã§
5. **å¯¾è©±è¨­è¨ˆ**: å¿…é ˆæƒ…å ±ã¨æ¨å¥¨æƒ…å ±ã‚’æ˜ç¢ºåŒ–ã€ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰è³ªå•å½¢å¼
6. **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹/ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ã€LLMã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰é™¤å¤–
7. **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‰å‡¦ç†**: ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®å‰å‡¦ç†è¨­è¨ˆï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶å«ã‚€ï¼‰
8. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: LLMã‚­ãƒ¼ç®¡ç†ã€å®Ÿè¡Œåˆ¶é™ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–

## æ®‹ã‚‹æ±ºå®šäº‹é …

**C#ã¨Rustã®ã©ã¡ã‚‰ã‚’é¸æŠã—ã¾ã™ã‹ï¼Ÿ**

- **C#**: Windowsãƒã‚¤ãƒ†ã‚£ãƒ–ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ãŒè±Šå¯Œã€.NETã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ 
- **Rust**: ãƒ¡ãƒ¢ãƒªå®‰å…¨æ€§ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯èƒ½æ€§

ã©ã¡ã‚‰ã‚’é¸æŠã™ã‚‹ã‹ã€ã¾ãŸã¯è¿½åŠ ã®è¦ä»¶ãŒã‚ã‚Œã°æ•™ãˆã¦ãã ã•ã„ã€‚

---

_**User**_

è¿½åŠ ã®è¦ä»¶ï¼š
ãƒ»LLMã®è²¬ä»»ã¨å¯¾å¿œç¯„å›²ã‚’æ˜ç¢ºã«ã—ã¦ãã ã•ã„ã€‚
ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã€éå»ã®å±¥æ­´ã‚’ãã“ã‹ã‚‰æŠ½å‡ºã—ã¾ã™ã€‚(ãƒ—ãƒ­ã‚°ãƒ©ãƒ åˆ©ç”¨ï¼šéLLM)
ãƒ»å®Ÿè£…ã¯åˆ¥ãƒ•ã‚©ãƒ«ãƒ€ã§ã‚„ã‚‹ã®ã§ã€å®Ÿè£…è¨ˆç”»æ›¸ã¨ã—ã¦ç”¨æ„ã€‚

---

_**Agent (model default, mode Agent)**_



---


è¿½åŠ è¦ä»¶ã‚’åæ˜ ã—ã¦è¨ˆç”»æ›¸ã‚’æ›´æ–°ä¸­ã§ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: c:\Users\btsi1\.cursor\plans\flow.mdãƒ™ãƒ¼ã‚¹ã®å¯¾è©±å‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…_673b0640.plan.md</summary>

</details>
</tool-use>

---



---


è¿½åŠ è¦ä»¶ã‚’åæ˜ ã—ã¦è¨ˆç”»æ›¸ã‚’æ›´æ–°ä¸­ã§ã™ã€‚


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: c:\Users\btsi1\.cursor\plans\flow.mdãƒ™ãƒ¼ã‚¹ã®å¯¾è©±å‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…_673b0640.plan.md</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: c:\Users\btsi1\.cursor\plans\flow.mdãƒ™ãƒ¼ã‚¹ã®å¯¾è©±å‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…_673b0640.plan.md</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: c:\Users\btsi1\.cursor\plans\flow.mdãƒ™ãƒ¼ã‚¹ã®å¯¾è©±å‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…_673b0640.plan.md</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: c:\Users\btsi1\.cursor\plans\flow.mdãƒ™ãƒ¼ã‚¹ã®å¯¾è©±å‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…_673b0640.plan.md</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: c:\Users\btsi1\.cursor\plans\flow.mdãƒ™ãƒ¼ã‚¹ã®å¯¾è©±å‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…_673b0640.plan.md</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: c:\Users\btsi1\.cursor\plans\flow.mdãƒ™ãƒ¼ã‚¹ã®å¯¾è©±å‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…_673b0640.plan.md</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: c:\Users\btsi1\.cursor\plans\flow.mdãƒ™ãƒ¼ã‚¹ã®å¯¾è©±å‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…_673b0640.plan.md</summary>

</details>

</tool-use>

---



---


è¨ˆç”»æ›¸ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚è¿½åŠ è¦ä»¶ã‚’åæ˜ ã—ã¦ã„ã¾ã™ã€‚

## ä¸»ãªè¿½åŠ ãƒ»æ›´æ–°å†…å®¹

### 1. LLMã®è²¬ä»»ã¨å¯¾å¿œç¯„å›²ã®æ˜ç¢ºåŒ–
- **LLMãŒæ‹…å½“ã™ã‚‹å‡¦ç†**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®åˆ†é¡ã€è©³ç´°æƒ…å ±ã®æŠ½å‡ºã€JSONå‡ºåŠ›ã®ã¿
- **LLMãŒæ‹…å½“ã—ãªã„å‡¦ç†**: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‰å‡¦ç†ã€ãƒ•ãƒ­ãƒ¼æŠ½å‡ºã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã€å±¥æ­´ç®¡ç†ã€UIåˆ¶å¾¡ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã€ãƒ•ãƒ­ãƒ¼è¡¨ç¤ºï¼ˆã™ã¹ã¦ãƒ—ãƒ­ã‚°ãƒ©ãƒ å´ã§ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹å®Ÿè¡Œï¼‰
- **LLMã¸ã®å…¥åŠ›åˆ¶é™**: å‰å‡¦ç†æ¸ˆã¿ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã¨flow.mdã®æ§‹é€ èª¬æ˜ã®ã¿
- **LLMã¸ã®å…¥åŠ›ç¦æ­¢äº‹é …**: ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´ã€ãƒ•ãƒ­ãƒ¼æ§‹é€ ã®è©³ç´°ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…å®¹ã€å®Ÿè¡Œå¯èƒ½ã‚³ãƒ¼ãƒ‰

### 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ã®å±¥æ­´æŠ½å‡ºï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒ å´ï¼‰
- å±¥æ­´ã®æ¤œç´¢ãƒ»å–å¾—ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ å´ã§å®Ÿè£…ï¼ˆSQLã‚¯ã‚¨ãƒªã¾ãŸã¯ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢ï¼‰
- LLMã¯ä½¿ç”¨ã—ãªã„
- å±¥æ­´ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¨æ¤œç´¢æ©Ÿèƒ½ã‚’å®šç¾©

### 3. å®Ÿè£…è¨ˆç”»æ›¸ã¨ã—ã¦æ•´ç†
- åˆ¥ãƒ•ã‚©ãƒ«ãƒ€ã§ã®å®Ÿè£…ã‚’æ˜è¨˜
- æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯å®Œå…¨ã«ç‹¬ç«‹ã—ãŸé…ç½®ã‚’æ˜ç¢ºåŒ–
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã«å±¥æ­´ç®¡ç†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ 

è¨ˆç”»æ›¸ã¯å®Ÿè£…è¨ˆç”»æ›¸ã¨ã—ã¦å®Œæˆã—ã¦ã„ã¾ã™ã€‚è¿½åŠ ã®ä¿®æ­£ã‚„ç¢ºèªäº‹é …ãŒã‚ã‚Œã°çŸ¥ã‚‰ã›ã¦ãã ã•ã„ã€‚

---

_**User**_

ä¸è¶³ç‚¹ãŒãªã„ã‹ç¢ºèªã—ã¦ã€å®Ÿè£…è¨ˆç”»æ›¸ã¨ã—ã¦å‡ºåŠ›ã—ã¦ãã ã•ã„ã€

---

_**Agent (model default, mode Agent)**_



---


è¨ˆç”»æ›¸ã‚’ç¢ºèªã—ã€ä¸è¶³ç‚¹ã‚’è£œå®Œã—ã¦å®Ÿè£…è¨ˆç”»æ›¸ã¨ã—ã¦å®Œæˆã•ã›ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: c:\Users\btsi1\.cursor\plans\flow.mdãƒ™ãƒ¼ã‚¹ã®å¯¾è©±å‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…_673b0640.plan.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: flow.md</summary>

</details>
</tool-use>

---



---


è¨ˆç”»æ›¸ã‚’ç¢ºèªã—ã€ä¸è¶³ç‚¹ã‚’è£œå®Œã—ã¦å®Ÿè£…è¨ˆç”»æ›¸ã¨ã—ã¦å®Œæˆã•ã›ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: c:\Users\btsi1\.cursor\plans\flow.mdãƒ™ãƒ¼ã‚¹ã®å¯¾è©±å‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…_673b0640.plan.md</summary>

</details>
</tool-use>

---



---


ä¸è¶³ç‚¹ã‚’è£œå®Œã—ã€å®Ÿè£…è¨ˆç”»æ›¸ã¨ã—ã¦å®Œæˆã•ã›ã¾ã™ã€‚


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: c:\Users\btsi1\.cursor\plans\flow.mdãƒ™ãƒ¼ã‚¹ã®å¯¾è©±å‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…_673b0640.plan.md</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: c:\Users\btsi1\.cursor\plans\flow.mdãƒ™ãƒ¼ã‚¹ã®å¯¾è©±å‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…_673b0640.plan.md</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: c:\Users\btsi1\.cursor\plans\flow.mdãƒ™ãƒ¼ã‚¹ã®å¯¾è©±å‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…_673b0640.plan.md</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: c:\Users\btsi1\.cursor\plans\flow.mdãƒ™ãƒ¼ã‚¹ã®å¯¾è©±å‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…_673b0640.plan.md</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: c:\Users\btsi1\.cursor\plans\flow.mdãƒ™ãƒ¼ã‚¹ã®å¯¾è©±å‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…_673b0640.plan.md</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: c:\Users\btsi1\.cursor\plans\flow.mdãƒ™ãƒ¼ã‚¹ã®å¯¾è©±å‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…_673b0640.plan.md</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: c:\Users\btsi1\.cursor\plans\flow.mdãƒ™ãƒ¼ã‚¹ã®å¯¾è©±å‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆå®Ÿè£…_673b0640.plan.md</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: å®Ÿè£…è¨ˆç”»æ›¸.md</summary>

</details>

</tool-use>

---



---


å®Ÿè£…è¨ˆç”»æ›¸ã‚’ä½œæˆã—ã¾ã—ãŸã€‚ä¸è¶³ç‚¹ã‚’è£œå®Œã—ã¦ã„ã¾ã™ã€‚

## è¿½åŠ ã—ãŸä¸»è¦é …ç›®

1. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ**: SQLiteã®ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥**: ã‚¨ãƒ©ãƒ¼åˆ†é¡ã¨å‡¦ç†æ–¹é‡
3. **ãƒ­ã‚°æ©Ÿèƒ½**: ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã€å‡ºåŠ›å…ˆã€è¨˜éŒ²å†…å®¹ã€å€‹äººæƒ…å ±ã®å–ã‚Šæ‰±ã„
4. **ãƒ†ã‚¹ãƒˆæˆ¦ç•¥**: å˜ä½“/çµ±åˆ/ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£/ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
5. **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«è¨­è¨ˆ**: app_config.jsonã¨llm_config.jsonã®æ§‹é€ 
6. **flow.mdãƒ‘ãƒ¼ã‚¹è©³ç´°**: Mermaidå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹æ‰‹é †ã¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé¸æŠ
7. **JSONæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã®è©³ç´°ã‚¹ã‚­ãƒ¼ãƒ**: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã€ãƒãƒ¼ãƒ‰ã€ã‚¨ãƒƒã‚¸ã€subgraphã€decision_pointsã€flow_paths
8. **ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹å‡¦ç†**: LLMåˆ†é¡å¤±æ•—ã€flow.mdæœªæ¤œå‡ºã€DBæ¥ç¶šå¤±æ•—ã€LLM APIæ¥ç¶šå¤±æ•—
9. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶**: ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ã€ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã€åŒæ™‚ãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œ
10. **ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆè¨­è¨ˆ**: ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ã€é…å¸ƒç‰©æ§‹æˆã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«è¦ä»¶ã€ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæ–¹æ³•
11. **ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒ»æ¨©é™ç®¡ç†**: Masterã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™å®šç¾©
12. **ãƒªã‚¹ã‚¯ã¨å¯¾ç­–**: æŠ€è¡“çš„ãƒªã‚¹ã‚¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã€é‹ç”¨ãƒªã‚¹ã‚¯

å®Ÿè£…è¨ˆç”»æ›¸ã¯`å®Ÿè£…è¨ˆç”»æ›¸.md`ã¨ã—ã¦å‡ºåŠ›æ¸ˆã¿ã§ã™ã€‚ã“ã®è¨ˆç”»æ›¸ã«åŸºã¥ã„ã¦å®Ÿè£…ã‚’é€²ã‚ã‚‰ã‚Œã¾ã™ã€‚è¿½åŠ ã®ç¢ºèªäº‹é …ã‚„ä¿®æ­£ãŒã‚ã‚Œã°çŸ¥ã‚‰ã›ã¦ãã ã•ã„ã€‚

---

_**User**_

ç¾åœ¨ã®ãƒ•ãƒ­ãƒãƒ£ãƒ¼ãƒˆã‚’ä½œæˆã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«è¿½åŠ ã§åˆ†å²ã‚„ãƒ•ãƒ­ãƒ¼ã‚’ç›´æ¥æŒ‡å®šã—ã¦å¤‰æ›´ã™ã‚‹æ©Ÿèƒ½ã‚’ä»˜ã‘ãŸã„ã€‚LLMã«å¯¾ã—ã¦ãã®åˆ†å²ã‚„ãƒãƒ¼ãƒ‰ã«å¯¾ã—ã¦ã ã‘å¤‰æ›´æŒ‡ç¤ºã‚’é£›ã°ã›ã‚‹ã‚ˆã†ã«ã—ãŸã„ã€‚startã¨endã¯å¯¾è±¡å¤–

---

_**Agent (model default, mode Agent)**_



---


æ—¢å­˜ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆä½œæˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ã€åˆ†å²ã‚„ãƒ•ãƒ­ãƒ¼ã‚’ç›´æ¥æŒ‡å®šã—ã¦å¤‰æ›´ã™ã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹è¨ˆç”»ã‚’ç«‹ã¦ã¾ã™ã€‚ã¾ãšã€æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‚’ç¢ºèªã—ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: app.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/schemas.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/llm_client.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "How does the current flowchart editing work? How are nodes and edges modified?",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\history_mgr.py",
        "range": {
          "startPosition": {
            "line": 6
          },
          "endPosition": {
            "line": 184
          }
        },
        "contents": "class HistoryManager:\ndef list_sessions(self) -&gt; List[str]:\n if not f.name.endswith('.broken')]\n\n    def append_toon_log(self, session_id: str, new_flowchart: Flowchart) -&gt; Flowchart:\n        \"\"\"æ—¢å­˜ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«æ–°ã—ã„ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã‚’è¿½åŠ ï¼ˆãƒãƒ¼ã‚¸ï¼‰ã—ã¾ã™ã€‚\"\"\"\n        existing_flow = self.load_toon_file(session_id)\n        \n        if existing_flow is None:\n            # æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„å ´åˆã¯æ–°è¦ä½œæˆ\n            return new_flowchart\n        \n        # æ—¢å­˜ã®ãƒãƒ¼ãƒ‰ã‚’IDã§ãƒãƒƒãƒ”ãƒ³ã‚°\n        existing_nodes_map = {node.id: node for node in existing_flow.nodes}\n        \n        # æ–°ã—ã„ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã¾ãŸã¯æ›´æ–°\n        merged_nodes = []\n        processed_ids = set()\n        \n        # ã¾ãšæ—¢å­˜ãƒãƒ¼ãƒ‰ã‚’å‡¦ç†ï¼ˆæ–°ã—ã„ãƒãƒ¼ãƒ‰ã§æ›´æ–°ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼‰\n        for existing_node in existing_flow.nodes:\n            # æ–°ã—ã„ãƒãƒ¼ãƒ‰ã«åŒã˜IDãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯\n            new_node = next((n for n in new_flowchart.nodes if n.id == existing_node.id), None)\n            if new_node:\n                # æ–°ã—ã„ãƒãƒ¼ãƒ‰ã§æ›´æ–°\n                merged_nodes.append(new_node)\n                processed_ids.add(new_node.id)\n            else:\n                # æ—¢å­˜ãƒãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾ä¿æŒ\n                merged_nodes.append(existing_node)\n                processed_ids.add(existing_node.id)\n        \n        # æ–°ã—ã„ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ï¼ˆã¾ã å‡¦ç†ã•ã‚Œã¦ã„ãªã„ã‚‚ã®ã®ã¿ï¼‰\n        for new_node in new_flowchart.nodes:\n            if new_node.id not in processed_ids:\n                merged_nodes.append(new_node)\n        \n        # æ–°ã—ã„ã‚¨ãƒƒã‚¸ã‚’è¿½åŠ ã¾ãŸã¯æ›´æ–°\n        # æ—¢å­˜ã‚¨ãƒƒã‚¸ã‚’(source, target)ã‚’ã‚­ãƒ¼ã¨ã—ã¦ãƒãƒƒãƒ”ãƒ³ã‚°\n        existing_edges_map = {(edge.source, edge.target): edge for edge in existing_flow.edges}\n        merged_edges = []\n        processed_edge_keys = set()\n        \n        # ã¾ãšæ—¢å­˜ã‚¨ãƒƒã‚¸ã‚’å‡¦ç†ï¼ˆæ–°ã—ã„ã‚¨ãƒƒã‚¸ã§æ›´æ–°ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼‰",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 7,
                "column": 1
              },
              "endPosition": {
                "line": 8,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class HistoryManager:",
            "lineNumber": 7,
            "isSignature": true
          },
          {
            "text": "def list_sessions(self) -&gt; List[str]:",
            "lineNumber": 101
          },
          {
            "text": " if not f.name.endswith('.broken')]",
            "lineNumber": 103
          },
          {
            "lineNumber": 104
          },
          {
            "text": "    def append_toon_log(self, session_id: str, new_flowchart: Flowchart) -&gt; Flowchart:",
            "lineNumber": 105
          },
          {
            "text": "        \"\"\"æ—¢å­˜ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«æ–°ã—ã„ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã‚’è¿½åŠ ï¼ˆãƒãƒ¼ã‚¸ï¼‰ã—ã¾ã™ã€‚\"\"\"",
            "lineNumber": 106
          },
          {
            "text": "        existing_flow = self.load_toon_file(session_id)",
            "lineNumber": 107
          },
          {
            "text": "        ",
            "lineNumber": 108
          },
          {
            "text": "        if existing_flow is None:",
            "lineNumber": 109
          },
          {
            "text": "            # æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„å ´åˆã¯æ–°è¦ä½œæˆ",
            "lineNumber": 110
          },
          {
            "text": "            return new_flowchart",
            "lineNumber": 111
          },
          {
            "text": "        ",
            "lineNumber": 112
          },
          {
            "text": "        # æ—¢å­˜ã®ãƒãƒ¼ãƒ‰ã‚’IDã§ãƒãƒƒãƒ”ãƒ³ã‚°",
            "lineNumber": 113
          },
          {
            "text": "        existing_nodes_map = {node.id: node for node in existing_flow.nodes}",
            "lineNumber": 114
          },
          {
            "text": "        ",
            "lineNumber": 115
          },
          {
            "text": "        # æ–°ã—ã„ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã¾ãŸã¯æ›´æ–°",
            "lineNumber": 116
          },
          {
            "text": "        merged_nodes = []",
            "lineNumber": 117
          },
          {
            "text": "        processed_ids = set()",
            "lineNumber": 118
          },
          {
            "text": "        ",
            "lineNumber": 119
          },
          {
            "text": "        # ã¾ãšæ—¢å­˜ãƒãƒ¼ãƒ‰ã‚’å‡¦ç†ï¼ˆæ–°ã—ã„ãƒãƒ¼ãƒ‰ã§æ›´æ–°ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼‰",
            "lineNumber": 120
          },
          {
            "text": "        for existing_node in existing_flow.nodes:",
            "lineNumber": 121
          },
          {
            "text": "            # æ–°ã—ã„ãƒãƒ¼ãƒ‰ã«åŒã˜IDãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 122
          },
          {
            "text": "            new_node = next((n for n in new_flowchart.nodes if n.id == existing_node.id), None)",
            "lineNumber": 123
          },
          {
            "text": "            if new_node:",
            "lineNumber": 124
          },
          {
            "text": "                # æ–°ã—ã„ãƒãƒ¼ãƒ‰ã§æ›´æ–°",
            "lineNumber": 125
          },
          {
            "text": "                merged_nodes.append(new_node)",
            "lineNumber": 126
          },
          {
            "text": "                processed_ids.add(new_node.id)",
            "lineNumber": 127
          },
          {
            "text": "            else:",
            "lineNumber": 128
          },
          {
            "text": "                # æ—¢å­˜ãƒãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾ä¿æŒ",
            "lineNumber": 129
          },
          {
            "text": "                merged_nodes.append(existing_node)",
            "lineNumber": 130
          },
          {
            "text": "                processed_ids.add(existing_node.id)",
            "lineNumber": 131
          },
          {
            "text": "        ",
            "lineNumber": 132
          },
          {
            "text": "        # æ–°ã—ã„ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ï¼ˆã¾ã å‡¦ç†ã•ã‚Œã¦ã„ãªã„ã‚‚ã®ã®ã¿ï¼‰",
            "lineNumber": 133
          },
          {
            "text": "        for new_node in new_flowchart.nodes:",
            "lineNumber": 134
          },
          {
            "text": "            if new_node.id not in processed_ids:",
            "lineNumber": 135
          },
          {
            "text": "                merged_nodes.append(new_node)",
            "lineNumber": 136
          },
          {
            "text": "        ",
            "lineNumber": 137
          },
          {
            "text": "        # æ–°ã—ã„ã‚¨ãƒƒã‚¸ã‚’è¿½åŠ ã¾ãŸã¯æ›´æ–°",
            "lineNumber": 138
          },
          {
            "text": "        # æ—¢å­˜ã‚¨ãƒƒã‚¸ã‚’(source, target)ã‚’ã‚­ãƒ¼ã¨ã—ã¦ãƒãƒƒãƒ”ãƒ³ã‚°",
            "lineNumber": 139
          },
          {
            "text": "        existing_edges_map = {(edge.source, edge.target): edge for edge in existing_flow.edges}",
            "lineNumber": 140
          },
          {
            "text": "        merged_edges = []",
            "lineNumber": 141
          },
          {
            "text": "        processed_edge_keys = set()",
            "lineNumber": 142
          },
          {
            "text": "        ",
            "lineNumber": 143
          },
          {
            "text": "        # ã¾ãšæ—¢å­˜ã‚¨ãƒƒã‚¸ã‚’å‡¦ç†ï¼ˆæ–°ã—ã„ã‚¨ãƒƒã‚¸ã§æ›´æ–°ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼‰",
            "lineNumber": 144
          }
        ]
      },
      "score": 0.36531805992126465
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 22,
            "column": 31
          },
          "endPosition": {
            "line": 336
          }
        },
        "contents": "class Flowchart(BaseModel):\n    nodes: List[Node]\n    edges: List[Edge]\n    subgraphs: Optional[Dict[str, str]] = None  # {subgraph_id: subgraph_label} ã®ãƒãƒƒãƒ”ãƒ³ã‚°\n\n    @field_validator('nodes')\n    @classmethod\n    def validate_flow_structure(cls, v: List[Node]) -&gt; List[Node]:\n        if not v:\n            raise FlowchartValidationError(\"ãƒãƒ¼ãƒ‰ãŒ1ã¤ã‚‚å­˜åœ¨ã—ã¾ã›ã‚“\")\n        \n        # é–‹å§‹/çµ‚äº†ãƒãƒ¼ãƒ‰ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯\n        types = {node.type for node in v}\n        if \"start\" not in types or \"end\" not in types:\n            raise FlowchartValidationError(\"é–‹å§‹/çµ‚äº†ãƒãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™\")\n        \n        # ãƒãƒ¼ãƒ‰IDã®é‡è¤‡ãƒã‚§ãƒƒã‚¯\n        node_ids = [node.id for node in v]\n        duplicates = [node_id for node_id in node_ids if node_ids.count(node_id) &gt; 1]\n        if duplicates:\n            raise FlowchartValidationError(f\"ãƒãƒ¼ãƒ‰IDãŒé‡è¤‡ã—ã¦ã„ã¾ã™: {set(duplicates)}\")\n        \n        # ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã®æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯\n        valid_types = {\"start\", \"end\", \"process\", \"decision\", \"io_data\", \"storage\", \"missing\"}\n        invalid_types = [node.type for node in v if node.type not in valid_types]\n        if invalid_types:\n            raise FlowchartValidationError(f\"ç„¡åŠ¹ãªãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™: {set(invalid_types)}\")\n        \n        return v\n\n    @model_validator(mode='after')\n    def validate_edges_reference_nodes(self):\n        \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 25,
            "isSignature": true
          },
          {
            "text": "    nodes: List[Node]",
            "lineNumber": 26
          },
          {
            "text": "    edges: List[Edge]",
            "lineNumber": 27
          },
          {
            "text": "    subgraphs: Optional[Dict[str, str]] = None  # {subgraph_id: subgraph_label} ã®ãƒãƒƒãƒ”ãƒ³ã‚°",
            "lineNumber": 28
          },
          {
            "lineNumber": 29
          },
          {
            "text": "    @field_validator('nodes')",
            "lineNumber": 30
          },
          {
            "text": "    @classmethod",
            "lineNumber": 31
          },
          {
            "text": "    def validate_flow_structure(cls, v: List[Node]) -&gt; List[Node]:",
            "lineNumber": 32
          },
          {
            "text": "        if not v:",
            "lineNumber": 33
          },
          {
            "text": "            raise FlowchartValidationError(\"ãƒãƒ¼ãƒ‰ãŒ1ã¤ã‚‚å­˜åœ¨ã—ã¾ã›ã‚“\")",
            "lineNumber": 34
          },
          {
            "text": "        ",
            "lineNumber": 35
          },
          {
            "text": "        # é–‹å§‹/çµ‚äº†ãƒãƒ¼ãƒ‰ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 36
          },
          {
            "text": "        types = {node.type for node in v}",
            "lineNumber": 37
          },
          {
            "text": "        if \"start\" not in types or \"end\" not in types:",
            "lineNumber": 38
          },
          {
            "text": "            raise FlowchartValidationError(\"é–‹å§‹/çµ‚äº†ãƒãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™\")",
            "lineNumber": 39
          },
          {
            "text": "        ",
            "lineNumber": 40
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰IDã®é‡è¤‡ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 41
          },
          {
            "text": "        node_ids = [node.id for node in v]",
            "lineNumber": 42
          },
          {
            "text": "        duplicates = [node_id for node_id in node_ids if node_ids.count(node_id) &gt; 1]",
            "lineNumber": 43
          },
          {
            "text": "        if duplicates:",
            "lineNumber": 44
          },
          {
            "text": "            raise FlowchartValidationError(f\"ãƒãƒ¼ãƒ‰IDãŒé‡è¤‡ã—ã¦ã„ã¾ã™: {set(duplicates)}\")",
            "lineNumber": 45
          },
          {
            "text": "        ",
            "lineNumber": 46
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã®æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 47
          },
          {
            "text": "        valid_types = {\"start\", \"end\", \"process\", \"decision\", \"io_data\", \"storage\", \"missing\"}",
            "lineNumber": 48
          },
          {
            "text": "        invalid_types = [node.type for node in v if node.type not in valid_types]",
            "lineNumber": 49
          },
          {
            "text": "        if invalid_types:",
            "lineNumber": 50
          },
          {
            "text": "            raise FlowchartValidationError(f\"ç„¡åŠ¹ãªãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™: {set(invalid_types)}\")",
            "lineNumber": 51
          },
          {
            "text": "        ",
            "lineNumber": 52
          },
          {
            "text": "        return v",
            "lineNumber": 53
          },
          {
            "lineNumber": 54
          },
          {
            "text": "    @model_validator(mode='after')",
            "lineNumber": 55
          },
          {
            "text": "    def validate_edges_reference_nodes(self):",
            "lineNumber": 56
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 57
          }
        ]
      },
      "score": 0.3590995967388153
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\history_mgr.py",
        "range": {
          "startPosition": {
            "line": 6
          },
          "endPosition": {
            "line": 184,
            "column": 26
          }
        },
        "contents": "class HistoryManager:\ndef append_toon_log(self, session_id: str, new_flowchart: Flowchart) -&gt; Flowchart:\n\n        processed_edge_keys = set()\n        \n        # ã¾ãšæ—¢å­˜ã‚¨ãƒƒã‚¸ã‚’å‡¦ç†ï¼ˆæ–°ã—ã„ã‚¨ãƒƒã‚¸ã§æ›´æ–°ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼‰\n        for existing_edge in existing_flow.edges:\n            edge_key = (existing_edge.source, existing_edge.target)\n            # æ–°ã—ã„ã‚¨ãƒƒã‚¸ã«åŒã˜ã‚­ãƒ¼ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯\n            new_edge = next(\n                (e for e in new_flowchart.edges if (e.source, e.target) == edge_key),\n                None\n            )\n            if new_edge:\n                # æ–°ã—ã„ã‚¨ãƒƒã‚¸ã§æ›´æ–°ï¼ˆãƒ©ãƒ™ãƒ«ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆãªã©ï¼‰\n                merged_edges.append(new_edge)\n                processed_edge_keys.add(edge_key)\n            else:\n                # æ—¢å­˜ã‚¨ãƒƒã‚¸ã‚’ãã®ã¾ã¾ä¿æŒ\n                merged_edges.append(existing_edge)\n                processed_edge_keys.add(edge_key)\n        \n        # æ–°ã—ã„ã‚¨ãƒƒã‚¸ã‚’è¿½åŠ ï¼ˆã¾ã å‡¦ç†ã•ã‚Œã¦ã„ãªã„ã‚‚ã®ã®ã¿ï¼‰\n        for new_edge in new_flowchart.edges:\n            edge_key = (new_edge.source, new_edge.target)\n            if edge_key not in processed_edge_keys:\n                merged_edges.append(new_edge)\n        \n        # subgraphæƒ…å ±ã‚’ãƒãƒ¼ã‚¸ï¼ˆæ–°ã—ã„subgraphæƒ…å ±ã§ä¸Šæ›¸ãï¼‰\n        merged_subgraphs = None\n        if existing_flowchart.subgraphs or new_flowchart.subgraphs:\n            merged_subgraphs = {}\n            if existing_flowchart.subgraphs:\n                merged_subgraphs.update(existing_flowchart.subgraphs)\n            if new_flowchart.subgraphs:\n                merged_subgraphs.update(new_flowchart.subgraphs)\n        \n        # ãƒãƒ¼ã‚¸ã•ã‚ŒãŸFlowchartã‚’ä½œæˆ\n        merged_flow = Flowchart(nodes=merged_nodes, edges=merged_edges, subgraphs=merged_subgraphs)\n        \n        # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨\n        merged_flow = merged_flow.apply_logic_gap_detection()\n        \n        # ä¿å­˜\n        self.save_toon_file(session_id, merged_flow)\n        \n        return merged_flow",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 7,
                "column": 1
              },
              "endPosition": {
                "line": 8,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 105,
                "column": 5
              },
              "endPosition": {
                "line": 106,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class HistoryManager:",
            "lineNumber": 7,
            "isSignature": true
          },
          {
            "text": "def append_toon_log(self, session_id: str, new_flowchart: Flowchart) -&gt; Flowchart:",
            "lineNumber": 105
          },
          {
            "lineNumber": 141
          },
          {
            "text": "        processed_edge_keys = set()",
            "lineNumber": 142
          },
          {
            "text": "        ",
            "lineNumber": 143
          },
          {
            "text": "        # ã¾ãšæ—¢å­˜ã‚¨ãƒƒã‚¸ã‚’å‡¦ç†ï¼ˆæ–°ã—ã„ã‚¨ãƒƒã‚¸ã§æ›´æ–°ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼‰",
            "lineNumber": 144
          },
          {
            "text": "        for existing_edge in existing_flow.edges:",
            "lineNumber": 145
          },
          {
            "text": "            edge_key = (existing_edge.source, existing_edge.target)",
            "lineNumber": 146
          },
          {
            "text": "            # æ–°ã—ã„ã‚¨ãƒƒã‚¸ã«åŒã˜ã‚­ãƒ¼ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 147
          },
          {
            "text": "            new_edge = next(",
            "lineNumber": 148
          },
          {
            "text": "                (e for e in new_flowchart.edges if (e.source, e.target) == edge_key),",
            "lineNumber": 149
          },
          {
            "text": "                None",
            "lineNumber": 150
          },
          {
            "text": "            )",
            "lineNumber": 151
          },
          {
            "text": "            if new_edge:",
            "lineNumber": 152
          },
          {
            "text": "                # æ–°ã—ã„ã‚¨ãƒƒã‚¸ã§æ›´æ–°ï¼ˆãƒ©ãƒ™ãƒ«ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆãªã©ï¼‰",
            "lineNumber": 153
          },
          {
            "text": "                merged_edges.append(new_edge)",
            "lineNumber": 154
          },
          {
            "text": "                processed_edge_keys.add(edge_key)",
            "lineNumber": 155
          },
          {
            "text": "            else:",
            "lineNumber": 156
          },
          {
            "text": "                # æ—¢å­˜ã‚¨ãƒƒã‚¸ã‚’ãã®ã¾ã¾ä¿æŒ",
            "lineNumber": 157
          },
          {
            "text": "                merged_edges.append(existing_edge)",
            "lineNumber": 158
          },
          {
            "text": "                processed_edge_keys.add(edge_key)",
            "lineNumber": 159
          },
          {
            "text": "        ",
            "lineNumber": 160
          },
          {
            "text": "        # æ–°ã—ã„ã‚¨ãƒƒã‚¸ã‚’è¿½åŠ ï¼ˆã¾ã å‡¦ç†ã•ã‚Œã¦ã„ãªã„ã‚‚ã®ã®ã¿ï¼‰",
            "lineNumber": 161
          },
          {
            "text": "        for new_edge in new_flowchart.edges:",
            "lineNumber": 162
          },
          {
            "text": "            edge_key = (new_edge.source, new_edge.target)",
            "lineNumber": 163
          },
          {
            "text": "            if edge_key not in processed_edge_keys:",
            "lineNumber": 164
          },
          {
            "text": "                merged_edges.append(new_edge)",
            "lineNumber": 165
          },
          {
            "text": "        ",
            "lineNumber": 166
          },
          {
            "text": "        # subgraphæƒ…å ±ã‚’ãƒãƒ¼ã‚¸ï¼ˆæ–°ã—ã„subgraphæƒ…å ±ã§ä¸Šæ›¸ãï¼‰",
            "lineNumber": 167
          },
          {
            "text": "        merged_subgraphs = None",
            "lineNumber": 168
          },
          {
            "text": "        if existing_flowchart.subgraphs or new_flowchart.subgraphs:",
            "lineNumber": 169
          },
          {
            "text": "            merged_subgraphs = {}",
            "lineNumber": 170
          },
          {
            "text": "            if existing_flowchart.subgraphs:",
            "lineNumber": 171
          },
          {
            "text": "                merged_subgraphs.update(existing_flowchart.subgraphs)",
            "lineNumber": 172
          },
          {
            "text": "            if new_flowchart.subgraphs:",
            "lineNumber": 173
          },
          {
            "text": "                merged_subgraphs.update(new_flowchart.subgraphs)",
            "lineNumber": 174
          },
          {
            "text": "        ",
            "lineNumber": 175
          },
          {
            "text": "        # ãƒãƒ¼ã‚¸ã•ã‚ŒãŸFlowchartã‚’ä½œæˆ",
            "lineNumber": 176
          },
          {
            "text": "        merged_flow = Flowchart(nodes=merged_nodes, edges=merged_edges, subgraphs=merged_subgraphs)",
            "lineNumber": 177
          },
          {
            "text": "        ",
            "lineNumber": 178
          },
          {
            "text": "        # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨",
            "lineNumber": 179
          },
          {
            "text": "        merged_flow = merged_flow.apply_logic_gap_detection()",
            "lineNumber": 180
          },
          {
            "text": "        ",
            "lineNumber": 181
          },
          {
            "text": "        # ä¿å­˜",
            "lineNumber": 182
          },
          {
            "text": "        self.save_toon_file(session_id, merged_flow)",
            "lineNumber": 183
          },
          {
            "text": "        ",
            "lineNumber": 184
          },
          {
            "text": "        return merged_flow",
            "lineNumber": 185,
            "isSignature": true
          }
        ]
      },
      "score": 0.3271690011024475
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 24
          },
          "endPosition": {
            "line": 336
          }
        },
        "contents": "class Flowchart(BaseModel):\n\n\n    @model_validator(mode='after')\n    def validate_edges_reference_nodes(self):\n        \"\"\"ã‚¨ãƒƒã‚¸ãŒæœ‰åŠ¹ãªãƒãƒ¼ãƒ‰IDã‚’å‚ç…§ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆè­¦å‘Šã®ã¿ã€è«–ç†ã®ç©´æ¤œçŸ¥ã§è‡ªå‹•ä¿®æ­£ï¼‰\"\"\"\n        node_ids = {node.id for node in self.nodes}\n        \n        # ã‚¨ãƒƒã‚¸ã®æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆè­¦å‘Šã®ã¿ã€ä¾‹å¤–ã¯æŠ•ã’ãªã„ï¼‰\n        invalid_edges = []\n        for edge in self.edges:\n            if edge.source not in node_ids:\n                invalid_edges.append(f\"source '{edge.source}' ãŒå­˜åœ¨ã—ã¾ã›ã‚“\")\n            if edge.target not in node_ids:\n                invalid_edges.append(f\"target '{edge.target}' ãŒå­˜åœ¨ã—ã¾ã›ã‚“\")\n        \n        if invalid_edges:\n            # è­¦å‘Šã®ã¿ã‚’å‡ºåŠ›ï¼ˆè«–ç†ã®ç©´æ¤œçŸ¥ã§è‡ªå‹•ä¿®æ­£ã•ã‚Œã‚‹ï¼‰\n            warnings.warn(\n                f\"ç„¡åŠ¹ãªã‚¨ãƒƒã‚¸ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸï¼ˆè«–ç†ã®ç©´æ¤œçŸ¥ã§è‡ªå‹•ä¿®æ­£ã•ã‚Œã¾ã™ï¼‰: {', '.join(invalid_edges)}\",\n                UserWarning\n            )\n        \n        return self\n\n    def detect_logic_gaps(self) -&gt; List[Node]:\n        ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 25,
                "column": 1
              },
              "endPosition": {
                "line": 26,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 25,
            "isSignature": true
          },
          {
            "lineNumber": 53
          },
          {
            "lineNumber": 54
          },
          {
            "text": "    @model_validator(mode='after')",
            "lineNumber": 55
          },
          {
            "text": "    def validate_edges_reference_nodes(self):",
            "lineNumber": 56
          },
          {
            "text": "        \"\"\"ã‚¨ãƒƒã‚¸ãŒæœ‰åŠ¹ãªãƒãƒ¼ãƒ‰IDã‚’å‚ç…§ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆè­¦å‘Šã®ã¿ã€è«–ç†ã®ç©´æ¤œçŸ¥ã§è‡ªå‹•ä¿®æ­£ï¼‰\"\"\"",
            "lineNumber": 57
          },
          {
            "text": "        node_ids = {node.id for node in self.nodes}",
            "lineNumber": 58
          },
          {
            "text": "        ",
            "lineNumber": 59
          },
          {
            "text": "        # ã‚¨ãƒƒã‚¸ã®æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆè­¦å‘Šã®ã¿ã€ä¾‹å¤–ã¯æŠ•ã’ãªã„ï¼‰",
            "lineNumber": 60
          },
          {
            "text": "        invalid_edges = []",
            "lineNumber": 61
          },
          {
            "text": "        for edge in self.edges:",
            "lineNumber": 62
          },
          {
            "text": "            if edge.source not in node_ids:",
            "lineNumber": 63
          },
          {
            "text": "                invalid_edges.append(f\"source '{edge.source}' ãŒå­˜åœ¨ã—ã¾ã›ã‚“\")",
            "lineNumber": 64
          },
          {
            "text": "            if edge.target not in node_ids:",
            "lineNumber": 65
          },
          {
            "text": "                invalid_edges.append(f\"target '{edge.target}' ãŒå­˜åœ¨ã—ã¾ã›ã‚“\")",
            "lineNumber": 66
          },
          {
            "text": "        ",
            "lineNumber": 67
          },
          {
            "text": "        if invalid_edges:",
            "lineNumber": 68
          },
          {
            "text": "            # è­¦å‘Šã®ã¿ã‚’å‡ºåŠ›ï¼ˆè«–ç†ã®ç©´æ¤œçŸ¥ã§è‡ªå‹•ä¿®æ­£ã•ã‚Œã‚‹ï¼‰",
            "lineNumber": 69
          },
          {
            "text": "            warnings.warn(",
            "lineNumber": 70
          },
          {
            "text": "                f\"ç„¡åŠ¹ãªã‚¨ãƒƒã‚¸ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸï¼ˆè«–ç†ã®ç©´æ¤œçŸ¥ã§è‡ªå‹•ä¿®æ­£ã•ã‚Œã¾ã™ï¼‰: {', '.join(invalid_edges)}\",",
            "lineNumber": 71
          },
          {
            "text": "                UserWarning",
            "lineNumber": 72
          },
          {
            "text": "            )",
            "lineNumber": 73
          },
          {
            "text": "        ",
            "lineNumber": 74
          },
          {
            "text": "        return self",
            "lineNumber": 75
          },
          {
            "lineNumber": 76
          },
          {
            "text": "    def detect_logic_gaps(self) -&gt; List[Node]:",
            "lineNumber": 77
          },
          {
            "text": "        ",
            "lineNumber": 78
          }
        ]
      },
      "score": 0.31407594680786133
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 24
          },
          "endPosition": {
            "line": 336
          }
        },
        "contents": "class Flowchart(BaseModel):\ndef detect_logic_gaps(self) -&gt; List[Node]:\n\n        \n        return gaps\n\n    def apply_logic_gap_detection(self) -&gt; 'Flowchart':\n        \"\"\"è«–ç†ã®ç©´ã‚’æ¤œå‡ºã—ã€MISSINGãƒãƒ¼ãƒ‰ã¨ã—ã¦è¿½åŠ \"\"\"\n        gaps = self.detect_logic_gaps()\n        \n        if not gaps:\n            return self\n        \n        # æ—¢å­˜ã®ãƒãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼\n        new_nodes = [Node(**node.model_dump()) for node in self.nodes]\n        new_edges = [Edge(**edge.model_dump()) for edge in self.edges]\n        \n        # ã‚®ãƒ£ãƒƒãƒ—ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã¾ãŸã¯æ›´æ–°\n        existing_ids = {node.id for node in new_nodes}\n        for gap in gaps:\n            if gap.id not in existing_ids:\n                new_nodes.append(gap)\n            else:\n                # æ—¢å­˜ãƒãƒ¼ãƒ‰ã‚’MISSINGã¨ã—ã¦æ›´æ–°\n                for i, node in enumerate(new_nodes):\n                    if node.id == gap.id:\n                        new_nodes[i] = Node(\n                            id=node.id,\n                            label=node.label,\n                            type=\"missing\",\n                            status=NodeStatus.MISSING,\n                            subgraph_id=node.subgraph_id\n                        )\n                        break\n        \n        return Flowchart(nodes=new_nodes, edges=new_edges, subgraphs=self.subgraphs)\n\n    @staticmethod\n    def _get_node_shape(node_type: str) -&gt; str:\n        \"\"\"ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸMermaidå½¢çŠ¶ã‚’è¿”ã™\"\"\"\n        shape_map = {\n            \"start\": \"([ ])\",\n            \"end\": \"([ ])\",\n            \"process\": \"[ ]\",\n            \"decision\": \"{ }\",\n            \"io_data\": \"[/ /]\",\n            \"storage\": \"[( )]\",\n            \"missing\": \"{{ }}\"\n        }\n        return shape_map.get(node_type.lower(), \"{{ }}\")  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯MISSING\n\n    @staticmethod\n    def _get_status_color(status: NodeStatus) -&gt; str:\n        ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 25,
                "column": 1
              },
              "endPosition": {
                "line": 26,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 25,
            "isSignature": true
          },
          {
            "text": "def detect_logic_gaps(self) -&gt; List[Node]:",
            "lineNumber": 77
          },
          {
            "lineNumber": 143
          },
          {
            "text": "        ",
            "lineNumber": 144
          },
          {
            "text": "        return gaps",
            "lineNumber": 145
          },
          {
            "lineNumber": 146
          },
          {
            "text": "    def apply_logic_gap_detection(self) -&gt; 'Flowchart':",
            "lineNumber": 147
          },
          {
            "text": "        \"\"\"è«–ç†ã®ç©´ã‚’æ¤œå‡ºã—ã€MISSINGãƒãƒ¼ãƒ‰ã¨ã—ã¦è¿½åŠ \"\"\"",
            "lineNumber": 148
          },
          {
            "text": "        gaps = self.detect_logic_gaps()",
            "lineNumber": 149
          },
          {
            "text": "        ",
            "lineNumber": 150
          },
          {
            "text": "        if not gaps:",
            "lineNumber": 151
          },
          {
            "text": "            return self",
            "lineNumber": 152
          },
          {
            "text": "        ",
            "lineNumber": 153
          },
          {
            "text": "        # æ—¢å­˜ã®ãƒãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼",
            "lineNumber": 154
          },
          {
            "text": "        new_nodes = [Node(**node.model_dump()) for node in self.nodes]",
            "lineNumber": 155
          },
          {
            "text": "        new_edges = [Edge(**edge.model_dump()) for edge in self.edges]",
            "lineNumber": 156
          },
          {
            "text": "        ",
            "lineNumber": 157
          },
          {
            "text": "        # ã‚®ãƒ£ãƒƒãƒ—ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã¾ãŸã¯æ›´æ–°",
            "lineNumber": 158
          },
          {
            "text": "        existing_ids = {node.id for node in new_nodes}",
            "lineNumber": 159
          },
          {
            "text": "        for gap in gaps:",
            "lineNumber": 160
          },
          {
            "text": "            if gap.id not in existing_ids:",
            "lineNumber": 161
          },
          {
            "text": "                new_nodes.append(gap)",
            "lineNumber": 162
          },
          {
            "text": "            else:",
            "lineNumber": 163
          },
          {
            "text": "                # æ—¢å­˜ãƒãƒ¼ãƒ‰ã‚’MISSINGã¨ã—ã¦æ›´æ–°",
            "lineNumber": 164
          },
          {
            "text": "                for i, node in enumerate(new_nodes):",
            "lineNumber": 165
          },
          {
            "text": "                    if node.id == gap.id:",
            "lineNumber": 166
          },
          {
            "text": "                        new_nodes[i] = Node(",
            "lineNumber": 167
          },
          {
            "text": "                            id=node.id,",
            "lineNumber": 168
          },
          {
            "text": "                            label=node.label,",
            "lineNumber": 169
          },
          {
            "text": "                            type=\"missing\",",
            "lineNumber": 170
          },
          {
            "text": "                            status=NodeStatus.MISSING,",
            "lineNumber": 171
          },
          {
            "text": "                            subgraph_id=node.subgraph_id",
            "lineNumber": 172
          },
          {
            "text": "                        )",
            "lineNumber": 173
          },
          {
            "text": "                        break",
            "lineNumber": 174
          },
          {
            "text": "        ",
            "lineNumber": 175
          },
          {
            "text": "        return Flowchart(nodes=new_nodes, edges=new_edges, subgraphs=self.subgraphs)",
            "lineNumber": 176
          },
          {
            "lineNumber": 177
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 178
          },
          {
            "text": "    def _get_node_shape(node_type: str) -&gt; str:",
            "lineNumber": 179
          },
          {
            "text": "        \"\"\"ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸMermaidå½¢çŠ¶ã‚’è¿”ã™\"\"\"",
            "lineNumber": 180
          },
          {
            "text": "        shape_map = {",
            "lineNumber": 181
          },
          {
            "text": "            \"start\": \"([ ])\",",
            "lineNumber": 182
          },
          {
            "text": "            \"end\": \"([ ])\",",
            "lineNumber": 183
          },
          {
            "text": "            \"process\": \"[ ]\",",
            "lineNumber": 184
          },
          {
            "text": "            \"decision\": \"{ }\",",
            "lineNumber": 185
          },
          {
            "text": "            \"io_data\": \"[/ /]\",",
            "lineNumber": 186
          },
          {
            "text": "            \"storage\": \"[( )]\",",
            "lineNumber": 187
          },
          {
            "text": "            \"missing\": \"{{ }}\"",
            "lineNumber": 188
          },
          {
            "text": "        }",
            "lineNumber": 189
          },
          {
            "text": "        return shape_map.get(node_type.lower(), \"{{ }}\")  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯MISSING",
            "lineNumber": 190
          },
          {
            "lineNumber": 191
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 192
          },
          {
            "text": "    def _get_status_color(status: NodeStatus) -&gt; str:",
            "lineNumber": 193
          },
          {
            "text": "        ",
            "lineNumber": 194
          }
        ]
      },
      "score": 0.3053185045719147
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 24
          },
          "endPosition": {
            "line": 336,
            "column": 31
          }
        },
        "contents": "class Flowchart(BaseModel):\n\n\n    def to_toon_format(self) -&gt; str:\n        \"\"\"Flowchartã‚’TOONå½¢å¼ï¼ˆMarkdownï¼‰ã«å¤‰æ›\"\"\"\n        lines = []\n        \n        # Subgraphå®šç¾©ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰\n        if self.subgraphs:\n            for sg_id, sg_label in self.subgraphs.items():\n                lines.append(\"[Subgraph]\")\n                lines.append(f\"id: {sg_id}\")\n                lines.append(f\"label: {sg_label}\")\n                lines.append(\"\")\n        \n        # ãƒãƒ¼ãƒ‰å®šç¾©\n        for node in self.nodes:\n            lines.append(\"[Node]\")\n            lines.append(f\"id: {node.id}\")\n            lines.append(f\"label: {node.label}\")\n            lines.append(f\"type: {node.type}\")\n            if node.status != NodeStatus.ACTIVE:\n                lines.append(f\"status: {node.status.value}\")\n            if node.subgraph_id:\n                lines.append(f\"subgraph: {node.subgraph_id}\")\n            lines.append(\"\")\n        \n        # ã‚¨ãƒƒã‚¸å®šç¾©\n        for edge in self.edges:\n            lines.append(\"[Edge]\")\n            lines.append(f\"source: {edge.source}\")\n            lines.append(f\"target: {edge.target}\")\n            if edge.label:\n                lines.append(f\"label: {edge.label}\")\n            lines.append(\"\")\n        \n        return \"\\n\".join(lines)",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 25,
                "column": 1
              },
              "endPosition": {
                "line": 26,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 25,
            "isSignature": true
          },
          {
            "lineNumber": 302
          },
          {
            "lineNumber": 303
          },
          {
            "text": "    def to_toon_format(self) -&gt; str:",
            "lineNumber": 304
          },
          {
            "text": "        \"\"\"Flowchartã‚’TOONå½¢å¼ï¼ˆMarkdownï¼‰ã«å¤‰æ›\"\"\"",
            "lineNumber": 305
          },
          {
            "text": "        lines = []",
            "lineNumber": 306
          },
          {
            "text": "        ",
            "lineNumber": 307
          },
          {
            "text": "        # Subgraphå®šç¾©ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰",
            "lineNumber": 308
          },
          {
            "text": "        if self.subgraphs:",
            "lineNumber": 309
          },
          {
            "text": "            for sg_id, sg_label in self.subgraphs.items():",
            "lineNumber": 310
          },
          {
            "text": "                lines.append(\"[Subgraph]\")",
            "lineNumber": 311
          },
          {
            "text": "                lines.append(f\"id: {sg_id}\")",
            "lineNumber": 312
          },
          {
            "text": "                lines.append(f\"label: {sg_label}\")",
            "lineNumber": 313
          },
          {
            "text": "                lines.append(\"\")",
            "lineNumber": 314
          },
          {
            "text": "        ",
            "lineNumber": 315
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰å®šç¾©",
            "lineNumber": 316
          },
          {
            "text": "        for node in self.nodes:",
            "lineNumber": 317
          },
          {
            "text": "            lines.append(\"[Node]\")",
            "lineNumber": 318
          },
          {
            "text": "            lines.append(f\"id: {node.id}\")",
            "lineNumber": 319
          },
          {
            "text": "            lines.append(f\"label: {node.label}\")",
            "lineNumber": 320
          },
          {
            "text": "            lines.append(f\"type: {node.type}\")",
            "lineNumber": 321
          },
          {
            "text": "            if node.status != NodeStatus.ACTIVE:",
            "lineNumber": 322
          },
          {
            "text": "                lines.append(f\"status: {node.status.value}\")",
            "lineNumber": 323
          },
          {
            "text": "            if node.subgraph_id:",
            "lineNumber": 324
          },
          {
            "text": "                lines.append(f\"subgraph: {node.subgraph_id}\")",
            "lineNumber": 325
          },
          {
            "text": "            lines.append(\"\")",
            "lineNumber": 326
          },
          {
            "text": "        ",
            "lineNumber": 327
          },
          {
            "text": "        # ã‚¨ãƒƒã‚¸å®šç¾©",
            "lineNumber": 328
          },
          {
            "text": "        for edge in self.edges:",
            "lineNumber": 329
          },
          {
            "text": "            lines.append(\"[Edge]\")",
            "lineNumber": 330
          },
          {
            "text": "            lines.append(f\"source: {edge.source}\")",
            "lineNumber": 331
          },
          {
            "text": "            lines.append(f\"target: {edge.target}\")",
            "lineNumber": 332
          },
          {
            "text": "            if edge.label:",
            "lineNumber": 333
          },
          {
            "text": "                lines.append(f\"label: {edge.label}\")",
            "lineNumber": 334
          },
          {
            "text": "            lines.append(\"\")",
            "lineNumber": 335
          },
          {
            "text": "        ",
            "lineNumber": 336
          },
          {
            "text": "        return \"\\n\".join(lines)",
            "lineNumber": 337,
            "isSignature": true
          }
        ]
      },
      "score": 0.3044230043888092
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\toon_parser.py",
        "range": {
          "startPosition": {
            "line": 5
          },
          "endPosition": {
            "line": 80
          }
        },
        "contents": "class TOONParser:\n@staticmethod\ndef parse(text: str) -&gt; Flowchart:\n        # Markdownã®è£…é£¾ï¼ˆ&#96;&#96;&#96;toon...&#96;&#96;&#96;ï¼‰ãŒã‚ã‚Œã°é™¤å»\n\n        for block in node_matches:\n            # æ¬¡ã®ã‚¿ã‚°ã®æ‰‹å‰ã¾ã§ã‚’ãƒ‘ãƒ¼ã‚¹\n            data = TOONParser._parse_block(re.split(r'\\[', block)[0])\n            if 'id' in data and 'label' in data:\n                raw_id = data['id'].strip()\n                safe_id = \"node_end\" if raw_id.lower() == \"end\" else raw_id\n                \n                # statusãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®èª­ã¿è¾¼ã¿\n                status = NodeStatus.ACTIVE  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤\n                if 'status' in data:\n                    try:\n                        status = NodeStatus(data['status'].strip().lower())\n                    except ValueError:\n                        # ç„¡åŠ¹ãªstatuså€¤ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨\n                        pass\n                \n                # subgraphãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®èª­ã¿è¾¼ã¿\n                subgraph_id = None\n                if 'subgraph' in data:\n                    subgraph_id = data['subgraph'].strip()\n                \n                nodes.append(Node(\n                    id=safe_id,\n                    label=data['label'].strip(),\n                    type=data.get('type', 'process').strip().lower(),\n                    status=status,\n                    subgraph_id=subgraph_id\n                ))\n\n        # [Edge]ã‚¿ã‚°ã§åˆ†å‰²ã—ã¦æŠ½å‡º\n        edge_matches = re.split(r'\\[Edge\\]', clean_text, flags=re.IGNORECASE)[1:]\n        for block in edge_matches:\n            data = TOONParser._parse_block(re.split(r'\\[', block)[0])\n            if 'source' in data and 'target' in data:\n                src = \"node_end\" if data['source'].strip().lower() == \"end\" else data['source'].strip()\n                tgt = \"node_end\" if data['target'].strip().lower() == \"end\" else data['target'].strip()\n                edges.append(Edge(source=src, target=tgt, label=data.get('label', '').strip() or None))\n\n        # æœ€çµ‚ãƒã‚§ãƒƒã‚¯ï¼šãƒãƒ¼ãƒ‰ãŒç©ºãªã‚‰ã“ã“ã§ä¾‹å¤–ã‚’æŠ•ã’ã¦ app.py ã§ã‚­ãƒ£ãƒƒãƒ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 6,
                "column": 1
              },
              "endPosition": {
                "line": 7,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 7,
                "column": 5
              },
              "endPosition": {
                "line": 8,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 8,
                "column": 5
              },
              "endPosition": {
                "line": 10,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class TOONParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 7
          },
          {
            "text": "def parse(text: str) -&gt; Flowchart:",
            "lineNumber": 8
          },
          {
            "text": "        # Markdownã®è£…é£¾ï¼ˆ&#96;&#96;&#96;toon...&#96;&#96;&#96;ï¼‰ãŒã‚ã‚Œã°é™¤å»",
            "lineNumber": 9
          },
          {
            "lineNumber": 29
          },
          {
            "text": "        for block in node_matches:",
            "lineNumber": 30
          },
          {
            "text": "            # æ¬¡ã®ã‚¿ã‚°ã®æ‰‹å‰ã¾ã§ã‚’ãƒ‘ãƒ¼ã‚¹",
            "lineNumber": 31
          },
          {
            "text": "            data = TOONParser._parse_block(re.split(r'\\[', block)[0])",
            "lineNumber": 32
          },
          {
            "text": "            if 'id' in data and 'label' in data:",
            "lineNumber": 33
          },
          {
            "text": "                raw_id = data['id'].strip()",
            "lineNumber": 34
          },
          {
            "text": "                safe_id = \"node_end\" if raw_id.lower() == \"end\" else raw_id",
            "lineNumber": 35
          },
          {
            "text": "                ",
            "lineNumber": 36
          },
          {
            "text": "                # statusãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®èª­ã¿è¾¼ã¿",
            "lineNumber": 37
          },
          {
            "text": "                status = NodeStatus.ACTIVE  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤",
            "lineNumber": 38
          },
          {
            "text": "                if 'status' in data:",
            "lineNumber": 39
          },
          {
            "text": "                    try:",
            "lineNumber": 40
          },
          {
            "text": "                        status = NodeStatus(data['status'].strip().lower())",
            "lineNumber": 41
          },
          {
            "text": "                    except ValueError:",
            "lineNumber": 42
          },
          {
            "text": "                        # ç„¡åŠ¹ãªstatuså€¤ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨",
            "lineNumber": 43
          },
          {
            "text": "                        pass",
            "lineNumber": 44
          },
          {
            "text": "                ",
            "lineNumber": 45
          },
          {
            "text": "                # subgraphãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®èª­ã¿è¾¼ã¿",
            "lineNumber": 46
          },
          {
            "text": "                subgraph_id = None",
            "lineNumber": 47
          },
          {
            "text": "                if 'subgraph' in data:",
            "lineNumber": 48
          },
          {
            "text": "                    subgraph_id = data['subgraph'].strip()",
            "lineNumber": 49
          },
          {
            "text": "                ",
            "lineNumber": 50
          },
          {
            "text": "                nodes.append(Node(",
            "lineNumber": 51
          },
          {
            "text": "                    id=safe_id,",
            "lineNumber": 52
          },
          {
            "text": "                    label=data['label'].strip(),",
            "lineNumber": 53
          },
          {
            "text": "                    type=data.get('type', 'process').strip().lower(),",
            "lineNumber": 54
          },
          {
            "text": "                    status=status,",
            "lineNumber": 55
          },
          {
            "text": "                    subgraph_id=subgraph_id",
            "lineNumber": 56
          },
          {
            "text": "                ))",
            "lineNumber": 57
          },
          {
            "lineNumber": 58
          },
          {
            "text": "        # [Edge]ã‚¿ã‚°ã§åˆ†å‰²ã—ã¦æŠ½å‡º",
            "lineNumber": 59
          },
          {
            "text": "        edge_matches = re.split(r'\\[Edge\\]', clean_text, flags=re.IGNORECASE)[1:]",
            "lineNumber": 60
          },
          {
            "text": "        for block in edge_matches:",
            "lineNumber": 61
          },
          {
            "text": "            data = TOONParser._parse_block(re.split(r'\\[', block)[0])",
            "lineNumber": 62
          },
          {
            "text": "            if 'source' in data and 'target' in data:",
            "lineNumber": 63
          },
          {
            "text": "                src = \"node_end\" if data['source'].strip().lower() == \"end\" else data['source'].strip()",
            "lineNumber": 64
          },
          {
            "text": "                tgt = \"node_end\" if data['target'].strip().lower() == \"end\" else data['target'].strip()",
            "lineNumber": 65
          },
          {
            "text": "                edges.append(Edge(source=src, target=tgt, label=data.get('label', '').strip() or None))",
            "lineNumber": 66
          },
          {
            "lineNumber": 67
          },
          {
            "text": "        # æœ€çµ‚ãƒã‚§ãƒƒã‚¯ï¼šãƒãƒ¼ãƒ‰ãŒç©ºãªã‚‰ã“ã“ã§ä¾‹å¤–ã‚’æŠ•ã’ã¦ app.py ã§ã‚­ãƒ£ãƒƒãƒ",
            "lineNumber": 68
          }
        ]
      },
      "score": 0.2858838438987732
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\mermaid_parser.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 178
          }
        },
        "contents": "import re\nfrom typing import List, Dict, Tuple\nfrom core.schemas import Node, Edge, Flowchart, NodeStatus\nfrom core.exceptions import TOONParseError\n\nclass MermaidParser:\n    \"\"\"Mermaidå½¢å¼ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹ãƒ‘ãƒ¼ã‚µãƒ¼\"\"\"\n    \n    @staticmethod\n    def parse(mermaid_text: str) -&gt; Flowchart:\n        \"\"\"\n        Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚\n        \n        Args:\n            mermaid_text: Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆ\n            \n        Returns:\n            Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ\n        \"\"\"\n        # Markdownã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’é™¤å»\n        clean_text = re.sub(r'&#96;&#96;&#96;mermaid\\s*\\n?', '', mermaid_text)\n        clean_text = clean_text.replace('&#96;&#96;&#96;', '').strip()\n        \n        lines = [line.strip() for line in clean_text.split('\\n') if line.strip()]\n        \n        nodes = []\n        edges = []\n        node_map = {}  # ID -&gt; Node ã®ãƒãƒƒãƒ”ãƒ³ã‚°\n        \n        # ãƒãƒ¼ãƒ‰å®šç¾©ã¨ã‚¨ãƒƒã‚¸å®šç¾©ã‚’æŠ½å‡º\n        in_subgraph = False\n        for line in lines:\n            # ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—\n            if line.startswith('%%'):\n                continue",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import re",
            "lineNumber": 1
          },
          {
            "text": "from typing import List, Dict, Tuple",
            "lineNumber": 2
          },
          {
            "text": "from core.schemas import Node, Edge, Flowchart, NodeStatus",
            "lineNumber": 3
          },
          {
            "text": "from core.exceptions import TOONParseError",
            "lineNumber": 4
          },
          {
            "lineNumber": 5
          },
          {
            "text": "class MermaidParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "    \"\"\"Mermaidå½¢å¼ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹ãƒ‘ãƒ¼ã‚µãƒ¼\"\"\"",
            "lineNumber": 7
          },
          {
            "text": "    ",
            "lineNumber": 8
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 9
          },
          {
            "text": "    def parse(mermaid_text: str) -&gt; Flowchart:",
            "lineNumber": 10
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 11
          },
          {
            "text": "        Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚",
            "lineNumber": 12
          },
          {
            "text": "        ",
            "lineNumber": 13
          },
          {
            "text": "        Args:",
            "lineNumber": 14
          },
          {
            "text": "            mermaid_text: Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆ",
            "lineNumber": 15
          },
          {
            "text": "            ",
            "lineNumber": 16
          },
          {
            "text": "        Returns:",
            "lineNumber": 17
          },
          {
            "text": "            Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ",
            "lineNumber": 18
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 19
          },
          {
            "text": "        # Markdownã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’é™¤å»",
            "lineNumber": 20
          },
          {
            "text": "        clean_text = re.sub(r'&#96;&#96;&#96;mermaid\\s*\\n?', '', mermaid_text)",
            "lineNumber": 21
          },
          {
            "text": "        clean_text = clean_text.replace('&#96;&#96;&#96;', '').strip()",
            "lineNumber": 22
          },
          {
            "text": "        ",
            "lineNumber": 23
          },
          {
            "text": "        lines = [line.strip() for line in clean_text.split('\\n') if line.strip()]",
            "lineNumber": 24
          },
          {
            "text": "        ",
            "lineNumber": 25
          },
          {
            "text": "        nodes = []",
            "lineNumber": 26
          },
          {
            "text": "        edges = []",
            "lineNumber": 27
          },
          {
            "text": "        node_map = {}  # ID -&gt; Node ã®ãƒãƒƒãƒ”ãƒ³ã‚°",
            "lineNumber": 28
          },
          {
            "text": "        ",
            "lineNumber": 29
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰å®šç¾©ã¨ã‚¨ãƒƒã‚¸å®šç¾©ã‚’æŠ½å‡º",
            "lineNumber": 30
          },
          {
            "text": "        in_subgraph = False",
            "lineNumber": 31
          },
          {
            "text": "        for line in lines:",
            "lineNumber": 32
          },
          {
            "text": "            # ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—",
            "lineNumber": 33
          },
          {
            "text": "            if line.startswith('%%'):",
            "lineNumber": 34
          },
          {
            "text": "                continue",
            "lineNumber": 35
          }
        ]
      },
      "score": 0.2713371515274048
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 330,
            "column": 117
          },
          "endPosition": {
            "line": 351,
            "column": 20
          }
        },
        "contents": "\",\n        height=150\n    )\n    \n    if st.button(\"ãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆ\", type=\"primary\", use_container_width=True):\n        if user_prompt:\n            with st.spinner(\"LLMãŒãƒ•ãƒ­ãƒ¼ã‚’è¨­è¨ˆä¸­...\"):\n                raw_toon_text = \"\"\n                try:\n                    # LLMã¨ã®é€šä¿¡\n                    client = LLMClient()\n                    # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯æ—¢å­˜ã®Flowchartã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦æ¸¡ã™\n                    context_flowchart = current_flow if append_mode else None\n                    \n                    # éƒ¨åˆ†ãƒ•ãƒ­ãƒ¼ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¿½åŠ æŒ‡ç¤ºã‚’ä»˜ä¸\n                    enhanced_prompt = user_prompt\n                    if partial_mode:\n                        enhanced_prompt = user_prompt + \"\\n\\nã€é‡è¦ã€‘ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚å…¨ãƒ«ãƒ¼ãƒˆã‚’å«ã‚€å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒãƒ¼ãƒ‰æ•°ã¯30å€‹ä»¥ä¸‹ã€ã‚¨ãƒƒã‚¸æ•°ã¯50å€‹ä»¥ä¸‹ã«ã—ã¦ãã ã•ã„ã€‚\"\n                    \n                    raw_toon_text = client.generate_flow(enhanced_prompt, context_flowchart)\n                    \n                    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "\",",
            "lineNumber": 331
          },
          {
            "text": "        height=150",
            "lineNumber": 332
          },
          {
            "text": "    )",
            "lineNumber": 333
          },
          {
            "text": "    ",
            "lineNumber": 334
          },
          {
            "text": "    if st.button(\"ãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆ\", type=\"primary\", use_container_width=True):",
            "lineNumber": 335
          },
          {
            "text": "        if user_prompt:",
            "lineNumber": 336
          },
          {
            "text": "            with st.spinner(\"LLMãŒãƒ•ãƒ­ãƒ¼ã‚’è¨­è¨ˆä¸­...\"):",
            "lineNumber": 337
          },
          {
            "text": "                raw_toon_text = \"\"",
            "lineNumber": 338
          },
          {
            "text": "                try:",
            "lineNumber": 339
          },
          {
            "text": "                    # LLMã¨ã®é€šä¿¡",
            "lineNumber": 340
          },
          {
            "text": "                    client = LLMClient()",
            "lineNumber": 341
          },
          {
            "text": "                    # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯æ—¢å­˜ã®Flowchartã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦æ¸¡ã™",
            "lineNumber": 342
          },
          {
            "text": "                    context_flowchart = current_flow if append_mode else None",
            "lineNumber": 343
          },
          {
            "text": "                    ",
            "lineNumber": 344
          },
          {
            "text": "                    # éƒ¨åˆ†ãƒ•ãƒ­ãƒ¼ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¿½åŠ æŒ‡ç¤ºã‚’ä»˜ä¸",
            "lineNumber": 345
          },
          {
            "text": "                    enhanced_prompt = user_prompt",
            "lineNumber": 346
          },
          {
            "text": "                    if partial_mode:",
            "lineNumber": 347
          },
          {
            "text": "                        enhanced_prompt = user_prompt + \"\\n\\nã€é‡è¦ã€‘ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚å…¨ãƒ«ãƒ¼ãƒˆã‚’å«ã‚€å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒãƒ¼ãƒ‰æ•°ã¯30å€‹ä»¥ä¸‹ã€ã‚¨ãƒƒã‚¸æ•°ã¯50å€‹ä»¥ä¸‹ã«ã—ã¦ãã ã•ã„ã€‚\"",
            "lineNumber": 348
          },
          {
            "text": "                    ",
            "lineNumber": 349
          },
          {
            "text": "                    raw_toon_text = client.generate_flow(enhanced_prompt, context_flowchart)",
            "lineNumber": 350
          },
          {
            "text": "                    ",
            "lineNumber": 351
          },
          {
            "text": "                    ",
            "lineNumber": 352
          }
        ]
      },
      "score": 0.2504567503929138
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\tests\\test_schemas.py",
        "range": {
          "startPosition": {
            "line": 28,
            "column": 34
          },
          "endPosition": {
            "line": 170
          }
        },
        "contents": "class TestFlowchart:\n    def test_valid_flowchart(self):\n        nodes = [\n            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),\n            Node(id=\"process1\", label=\"å‡¦ç†\", type=\"process\"),\n            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")\n        ]\n        edges = [\n            Edge(source=\"start\", target=\"process1\"),\n            Edge(source=\"process1\", target=\"node_end\")\n        ]\n        flowchart = Flowchart(nodes=nodes, edges=edges)\n        assert len(flowchart.nodes) == 3\n        assert len(flowchart.edges) == 2\n\n    def test_missing_start_node(self):\n        nodes = [\n            Node(id=\"process1\", label=\"å‡¦ç†\", type=\"process\"),\n            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")\n        ]\n        edges = [Edge(source=\"process1\", target=\"node_end\")]\n        with pytest.raises(FlowchartValidationError, match=\"é–‹å§‹/çµ‚äº†ãƒãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™\"):\n            Flowchart(nodes=nodes, edges=edges)\n\n    def test_missing_end_node(self):\n        nodes = [\n            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),\n            Node(id=\"process1\", label=\"å‡¦ç†\", type=\"process\")\n        ]\n        edges = [Edge(source=\"start\", target=\"process1\")]\n        with pytest.raises(FlowchartValidationError, match=\"é–‹å§‹/çµ‚äº†ãƒãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™\"):\n            Flowchart(nodes=nodes, edges=edges)\n\n    def test_duplicate_node_ids(self):\n        nodes = [\n            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),\n            Node(id=\"process1\", label=\"å‡¦ç†1\", type=\"process\"),\n            Node(id=\"process1\", label=\"å‡¦ç†2\", type=\"process\"),  # é‡è¤‡\n            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")\n        ]\n        edges = [Edge(source=\"start\", target=\"process1\")]\n        with pytest.raises(FlowchartValidationError, match=\"ãƒãƒ¼ãƒ‰IDãŒé‡è¤‡ã—ã¦ã„ã¾ã™\"):\n            Flowchart(nodes=nodes, edges=edges)\n\n    def test_invalid_node_type(self):\n        nodes =",
        "signatures": {},
        "detailedLines": [
          {
            "text": "class TestFlowchart:",
            "lineNumber": 32,
            "isSignature": true
          },
          {
            "text": "    def test_valid_flowchart(self):",
            "lineNumber": 33
          },
          {
            "text": "        nodes = [",
            "lineNumber": 34
          },
          {
            "text": "            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),",
            "lineNumber": 35
          },
          {
            "text": "            Node(id=\"process1\", label=\"å‡¦ç†\", type=\"process\"),",
            "lineNumber": 36
          },
          {
            "text": "            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")",
            "lineNumber": 37
          },
          {
            "text": "        ]",
            "lineNumber": 38
          },
          {
            "text": "        edges = [",
            "lineNumber": 39
          },
          {
            "text": "            Edge(source=\"start\", target=\"process1\"),",
            "lineNumber": 40
          },
          {
            "text": "            Edge(source=\"process1\", target=\"node_end\")",
            "lineNumber": 41
          },
          {
            "text": "        ]",
            "lineNumber": 42
          },
          {
            "text": "        flowchart = Flowchart(nodes=nodes, edges=edges)",
            "lineNumber": 43
          },
          {
            "text": "        assert len(flowchart.nodes) == 3",
            "lineNumber": 44
          },
          {
            "text": "        assert len(flowchart.edges) == 2",
            "lineNumber": 45
          },
          {
            "lineNumber": 46
          },
          {
            "text": "    def test_missing_start_node(self):",
            "lineNumber": 47
          },
          {
            "text": "        nodes = [",
            "lineNumber": 48
          },
          {
            "text": "            Node(id=\"process1\", label=\"å‡¦ç†\", type=\"process\"),",
            "lineNumber": 49
          },
          {
            "text": "            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")",
            "lineNumber": 50
          },
          {
            "text": "        ]",
            "lineNumber": 51
          },
          {
            "text": "        edges = [Edge(source=\"process1\", target=\"node_end\")]",
            "lineNumber": 52
          },
          {
            "text": "        with pytest.raises(FlowchartValidationError, match=\"é–‹å§‹/çµ‚äº†ãƒãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™\"):",
            "lineNumber": 53
          },
          {
            "text": "            Flowchart(nodes=nodes, edges=edges)",
            "lineNumber": 54
          },
          {
            "lineNumber": 55
          },
          {
            "text": "    def test_missing_end_node(self):",
            "lineNumber": 56
          },
          {
            "text": "        nodes = [",
            "lineNumber": 57
          },
          {
            "text": "            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),",
            "lineNumber": 58
          },
          {
            "text": "            Node(id=\"process1\", label=\"å‡¦ç†\", type=\"process\")",
            "lineNumber": 59
          },
          {
            "text": "        ]",
            "lineNumber": 60
          },
          {
            "text": "        edges = [Edge(source=\"start\", target=\"process1\")]",
            "lineNumber": 61
          },
          {
            "text": "        with pytest.raises(FlowchartValidationError, match=\"é–‹å§‹/çµ‚äº†ãƒãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™\"):",
            "lineNumber": 62
          },
          {
            "text": "            Flowchart(nodes=nodes, edges=edges)",
            "lineNumber": 63
          },
          {
            "lineNumber": 64
          },
          {
            "text": "    def test_duplicate_node_ids(self):",
            "lineNumber": 65
          },
          {
            "text": "        nodes = [",
            "lineNumber": 66
          },
          {
            "text": "            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),",
            "lineNumber": 67
          },
          {
            "text": "            Node(id=\"process1\", label=\"å‡¦ç†1\", type=\"process\"),",
            "lineNumber": 68
          },
          {
            "text": "            Node(id=\"process1\", label=\"å‡¦ç†2\", type=\"process\"),  # é‡è¤‡",
            "lineNumber": 69
          },
          {
            "text": "            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")",
            "lineNumber": 70
          },
          {
            "text": "        ]",
            "lineNumber": 71
          },
          {
            "text": "        edges = [Edge(source=\"start\", target=\"process1\")]",
            "lineNumber": 72
          },
          {
            "text": "        with pytest.raises(FlowchartValidationError, match=\"ãƒãƒ¼ãƒ‰IDãŒé‡è¤‡ã—ã¦ã„ã¾ã™\"):",
            "lineNumber": 73
          },
          {
            "text": "            Flowchart(nodes=nodes, edges=edges)",
            "lineNumber": 74
          },
          {
            "lineNumber": 75
          },
          {
            "text": "    def test_invalid_node_type(self):",
            "lineNumber": 76
          },
          {
            "text": "        nodes =",
            "lineNumber": 77
          }
        ]
      },
      "score": 0.25045061111450195
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 49,
            "column": 53
          }
        },
        "contents": "import streamlit as st\nimport streamlit.components.v1 as components\nimport base64\nfrom core.schemas import Node, Edge, Flowchart\nfrom core.llm_client import LLMClient\nfrom core.toon_parser import TOONParser\nfrom core.history_mgr import HistoryManager\nfrom core.exceptions import LLMAPIError, TOONParseError, FlowchartValidationError\nfrom pathlib import Path\n\nst.set_page_config(layout=\"wide\")\nst.title(\"Flowchart Generator &amp; History Manager\")\n\n# 1. ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–\nhistory_mgr = HistoryManager()\n\n# 2. ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´ã®åˆæœŸåŒ–\nif 'history' not in st.session_state:\n    # åˆæœŸçŠ¶æ…‹ï¼šé–‹å§‹ã¨çµ‚äº†ã®ã¿ã®æ§‹æˆ\n    initial_flow = Flowchart(\n        nodes=[\n            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),\n            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")\n        ],\n        edges=[Edge(source=\"start\", target=\"node_end\")]\n    )\n    st.session_state.history = [initial_flow]\n\n# 3. è³ªå•å¿œç­”ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®åˆæœŸåŒ–\nif 'conversation_context' not in st.session_state:\n    st.session_state.conversation_context = None  # å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\nif 'pending_questions' not in st.session_state:\n    st.session_state.pending_questions = None  # ç¾åœ¨ã®è³ªå•ãƒ†ã‚­ã‚¹ãƒˆ\nif 'question_responses' not in st.session_state:\n    st.session_state.question_responses = []  # å›ç­”ã®ãƒªã‚¹ãƒˆ\nif 'append_mode_for_question' not in st.session_state:\n    st.session_state.append_mode_for_question = False  # è³ªå•æ™‚ã®å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®š\n\n# --- ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼šã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† ---\nst.sidebar.header(\"ğŸ’¾ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†\")\n\n# ä¿å­˜æ¸ˆã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä¸€è¦§ã‚’å–å¾—\nsaved_sessions = history_mgr.list_sessions()\n\n# ã‚»ãƒƒã‚·ãƒ§ãƒ³åã®å…¥åŠ›ï¼ˆæ–°è¦ä½œæˆç”¨ï¼‰\nsession_name = st.sidebar.text_input(\"ã‚»ãƒƒã‚·ãƒ§ãƒ³åï¼ˆæ–°è¦ä½œæˆ/ä¿å­˜ç”¨ï¼‰\", value=\"default_session\")\n\ncol_save, col_load = st.sidebar.columns(2)\nwith col_save:\n    if st.button(\"ä¿å­˜\", use_container_width=True):",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import streamlit as st",
            "lineNumber": 1
          },
          {
            "text": "import streamlit.components.v1 as components",
            "lineNumber": 2
          },
          {
            "text": "import base64",
            "lineNumber": 3
          },
          {
            "text": "from core.schemas import Node, Edge, Flowchart",
            "lineNumber": 4
          },
          {
            "text": "from core.llm_client import LLMClient",
            "lineNumber": 5
          },
          {
            "text": "from core.toon_parser import TOONParser",
            "lineNumber": 6
          },
          {
            "text": "from core.history_mgr import HistoryManager",
            "lineNumber": 7
          },
          {
            "text": "from core.exceptions import LLMAPIError, TOONParseError, FlowchartValidationError",
            "lineNumber": 8
          },
          {
            "text": "from pathlib import Path",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "text": "st.set_page_config(layout=\"wide\")",
            "lineNumber": 11
          },
          {
            "text": "st.title(\"Flowchart Generator &amp; History Manager\")",
            "lineNumber": 12
          },
          {
            "lineNumber": 13
          },
          {
            "text": "# 1. ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–",
            "lineNumber": 14
          },
          {
            "text": "history_mgr = HistoryManager()",
            "lineNumber": 15
          },
          {
            "lineNumber": 16
          },
          {
            "text": "# 2. ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´ã®åˆæœŸåŒ–",
            "lineNumber": 17
          },
          {
            "text": "if 'history' not in st.session_state:",
            "lineNumber": 18
          },
          {
            "text": "    # åˆæœŸçŠ¶æ…‹ï¼šé–‹å§‹ã¨çµ‚äº†ã®ã¿ã®æ§‹æˆ",
            "lineNumber": 19
          },
          {
            "text": "    initial_flow = Flowchart(",
            "lineNumber": 20
          },
          {
            "text": "        nodes=[",
            "lineNumber": 21
          },
          {
            "text": "            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),",
            "lineNumber": 22
          },
          {
            "text": "            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")",
            "lineNumber": 23
          },
          {
            "text": "        ],",
            "lineNumber": 24
          },
          {
            "text": "        edges=[Edge(source=\"start\", target=\"node_end\")]",
            "lineNumber": 25
          },
          {
            "text": "    )",
            "lineNumber": 26
          },
          {
            "text": "    st.session_state.history = [initial_flow]",
            "lineNumber": 27
          },
          {
            "lineNumber": 28
          },
          {
            "text": "# 3. è³ªå•å¿œç­”ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®åˆæœŸåŒ–",
            "lineNumber": 29
          },
          {
            "text": "if 'conversation_context' not in st.session_state:",
            "lineNumber": 30
          },
          {
            "text": "    st.session_state.conversation_context = None  # å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ",
            "lineNumber": 31
          },
          {
            "text": "if 'pending_questions' not in st.session_state:",
            "lineNumber": 32
          },
          {
            "text": "    st.session_state.pending_questions = None  # ç¾åœ¨ã®è³ªå•ãƒ†ã‚­ã‚¹ãƒˆ",
            "lineNumber": 33
          },
          {
            "text": "if 'question_responses' not in st.session_state:",
            "lineNumber": 34
          },
          {
            "text": "    st.session_state.question_responses = []  # å›ç­”ã®ãƒªã‚¹ãƒˆ",
            "lineNumber": 35
          },
          {
            "text": "if 'append_mode_for_question' not in st.session_state:",
            "lineNumber": 36
          },
          {
            "text": "    st.session_state.append_mode_for_question = False  # è³ªå•æ™‚ã®å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®š",
            "lineNumber": 37
          },
          {
            "lineNumber": 38
          },
          {
            "text": "# --- ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼šã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† ---",
            "lineNumber": 39
          },
          {
            "text": "st.sidebar.header(\"ğŸ’¾ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†\")",
            "lineNumber": 40
          },
          {
            "lineNumber": 41
          },
          {
            "text": "# ä¿å­˜æ¸ˆã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä¸€è¦§ã‚’å–å¾—",
            "lineNumber": 42
          },
          {
            "text": "saved_sessions = history_mgr.list_sessions()",
            "lineNumber": 43
          },
          {
            "lineNumber": 44
          },
          {
            "text": "# ã‚»ãƒƒã‚·ãƒ§ãƒ³åã®å…¥åŠ›ï¼ˆæ–°è¦ä½œæˆç”¨ï¼‰",
            "lineNumber": 45
          },
          {
            "text": "session_name = st.sidebar.text_input(\"ã‚»ãƒƒã‚·ãƒ§ãƒ³åï¼ˆæ–°è¦ä½œæˆ/ä¿å­˜ç”¨ï¼‰\", value=\"default_session\")",
            "lineNumber": 46
          },
          {
            "lineNumber": 47
          },
          {
            "text": "col_save, col_load = st.sidebar.columns(2)",
            "lineNumber": 48
          },
          {
            "text": "with col_save:",
            "lineNumber": 49
          },
          {
            "text": "    if st.button(\"ä¿å­˜\", use_container_width=True):",
            "lineNumber": 50
          }
        ]
      },
      "score": 0.2467893362045288
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\toon_parser.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 80
          }
        },
        "contents": "import re\nfrom typing import Dict, Optional\nfrom core.schemas import Node, Edge, Flowchart, NodeStatus\nfrom core.exceptions import TOONParseError\n\nclass TOONParser:\n    @staticmethod\n    def parse(text: str) -&gt; Flowchart:\n        # Markdownã®è£…é£¾ï¼ˆ&#96;&#96;&#96;toon...&#96;&#96;&#96;ï¼‰ãŒã‚ã‚Œã°é™¤å»\n        clean_text = re.sub(r'&#96;&#96;&#96;[a-zA-Z]*\\n?', '', text)\n        clean_text = clean_text.replace('&#96;&#96;&#96;', '').strip()\n\n        nodes = []\n        edges = []\n        subgraphs: Optional[Dict[str, str]] = None\n\n        # [Subgraph]ã‚¿ã‚°ã§åˆ†å‰²ã—ã¦æŠ½å‡º\n        subgraph_matches = re.split(r'\\[Subgraph\\]', clean_text, flags=re.IGNORECASE)[1:]\n        if subgraph_matches:\n            subgraphs = {}\n            for block in subgraph_matches:\n                data = TOONParser._parse_block(re.split(r'\\[', block)[0])\n                if 'id' in data and 'label' in data:\n                    sg_id = data['id'].strip()\n                    sg_label = data['label'].strip()\n                    subgraphs[sg_id] = sg_label\n\n        # [Node]ã‚¿ã‚°ã§åˆ†å‰²ã—ã¦æŠ½å‡º\n        node_matches = re.split(r'\\[Node\\]', clean_text, flags=re.IGNORECASE)[1:]\n        for block in node_matches:\n            # æ¬¡ã®ã‚¿ã‚°ã®æ‰‹å‰ã¾ã§ã‚’ãƒ‘ãƒ¼ã‚¹\n            data",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import re",
            "lineNumber": 1
          },
          {
            "text": "from typing import Dict, Optional",
            "lineNumber": 2
          },
          {
            "text": "from core.schemas import Node, Edge, Flowchart, NodeStatus",
            "lineNumber": 3
          },
          {
            "text": "from core.exceptions import TOONParseError",
            "lineNumber": 4
          },
          {
            "lineNumber": 5
          },
          {
            "text": "class TOONParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 7
          },
          {
            "text": "    def parse(text: str) -&gt; Flowchart:",
            "lineNumber": 8
          },
          {
            "text": "        # Markdownã®è£…é£¾ï¼ˆ&#96;&#96;&#96;toon...&#96;&#96;&#96;ï¼‰ãŒã‚ã‚Œã°é™¤å»",
            "lineNumber": 9
          },
          {
            "text": "        clean_text = re.sub(r'&#96;&#96;&#96;[a-zA-Z]*\\n?', '', text)",
            "lineNumber": 10
          },
          {
            "text": "        clean_text = clean_text.replace('&#96;&#96;&#96;', '').strip()",
            "lineNumber": 11
          },
          {
            "lineNumber": 12
          },
          {
            "text": "        nodes = []",
            "lineNumber": 13
          },
          {
            "text": "        edges = []",
            "lineNumber": 14
          },
          {
            "text": "        subgraphs: Optional[Dict[str, str]] = None",
            "lineNumber": 15
          },
          {
            "lineNumber": 16
          },
          {
            "text": "        # [Subgraph]ã‚¿ã‚°ã§åˆ†å‰²ã—ã¦æŠ½å‡º",
            "lineNumber": 17
          },
          {
            "text": "        subgraph_matches = re.split(r'\\[Subgraph\\]', clean_text, flags=re.IGNORECASE)[1:]",
            "lineNumber": 18
          },
          {
            "text": "        if subgraph_matches:",
            "lineNumber": 19
          },
          {
            "text": "            subgraphs = {}",
            "lineNumber": 20
          },
          {
            "text": "            for block in subgraph_matches:",
            "lineNumber": 21
          },
          {
            "text": "                data = TOONParser._parse_block(re.split(r'\\[', block)[0])",
            "lineNumber": 22
          },
          {
            "text": "                if 'id' in data and 'label' in data:",
            "lineNumber": 23
          },
          {
            "text": "                    sg_id = data['id'].strip()",
            "lineNumber": 24
          },
          {
            "text": "                    sg_label = data['label'].strip()",
            "lineNumber": 25
          },
          {
            "text": "                    subgraphs[sg_id] = sg_label",
            "lineNumber": 26
          },
          {
            "lineNumber": 27
          },
          {
            "text": "        # [Node]ã‚¿ã‚°ã§åˆ†å‰²ã—ã¦æŠ½å‡º",
            "lineNumber": 28
          },
          {
            "text": "        node_matches = re.split(r'\\[Node\\]', clean_text, flags=re.IGNORECASE)[1:]",
            "lineNumber": 29
          },
          {
            "text": "        for block in node_matches:",
            "lineNumber": 30
          },
          {
            "text": "            # æ¬¡ã®ã‚¿ã‚°ã®æ‰‹å‰ã¾ã§ã‚’ãƒ‘ãƒ¼ã‚¹",
            "lineNumber": 31
          },
          {
            "text": "            data",
            "lineNumber": 32
          }
        ]
      },
      "score": 0.2451932430267334
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 24
          },
          "endPosition": {
            "line": 336
          }
        },
        "contents": "class Flowchart(BaseModel):\ndef detect_logic_gaps(self) -&gt; List[Node]:\n\n        \n        for edge in self.edges:\n            # æ¥ç¶šå…ˆæœªå®šç¾©ãƒãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯\n            if edge.target not in node_ids:\n                missing_id = f\"missing_{edge.target}\"\n                if missing_id not in processed_missing_ids:\n                    missing_node = Node(\n                        id=missing_id,\n                        label=f\"æœªå®šç¾©: {edge.target}\",\n                        type=\"missing\",\n                        status=NodeStatus.MISSING\n                    )\n                    gaps.append(missing_node)\n                    processed_missing_ids.add(missing_id)\n            \n            # æ¥ç¶šå…ƒæœªå®šç¾©ãƒãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯\n            if edge.source not in node_ids:\n                missing_id = f\"missing_{edge.source}\"\n                if missing_id not in processed_missing_ids:\n                    missing_node = Node(\n                        id=missing_id,\n                        label=f\"æœªå®šç¾©: {edge.source}\",\n                        type=\"missing\",\n                        status=NodeStatus.MISSING\n                    )\n                    gaps.append(missing_node)\n                    processed_missing_ids.add(missing_id)\n        \n        # 3. å­¤ç«‹ãƒãƒ¼ãƒ‰ï¼ˆSTART/ENDä»¥å¤–ã§æ¥ç¶šãŒãªã„ï¼‰\n        for node in self.nodes:\n            if node.type not in [\"start\", \"end\"]:\n                if len(outgoing_edges[node.id]) == 0 and len(incoming_edges[node.id]) == 0:\n                    # å­¤ç«‹ã—ã¦ã„ã‚‹ãƒãƒ¼ãƒ‰ã‚’MISSINGã¨ã—ã¦ãƒãƒ¼ã‚¯\n                    gaps.append(node)\n        \n        return gaps\n\n    def apply_logic_gap_detection(self) -&gt; 'Flowchart':\n        ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 25,
                "column": 1
              },
              "endPosition": {
                "line": 26,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 77,
                "column": 5
              },
              "endPosition": {
                "line": 78,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 25,
            "isSignature": true
          },
          {
            "text": "def detect_logic_gaps(self) -&gt; List[Node]:",
            "lineNumber": 77
          },
          {
            "lineNumber": 109
          },
          {
            "text": "        ",
            "lineNumber": 110
          },
          {
            "text": "        for edge in self.edges:",
            "lineNumber": 111
          },
          {
            "text": "            # æ¥ç¶šå…ˆæœªå®šç¾©ãƒãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 112
          },
          {
            "text": "            if edge.target not in node_ids:",
            "lineNumber": 113
          },
          {
            "text": "                missing_id = f\"missing_{edge.target}\"",
            "lineNumber": 114
          },
          {
            "text": "                if missing_id not in processed_missing_ids:",
            "lineNumber": 115
          },
          {
            "text": "                    missing_node = Node(",
            "lineNumber": 116
          },
          {
            "text": "                        id=missing_id,",
            "lineNumber": 117
          },
          {
            "text": "                        label=f\"æœªå®šç¾©: {edge.target}\",",
            "lineNumber": 118
          },
          {
            "text": "                        type=\"missing\",",
            "lineNumber": 119
          },
          {
            "text": "                        status=NodeStatus.MISSING",
            "lineNumber": 120
          },
          {
            "text": "                    )",
            "lineNumber": 121
          },
          {
            "text": "                    gaps.append(missing_node)",
            "lineNumber": 122
          },
          {
            "text": "                    processed_missing_ids.add(missing_id)",
            "lineNumber": 123
          },
          {
            "text": "            ",
            "lineNumber": 124
          },
          {
            "text": "            # æ¥ç¶šå…ƒæœªå®šç¾©ãƒãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 125
          },
          {
            "text": "            if edge.source not in node_ids:",
            "lineNumber": 126
          },
          {
            "text": "                missing_id = f\"missing_{edge.source}\"",
            "lineNumber": 127
          },
          {
            "text": "                if missing_id not in processed_missing_ids:",
            "lineNumber": 128
          },
          {
            "text": "                    missing_node = Node(",
            "lineNumber": 129
          },
          {
            "text": "                        id=missing_id,",
            "lineNumber": 130
          },
          {
            "text": "                        label=f\"æœªå®šç¾©: {edge.source}\",",
            "lineNumber": 131
          },
          {
            "text": "                        type=\"missing\",",
            "lineNumber": 132
          },
          {
            "text": "                        status=NodeStatus.MISSING",
            "lineNumber": 133
          },
          {
            "text": "                    )",
            "lineNumber": 134
          },
          {
            "text": "                    gaps.append(missing_node)",
            "lineNumber": 135
          },
          {
            "text": "                    processed_missing_ids.add(missing_id)",
            "lineNumber": 136
          },
          {
            "text": "        ",
            "lineNumber": 137
          },
          {
            "text": "        # 3. å­¤ç«‹ãƒãƒ¼ãƒ‰ï¼ˆSTART/ENDä»¥å¤–ã§æ¥ç¶šãŒãªã„ï¼‰",
            "lineNumber": 138
          },
          {
            "text": "        for node in self.nodes:",
            "lineNumber": 139
          },
          {
            "text": "            if node.type not in [\"start\", \"end\"]:",
            "lineNumber": 140
          },
          {
            "text": "                if len(outgoing_edges[node.id]) == 0 and len(incoming_edges[node.id]) == 0:",
            "lineNumber": 141
          },
          {
            "text": "                    # å­¤ç«‹ã—ã¦ã„ã‚‹ãƒãƒ¼ãƒ‰ã‚’MISSINGã¨ã—ã¦ãƒãƒ¼ã‚¯",
            "lineNumber": 142
          },
          {
            "text": "                    gaps.append(node)",
            "lineNumber": 143
          },
          {
            "text": "        ",
            "lineNumber": 144
          },
          {
            "text": "        return gaps",
            "lineNumber": 145
          },
          {
            "lineNumber": 146
          },
          {
            "text": "    def apply_logic_gap_detection(self) -&gt; 'Flowchart':",
            "lineNumber": 147
          },
          {
            "text": "        ",
            "lineNumber": 148
          }
        ]
      },
      "score": 0.24274373054504395
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\TOON_BASE.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 86,
            "column": 16
          }
        },
        "contents": "# Output Format: TOON (Token-Oriented Object Notation)\n\nå›ç­”ã¯ä»¥ä¸‹ã®ãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ã®ã¿ã§æ§‹æˆã—ã¦ãã ã•ã„ã€‚è§£èª¬ã‚„å°å…¥æ–‡ã¯ä¸€åˆ‡ç¦æ­¢ã—ã¾ã™ã€‚\n\n## Output Size Guidelines\n- **ãƒãƒ¼ãƒ‰æ•°**: æœ€å¤§30å€‹ã¾ã§ï¼ˆStreamlitã§ã®è¡¨ç¤ºãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ï¼‰\n- **ã‚¨ãƒƒã‚¸æ•°**: æœ€å¤§50å€‹ã¾ã§\n- **éƒ¨åˆ†çš„ãªãƒ•ãƒ­ãƒ¼ã®ç”Ÿæˆ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã‚„éƒ¨åˆ†ã‚’æŒ‡å®šã—ã¦ã„ã‚‹å ´åˆã€ãã®éƒ¨åˆ†ã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚å…¨ãƒ«ãƒ¼ãƒˆã‚’å«ã‚€å¿…è¦ã¯ãªã„ã€‚\n- **è¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ã®å ´åˆ**: ã¾ãšä¸»è¦ãªãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆã—ã€è©³ç´°ã¯å¾Œã‹ã‚‰è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã™ã‚‹ã€‚\n\n[Subgraph]\nid: (subgraphã®ID)\nlabel: (subgraphã®ãƒ©ãƒ™ãƒ«)\nâ€» ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼šè¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã™ã‚‹å ´åˆã«ä½¿ç”¨\n\n[Node]\nid: (è‹±æ•°å­—ID)\nlabel: (å·¥ç¨‹å)\ntype: (start | end | process | decision | io_data | storage)\nsubgraph: (subgraphã®ID) â€» ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼šã“ã®ãƒãƒ¼ãƒ‰ãŒå±ã™ã‚‹subgraph\n\n[Edge]\nsource: (ç™ºä¿¡å…ƒID)\ntarget: (å®›å…ˆID)\nlabel: (åˆ†å²æ¡ä»¶ãŒã‚ã‚‹å ´åˆã®ã¿)\n\n## Examples\n\n### åŸºæœ¬çš„ãªä¾‹\n[Node]\nid: start\nlabel: é–‹å§‹\ntype: start\n[Node]\nid: task1\nlabel: å‡¦ç†\ntype: process\n[Node]\nid: node_end\nlabel: çµ‚äº†\ntype: end\n[Edge]\nsource: start\ntarget: task1\n[Edge]\nsource: task1\ntarget: node_end\n\n### subgraphã‚’ä½¿ç”¨ã—ãŸä¾‹\n[Subgraph]\nid: flow1\nlabel: è©³ç´°å‡¦ç†ãƒ•ãƒ­ãƒ¼\n\n[Node]\nid: start\nlabel: é–‹å§‹\ntype: start\n[Node]\nid: task1\nlabel: å‡¦ç†\ntype: process\n[Node]\nid: check1\nlabel: ãƒã‚§ãƒƒã‚¯\ntype: decision\nsubgraph: flow1\n[Node]\nid: task2\nlabel: è©³ç´°å‡¦ç†\ntype: process\nsubgraph: flow1\n[Node]\nid: node_end\nlabel: çµ‚äº†\ntype: end\n[Edge]\nsource: start\ntarget: task1\n[Edge]\nsource: task1\ntarget: check1\n[Edge]\nsource: check1\ntarget: task2\n[Edge]\nsource: task2\ntarget: node_end",
        "signatures": {},
        "detailedLines": [
          {
            "text": "# Output Format: TOON (Token-Oriented Object Notation)",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "å›ç­”ã¯ä»¥ä¸‹ã®ãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ã®ã¿ã§æ§‹æˆã—ã¦ãã ã•ã„ã€‚è§£èª¬ã‚„å°å…¥æ–‡ã¯ä¸€åˆ‡ç¦æ­¢ã—ã¾ã™ã€‚",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "## Output Size Guidelines",
            "lineNumber": 5
          },
          {
            "text": "- **ãƒãƒ¼ãƒ‰æ•°**: æœ€å¤§30å€‹ã¾ã§ï¼ˆStreamlitã§ã®è¡¨ç¤ºãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ï¼‰",
            "lineNumber": 6
          },
          {
            "text": "- **ã‚¨ãƒƒã‚¸æ•°**: æœ€å¤§50å€‹ã¾ã§",
            "lineNumber": 7
          },
          {
            "text": "- **éƒ¨åˆ†çš„ãªãƒ•ãƒ­ãƒ¼ã®ç”Ÿæˆ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã‚„éƒ¨åˆ†ã‚’æŒ‡å®šã—ã¦ã„ã‚‹å ´åˆã€ãã®éƒ¨åˆ†ã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚å…¨ãƒ«ãƒ¼ãƒˆã‚’å«ã‚€å¿…è¦ã¯ãªã„ã€‚",
            "lineNumber": 8
          },
          {
            "text": "- **è¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ã®å ´åˆ**: ã¾ãšä¸»è¦ãªãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆã—ã€è©³ç´°ã¯å¾Œã‹ã‚‰è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã™ã‚‹ã€‚",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "text": "[Subgraph]",
            "lineNumber": 11
          },
          {
            "text": "id: (subgraphã®ID)",
            "lineNumber": 12
          },
          {
            "text": "label: (subgraphã®ãƒ©ãƒ™ãƒ«)",
            "lineNumber": 13
          },
          {
            "text": "â€» ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼šè¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã™ã‚‹å ´åˆã«ä½¿ç”¨",
            "lineNumber": 14
          },
          {
            "lineNumber": 15
          },
          {
            "text": "[Node]",
            "lineNumber": 16
          },
          {
            "text": "id: (è‹±æ•°å­—ID)",
            "lineNumber": 17
          },
          {
            "text": "label: (å·¥ç¨‹å)",
            "lineNumber": 18
          },
          {
            "text": "type: (start | end | process | decision | io_data | storage)",
            "lineNumber": 19
          },
          {
            "text": "subgraph: (subgraphã®ID) â€» ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼šã“ã®ãƒãƒ¼ãƒ‰ãŒå±ã™ã‚‹subgraph",
            "lineNumber": 20
          },
          {
            "lineNumber": 21
          },
          {
            "text": "[Edge]",
            "lineNumber": 22
          },
          {
            "text": "source: (ç™ºä¿¡å…ƒID)",
            "lineNumber": 23
          },
          {
            "text": "target: (å®›å…ˆID)",
            "lineNumber": 24
          },
          {
            "text": "label: (åˆ†å²æ¡ä»¶ãŒã‚ã‚‹å ´åˆã®ã¿)",
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "text": "## Examples",
            "lineNumber": 27
          },
          {
            "lineNumber": 28
          },
          {
            "text": "### åŸºæœ¬çš„ãªä¾‹",
            "lineNumber": 29
          },
          {
            "text": "[Node]",
            "lineNumber": 30
          },
          {
            "text": "id: start",
            "lineNumber": 31
          },
          {
            "text": "label: é–‹å§‹",
            "lineNumber": 32
          },
          {
            "text": "type: start",
            "lineNumber": 33
          },
          {
            "text": "[Node]",
            "lineNumber": 34
          },
          {
            "text": "id: task1",
            "lineNumber": 35
          },
          {
            "text": "label: å‡¦ç†",
            "lineNumber": 36
          },
          {
            "text": "type: process",
            "lineNumber": 37
          },
          {
            "text": "[Node]",
            "lineNumber": 38
          },
          {
            "text": "id: node_end",
            "lineNumber": 39
          },
          {
            "text": "label: çµ‚äº†",
            "lineNumber": 40
          },
          {
            "text": "type: end",
            "lineNumber": 41
          },
          {
            "text": "[Edge]",
            "lineNumber": 42
          },
          {
            "text": "source: start",
            "lineNumber": 43
          },
          {
            "text": "target: task1",
            "lineNumber": 44
          },
          {
            "text": "[Edge]",
            "lineNumber": 45
          },
          {
            "text": "source: task1",
            "lineNumber": 46
          },
          {
            "text": "target: node_end",
            "lineNumber": 47
          },
          {
            "lineNumber": 48
          },
          {
            "text": "### subgraphã‚’ä½¿ç”¨ã—ãŸä¾‹",
            "lineNumber": 49
          },
          {
            "text": "[Subgraph]",
            "lineNumber": 50
          },
          {
            "text": "id: flow1",
            "lineNumber": 51
          },
          {
            "text": "label: è©³ç´°å‡¦ç†ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 52
          },
          {
            "lineNumber": 53
          },
          {
            "text": "[Node]",
            "lineNumber": 54
          },
          {
            "text": "id: start",
            "lineNumber": 55
          },
          {
            "text": "label: é–‹å§‹",
            "lineNumber": 56
          },
          {
            "text": "type: start",
            "lineNumber": 57
          },
          {
            "text": "[Node]",
            "lineNumber": 58
          },
          {
            "text": "id: task1",
            "lineNumber": 59
          },
          {
            "text": "label: å‡¦ç†",
            "lineNumber": 60
          },
          {
            "text": "type: process",
            "lineNumber": 61
          },
          {
            "text": "[Node]",
            "lineNumber": 62
          },
          {
            "text": "id: check1",
            "lineNumber": 63
          },
          {
            "text": "label: ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 64
          },
          {
            "text": "type: decision",
            "lineNumber": 65
          },
          {
            "text": "subgraph: flow1",
            "lineNumber": 66
          },
          {
            "text": "[Node]",
            "lineNumber": 67
          },
          {
            "text": "id: task2",
            "lineNumber": 68
          },
          {
            "text": "label: è©³ç´°å‡¦ç†",
            "lineNumber": 69
          },
          {
            "text": "type: process",
            "lineNumber": 70
          },
          {
            "text": "subgraph: flow1",
            "lineNumber": 71
          },
          {
            "text": "[Node]",
            "lineNumber": 72
          },
          {
            "text": "id: node_end",
            "lineNumber": 73
          },
          {
            "text": "label: çµ‚äº†",
            "lineNumber": 74
          },
          {
            "text": "type: end",
            "lineNumber": 75
          },
          {
            "text": "[Edge]",
            "lineNumber": 76
          },
          {
            "text": "source: start",
            "lineNumber": 77
          },
          {
            "text": "target: task1",
            "lineNumber": 78
          },
          {
            "text": "[Edge]",
            "lineNumber": 79
          },
          {
            "text": "source: task1",
            "lineNumber": 80
          },
          {
            "text": "target: check1",
            "lineNumber": 81
          },
          {
            "text": "[Edge]",
            "lineNumber": 82
          },
          {
            "text": "source: check1",
            "lineNumber": 83
          },
          {
            "text": "target: task2",
            "lineNumber": 84
          },
          {
            "text": "[Edge]",
            "lineNumber": 85
          },
          {
            "text": "source: task2",
            "lineNumber": 86
          },
          {
            "text": "target: node_end",
            "lineNumber": 87
          }
        ]
      },
      "score": 0.241826593875885
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 24
          },
          "endPosition": {
            "line": 336
          }
        },
        "contents": "class Flowchart(BaseModel):\ndef to_mermaid(self) -&gt; str:\n\n        else:\n            # subgraphãŒãªã„å ´åˆã¯å¾“æ¥é€šã‚Š\n            for n in self.nodes:\n                safe_id = f\"n_{n.id}\" if n.id == \"end\" else n.id\n                shape = self._get_node_shape(n.type)\n                \n                if shape == \"([ ])\":  # START/END\n                    lines.append(f'{safe_id}[\"{n.label}\"]')\n                elif shape == \"[ ]\":  # PROCESS\n                    lines.append(f'{safe_id}[\"{n.label}\"]')\n                elif shape == \"{ }\":  # DECISION\n                    lines.append(f'{safe_id}{{\"{n.label}\"}}')\n                elif shape == \"[/ /]\":  # IO_DATA (å¹³è¡Œå››è¾ºå½¢)\n                    lines.append(f'{safe_id}[/\"{n.label}\"/]')\n                elif shape == \"[( )]\":  # STORAGE (å††ç­’å½¢)\n                    lines.append(f'{safe_id}[(\"{n.label}\")]')\n                elif shape == \"{{ }}\":  # MISSING\n                    lines.append(f'{safe_id}{{\"{n.label}\"}}')\n                \n                color = self._get_status_color(n.status)\n                style_lines.append(f'    style {safe_id} fill:{color}')\n        \n        # ã‚¨ãƒƒã‚¸å®šç¾©\n        for e in self.edges:\n            src = f\"n_{e.source}\" if e.source == \"end\" else e.source\n            tgt = f\"n_{e.target}\" if e.target == \"end\" else e.target\n            \n            if e.label:\n                lines.append(f'{src}--&gt;|\"{e.label}\"|{tgt}')\n            else:\n                lines.append(f'{src}--&gt;{tgt}')\n        \n        # ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©ã‚’è¿½åŠ \n        if style_lines:\n            lines.append(\"\")\n            lines.extend(style_lines)\n            \n        return \"\\n\".join(lines)\n\n    def to_toon_format(self) -&gt; str:\n        \"\"\"Flowchartã‚’TOONå½¢å¼ï¼ˆMarkdownï¼‰ã«å¤‰æ›\"\"\"",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 25,
                "column": 1
              },
              "endPosition": {
                "line": 26,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 202,
                "column": 5
              },
              "endPosition": {
                "line": 203,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 25,
            "isSignature": true
          },
          {
            "text": "def to_mermaid(self) -&gt; str:",
            "lineNumber": 202
          },
          {
            "lineNumber": 264
          },
          {
            "text": "        else:",
            "lineNumber": 265
          },
          {
            "text": "            # subgraphãŒãªã„å ´åˆã¯å¾“æ¥é€šã‚Š",
            "lineNumber": 266
          },
          {
            "text": "            for n in self.nodes:",
            "lineNumber": 267
          },
          {
            "text": "                safe_id = f\"n_{n.id}\" if n.id == \"end\" else n.id",
            "lineNumber": 268
          },
          {
            "text": "                shape = self._get_node_shape(n.type)",
            "lineNumber": 269
          },
          {
            "text": "                ",
            "lineNumber": 270
          },
          {
            "text": "                if shape == \"([ ])\":  # START/END",
            "lineNumber": 271
          },
          {
            "text": "                    lines.append(f'{safe_id}[\"{n.label}\"]')",
            "lineNumber": 272
          },
          {
            "text": "                elif shape == \"[ ]\":  # PROCESS",
            "lineNumber": 273
          },
          {
            "text": "                    lines.append(f'{safe_id}[\"{n.label}\"]')",
            "lineNumber": 274
          },
          {
            "text": "                elif shape == \"{ }\":  # DECISION",
            "lineNumber": 275
          },
          {
            "text": "                    lines.append(f'{safe_id}{{\"{n.label}\"}}')",
            "lineNumber": 276
          },
          {
            "text": "                elif shape == \"[/ /]\":  # IO_DATA (å¹³è¡Œå››è¾ºå½¢)",
            "lineNumber": 277
          },
          {
            "text": "                    lines.append(f'{safe_id}[/\"{n.label}\"/]')",
            "lineNumber": 278
          },
          {
            "text": "                elif shape == \"[( )]\":  # STORAGE (å††ç­’å½¢)",
            "lineNumber": 279
          },
          {
            "text": "                    lines.append(f'{safe_id}[(\"{n.label}\")]')",
            "lineNumber": 280
          },
          {
            "text": "                elif shape == \"{{ }}\":  # MISSING",
            "lineNumber": 281
          },
          {
            "text": "                    lines.append(f'{safe_id}{{\"{n.label}\"}}')",
            "lineNumber": 282
          },
          {
            "text": "                ",
            "lineNumber": 283
          },
          {
            "text": "                color = self._get_status_color(n.status)",
            "lineNumber": 284
          },
          {
            "text": "                style_lines.append(f'    style {safe_id} fill:{color}')",
            "lineNumber": 285
          },
          {
            "text": "        ",
            "lineNumber": 286
          },
          {
            "text": "        # ã‚¨ãƒƒã‚¸å®šç¾©",
            "lineNumber": 287
          },
          {
            "text": "        for e in self.edges:",
            "lineNumber": 288
          },
          {
            "text": "            src = f\"n_{e.source}\" if e.source == \"end\" else e.source",
            "lineNumber": 289
          },
          {
            "text": "            tgt = f\"n_{e.target}\" if e.target == \"end\" else e.target",
            "lineNumber": 290
          },
          {
            "text": "            ",
            "lineNumber": 291
          },
          {
            "text": "            if e.label:",
            "lineNumber": 292
          },
          {
            "text": "                lines.append(f'{src}--&gt;|\"{e.label}\"|{tgt}')",
            "lineNumber": 293
          },
          {
            "text": "            else:",
            "lineNumber": 294
          },
          {
            "text": "                lines.append(f'{src}--&gt;{tgt}')",
            "lineNumber": 295
          },
          {
            "text": "        ",
            "lineNumber": 296
          },
          {
            "text": "        # ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©ã‚’è¿½åŠ ",
            "lineNumber": 297
          },
          {
            "text": "        if style_lines:",
            "lineNumber": 298
          },
          {
            "text": "            lines.append(\"\")",
            "lineNumber": 299
          },
          {
            "text": "            lines.extend(style_lines)",
            "lineNumber": 300
          },
          {
            "text": "            ",
            "lineNumber": 301
          },
          {
            "text": "        return \"\\n\".join(lines)",
            "lineNumber": 302
          },
          {
            "lineNumber": 303
          },
          {
            "text": "    def to_toon_format(self) -&gt; str:",
            "lineNumber": 304
          },
          {
            "text": "        \"\"\"Flowchartã‚’TOONå½¢å¼ï¼ˆMarkdownï¼‰ã«å¤‰æ›\"\"\"",
            "lineNumber": 305
          }
        ]
      },
      "score": 0.24158316850662231
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\tests\\test_history_mgr.py",
        "range": {
          "startPosition": {
            "line": 9
          },
          "endPosition": {
            "line": 150,
            "column": 54
          }
        },
        "contents": "class TestHistoryManager:\n\n\n    def test_append_toon_log_update_edge(self, history_mgr, sample_flowchart):\n        session_id = \"update_edge_session\"\n        history_mgr.save_toon_file(session_id, sample_flowchart)\n        \n        # ã‚¨ãƒƒã‚¸ã®ãƒ©ãƒ™ãƒ«ã‚’æ›´æ–°\n        updated_flowchart = Flowchart(\n            nodes=[\n                Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),\n                Node(id=\"process1\", label=\"å‡¦ç†\", type=\"process\"),\n                Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")\n            ],\n            edges=[\n                Edge(source=\"start\", target=\"process1\", label=\"é–‹å§‹å‡¦ç†\"),\n                Edge(source=\"process1\", target=\"node_end\")\n            ]\n        )\n        \n        result = history_mgr.append_toon_log(session_id, updated_flowchart)\n        edge_with_label = next(\n            (e for e in result.edges if e.source == \"start\" and e.target == \"process1\"),\n            None\n        )\n        assert edge_with_label is not None\n        assert edge_with_label.label == \"é–‹å§‹å‡¦ç†\"",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 10,
                "column": 1
              },
              "endPosition": {
                "line": 11,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class TestHistoryManager:",
            "lineNumber": 10,
            "isSignature": true
          },
          {
            "lineNumber": 126
          },
          {
            "lineNumber": 127
          },
          {
            "text": "    def test_append_toon_log_update_edge(self, history_mgr, sample_flowchart):",
            "lineNumber": 128
          },
          {
            "text": "        session_id = \"update_edge_session\"",
            "lineNumber": 129
          },
          {
            "text": "        history_mgr.save_toon_file(session_id, sample_flowchart)",
            "lineNumber": 130
          },
          {
            "text": "        ",
            "lineNumber": 131
          },
          {
            "text": "        # ã‚¨ãƒƒã‚¸ã®ãƒ©ãƒ™ãƒ«ã‚’æ›´æ–°",
            "lineNumber": 132
          },
          {
            "text": "        updated_flowchart = Flowchart(",
            "lineNumber": 133
          },
          {
            "text": "            nodes=[",
            "lineNumber": 134
          },
          {
            "text": "                Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),",
            "lineNumber": 135
          },
          {
            "text": "                Node(id=\"process1\", label=\"å‡¦ç†\", type=\"process\"),",
            "lineNumber": 136
          },
          {
            "text": "                Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")",
            "lineNumber": 137
          },
          {
            "text": "            ],",
            "lineNumber": 138
          },
          {
            "text": "            edges=[",
            "lineNumber": 139
          },
          {
            "text": "                Edge(source=\"start\", target=\"process1\", label=\"é–‹å§‹å‡¦ç†\"),",
            "lineNumber": 140
          },
          {
            "text": "                Edge(source=\"process1\", target=\"node_end\")",
            "lineNumber": 141
          },
          {
            "text": "            ]",
            "lineNumber": 142
          },
          {
            "text": "        )",
            "lineNumber": 143
          },
          {
            "text": "        ",
            "lineNumber": 144
          },
          {
            "text": "        result = history_mgr.append_toon_log(session_id, updated_flowchart)",
            "lineNumber": 145
          },
          {
            "text": "        edge_with_label = next(",
            "lineNumber": 146
          },
          {
            "text": "            (e for e in result.edges if e.source == \"start\" and e.target == \"process1\"),",
            "lineNumber": 147
          },
          {
            "text": "            None",
            "lineNumber": 148
          },
          {
            "text": "        )",
            "lineNumber": 149
          },
          {
            "text": "        assert edge_with_label is not None",
            "lineNumber": 150
          },
          {
            "text": "        assert edge_with_label.label == \"é–‹å§‹å‡¦ç†\"",
            "lineNumber": 151,
            "isSignature": true
          }
        ]
      },
      "score": 0.24076899886131287
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\rules.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 26
          }
        },
        "contents": "# Skills: Flowchart Logic Expert\n\n## Core Rules\n- **Logical Integrity**: å…¨ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ã¯å¿…ãšã€Œé–‹å§‹ã€ã‹ã‚‰å§‹ã¾ã‚Šã€Œçµ‚äº†ã€ã¸åˆ°é”ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚\n- **Reserved Word Protection**: Mermaid.js ã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã‚’é˜²ããŸã‚ã€çµ‚äº†ãƒãƒ¼ãƒ‰ã® ID ã«ã¯å¿…ãš &#96;node_end&#96; ã‚’ä½¿ç”¨ã—ã€ID å˜ä½“ã§ &#96;end&#96; ã‚’ä½¿ç”¨ã—ã¦ã¯ãªã‚‰ãªã„ã€‚\n- **Node Classification**:\n  - &#96;start&#96;: ãƒ•ãƒ­ãƒ¼ã®èµ·ç‚¹ã€‚\n  - &#96;end&#96;: ãƒ•ãƒ­ãƒ¼ã®çµ‚ç€ç‚¹ã€‚\n  - &#96;process&#96;: å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚„ä½œæ¥­ã€‚\n  - &#96;decision&#96;: äºŒè€…æŠä¸€ã€ã¾ãŸã¯å¤šè‚¢é¸æŠã®åˆ†å²ç‚¹ã€‚\n- **Atomic Steps**: 1ã¤ã®ãƒãƒ¼ãƒ‰ã«è¤‡æ•°ã®å·¥ç¨‹ã‚’è©°ã‚è¾¼ã¾ãšã€å¯èƒ½ãªé™ã‚Šæœ€å°å˜ä½ã«åˆ†å‰²ã™ã‚‹ã“ã¨ã€‚\n\n## Constraints\n- Windows / Python 3.10+ ç’°å¢ƒã§å‹•ä½œã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã‚ã‚‹ã“ã¨ã‚’æ„è­˜ã™ã‚‹ã“ã¨ã€‚\n- æ—¥æœ¬èªãƒ©ãƒ™ãƒ«ã¯å¸¸ã«æ­£ç¢ºã«ã€ã‹ã¤ç°¡æ½”ã«è¡¨ç¾ã™ã‚‹ã“ã¨ã€‚\n\n## Output Size Limits\n- **ãƒãƒ¼ãƒ‰æ•°ã®åˆ¶é™**: 1ã¤ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã«å«ã¾ã‚Œã‚‹ãƒãƒ¼ãƒ‰æ•°ã¯æœ€å¤§30å€‹ã¾ã§ã¨ã™ã‚‹ã€‚ã“ã‚Œã‚’è¶…ãˆã‚‹å ´åˆã¯ã€è¤‡æ•°ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã«åˆ†å‰²ã™ã‚‹ã‹ã€ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚\n- **ã‚¨ãƒƒã‚¸æ•°ã®åˆ¶é™**: ã‚¨ãƒƒã‚¸æ•°ã¯æœ€å¤§50å€‹ã¾ã§ã¨ã™ã‚‹ã€‚è¤‡é›‘ãªåˆ†å²ãŒå¤šã„å ´åˆã¯ã€ä¸»è¦ãªãƒ‘ã‚¹ã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚\n- **éƒ¨åˆ†çš„ãªãƒ•ãƒ­ãƒ¼ã®ç”Ÿæˆã‚’æ¨å¥¨**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã‚„éƒ¨åˆ†ã‚’æŒ‡å®šã—ã¦ã„ã‚‹å ´åˆã€ãã®éƒ¨åˆ†ã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚å…¨ãƒ«ãƒ¼ãƒˆã‚’å«ã‚€å¿…è¦ã¯ãªã„ã€‚\n- **æ®µéšçš„ãªç”Ÿæˆ**: å¤§è¦æ¨¡ãªãƒ—ãƒ­ã‚»ã‚¹ã‚’å¯è¦–åŒ–ã™ã‚‹å ´åˆã€ã¾ãšä¸»è¦ãªãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆã—ã€è©³ç´°ã¯å¾Œã‹ã‚‰è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã™ã‚‹ã€‚\n- **Streamlitè¡¨ç¤ºã®æœ€é©åŒ–**: Streamlitã§ãƒãƒ¼ãƒ¡ã‚¤ãƒ‰å›³ã‚’è¡¨ç¤ºã™ã‚‹éš›ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ã—ã€éåº¦ã«è¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã¯é¿ã‘ã‚‹ã“ã¨ã€‚\n\n## Subgraph Usage\n- **è¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–**: é–¢é€£ã™ã‚‹ãƒãƒ¼ãƒ‰ãŒ5å€‹ä»¥ä¸Šã‚ã‚‹å ´åˆã€ã¾ãŸã¯ç‰¹å®šã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ã¨ã—ã¦ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã§ãã‚‹å ´åˆã¯ã€&#96;[Subgraph]&#96;ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦è¦–èªæ€§ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ã€‚\n- **subgraphã®å‘½å**: subgraphã®IDã¨labelã¯ã€ãã®ãƒ•ãƒ­ãƒ¼ã®å†…å®¹ã‚’æ˜ç¢ºã«ç¤ºã™ã‚‚ã®ã¨ã™ã‚‹ã“ã¨ã€‚",
        "signatures": {},
        "detailedLines": [
          {
            "text": "# Skills: Flowchart Logic Expert",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "## Core Rules",
            "lineNumber": 3
          },
          {
            "text": "- **Logical Integrity**: å…¨ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ã¯å¿…ãšã€Œé–‹å§‹ã€ã‹ã‚‰å§‹ã¾ã‚Šã€Œçµ‚äº†ã€ã¸åˆ°é”ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚",
            "lineNumber": 4
          },
          {
            "text": "- **Reserved Word Protection**: Mermaid.js ã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã‚’é˜²ããŸã‚ã€çµ‚äº†ãƒãƒ¼ãƒ‰ã® ID ã«ã¯å¿…ãš &#96;node_end&#96; ã‚’ä½¿ç”¨ã—ã€ID å˜ä½“ã§ &#96;end&#96; ã‚’ä½¿ç”¨ã—ã¦ã¯ãªã‚‰ãªã„ã€‚",
            "lineNumber": 5
          },
          {
            "text": "- **Node Classification**:",
            "lineNumber": 6
          },
          {
            "text": "  - &#96;start&#96;: ãƒ•ãƒ­ãƒ¼ã®èµ·ç‚¹ã€‚",
            "lineNumber": 7
          },
          {
            "text": "  - &#96;end&#96;: ãƒ•ãƒ­ãƒ¼ã®çµ‚ç€ç‚¹ã€‚",
            "lineNumber": 8
          },
          {
            "text": "  - &#96;process&#96;: å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚„ä½œæ¥­ã€‚",
            "lineNumber": 9
          },
          {
            "text": "  - &#96;decision&#96;: äºŒè€…æŠä¸€ã€ã¾ãŸã¯å¤šè‚¢é¸æŠã®åˆ†å²ç‚¹ã€‚",
            "lineNumber": 10
          },
          {
            "text": "- **Atomic Steps**: 1ã¤ã®ãƒãƒ¼ãƒ‰ã«è¤‡æ•°ã®å·¥ç¨‹ã‚’è©°ã‚è¾¼ã¾ãšã€å¯èƒ½ãªé™ã‚Šæœ€å°å˜ä½ã«åˆ†å‰²ã™ã‚‹ã“ã¨ã€‚",
            "lineNumber": 11
          },
          {
            "lineNumber": 12
          },
          {
            "text": "## Constraints",
            "lineNumber": 13
          },
          {
            "text": "- Windows / Python 3.10+ ç’°å¢ƒã§å‹•ä½œã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã‚ã‚‹ã“ã¨ã‚’æ„è­˜ã™ã‚‹ã“ã¨ã€‚",
            "lineNumber": 14
          },
          {
            "text": "- æ—¥æœ¬èªãƒ©ãƒ™ãƒ«ã¯å¸¸ã«æ­£ç¢ºã«ã€ã‹ã¤ç°¡æ½”ã«è¡¨ç¾ã™ã‚‹ã“ã¨ã€‚",
            "lineNumber": 15
          },
          {
            "lineNumber": 16
          },
          {
            "text": "## Output Size Limits",
            "lineNumber": 17
          },
          {
            "text": "- **ãƒãƒ¼ãƒ‰æ•°ã®åˆ¶é™**: 1ã¤ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã«å«ã¾ã‚Œã‚‹ãƒãƒ¼ãƒ‰æ•°ã¯æœ€å¤§30å€‹ã¾ã§ã¨ã™ã‚‹ã€‚ã“ã‚Œã‚’è¶…ãˆã‚‹å ´åˆã¯ã€è¤‡æ•°ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã«åˆ†å‰²ã™ã‚‹ã‹ã€ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚",
            "lineNumber": 18
          },
          {
            "text": "- **ã‚¨ãƒƒã‚¸æ•°ã®åˆ¶é™**: ã‚¨ãƒƒã‚¸æ•°ã¯æœ€å¤§50å€‹ã¾ã§ã¨ã™ã‚‹ã€‚è¤‡é›‘ãªåˆ†å²ãŒå¤šã„å ´åˆã¯ã€ä¸»è¦ãªãƒ‘ã‚¹ã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚",
            "lineNumber": 19
          },
          {
            "text": "- **éƒ¨åˆ†çš„ãªãƒ•ãƒ­ãƒ¼ã®ç”Ÿæˆã‚’æ¨å¥¨**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã‚„éƒ¨åˆ†ã‚’æŒ‡å®šã—ã¦ã„ã‚‹å ´åˆã€ãã®éƒ¨åˆ†ã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚å…¨ãƒ«ãƒ¼ãƒˆã‚’å«ã‚€å¿…è¦ã¯ãªã„ã€‚",
            "lineNumber": 20
          },
          {
            "text": "- **æ®µéšçš„ãªç”Ÿæˆ**: å¤§è¦æ¨¡ãªãƒ—ãƒ­ã‚»ã‚¹ã‚’å¯è¦–åŒ–ã™ã‚‹å ´åˆã€ã¾ãšä¸»è¦ãªãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆã—ã€è©³ç´°ã¯å¾Œã‹ã‚‰è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã™ã‚‹ã€‚",
            "lineNumber": 21
          },
          {
            "text": "- **Streamlitè¡¨ç¤ºã®æœ€é©åŒ–**: Streamlitã§ãƒãƒ¼ãƒ¡ã‚¤ãƒ‰å›³ã‚’è¡¨ç¤ºã™ã‚‹éš›ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ã—ã€éåº¦ã«è¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã¯é¿ã‘ã‚‹ã“ã¨ã€‚",
            "lineNumber": 22
          },
          {
            "lineNumber": 23
          },
          {
            "text": "## Subgraph Usage",
            "lineNumber": 24
          },
          {
            "text": "- **è¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–**: é–¢é€£ã™ã‚‹ãƒãƒ¼ãƒ‰ãŒ5å€‹ä»¥ä¸Šã‚ã‚‹å ´åˆã€ã¾ãŸã¯ç‰¹å®šã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ã¨ã—ã¦ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã§ãã‚‹å ´åˆã¯ã€&#96;[Subgraph]&#96;ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦è¦–èªæ€§ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ã€‚",
            "lineNumber": 25
          },
          {
            "text": "- **subgraphã®å‘½å**: subgraphã®IDã¨labelã¯ã€ãã®ãƒ•ãƒ­ãƒ¼ã®å†…å®¹ã‚’æ˜ç¢ºã«ç¤ºã™ã‚‚ã®ã¨ã™ã‚‹ã“ã¨ã€‚",
            "lineNumber": 26
          }
        ]
      },
      "score": 0.2397291660308838
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\flow.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 47
          }
        },
        "contents": "&#96;&#96;&#96;mermaid\ngraph TD\n    start[\"é–‹å§‹\"]\n    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]\n    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]\n    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]\n    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}\n    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}\n    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]\n    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]\n    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]\n    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]\n    task10[\"æµå‹•ã«æˆ»ã™\"]\n    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}\n    node_end[\"çµ‚äº†\"]\n    \n    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼\n    start--&gt;task1\n    task1--&gt;task2\n    task2--&gt;decision1\n    \n    %% å†ç¾ã—ãªã„å ´åˆ\n    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10\n    task10--&gt;decision_recurrence\n    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1\n    \n    %% å†ç¾ã™ã‚‹å ´åˆ\n    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3\n    task3--&gt;decision2\n    \n    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²\n    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4\n    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8\n    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9\n    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other\n    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "&#96;&#96;&#96;mermaid",
            "lineNumber": 1
          },
          {
            "text": "graph TD",
            "lineNumber": 2
          },
          {
            "text": "    start[\"é–‹å§‹\"]",
            "lineNumber": 3
          },
          {
            "text": "    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]",
            "lineNumber": 4
          },
          {
            "text": "    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]",
            "lineNumber": 5
          },
          {
            "text": "    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 6
          },
          {
            "text": "    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]",
            "lineNumber": 7
          },
          {
            "text": "    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}",
            "lineNumber": 8
          },
          {
            "text": "    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 9
          },
          {
            "text": "    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}",
            "lineNumber": 10
          },
          {
            "text": "    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 11
          },
          {
            "text": "    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 12
          },
          {
            "text": "    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]",
            "lineNumber": 13
          },
          {
            "text": "    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]",
            "lineNumber": 14
          },
          {
            "text": "    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]",
            "lineNumber": 15
          },
          {
            "text": "    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]",
            "lineNumber": 16
          },
          {
            "text": "    task10[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 17
          },
          {
            "text": "    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}",
            "lineNumber": 18
          },
          {
            "text": "    node_end[\"çµ‚äº†\"]",
            "lineNumber": 19
          },
          {
            "text": "    ",
            "lineNumber": 20
          },
          {
            "text": "    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 21
          },
          {
            "text": "    start--&gt;task1",
            "lineNumber": 22
          },
          {
            "text": "    task1--&gt;task2",
            "lineNumber": 23
          },
          {
            "text": "    task2--&gt;decision1",
            "lineNumber": 24
          },
          {
            "text": "    ",
            "lineNumber": 25
          },
          {
            "text": "    %% å†ç¾ã—ãªã„å ´åˆ",
            "lineNumber": 26
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 27
          },
          {
            "text": "    task10--&gt;decision_recurrence",
            "lineNumber": 28
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end",
            "lineNumber": 29
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1",
            "lineNumber": 30
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2",
            "lineNumber": 31
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3",
            "lineNumber": 32
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4",
            "lineNumber": 33
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1",
            "lineNumber": 34
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1",
            "lineNumber": 35
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1",
            "lineNumber": 36
          },
          {
            "text": "    ",
            "lineNumber": 37
          },
          {
            "text": "    %% å†ç¾ã™ã‚‹å ´åˆ",
            "lineNumber": 38
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3",
            "lineNumber": 39
          },
          {
            "text": "    task3--&gt;decision2",
            "lineNumber": 40
          },
          {
            "text": "    ",
            "lineNumber": 41
          },
          {
            "text": "    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²",
            "lineNumber": 42
          },
          {
            "text": "    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4",
            "lineNumber": 43
          },
          {
            "text": "    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8",
            "lineNumber": 44
          },
          {
            "text": "    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9",
            "lineNumber": 45
          },
          {
            "text": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other",
            "lineNumber": 46
          },
          {
            "text": "    ",
            "lineNumber": 47
          }
        ]
      },
      "score": 0.23369109630584717
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 24
          },
          "endPosition": {
            "line": 336
          }
        },
        "contents": "class Flowchart(BaseModel):\n@model_validator(mode='after')\ndef validate_edges_reference_nodes(self):\n\n        \n        return self\n\n    def detect_logic_gaps(self) -&gt; List[Node]:\n        \"\"\"è«–ç†ã®ç©´ï¼ˆå‡ºå£ã®ãªã„åˆ†å²ã€æ¥ç¶šå…ˆ/æ¥ç¶šå…ƒæœªå®šç¾©ãƒãƒ¼ãƒ‰ã€å­¤ç«‹ãƒãƒ¼ãƒ‰ï¼‰ã‚’æ¤œå‡º\"\"\"\n        node_ids = {node.id for node in self.nodes}\n        gaps = []\n        \n        # å„ãƒãƒ¼ãƒ‰ã®æ¥ç¶šçŠ¶æ³ã‚’ç¢ºèªï¼ˆdefaultdictã‚’ä½¿ç”¨ã—ã¦KeyErrorã‚’é˜²ãï¼‰\n        outgoing_edges = defaultdict(list)\n        incoming_edges = defaultdict(list)\n        \n        # æ—¢å­˜ãƒãƒ¼ãƒ‰ã‚’åˆæœŸåŒ–\n        for node in self.nodes:\n            outgoing_edges[node.id] = []\n            incoming_edges[node.id] = []\n        \n        # ã‚¨ãƒƒã‚¸ã‚’å‡¦ç†ï¼ˆå­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰IDã§ã‚‚KeyErrorãŒç™ºç”Ÿã—ãªã„ï¼‰\n        for edge in self.edges:\n            outgoing_edges[edge.source].append(edge)\n            incoming_edges[edge.target].append(edge)\n        \n        # 1. å‡ºå£ã®ãªã„åˆ†å²ï¼ˆDECISIONãƒãƒ¼ãƒ‰ã§å‡ºå£ãŒ1ã¤ä»¥ä¸‹ï¼‰\n        for node in self.nodes:\n            if node.type == \"decision\":\n                outgoing_count = len(outgoing_edges[node.id])\n                if outgoing_count == 0:\n                    # DECISIONãƒãƒ¼ãƒ‰ã«å‡ºå£ãŒãªã„å ´åˆï¼ˆé‡å¤§ãªå•é¡Œï¼‰\n                    gaps.append(node)\n                elif outgoing_count == 1:\n                    # DECISIONãƒãƒ¼ãƒ‰ã«å‡ºå£ãŒ1ã¤ã—ã‹ãªã„å ´åˆï¼ˆé€šå¸¸ã¯2ã¤ä»¥ä¸Šå¿…è¦ï¼‰\n                    gaps.append(node)\n        \n        # 2. æ¥ç¶šå…ˆ/æ¥ç¶šå…ƒæœªå®šç¾©ãƒãƒ¼ãƒ‰ï¼ˆã‚¨ãƒƒã‚¸ã®target/sourceãŒå­˜åœ¨ã—ãªã„ï¼‰\n        # é‡è¤‡ã‚’é˜²ããŸã‚ã«æ—¢ã«å‡¦ç†æ¸ˆã¿ã®IDã‚’è¨˜éŒ²\n        processed_missing_ids = set()\n        \n        for edge in self.edges:",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 25,
                "column": 1
              },
              "endPosition": {
                "line": 26,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 25,
            "isSignature": true
          },
          {
            "text": "@model_validator(mode='after')",
            "lineNumber": 55
          },
          {
            "text": "def validate_edges_reference_nodes(self):",
            "lineNumber": 56
          },
          {
            "lineNumber": 73
          },
          {
            "text": "        ",
            "lineNumber": 74
          },
          {
            "text": "        return self",
            "lineNumber": 75
          },
          {
            "lineNumber": 76
          },
          {
            "text": "    def detect_logic_gaps(self) -&gt; List[Node]:",
            "lineNumber": 77
          },
          {
            "text": "        \"\"\"è«–ç†ã®ç©´ï¼ˆå‡ºå£ã®ãªã„åˆ†å²ã€æ¥ç¶šå…ˆ/æ¥ç¶šå…ƒæœªå®šç¾©ãƒãƒ¼ãƒ‰ã€å­¤ç«‹ãƒãƒ¼ãƒ‰ï¼‰ã‚’æ¤œå‡º\"\"\"",
            "lineNumber": 78
          },
          {
            "text": "        node_ids = {node.id for node in self.nodes}",
            "lineNumber": 79
          },
          {
            "text": "        gaps = []",
            "lineNumber": 80
          },
          {
            "text": "        ",
            "lineNumber": 81
          },
          {
            "text": "        # å„ãƒãƒ¼ãƒ‰ã®æ¥ç¶šçŠ¶æ³ã‚’ç¢ºèªï¼ˆdefaultdictã‚’ä½¿ç”¨ã—ã¦KeyErrorã‚’é˜²ãï¼‰",
            "lineNumber": 82
          },
          {
            "text": "        outgoing_edges = defaultdict(list)",
            "lineNumber": 83
          },
          {
            "text": "        incoming_edges = defaultdict(list)",
            "lineNumber": 84
          },
          {
            "text": "        ",
            "lineNumber": 85
          },
          {
            "text": "        # æ—¢å­˜ãƒãƒ¼ãƒ‰ã‚’åˆæœŸåŒ–",
            "lineNumber": 86
          },
          {
            "text": "        for node in self.nodes:",
            "lineNumber": 87
          },
          {
            "text": "            outgoing_edges[node.id] = []",
            "lineNumber": 88
          },
          {
            "text": "            incoming_edges[node.id] = []",
            "lineNumber": 89
          },
          {
            "text": "        ",
            "lineNumber": 90
          },
          {
            "text": "        # ã‚¨ãƒƒã‚¸ã‚’å‡¦ç†ï¼ˆå­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰IDã§ã‚‚KeyErrorãŒç™ºç”Ÿã—ãªã„ï¼‰",
            "lineNumber": 91
          },
          {
            "text": "        for edge in self.edges:",
            "lineNumber": 92
          },
          {
            "text": "            outgoing_edges[edge.source].append(edge)",
            "lineNumber": 93
          },
          {
            "text": "            incoming_edges[edge.target].append(edge)",
            "lineNumber": 94
          },
          {
            "text": "        ",
            "lineNumber": 95
          },
          {
            "text": "        # 1. å‡ºå£ã®ãªã„åˆ†å²ï¼ˆDECISIONãƒãƒ¼ãƒ‰ã§å‡ºå£ãŒ1ã¤ä»¥ä¸‹ï¼‰",
            "lineNumber": 96
          },
          {
            "text": "        for node in self.nodes:",
            "lineNumber": 97
          },
          {
            "text": "            if node.type == \"decision\":",
            "lineNumber": 98
          },
          {
            "text": "                outgoing_count = len(outgoing_edges[node.id])",
            "lineNumber": 99
          },
          {
            "text": "                if outgoing_count == 0:",
            "lineNumber": 100
          },
          {
            "text": "                    # DECISIONãƒãƒ¼ãƒ‰ã«å‡ºå£ãŒãªã„å ´åˆï¼ˆé‡å¤§ãªå•é¡Œï¼‰",
            "lineNumber": 101
          },
          {
            "text": "                    gaps.append(node)",
            "lineNumber": 102
          },
          {
            "text": "                elif outgoing_count == 1:",
            "lineNumber": 103
          },
          {
            "text": "                    # DECISIONãƒãƒ¼ãƒ‰ã«å‡ºå£ãŒ1ã¤ã—ã‹ãªã„å ´åˆï¼ˆé€šå¸¸ã¯2ã¤ä»¥ä¸Šå¿…è¦ï¼‰",
            "lineNumber": 104
          },
          {
            "text": "                    gaps.append(node)",
            "lineNumber": 105
          },
          {
            "text": "        ",
            "lineNumber": 106
          },
          {
            "text": "        # 2. æ¥ç¶šå…ˆ/æ¥ç¶šå…ƒæœªå®šç¾©ãƒãƒ¼ãƒ‰ï¼ˆã‚¨ãƒƒã‚¸ã®target/sourceãŒå­˜åœ¨ã—ãªã„ï¼‰",
            "lineNumber": 107
          },
          {
            "text": "        # é‡è¤‡ã‚’é˜²ããŸã‚ã«æ—¢ã«å‡¦ç†æ¸ˆã¿ã®IDã‚’è¨˜éŒ²",
            "lineNumber": 108
          },
          {
            "text": "        processed_missing_ids = set()",
            "lineNumber": 109
          },
          {
            "text": "        ",
            "lineNumber": 110
          },
          {
            "text": "        for edge in self.edges:",
            "lineNumber": 111
          }
        ]
      },
      "score": 0.23245550692081451
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\tests\\test_schemas.py",
        "range": {
          "startPosition": {
            "line": 31
          },
          "endPosition": {
            "line": 170
          }
        },
        "contents": "class TestFlowchart:\n\n\n    def test_invalid_node_type(self):\n        nodes = [\n            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),\n            Node(id=\"process1\", label=\"å‡¦ç†\", type=\"invalid_type\"),\n            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")\n        ]\n        edges = [Edge(source=\"start\", target=\"process1\")]\n        with pytest.raises(FlowchartValidationError, match=\"ç„¡åŠ¹ãªãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—\"):\n            Flowchart(nodes=nodes, edges=edges)\n\n    def test_invalid_edge_source(self):\n        # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç·©å’Œã«ã‚ˆã‚Šã€ã‚¨ãƒƒã‚¸ã®ç„¡åŠ¹æ€§ã¯è­¦å‘Šã®ã¿ï¼ˆä¾‹å¤–ã¯æŠ•ã’ãªã„ï¼‰\n        # è«–ç†ã®ç©´æ¤œçŸ¥ã§è‡ªå‹•ä¿®æ­£ã•ã‚Œã‚‹\n        nodes = [\n            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),\n            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")\n        ]\n        edges = [Edge(source=\"nonexistent\", target=\"node_end\")]\n        flowchart = Flowchart(nodes=nodes, edges=edges)\n        # è­¦å‘Šã¯å‡ºã‚‹ãŒã€Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ä½œæˆã•ã‚Œã‚‹\n        assert len(flowchart.nodes) == 2\n        assert len(flowchart.edges) == 1\n\n    def test_invalid_edge_target(self):\n        # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç·©å’Œã«ã‚ˆã‚Šã€ã‚¨ãƒƒã‚¸ã®ç„¡åŠ¹æ€§ã¯è­¦å‘Šã®ã¿ï¼ˆä¾‹å¤–ã¯æŠ•ã’ãªã„ï¼‰\n        # è«–ç†ã®ç©´æ¤œçŸ¥ã§è‡ªå‹•ä¿®æ­£ã•ã‚Œã‚‹\n        nodes = [\n            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),\n            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")\n        ]\n        edges = [Edge(source=\"start\", target=\"nonexistent\")]\n        flowchart = Flowchart(nodes=nodes, edges=edges)\n        # è­¦å‘Šã¯å‡ºã‚‹ãŒã€Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ä½œæˆã•ã‚Œã‚‹\n        assert len(flowchart.nodes) == 2\n        assert len(flowchart.edges) == 1\n\n    def test_detect_logic_gaps_decision_no_outgoing(self):\n        nodes =",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 32,
                "column": 1
              },
              "endPosition": {
                "line": 33,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class TestFlowchart:",
            "lineNumber": 32,
            "isSignature": true
          },
          {
            "lineNumber": 74
          },
          {
            "lineNumber": 75
          },
          {
            "text": "    def test_invalid_node_type(self):",
            "lineNumber": 76
          },
          {
            "text": "        nodes = [",
            "lineNumber": 77
          },
          {
            "text": "            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),",
            "lineNumber": 78
          },
          {
            "text": "            Node(id=\"process1\", label=\"å‡¦ç†\", type=\"invalid_type\"),",
            "lineNumber": 79
          },
          {
            "text": "            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")",
            "lineNumber": 80
          },
          {
            "text": "        ]",
            "lineNumber": 81
          },
          {
            "text": "        edges = [Edge(source=\"start\", target=\"process1\")]",
            "lineNumber": 82
          },
          {
            "text": "        with pytest.raises(FlowchartValidationError, match=\"ç„¡åŠ¹ãªãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—\"):",
            "lineNumber": 83
          },
          {
            "text": "            Flowchart(nodes=nodes, edges=edges)",
            "lineNumber": 84
          },
          {
            "lineNumber": 85
          },
          {
            "text": "    def test_invalid_edge_source(self):",
            "lineNumber": 86
          },
          {
            "text": "        # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç·©å’Œã«ã‚ˆã‚Šã€ã‚¨ãƒƒã‚¸ã®ç„¡åŠ¹æ€§ã¯è­¦å‘Šã®ã¿ï¼ˆä¾‹å¤–ã¯æŠ•ã’ãªã„ï¼‰",
            "lineNumber": 87
          },
          {
            "text": "        # è«–ç†ã®ç©´æ¤œçŸ¥ã§è‡ªå‹•ä¿®æ­£ã•ã‚Œã‚‹",
            "lineNumber": 88
          },
          {
            "text": "        nodes = [",
            "lineNumber": 89
          },
          {
            "text": "            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),",
            "lineNumber": 90
          },
          {
            "text": "            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")",
            "lineNumber": 91
          },
          {
            "text": "        ]",
            "lineNumber": 92
          },
          {
            "text": "        edges = [Edge(source=\"nonexistent\", target=\"node_end\")]",
            "lineNumber": 93
          },
          {
            "text": "        flowchart = Flowchart(nodes=nodes, edges=edges)",
            "lineNumber": 94
          },
          {
            "text": "        # è­¦å‘Šã¯å‡ºã‚‹ãŒã€Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ä½œæˆã•ã‚Œã‚‹",
            "lineNumber": 95
          },
          {
            "text": "        assert len(flowchart.nodes) == 2",
            "lineNumber": 96
          },
          {
            "text": "        assert len(flowchart.edges) == 1",
            "lineNumber": 97
          },
          {
            "lineNumber": 98
          },
          {
            "text": "    def test_invalid_edge_target(self):",
            "lineNumber": 99
          },
          {
            "text": "        # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç·©å’Œã«ã‚ˆã‚Šã€ã‚¨ãƒƒã‚¸ã®ç„¡åŠ¹æ€§ã¯è­¦å‘Šã®ã¿ï¼ˆä¾‹å¤–ã¯æŠ•ã’ãªã„ï¼‰",
            "lineNumber": 100
          },
          {
            "text": "        # è«–ç†ã®ç©´æ¤œçŸ¥ã§è‡ªå‹•ä¿®æ­£ã•ã‚Œã‚‹",
            "lineNumber": 101
          },
          {
            "text": "        nodes = [",
            "lineNumber": 102
          },
          {
            "text": "            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),",
            "lineNumber": 103
          },
          {
            "text": "            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")",
            "lineNumber": 104
          },
          {
            "text": "        ]",
            "lineNumber": 105
          },
          {
            "text": "        edges = [Edge(source=\"start\", target=\"nonexistent\")]",
            "lineNumber": 106
          },
          {
            "text": "        flowchart = Flowchart(nodes=nodes, edges=edges)",
            "lineNumber": 107
          },
          {
            "text": "        # è­¦å‘Šã¯å‡ºã‚‹ãŒã€Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ä½œæˆã•ã‚Œã‚‹",
            "lineNumber": 108
          },
          {
            "text": "        assert len(flowchart.nodes) == 2",
            "lineNumber": 109
          },
          {
            "text": "        assert len(flowchart.edges) == 1",
            "lineNumber": 110
          },
          {
            "lineNumber": 111
          },
          {
            "text": "    def test_detect_logic_gaps_decision_no_outgoing(self):",
            "lineNumber": 112
          },
          {
            "text": "        nodes =",
            "lineNumber": 113
          }
        ]
      },
      "score": 0.22718949615955353
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\mermaid_parser.py",
        "range": {
          "startPosition": {
            "line": 5
          },
          "endPosition": {
            "line": 178
          }
        },
        "contents": "class MermaidParser:\n@staticmethod\ndef parse(mermaid_text: str) -&gt; Flowchart:\n\n            \n            # ã‚¨ãƒƒã‚¸å®šç¾©: source--&gt;target ã¾ãŸã¯ source--&gt;|\"label\"|target\n            edge_patterns = [\n                r'(\\w+)\\s*--&gt;\\s*\\|\\s*[\"\\']([^\"\\']+)[\"\\']\\s*\\|\\s*(\\w+)',  # source--&gt;|\"label\"|target\n                r'(\\w+)\\s*--&gt;\\s*(\\w+)',                                   # source--&gt;target\n            ]\n            \n            for pattern in edge_patterns:\n                edge_match = re.match(pattern, line)\n                if edge_match:\n                    source_id = edge_match.group(1)\n                    if len(edge_match.groups()) == 3:\n                        label = edge_match.group(2)\n                        target_id = edge_match.group(3)\n                    else:\n                        label = None\n                        target_id = edge_match.group(2)\n                    \n                    # IDãŒ'end'ã®å ´åˆã¯'node_end'ã«å¤‰æ›\n                    safe_source = \"node_end\" if source_id.lower() == \"end\" else source_id\n                    safe_target = \"node_end\" if target_id.lower() == \"end\" else target_id\n                    \n                    edges.append(Edge(\n                        source=safe_source,\n                        target=safe_target,\n                        label=label.strip() if label else None\n                    ))\n                    break\n        \n        # ãƒãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼\n        if not nodes:\n            raise TOONParseError(f\"Mermaidå½¢å¼ã®ãƒãƒ¼ãƒ‰ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚å†…å®¹ï¼š\\n{mermaid_text[:200]}...\")\n        \n        # startãƒãƒ¼ãƒ‰ã¨endãƒãƒ¼ãƒ‰ã®å­˜åœ¨ç¢ºèª\n        node_types = {node.type for node in nodes}\n        if \"start\" not in node_types:\n            # startãƒãƒ¼ãƒ‰ãŒãªã„å ´åˆã€æœ€åˆã®ãƒãƒ¼ãƒ‰ã‚’startã«è¨­å®š\n            if nodes:\n                nodes[0].type = \"start\"\n        \n        if \"end\" not in node_types:",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 6,
                "column": 1
              },
              "endPosition": {
                "line": 7,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 9,
                "column": 5
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 10,
                "column": 5
              },
              "endPosition": {
                "line": 11,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class MermaidParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 9
          },
          {
            "text": "def parse(mermaid_text: str) -&gt; Flowchart:",
            "lineNumber": 10
          },
          {
            "lineNumber": 101
          },
          {
            "text": "            ",
            "lineNumber": 102
          },
          {
            "text": "            # ã‚¨ãƒƒã‚¸å®šç¾©: source--&gt;target ã¾ãŸã¯ source--&gt;|\"label\"|target",
            "lineNumber": 103
          },
          {
            "text": "            edge_patterns = [",
            "lineNumber": 104
          },
          {
            "text": "                r'(\\w+)\\s*--&gt;\\s*\\|\\s*[\"\\']([^\"\\']+)[\"\\']\\s*\\|\\s*(\\w+)',  # source--&gt;|\"label\"|target",
            "lineNumber": 105
          },
          {
            "text": "                r'(\\w+)\\s*--&gt;\\s*(\\w+)',                                   # source--&gt;target",
            "lineNumber": 106
          },
          {
            "text": "            ]",
            "lineNumber": 107
          },
          {
            "text": "            ",
            "lineNumber": 108
          },
          {
            "text": "            for pattern in edge_patterns:",
            "lineNumber": 109
          },
          {
            "text": "                edge_match = re.match(pattern, line)",
            "lineNumber": 110
          },
          {
            "text": "                if edge_match:",
            "lineNumber": 111
          },
          {
            "text": "                    source_id = edge_match.group(1)",
            "lineNumber": 112
          },
          {
            "text": "                    if len(edge_match.groups()) == 3:",
            "lineNumber": 113
          },
          {
            "text": "                        label = edge_match.group(2)",
            "lineNumber": 114
          },
          {
            "text": "                        target_id = edge_match.group(3)",
            "lineNumber": 115
          },
          {
            "text": "                    else:",
            "lineNumber": 116
          },
          {
            "text": "                        label = None",
            "lineNumber": 117
          },
          {
            "text": "                        target_id = edge_match.group(2)",
            "lineNumber": 118
          },
          {
            "text": "                    ",
            "lineNumber": 119
          },
          {
            "text": "                    # IDãŒ'end'ã®å ´åˆã¯'node_end'ã«å¤‰æ›",
            "lineNumber": 120
          },
          {
            "text": "                    safe_source = \"node_end\" if source_id.lower() == \"end\" else source_id",
            "lineNumber": 121
          },
          {
            "text": "                    safe_target = \"node_end\" if target_id.lower() == \"end\" else target_id",
            "lineNumber": 122
          },
          {
            "text": "                    ",
            "lineNumber": 123
          },
          {
            "text": "                    edges.append(Edge(",
            "lineNumber": 124
          },
          {
            "text": "                        source=safe_source,",
            "lineNumber": 125
          },
          {
            "text": "                        target=safe_target,",
            "lineNumber": 126
          },
          {
            "text": "                        label=label.strip() if label else None",
            "lineNumber": 127
          },
          {
            "text": "                    ))",
            "lineNumber": 128
          },
          {
            "text": "                    break",
            "lineNumber": 129
          },
          {
            "text": "        ",
            "lineNumber": 130
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼",
            "lineNumber": 131
          },
          {
            "text": "        if not nodes:",
            "lineNumber": 132
          },
          {
            "text": "            raise TOONParseError(f\"Mermaidå½¢å¼ã®ãƒãƒ¼ãƒ‰ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚å†…å®¹ï¼š\\n{mermaid_text[:200]}...\")",
            "lineNumber": 133
          },
          {
            "text": "        ",
            "lineNumber": 134
          },
          {
            "text": "        # startãƒãƒ¼ãƒ‰ã¨endãƒãƒ¼ãƒ‰ã®å­˜åœ¨ç¢ºèª",
            "lineNumber": 135
          },
          {
            "text": "        node_types = {node.type for node in nodes}",
            "lineNumber": 136
          },
          {
            "text": "        if \"start\" not in node_types:",
            "lineNumber": 137
          },
          {
            "text": "            # startãƒãƒ¼ãƒ‰ãŒãªã„å ´åˆã€æœ€åˆã®ãƒãƒ¼ãƒ‰ã‚’startã«è¨­å®š",
            "lineNumber": 138
          },
          {
            "text": "            if nodes:",
            "lineNumber": 139
          },
          {
            "text": "                nodes[0].type = \"start\"",
            "lineNumber": 140
          },
          {
            "text": "        ",
            "lineNumber": 141
          },
          {
            "text": "        if \"end\" not in node_types:",
            "lineNumber": 142
          }
        ]
      },
      "score": 0.22488903999328613
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\tests\\test_history_mgr.py",
        "range": {
          "startPosition": {
            "line": 9
          },
          "endPosition": {
            "line": 150
          }
        },
        "contents": "class TestHistoryManager:\n\n\n    def test_append_toon_log_add_node(self, history_mgr, sample_flowchart):\n        session_id = \"add_node_session\"\n        history_mgr.save_toon_file(session_id, sample_flowchart)\n        \n        # æ–°ã—ã„ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ \n        new_flowchart = Flowchart(\n            nodes=[\n                Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),\n                Node(id=\"process1\", label=\"å‡¦ç†\", type=\"process\"),\n                Node(id=\"process2\", label=\"å‡¦ç†2\", type=\"process\"),  # æ–°è¦\n                Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")\n            ],\n            edges=[\n                Edge(source=\"start\", target=\"process1\"),\n                Edge(source=\"process1\", target=\"process2\"),\n                Edge(source=\"process2\", target=\"node_end\")\n            ]\n        )\n        \n        result = history_mgr.append_toon_log(session_id, new_flowchart)\n        assert len(result.nodes) == 4\n        assert any(node.id == \"process2\" for node in result.nodes)\n\n    def test_append_toon_log_update_edge(self, history_mgr, sample_flowchart):\n        ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 10,
                "column": 1
              },
              "endPosition": {
                "line": 11,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class TestHistoryManager:",
            "lineNumber": 10,
            "isSignature": true
          },
          {
            "lineNumber": 103
          },
          {
            "lineNumber": 104
          },
          {
            "text": "    def test_append_toon_log_add_node(self, history_mgr, sample_flowchart):",
            "lineNumber": 105
          },
          {
            "text": "        session_id = \"add_node_session\"",
            "lineNumber": 106
          },
          {
            "text": "        history_mgr.save_toon_file(session_id, sample_flowchart)",
            "lineNumber": 107
          },
          {
            "text": "        ",
            "lineNumber": 108
          },
          {
            "text": "        # æ–°ã—ã„ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ",
            "lineNumber": 109
          },
          {
            "text": "        new_flowchart = Flowchart(",
            "lineNumber": 110
          },
          {
            "text": "            nodes=[",
            "lineNumber": 111
          },
          {
            "text": "                Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),",
            "lineNumber": 112
          },
          {
            "text": "                Node(id=\"process1\", label=\"å‡¦ç†\", type=\"process\"),",
            "lineNumber": 113
          },
          {
            "text": "                Node(id=\"process2\", label=\"å‡¦ç†2\", type=\"process\"),  # æ–°è¦",
            "lineNumber": 114
          },
          {
            "text": "                Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")",
            "lineNumber": 115
          },
          {
            "text": "            ],",
            "lineNumber": 116
          },
          {
            "text": "            edges=[",
            "lineNumber": 117
          },
          {
            "text": "                Edge(source=\"start\", target=\"process1\"),",
            "lineNumber": 118
          },
          {
            "text": "                Edge(source=\"process1\", target=\"process2\"),",
            "lineNumber": 119
          },
          {
            "text": "                Edge(source=\"process2\", target=\"node_end\")",
            "lineNumber": 120
          },
          {
            "text": "            ]",
            "lineNumber": 121
          },
          {
            "text": "        )",
            "lineNumber": 122
          },
          {
            "text": "        ",
            "lineNumber": 123
          },
          {
            "text": "        result = history_mgr.append_toon_log(session_id, new_flowchart)",
            "lineNumber": 124
          },
          {
            "text": "        assert len(result.nodes) == 4",
            "lineNumber": 125
          },
          {
            "text": "        assert any(node.id == \"process2\" for node in result.nodes)",
            "lineNumber": 126
          },
          {
            "lineNumber": 127
          },
          {
            "text": "    def test_append_toon_log_update_edge(self, history_mgr, sample_flowchart):",
            "lineNumber": 128
          },
          {
            "text": "        ",
            "lineNumber": 129
          }
        ]
      },
      "score": 0.21902954578399658
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\storage\\sessions\\default_session.json",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 24,
            "column": 1
          }
        },
        "contents": "[\n    {\n        \"nodes\": [\n            {\n                \"id\": \"start\",\n                \"label\": \"é–‹å§‹\",\n                \"type\": \"start\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"node_end\",\n                \"label\": \"çµ‚äº†\",\n                \"type\": \"end\",\n                \"status\": \"active\"\n            }\n        ],\n        \"edges\": [\n            {\n                \"source\": \"start\",\n                \"target\": \"node_end\",\n                \"label\": null\n            }\n        ]\n    }\n]",
        "signatures": {},
        "detailedLines": [
          {
            "text": "[",
            "lineNumber": 1
          },
          {
            "text": "    {",
            "lineNumber": 2
          },
          {
            "text": "        \"nodes\": [",
            "lineNumber": 3
          },
          {
            "text": "            {",
            "lineNumber": 4
          },
          {
            "text": "                \"id\": \"start\",",
            "lineNumber": 5
          },
          {
            "text": "                \"label\": \"é–‹å§‹\",",
            "lineNumber": 6
          },
          {
            "text": "                \"type\": \"start\",",
            "lineNumber": 7
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 8
          },
          {
            "text": "            },",
            "lineNumber": 9
          },
          {
            "text": "            {",
            "lineNumber": 10
          },
          {
            "text": "                \"id\": \"node_end\",",
            "lineNumber": 11
          },
          {
            "text": "                \"label\": \"çµ‚äº†\",",
            "lineNumber": 12
          },
          {
            "text": "                \"type\": \"end\",",
            "lineNumber": 13
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 14
          },
          {
            "text": "            }",
            "lineNumber": 15
          },
          {
            "text": "        ],",
            "lineNumber": 16
          },
          {
            "text": "        \"edges\": [",
            "lineNumber": 17
          },
          {
            "text": "            {",
            "lineNumber": 18
          },
          {
            "text": "                \"source\": \"start\",",
            "lineNumber": 19
          },
          {
            "text": "                \"target\": \"node_end\",",
            "lineNumber": 20
          },
          {
            "text": "                \"label\": null",
            "lineNumber": 21
          },
          {
            "text": "            }",
            "lineNumber": 22
          },
          {
            "text": "        ]",
            "lineNumber": 23
          },
          {
            "text": "    }",
            "lineNumber": 24
          },
          {
            "text": "]",
            "lineNumber": 25
          }
        ]
      },
      "score": 0.21775126457214355
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\storage\\toon_files\\flow_md.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 47
          }
        },
        "contents": "&#96;&#96;&#96;mermaid\ngraph TD\n    start[\"é–‹å§‹\"]\n    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]\n    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]\n    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]\n    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}\n    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}\n    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]\n    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]\n    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]\n    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]\n    task10[\"æµå‹•ã«æˆ»ã™\"]\n    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}\n    node_end[\"çµ‚äº†\"]\n    \n    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼\n    start--&gt;task1\n    task1--&gt;task2\n    task2--&gt;decision1\n    \n    %% å†ç¾ã—ãªã„å ´åˆ\n    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10\n    task10--&gt;decision_recurrence\n    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1\n    \n    %% å†ç¾ã™ã‚‹å ´åˆ\n    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3\n    task3--&gt;decision2\n    \n    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²\n    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4\n    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8\n    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9\n    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other\n    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "&#96;&#96;&#96;mermaid",
            "lineNumber": 1
          },
          {
            "text": "graph TD",
            "lineNumber": 2
          },
          {
            "text": "    start[\"é–‹å§‹\"]",
            "lineNumber": 3
          },
          {
            "text": "    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]",
            "lineNumber": 4
          },
          {
            "text": "    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]",
            "lineNumber": 5
          },
          {
            "text": "    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 6
          },
          {
            "text": "    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]",
            "lineNumber": 7
          },
          {
            "text": "    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}",
            "lineNumber": 8
          },
          {
            "text": "    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 9
          },
          {
            "text": "    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}",
            "lineNumber": 10
          },
          {
            "text": "    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 11
          },
          {
            "text": "    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 12
          },
          {
            "text": "    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]",
            "lineNumber": 13
          },
          {
            "text": "    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]",
            "lineNumber": 14
          },
          {
            "text": "    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]",
            "lineNumber": 15
          },
          {
            "text": "    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]",
            "lineNumber": 16
          },
          {
            "text": "    task10[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 17
          },
          {
            "text": "    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}",
            "lineNumber": 18
          },
          {
            "text": "    node_end[\"çµ‚äº†\"]",
            "lineNumber": 19
          },
          {
            "text": "    ",
            "lineNumber": 20
          },
          {
            "text": "    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 21
          },
          {
            "text": "    start--&gt;task1",
            "lineNumber": 22
          },
          {
            "text": "    task1--&gt;task2",
            "lineNumber": 23
          },
          {
            "text": "    task2--&gt;decision1",
            "lineNumber": 24
          },
          {
            "text": "    ",
            "lineNumber": 25
          },
          {
            "text": "    %% å†ç¾ã—ãªã„å ´åˆ",
            "lineNumber": 26
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 27
          },
          {
            "text": "    task10--&gt;decision_recurrence",
            "lineNumber": 28
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end",
            "lineNumber": 29
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1",
            "lineNumber": 30
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2",
            "lineNumber": 31
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3",
            "lineNumber": 32
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4",
            "lineNumber": 33
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1",
            "lineNumber": 34
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1",
            "lineNumber": 35
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1",
            "lineNumber": 36
          },
          {
            "text": "    ",
            "lineNumber": 37
          },
          {
            "text": "    %% å†ç¾ã™ã‚‹å ´åˆ",
            "lineNumber": 38
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3",
            "lineNumber": 39
          },
          {
            "text": "    task3--&gt;decision2",
            "lineNumber": 40
          },
          {
            "text": "    ",
            "lineNumber": 41
          },
          {
            "text": "    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²",
            "lineNumber": 42
          },
          {
            "text": "    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4",
            "lineNumber": 43
          },
          {
            "text": "    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8",
            "lineNumber": 44
          },
          {
            "text": "    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9",
            "lineNumber": 45
          },
          {
            "text": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other",
            "lineNumber": 46
          },
          {
            "text": "    ",
            "lineNumber": 47
          }
        ]
      },
      "score": 0.21718484163284302
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªæ¸ˆã¿ã€‚åˆ†å²ã‚„ãƒ•ãƒ­ãƒ¼ã‚’ç›´æ¥æŒ‡å®šã—ã¦å¤‰æ›´ã™ã‚‹æ©Ÿèƒ½ã®å®Ÿè£…è¨ˆç”»ã‚’ä½œæˆã—ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: app.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/schemas.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "How are nodes selected or identified in the flowchart display?",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\mermaid_parser.py",
        "range": {
          "startPosition": {
            "line": 5
          },
          "endPosition": {
            "line": 178
          }
        },
        "contents": "class MermaidParser:\n@staticmethod\ndef parse(mermaid_text: str) -&gt; Flowchart:\n\n            for pattern in node_patterns:\n                node_match = re.match(pattern, line)\n                if node_match:\n                    node_id = node_match.group(1)\n                    label = node_match.group(2)\n                    \n                    # å½¢çŠ¶ã‹ã‚‰ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š\n                    if '{' in line and '}' in line:\n                        node_type = \"decision\"\n                    elif '(' in line and ')' in line:\n                        # ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ã¾ãŸã¯å††ç­’å½¢\n                        if node_id == \"start\" or (not nodes and node_id != \"node_end\"):\n                            node_type = \"start\"\n                        elif node_id == \"node_end\" or node_id.endswith(\"_end\"):\n                            node_type = \"end\"\n                        else:\n                            node_type = \"process\"\n                    elif '/' in line:\n                        node_type = \"io_data\"\n                    else:\n                        node_type = \"process\"\n                    \n                    # IDãŒ'end'ã®å ´åˆã¯'node_end'ã«å¤‰æ›\n                    safe_id = \"node_end\" if node_id.lower() == \"end\" else node_id\n                    \n                    # æ—¢ã«å­˜åœ¨ã™ã‚‹ãƒãƒ¼ãƒ‰ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆé‡è¤‡ã‚’é˜²ãï¼‰\n                    if safe_id not in [n.id for n in nodes]:\n                        node = Node(\n                            id=safe_id,\n                            label=label.strip(),\n                            type=node_type,\n                            status=NodeStatus.ACTIVE\n                        )\n                        nodes.append(node)\n                        node_map[node_id] = node\n                    node_found = True\n                    break\n            \n            if node_found:\n                continue\n            \n            # ã‚¨ãƒƒã‚¸å®šç¾©: source--&gt;target ã¾ãŸã¯ source--&gt;|\"label\"|target",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 6,
                "column": 1
              },
              "endPosition": {
                "line": 7,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 9,
                "column": 5
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 10,
                "column": 5
              },
              "endPosition": {
                "line": 11,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class MermaidParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 9
          },
          {
            "text": "def parse(mermaid_text: str) -&gt; Flowchart:",
            "lineNumber": 10
          },
          {
            "lineNumber": 61
          },
          {
            "text": "            for pattern in node_patterns:",
            "lineNumber": 62
          },
          {
            "text": "                node_match = re.match(pattern, line)",
            "lineNumber": 63
          },
          {
            "text": "                if node_match:",
            "lineNumber": 64
          },
          {
            "text": "                    node_id = node_match.group(1)",
            "lineNumber": 65
          },
          {
            "text": "                    label = node_match.group(2)",
            "lineNumber": 66
          },
          {
            "text": "                    ",
            "lineNumber": 67
          },
          {
            "text": "                    # å½¢çŠ¶ã‹ã‚‰ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š",
            "lineNumber": 68
          },
          {
            "text": "                    if '{' in line and '}' in line:",
            "lineNumber": 69
          },
          {
            "text": "                        node_type = \"decision\"",
            "lineNumber": 70
          },
          {
            "text": "                    elif '(' in line and ')' in line:",
            "lineNumber": 71
          },
          {
            "text": "                        # ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ã¾ãŸã¯å††ç­’å½¢",
            "lineNumber": 72
          },
          {
            "text": "                        if node_id == \"start\" or (not nodes and node_id != \"node_end\"):",
            "lineNumber": 73
          },
          {
            "text": "                            node_type = \"start\"",
            "lineNumber": 74
          },
          {
            "text": "                        elif node_id == \"node_end\" or node_id.endswith(\"_end\"):",
            "lineNumber": 75
          },
          {
            "text": "                            node_type = \"end\"",
            "lineNumber": 76
          },
          {
            "text": "                        else:",
            "lineNumber": 77
          },
          {
            "text": "                            node_type = \"process\"",
            "lineNumber": 78
          },
          {
            "text": "                    elif '/' in line:",
            "lineNumber": 79
          },
          {
            "text": "                        node_type = \"io_data\"",
            "lineNumber": 80
          },
          {
            "text": "                    else:",
            "lineNumber": 81
          },
          {
            "text": "                        node_type = \"process\"",
            "lineNumber": 82
          },
          {
            "text": "                    ",
            "lineNumber": 83
          },
          {
            "text": "                    # IDãŒ'end'ã®å ´åˆã¯'node_end'ã«å¤‰æ›",
            "lineNumber": 84
          },
          {
            "text": "                    safe_id = \"node_end\" if node_id.lower() == \"end\" else node_id",
            "lineNumber": 85
          },
          {
            "text": "                    ",
            "lineNumber": 86
          },
          {
            "text": "                    # æ—¢ã«å­˜åœ¨ã™ã‚‹ãƒãƒ¼ãƒ‰ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆé‡è¤‡ã‚’é˜²ãï¼‰",
            "lineNumber": 87
          },
          {
            "text": "                    if safe_id not in [n.id for n in nodes]:",
            "lineNumber": 88
          },
          {
            "text": "                        node = Node(",
            "lineNumber": 89
          },
          {
            "text": "                            id=safe_id,",
            "lineNumber": 90
          },
          {
            "text": "                            label=label.strip(),",
            "lineNumber": 91
          },
          {
            "text": "                            type=node_type,",
            "lineNumber": 92
          },
          {
            "text": "                            status=NodeStatus.ACTIVE",
            "lineNumber": 93
          },
          {
            "text": "                        )",
            "lineNumber": 94
          },
          {
            "text": "                        nodes.append(node)",
            "lineNumber": 95
          },
          {
            "text": "                        node_map[node_id] = node",
            "lineNumber": 96
          },
          {
            "text": "                    node_found = True",
            "lineNumber": 97
          },
          {
            "text": "                    break",
            "lineNumber": 98
          },
          {
            "text": "            ",
            "lineNumber": 99
          },
          {
            "text": "            if node_found:",
            "lineNumber": 100
          },
          {
            "text": "                continue",
            "lineNumber": 101
          },
          {
            "text": "            ",
            "lineNumber": 102
          },
          {
            "text": "            # ã‚¨ãƒƒã‚¸å®šç¾©: source--&gt;target ã¾ãŸã¯ source--&gt;|\"label\"|target",
            "lineNumber": 103
          }
        ]
      },
      "score": 0.3528350591659546
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 24
          },
          "endPosition": {
            "line": 336
          }
        },
        "contents": "class Flowchart(BaseModel):\ndef detect_logic_gaps(self) -&gt; List[Node]:\n\n        \n        return gaps\n\n    def apply_logic_gap_detection(self) -&gt; 'Flowchart':\n        \"\"\"è«–ç†ã®ç©´ã‚’æ¤œå‡ºã—ã€MISSINGãƒãƒ¼ãƒ‰ã¨ã—ã¦è¿½åŠ \"\"\"\n        gaps = self.detect_logic_gaps()\n        \n        if not gaps:\n            return self\n        \n        # æ—¢å­˜ã®ãƒãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼\n        new_nodes = [Node(**node.model_dump()) for node in self.nodes]\n        new_edges = [Edge(**edge.model_dump()) for edge in self.edges]\n        \n        # ã‚®ãƒ£ãƒƒãƒ—ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã¾ãŸã¯æ›´æ–°\n        existing_ids = {node.id for node in new_nodes}\n        for gap in gaps:\n            if gap.id not in existing_ids:\n                new_nodes.append(gap)\n            else:\n                # æ—¢å­˜ãƒãƒ¼ãƒ‰ã‚’MISSINGã¨ã—ã¦æ›´æ–°\n                for i, node in enumerate(new_nodes):\n                    if node.id == gap.id:\n                        new_nodes[i] = Node(\n                            id=node.id,\n                            label=node.label,\n                            type=\"missing\",\n                            status=NodeStatus.MISSING,\n                            subgraph_id=node.subgraph_id\n                        )\n                        break\n        \n        return Flowchart(nodes=new_nodes, edges=new_edges, subgraphs=self.subgraphs)\n\n    @staticmethod\n    def _get_node_shape(node_type: str) -&gt; str:\n        \"\"\"ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸMermaidå½¢çŠ¶ã‚’è¿”ã™\"\"\"\n        shape_map = {\n            \"start\": \"([ ])\",\n            \"end\": \"([ ])\",\n            \"process\": \"[ ]\",\n            \"decision\": \"{ }\",\n            \"io_data\": \"[/ /]\",\n            \"storage\": \"[( )]\",\n            \"missing\": \"{{ }}\"\n        }\n        return shape_map.get(node_type.lower(), \"{{ }}\")  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯MISSING\n\n    @staticmethod\n    def _get_status_color(status: NodeStatus) -&gt; str:\n        ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 25,
                "column": 1
              },
              "endPosition": {
                "line": 26,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 25,
            "isSignature": true
          },
          {
            "text": "def detect_logic_gaps(self) -&gt; List[Node]:",
            "lineNumber": 77
          },
          {
            "lineNumber": 143
          },
          {
            "text": "        ",
            "lineNumber": 144
          },
          {
            "text": "        return gaps",
            "lineNumber": 145
          },
          {
            "lineNumber": 146
          },
          {
            "text": "    def apply_logic_gap_detection(self) -&gt; 'Flowchart':",
            "lineNumber": 147
          },
          {
            "text": "        \"\"\"è«–ç†ã®ç©´ã‚’æ¤œå‡ºã—ã€MISSINGãƒãƒ¼ãƒ‰ã¨ã—ã¦è¿½åŠ \"\"\"",
            "lineNumber": 148
          },
          {
            "text": "        gaps = self.detect_logic_gaps()",
            "lineNumber": 149
          },
          {
            "text": "        ",
            "lineNumber": 150
          },
          {
            "text": "        if not gaps:",
            "lineNumber": 151
          },
          {
            "text": "            return self",
            "lineNumber": 152
          },
          {
            "text": "        ",
            "lineNumber": 153
          },
          {
            "text": "        # æ—¢å­˜ã®ãƒãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼",
            "lineNumber": 154
          },
          {
            "text": "        new_nodes = [Node(**node.model_dump()) for node in self.nodes]",
            "lineNumber": 155
          },
          {
            "text": "        new_edges = [Edge(**edge.model_dump()) for edge in self.edges]",
            "lineNumber": 156
          },
          {
            "text": "        ",
            "lineNumber": 157
          },
          {
            "text": "        # ã‚®ãƒ£ãƒƒãƒ—ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã¾ãŸã¯æ›´æ–°",
            "lineNumber": 158
          },
          {
            "text": "        existing_ids = {node.id for node in new_nodes}",
            "lineNumber": 159
          },
          {
            "text": "        for gap in gaps:",
            "lineNumber": 160
          },
          {
            "text": "            if gap.id not in existing_ids:",
            "lineNumber": 161
          },
          {
            "text": "                new_nodes.append(gap)",
            "lineNumber": 162
          },
          {
            "text": "            else:",
            "lineNumber": 163
          },
          {
            "text": "                # æ—¢å­˜ãƒãƒ¼ãƒ‰ã‚’MISSINGã¨ã—ã¦æ›´æ–°",
            "lineNumber": 164
          },
          {
            "text": "                for i, node in enumerate(new_nodes):",
            "lineNumber": 165
          },
          {
            "text": "                    if node.id == gap.id:",
            "lineNumber": 166
          },
          {
            "text": "                        new_nodes[i] = Node(",
            "lineNumber": 167
          },
          {
            "text": "                            id=node.id,",
            "lineNumber": 168
          },
          {
            "text": "                            label=node.label,",
            "lineNumber": 169
          },
          {
            "text": "                            type=\"missing\",",
            "lineNumber": 170
          },
          {
            "text": "                            status=NodeStatus.MISSING,",
            "lineNumber": 171
          },
          {
            "text": "                            subgraph_id=node.subgraph_id",
            "lineNumber": 172
          },
          {
            "text": "                        )",
            "lineNumber": 173
          },
          {
            "text": "                        break",
            "lineNumber": 174
          },
          {
            "text": "        ",
            "lineNumber": 175
          },
          {
            "text": "        return Flowchart(nodes=new_nodes, edges=new_edges, subgraphs=self.subgraphs)",
            "lineNumber": 176
          },
          {
            "lineNumber": 177
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 178
          },
          {
            "text": "    def _get_node_shape(node_type: str) -&gt; str:",
            "lineNumber": 179
          },
          {
            "text": "        \"\"\"ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸMermaidå½¢çŠ¶ã‚’è¿”ã™\"\"\"",
            "lineNumber": 180
          },
          {
            "text": "        shape_map = {",
            "lineNumber": 181
          },
          {
            "text": "            \"start\": \"([ ])\",",
            "lineNumber": 182
          },
          {
            "text": "            \"end\": \"([ ])\",",
            "lineNumber": 183
          },
          {
            "text": "            \"process\": \"[ ]\",",
            "lineNumber": 184
          },
          {
            "text": "            \"decision\": \"{ }\",",
            "lineNumber": 185
          },
          {
            "text": "            \"io_data\": \"[/ /]\",",
            "lineNumber": 186
          },
          {
            "text": "            \"storage\": \"[( )]\",",
            "lineNumber": 187
          },
          {
            "text": "            \"missing\": \"{{ }}\"",
            "lineNumber": 188
          },
          {
            "text": "        }",
            "lineNumber": 189
          },
          {
            "text": "        return shape_map.get(node_type.lower(), \"{{ }}\")  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯MISSING",
            "lineNumber": 190
          },
          {
            "lineNumber": 191
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 192
          },
          {
            "text": "    def _get_status_color(status: NodeStatus) -&gt; str:",
            "lineNumber": 193
          },
          {
            "text": "        ",
            "lineNumber": 194
          }
        ]
      },
      "score": 0.3379206657409668
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 22,
            "column": 31
          },
          "endPosition": {
            "line": 336
          }
        },
        "contents": "class Flowchart(BaseModel):\n    nodes: List[Node]\n    edges: List[Edge]\n    subgraphs: Optional[Dict[str, str]] = None  # {subgraph_id: subgraph_label} ã®ãƒãƒƒãƒ”ãƒ³ã‚°\n\n    @field_validator('nodes')\n    @classmethod\n    def validate_flow_structure(cls, v: List[Node]) -&gt; List[Node]:\n        if not v:\n            raise FlowchartValidationError(\"ãƒãƒ¼ãƒ‰ãŒ1ã¤ã‚‚å­˜åœ¨ã—ã¾ã›ã‚“\")\n        \n        # é–‹å§‹/çµ‚äº†ãƒãƒ¼ãƒ‰ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯\n        types = {node.type for node in v}\n        if \"start\" not in types or \"end\" not in types:\n            raise FlowchartValidationError(\"é–‹å§‹/çµ‚äº†ãƒãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™\")\n        \n        # ãƒãƒ¼ãƒ‰IDã®é‡è¤‡ãƒã‚§ãƒƒã‚¯\n        node_ids = [node.id for node in v]\n        duplicates = [node_id for node_id in node_ids if node_ids.count(node_id) &gt; 1]\n        if duplicates:\n            raise FlowchartValidationError(f\"ãƒãƒ¼ãƒ‰IDãŒé‡è¤‡ã—ã¦ã„ã¾ã™: {set(duplicates)}\")\n        \n        # ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã®æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯\n        valid_types = {\"start\", \"end\", \"process\", \"decision\", \"io_data\", \"storage\", \"missing\"}\n        invalid_types = [node.type for node in v if node.type not in valid_types]\n        if invalid_types:\n            raise FlowchartValidationError(f\"ç„¡åŠ¹ãªãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™: {set(invalid_types)}\")\n        \n        return v\n\n    @model_validator(mode='after')\n    def validate_edges_reference_nodes(self):\n        \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 25,
            "isSignature": true
          },
          {
            "text": "    nodes: List[Node]",
            "lineNumber": 26
          },
          {
            "text": "    edges: List[Edge]",
            "lineNumber": 27
          },
          {
            "text": "    subgraphs: Optional[Dict[str, str]] = None  # {subgraph_id: subgraph_label} ã®ãƒãƒƒãƒ”ãƒ³ã‚°",
            "lineNumber": 28
          },
          {
            "lineNumber": 29
          },
          {
            "text": "    @field_validator('nodes')",
            "lineNumber": 30
          },
          {
            "text": "    @classmethod",
            "lineNumber": 31
          },
          {
            "text": "    def validate_flow_structure(cls, v: List[Node]) -&gt; List[Node]:",
            "lineNumber": 32
          },
          {
            "text": "        if not v:",
            "lineNumber": 33
          },
          {
            "text": "            raise FlowchartValidationError(\"ãƒãƒ¼ãƒ‰ãŒ1ã¤ã‚‚å­˜åœ¨ã—ã¾ã›ã‚“\")",
            "lineNumber": 34
          },
          {
            "text": "        ",
            "lineNumber": 35
          },
          {
            "text": "        # é–‹å§‹/çµ‚äº†ãƒãƒ¼ãƒ‰ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 36
          },
          {
            "text": "        types = {node.type for node in v}",
            "lineNumber": 37
          },
          {
            "text": "        if \"start\" not in types or \"end\" not in types:",
            "lineNumber": 38
          },
          {
            "text": "            raise FlowchartValidationError(\"é–‹å§‹/çµ‚äº†ãƒãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™\")",
            "lineNumber": 39
          },
          {
            "text": "        ",
            "lineNumber": 40
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰IDã®é‡è¤‡ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 41
          },
          {
            "text": "        node_ids = [node.id for node in v]",
            "lineNumber": 42
          },
          {
            "text": "        duplicates = [node_id for node_id in node_ids if node_ids.count(node_id) &gt; 1]",
            "lineNumber": 43
          },
          {
            "text": "        if duplicates:",
            "lineNumber": 44
          },
          {
            "text": "            raise FlowchartValidationError(f\"ãƒãƒ¼ãƒ‰IDãŒé‡è¤‡ã—ã¦ã„ã¾ã™: {set(duplicates)}\")",
            "lineNumber": 45
          },
          {
            "text": "        ",
            "lineNumber": 46
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã®æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 47
          },
          {
            "text": "        valid_types = {\"start\", \"end\", \"process\", \"decision\", \"io_data\", \"storage\", \"missing\"}",
            "lineNumber": 48
          },
          {
            "text": "        invalid_types = [node.type for node in v if node.type not in valid_types]",
            "lineNumber": 49
          },
          {
            "text": "        if invalid_types:",
            "lineNumber": 50
          },
          {
            "text": "            raise FlowchartValidationError(f\"ç„¡åŠ¹ãªãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™: {set(invalid_types)}\")",
            "lineNumber": 51
          },
          {
            "text": "        ",
            "lineNumber": 52
          },
          {
            "text": "        return v",
            "lineNumber": 53
          },
          {
            "lineNumber": 54
          },
          {
            "text": "    @model_validator(mode='after')",
            "lineNumber": 55
          },
          {
            "text": "    def validate_edges_reference_nodes(self):",
            "lineNumber": 56
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 57
          }
        ]
      },
      "score": 0.3177303969860077
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\toon_parser.py",
        "range": {
          "startPosition": {
            "line": 5
          },
          "endPosition": {
            "line": 80
          }
        },
        "contents": "class TOONParser:\n@staticmethod\ndef parse(text: str) -&gt; Flowchart:\n        # Markdownã®è£…é£¾ï¼ˆ&#96;&#96;&#96;toon...&#96;&#96;&#96;ï¼‰ãŒã‚ã‚Œã°é™¤å»\n\n        for block in node_matches:\n            # æ¬¡ã®ã‚¿ã‚°ã®æ‰‹å‰ã¾ã§ã‚’ãƒ‘ãƒ¼ã‚¹\n            data = TOONParser._parse_block(re.split(r'\\[', block)[0])\n            if 'id' in data and 'label' in data:\n                raw_id = data['id'].strip()\n                safe_id = \"node_end\" if raw_id.lower() == \"end\" else raw_id\n                \n                # statusãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®èª­ã¿è¾¼ã¿\n                status = NodeStatus.ACTIVE  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤\n                if 'status' in data:\n                    try:\n                        status = NodeStatus(data['status'].strip().lower())\n                    except ValueError:\n                        # ç„¡åŠ¹ãªstatuså€¤ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨\n                        pass\n                \n                # subgraphãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®èª­ã¿è¾¼ã¿\n                subgraph_id = None\n                if 'subgraph' in data:\n                    subgraph_id = data['subgraph'].strip()\n                \n                nodes.append(Node(\n                    id=safe_id,\n                    label=data['label'].strip(),\n                    type=data.get('type', 'process').strip().lower(),\n                    status=status,\n                    subgraph_id=subgraph_id\n                ))\n\n        # [Edge]ã‚¿ã‚°ã§åˆ†å‰²ã—ã¦æŠ½å‡º\n        edge_matches = re.split(r'\\[Edge\\]', clean_text, flags=re.IGNORECASE)[1:]\n        for block in edge_matches:\n            data = TOONParser._parse_block(re.split(r'\\[', block)[0])\n            if 'source' in data and 'target' in data:\n                src = \"node_end\" if data['source'].strip().lower() == \"end\" else data['source'].strip()\n                tgt = \"node_end\" if data['target'].strip().lower() == \"end\" else data['target'].strip()\n                edges.append(Edge(source=src, target=tgt, label=data.get('label', '').strip() or None))\n\n        # æœ€çµ‚ãƒã‚§ãƒƒã‚¯ï¼šãƒãƒ¼ãƒ‰ãŒç©ºãªã‚‰ã“ã“ã§ä¾‹å¤–ã‚’æŠ•ã’ã¦ app.py ã§ã‚­ãƒ£ãƒƒãƒ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 6,
                "column": 1
              },
              "endPosition": {
                "line": 7,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 7,
                "column": 5
              },
              "endPosition": {
                "line": 8,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 8,
                "column": 5
              },
              "endPosition": {
                "line": 10,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class TOONParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 7
          },
          {
            "text": "def parse(text: str) -&gt; Flowchart:",
            "lineNumber": 8
          },
          {
            "text": "        # Markdownã®è£…é£¾ï¼ˆ&#96;&#96;&#96;toon...&#96;&#96;&#96;ï¼‰ãŒã‚ã‚Œã°é™¤å»",
            "lineNumber": 9
          },
          {
            "lineNumber": 29
          },
          {
            "text": "        for block in node_matches:",
            "lineNumber": 30
          },
          {
            "text": "            # æ¬¡ã®ã‚¿ã‚°ã®æ‰‹å‰ã¾ã§ã‚’ãƒ‘ãƒ¼ã‚¹",
            "lineNumber": 31
          },
          {
            "text": "            data = TOONParser._parse_block(re.split(r'\\[', block)[0])",
            "lineNumber": 32
          },
          {
            "text": "            if 'id' in data and 'label' in data:",
            "lineNumber": 33
          },
          {
            "text": "                raw_id = data['id'].strip()",
            "lineNumber": 34
          },
          {
            "text": "                safe_id = \"node_end\" if raw_id.lower() == \"end\" else raw_id",
            "lineNumber": 35
          },
          {
            "text": "                ",
            "lineNumber": 36
          },
          {
            "text": "                # statusãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®èª­ã¿è¾¼ã¿",
            "lineNumber": 37
          },
          {
            "text": "                status = NodeStatus.ACTIVE  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤",
            "lineNumber": 38
          },
          {
            "text": "                if 'status' in data:",
            "lineNumber": 39
          },
          {
            "text": "                    try:",
            "lineNumber": 40
          },
          {
            "text": "                        status = NodeStatus(data['status'].strip().lower())",
            "lineNumber": 41
          },
          {
            "text": "                    except ValueError:",
            "lineNumber": 42
          },
          {
            "text": "                        # ç„¡åŠ¹ãªstatuså€¤ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨",
            "lineNumber": 43
          },
          {
            "text": "                        pass",
            "lineNumber": 44
          },
          {
            "text": "                ",
            "lineNumber": 45
          },
          {
            "text": "                # subgraphãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®èª­ã¿è¾¼ã¿",
            "lineNumber": 46
          },
          {
            "text": "                subgraph_id = None",
            "lineNumber": 47
          },
          {
            "text": "                if 'subgraph' in data:",
            "lineNumber": 48
          },
          {
            "text": "                    subgraph_id = data['subgraph'].strip()",
            "lineNumber": 49
          },
          {
            "text": "                ",
            "lineNumber": 50
          },
          {
            "text": "                nodes.append(Node(",
            "lineNumber": 51
          },
          {
            "text": "                    id=safe_id,",
            "lineNumber": 52
          },
          {
            "text": "                    label=data['label'].strip(),",
            "lineNumber": 53
          },
          {
            "text": "                    type=data.get('type', 'process').strip().lower(),",
            "lineNumber": 54
          },
          {
            "text": "                    status=status,",
            "lineNumber": 55
          },
          {
            "text": "                    subgraph_id=subgraph_id",
            "lineNumber": 56
          },
          {
            "text": "                ))",
            "lineNumber": 57
          },
          {
            "lineNumber": 58
          },
          {
            "text": "        # [Edge]ã‚¿ã‚°ã§åˆ†å‰²ã—ã¦æŠ½å‡º",
            "lineNumber": 59
          },
          {
            "text": "        edge_matches = re.split(r'\\[Edge\\]', clean_text, flags=re.IGNORECASE)[1:]",
            "lineNumber": 60
          },
          {
            "text": "        for block in edge_matches:",
            "lineNumber": 61
          },
          {
            "text": "            data = TOONParser._parse_block(re.split(r'\\[', block)[0])",
            "lineNumber": 62
          },
          {
            "text": "            if 'source' in data and 'target' in data:",
            "lineNumber": 63
          },
          {
            "text": "                src = \"node_end\" if data['source'].strip().lower() == \"end\" else data['source'].strip()",
            "lineNumber": 64
          },
          {
            "text": "                tgt = \"node_end\" if data['target'].strip().lower() == \"end\" else data['target'].strip()",
            "lineNumber": 65
          },
          {
            "text": "                edges.append(Edge(source=src, target=tgt, label=data.get('label', '').strip() or None))",
            "lineNumber": 66
          },
          {
            "lineNumber": 67
          },
          {
            "text": "        # æœ€çµ‚ãƒã‚§ãƒƒã‚¯ï¼šãƒãƒ¼ãƒ‰ãŒç©ºãªã‚‰ã“ã“ã§ä¾‹å¤–ã‚’æŠ•ã’ã¦ app.py ã§ã‚­ãƒ£ãƒƒãƒ",
            "lineNumber": 68
          }
        ]
      },
      "score": 0.31670019030570984
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 24
          },
          "endPosition": {
            "line": 336
          }
        },
        "contents": "class Flowchart(BaseModel):\ndef detect_logic_gaps(self) -&gt; List[Node]:\n\n        \n        for edge in self.edges:\n            # æ¥ç¶šå…ˆæœªå®šç¾©ãƒãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯\n            if edge.target not in node_ids:\n                missing_id = f\"missing_{edge.target}\"\n                if missing_id not in processed_missing_ids:\n                    missing_node = Node(\n                        id=missing_id,\n                        label=f\"æœªå®šç¾©: {edge.target}\",\n                        type=\"missing\",\n                        status=NodeStatus.MISSING\n                    )\n                    gaps.append(missing_node)\n                    processed_missing_ids.add(missing_id)\n            \n            # æ¥ç¶šå…ƒæœªå®šç¾©ãƒãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯\n            if edge.source not in node_ids:\n                missing_id = f\"missing_{edge.source}\"\n                if missing_id not in processed_missing_ids:\n                    missing_node = Node(\n                        id=missing_id,\n                        label=f\"æœªå®šç¾©: {edge.source}\",\n                        type=\"missing\",\n                        status=NodeStatus.MISSING\n                    )\n                    gaps.append(missing_node)\n                    processed_missing_ids.add(missing_id)\n        \n        # 3. å­¤ç«‹ãƒãƒ¼ãƒ‰ï¼ˆSTART/ENDä»¥å¤–ã§æ¥ç¶šãŒãªã„ï¼‰\n        for node in self.nodes:\n            if node.type not in [\"start\", \"end\"]:\n                if len(outgoing_edges[node.id]) == 0 and len(incoming_edges[node.id]) == 0:\n                    # å­¤ç«‹ã—ã¦ã„ã‚‹ãƒãƒ¼ãƒ‰ã‚’MISSINGã¨ã—ã¦ãƒãƒ¼ã‚¯\n                    gaps.append(node)\n        \n        return gaps\n\n    def apply_logic_gap_detection(self) -&gt; 'Flowchart':\n        ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 25,
                "column": 1
              },
              "endPosition": {
                "line": 26,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 77,
                "column": 5
              },
              "endPosition": {
                "line": 78,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 25,
            "isSignature": true
          },
          {
            "text": "def detect_logic_gaps(self) -&gt; List[Node]:",
            "lineNumber": 77
          },
          {
            "lineNumber": 109
          },
          {
            "text": "        ",
            "lineNumber": 110
          },
          {
            "text": "        for edge in self.edges:",
            "lineNumber": 111
          },
          {
            "text": "            # æ¥ç¶šå…ˆæœªå®šç¾©ãƒãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 112
          },
          {
            "text": "            if edge.target not in node_ids:",
            "lineNumber": 113
          },
          {
            "text": "                missing_id = f\"missing_{edge.target}\"",
            "lineNumber": 114
          },
          {
            "text": "                if missing_id not in processed_missing_ids:",
            "lineNumber": 115
          },
          {
            "text": "                    missing_node = Node(",
            "lineNumber": 116
          },
          {
            "text": "                        id=missing_id,",
            "lineNumber": 117
          },
          {
            "text": "                        label=f\"æœªå®šç¾©: {edge.target}\",",
            "lineNumber": 118
          },
          {
            "text": "                        type=\"missing\",",
            "lineNumber": 119
          },
          {
            "text": "                        status=NodeStatus.MISSING",
            "lineNumber": 120
          },
          {
            "text": "                    )",
            "lineNumber": 121
          },
          {
            "text": "                    gaps.append(missing_node)",
            "lineNumber": 122
          },
          {
            "text": "                    processed_missing_ids.add(missing_id)",
            "lineNumber": 123
          },
          {
            "text": "            ",
            "lineNumber": 124
          },
          {
            "text": "            # æ¥ç¶šå…ƒæœªå®šç¾©ãƒãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 125
          },
          {
            "text": "            if edge.source not in node_ids:",
            "lineNumber": 126
          },
          {
            "text": "                missing_id = f\"missing_{edge.source}\"",
            "lineNumber": 127
          },
          {
            "text": "                if missing_id not in processed_missing_ids:",
            "lineNumber": 128
          },
          {
            "text": "                    missing_node = Node(",
            "lineNumber": 129
          },
          {
            "text": "                        id=missing_id,",
            "lineNumber": 130
          },
          {
            "text": "                        label=f\"æœªå®šç¾©: {edge.source}\",",
            "lineNumber": 131
          },
          {
            "text": "                        type=\"missing\",",
            "lineNumber": 132
          },
          {
            "text": "                        status=NodeStatus.MISSING",
            "lineNumber": 133
          },
          {
            "text": "                    )",
            "lineNumber": 134
          },
          {
            "text": "                    gaps.append(missing_node)",
            "lineNumber": 135
          },
          {
            "text": "                    processed_missing_ids.add(missing_id)",
            "lineNumber": 136
          },
          {
            "text": "        ",
            "lineNumber": 137
          },
          {
            "text": "        # 3. å­¤ç«‹ãƒãƒ¼ãƒ‰ï¼ˆSTART/ENDä»¥å¤–ã§æ¥ç¶šãŒãªã„ï¼‰",
            "lineNumber": 138
          },
          {
            "text": "        for node in self.nodes:",
            "lineNumber": 139
          },
          {
            "text": "            if node.type not in [\"start\", \"end\"]:",
            "lineNumber": 140
          },
          {
            "text": "                if len(outgoing_edges[node.id]) == 0 and len(incoming_edges[node.id]) == 0:",
            "lineNumber": 141
          },
          {
            "text": "                    # å­¤ç«‹ã—ã¦ã„ã‚‹ãƒãƒ¼ãƒ‰ã‚’MISSINGã¨ã—ã¦ãƒãƒ¼ã‚¯",
            "lineNumber": 142
          },
          {
            "text": "                    gaps.append(node)",
            "lineNumber": 143
          },
          {
            "text": "        ",
            "lineNumber": 144
          },
          {
            "text": "        return gaps",
            "lineNumber": 145
          },
          {
            "lineNumber": 146
          },
          {
            "text": "    def apply_logic_gap_detection(self) -&gt; 'Flowchart':",
            "lineNumber": 147
          },
          {
            "text": "        ",
            "lineNumber": 148
          }
        ]
      },
      "score": 0.3061932921409607
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\mermaid_parser.py",
        "range": {
          "startPosition": {
            "line": 5
          },
          "endPosition": {
            "line": 178
          }
        },
        "contents": "class MermaidParser:\n@staticmethod\ndef parse(mermaid_text: str) -&gt; Flowchart:\n\n        for line in lines:\n            # ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—\n            if line.startswith('%%'):\n                continue\n            \n            # styleè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆå¾Œã§å‡¦ç†ï¼‰\n            if line.startswith('style '):\n                continue\n            \n            # subgraphã®é–‹å§‹/çµ‚äº†ã‚’æ¤œå‡º\n            if line.startswith('subgraph '):\n                in_subgraph = True\n                continue\n            if line.strip() == 'end':\n                in_subgraph = False\n                continue\n            \n            # ãƒãƒ¼ãƒ‰å®šç¾©: id[\"label\"] ã¾ãŸã¯ id{\"label\"} ã¾ãŸã¯ id[(\"label\")]\n            # ã‚ˆã‚ŠæŸ”è»Ÿãªãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°\n            node_patterns = [\n                r'(\\w+)\\[\\([\"\\']([^\"\\']+)[\"\\']\\)\\]',  # id[(\"label\")]\n                r'(\\w+)\\[/[\"\\']([^\"\\']+)[\"\\']/\\]',     # id[/\"label\"/]\n                r'(\\w+)\\[[\"\\']([^\"\\']+)[\"\\']\\]',       # id[\"label\"]\n                r'(\\w+)\\{[\"\\']([^\"\\']+)[\"\\']\\}',       # id{\"label\"}\n                r'(\\w+)\\[\\(([^)]+)\\)\\]',                # id[(label)]\n                r'(\\w+)\\[([^\\]]+)\\]',                   # id[label]\n                r'(\\w+)\\{([^}]+)\\}',                    # id{label}\n            ]\n            \n            node_found = False\n            for pattern in node_patterns:\n                node_match = re.match(pattern, line)",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 6,
                "column": 1
              },
              "endPosition": {
                "line": 7,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 9,
                "column": 5
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 10,
                "column": 5
              },
              "endPosition": {
                "line": 11,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class MermaidParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 9
          },
          {
            "text": "def parse(mermaid_text: str) -&gt; Flowchart:",
            "lineNumber": 10
          },
          {
            "lineNumber": 31
          },
          {
            "text": "        for line in lines:",
            "lineNumber": 32
          },
          {
            "text": "            # ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—",
            "lineNumber": 33
          },
          {
            "text": "            if line.startswith('%%'):",
            "lineNumber": 34
          },
          {
            "text": "                continue",
            "lineNumber": 35
          },
          {
            "text": "            ",
            "lineNumber": 36
          },
          {
            "text": "            # styleè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆå¾Œã§å‡¦ç†ï¼‰",
            "lineNumber": 37
          },
          {
            "text": "            if line.startswith('style '):",
            "lineNumber": 38
          },
          {
            "text": "                continue",
            "lineNumber": 39
          },
          {
            "text": "            ",
            "lineNumber": 40
          },
          {
            "text": "            # subgraphã®é–‹å§‹/çµ‚äº†ã‚’æ¤œå‡º",
            "lineNumber": 41
          },
          {
            "text": "            if line.startswith('subgraph '):",
            "lineNumber": 42
          },
          {
            "text": "                in_subgraph = True",
            "lineNumber": 43
          },
          {
            "text": "                continue",
            "lineNumber": 44
          },
          {
            "text": "            if line.strip() == 'end':",
            "lineNumber": 45
          },
          {
            "text": "                in_subgraph = False",
            "lineNumber": 46
          },
          {
            "text": "                continue",
            "lineNumber": 47
          },
          {
            "text": "            ",
            "lineNumber": 48
          },
          {
            "text": "            # ãƒãƒ¼ãƒ‰å®šç¾©: id[\"label\"] ã¾ãŸã¯ id{\"label\"} ã¾ãŸã¯ id[(\"label\")]",
            "lineNumber": 49
          },
          {
            "text": "            # ã‚ˆã‚ŠæŸ”è»Ÿãªãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°",
            "lineNumber": 50
          },
          {
            "text": "            node_patterns = [",
            "lineNumber": 51
          },
          {
            "text": "                r'(\\w+)\\[\\([\"\\']([^\"\\']+)[\"\\']\\)\\]',  # id[(\"label\")]",
            "lineNumber": 52
          },
          {
            "text": "                r'(\\w+)\\[/[\"\\']([^\"\\']+)[\"\\']/\\]',     # id[/\"label\"/]",
            "lineNumber": 53
          },
          {
            "text": "                r'(\\w+)\\[[\"\\']([^\"\\']+)[\"\\']\\]',       # id[\"label\"]",
            "lineNumber": 54
          },
          {
            "text": "                r'(\\w+)\\{[\"\\']([^\"\\']+)[\"\\']\\}',       # id{\"label\"}",
            "lineNumber": 55
          },
          {
            "text": "                r'(\\w+)\\[\\(([^)]+)\\)\\]',                # id[(label)]",
            "lineNumber": 56
          },
          {
            "text": "                r'(\\w+)\\[([^\\]]+)\\]',                   # id[label]",
            "lineNumber": 57
          },
          {
            "text": "                r'(\\w+)\\{([^}]+)\\}',                    # id{label}",
            "lineNumber": 58
          },
          {
            "text": "            ]",
            "lineNumber": 59
          },
          {
            "text": "            ",
            "lineNumber": 60
          },
          {
            "text": "            node_found = False",
            "lineNumber": 61
          },
          {
            "text": "            for pattern in node_patterns:",
            "lineNumber": 62
          },
          {
            "text": "                node_match = re.match(pattern, line)",
            "lineNumber": 63
          }
        ]
      },
      "score": 0.2942850589752197
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 24
          },
          "endPosition": {
            "line": 336
          }
        },
        "contents": "class Flowchart(BaseModel):\n@model_validator(mode='after')\ndef validate_edges_reference_nodes(self):\n\n        \n        return self\n\n    def detect_logic_gaps(self) -&gt; List[Node]:\n        \"\"\"è«–ç†ã®ç©´ï¼ˆå‡ºå£ã®ãªã„åˆ†å²ã€æ¥ç¶šå…ˆ/æ¥ç¶šå…ƒæœªå®šç¾©ãƒãƒ¼ãƒ‰ã€å­¤ç«‹ãƒãƒ¼ãƒ‰ï¼‰ã‚’æ¤œå‡º\"\"\"\n        node_ids = {node.id for node in self.nodes}\n        gaps = []\n        \n        # å„ãƒãƒ¼ãƒ‰ã®æ¥ç¶šçŠ¶æ³ã‚’ç¢ºèªï¼ˆdefaultdictã‚’ä½¿ç”¨ã—ã¦KeyErrorã‚’é˜²ãï¼‰\n        outgoing_edges = defaultdict(list)\n        incoming_edges = defaultdict(list)\n        \n        # æ—¢å­˜ãƒãƒ¼ãƒ‰ã‚’åˆæœŸåŒ–\n        for node in self.nodes:\n            outgoing_edges[node.id] = []\n            incoming_edges[node.id] = []\n        \n        # ã‚¨ãƒƒã‚¸ã‚’å‡¦ç†ï¼ˆå­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰IDã§ã‚‚KeyErrorãŒç™ºç”Ÿã—ãªã„ï¼‰\n        for edge in self.edges:\n            outgoing_edges[edge.source].append(edge)\n            incoming_edges[edge.target].append(edge)\n        \n        # 1. å‡ºå£ã®ãªã„åˆ†å²ï¼ˆDECISIONãƒãƒ¼ãƒ‰ã§å‡ºå£ãŒ1ã¤ä»¥ä¸‹ï¼‰\n        for node in self.nodes:\n            if node.type == \"decision\":\n                outgoing_count = len(outgoing_edges[node.id])\n                if outgoing_count == 0:\n                    # DECISIONãƒãƒ¼ãƒ‰ã«å‡ºå£ãŒãªã„å ´åˆï¼ˆé‡å¤§ãªå•é¡Œï¼‰\n                    gaps.append(node)\n                elif outgoing_count == 1:\n                    # DECISIONãƒãƒ¼ãƒ‰ã«å‡ºå£ãŒ1ã¤ã—ã‹ãªã„å ´åˆï¼ˆé€šå¸¸ã¯2ã¤ä»¥ä¸Šå¿…è¦ï¼‰\n                    gaps.append(node)\n        \n        # 2. æ¥ç¶šå…ˆ/æ¥ç¶šå…ƒæœªå®šç¾©ãƒãƒ¼ãƒ‰ï¼ˆã‚¨ãƒƒã‚¸ã®target/sourceãŒå­˜åœ¨ã—ãªã„ï¼‰\n        # é‡è¤‡ã‚’é˜²ããŸã‚ã«æ—¢ã«å‡¦ç†æ¸ˆã¿ã®IDã‚’è¨˜éŒ²\n        processed_missing_ids = set()\n        \n        for edge in self.edges:",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 25,
                "column": 1
              },
              "endPosition": {
                "line": 26,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 25,
            "isSignature": true
          },
          {
            "text": "@model_validator(mode='after')",
            "lineNumber": 55
          },
          {
            "text": "def validate_edges_reference_nodes(self):",
            "lineNumber": 56
          },
          {
            "lineNumber": 73
          },
          {
            "text": "        ",
            "lineNumber": 74
          },
          {
            "text": "        return self",
            "lineNumber": 75
          },
          {
            "lineNumber": 76
          },
          {
            "text": "    def detect_logic_gaps(self) -&gt; List[Node]:",
            "lineNumber": 77
          },
          {
            "text": "        \"\"\"è«–ç†ã®ç©´ï¼ˆå‡ºå£ã®ãªã„åˆ†å²ã€æ¥ç¶šå…ˆ/æ¥ç¶šå…ƒæœªå®šç¾©ãƒãƒ¼ãƒ‰ã€å­¤ç«‹ãƒãƒ¼ãƒ‰ï¼‰ã‚’æ¤œå‡º\"\"\"",
            "lineNumber": 78
          },
          {
            "text": "        node_ids = {node.id for node in self.nodes}",
            "lineNumber": 79
          },
          {
            "text": "        gaps = []",
            "lineNumber": 80
          },
          {
            "text": "        ",
            "lineNumber": 81
          },
          {
            "text": "        # å„ãƒãƒ¼ãƒ‰ã®æ¥ç¶šçŠ¶æ³ã‚’ç¢ºèªï¼ˆdefaultdictã‚’ä½¿ç”¨ã—ã¦KeyErrorã‚’é˜²ãï¼‰",
            "lineNumber": 82
          },
          {
            "text": "        outgoing_edges = defaultdict(list)",
            "lineNumber": 83
          },
          {
            "text": "        incoming_edges = defaultdict(list)",
            "lineNumber": 84
          },
          {
            "text": "        ",
            "lineNumber": 85
          },
          {
            "text": "        # æ—¢å­˜ãƒãƒ¼ãƒ‰ã‚’åˆæœŸåŒ–",
            "lineNumber": 86
          },
          {
            "text": "        for node in self.nodes:",
            "lineNumber": 87
          },
          {
            "text": "            outgoing_edges[node.id] = []",
            "lineNumber": 88
          },
          {
            "text": "            incoming_edges[node.id] = []",
            "lineNumber": 89
          },
          {
            "text": "        ",
            "lineNumber": 90
          },
          {
            "text": "        # ã‚¨ãƒƒã‚¸ã‚’å‡¦ç†ï¼ˆå­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰IDã§ã‚‚KeyErrorãŒç™ºç”Ÿã—ãªã„ï¼‰",
            "lineNumber": 91
          },
          {
            "text": "        for edge in self.edges:",
            "lineNumber": 92
          },
          {
            "text": "            outgoing_edges[edge.source].append(edge)",
            "lineNumber": 93
          },
          {
            "text": "            incoming_edges[edge.target].append(edge)",
            "lineNumber": 94
          },
          {
            "text": "        ",
            "lineNumber": 95
          },
          {
            "text": "        # 1. å‡ºå£ã®ãªã„åˆ†å²ï¼ˆDECISIONãƒãƒ¼ãƒ‰ã§å‡ºå£ãŒ1ã¤ä»¥ä¸‹ï¼‰",
            "lineNumber": 96
          },
          {
            "text": "        for node in self.nodes:",
            "lineNumber": 97
          },
          {
            "text": "            if node.type == \"decision\":",
            "lineNumber": 98
          },
          {
            "text": "                outgoing_count = len(outgoing_edges[node.id])",
            "lineNumber": 99
          },
          {
            "text": "                if outgoing_count == 0:",
            "lineNumber": 100
          },
          {
            "text": "                    # DECISIONãƒãƒ¼ãƒ‰ã«å‡ºå£ãŒãªã„å ´åˆï¼ˆé‡å¤§ãªå•é¡Œï¼‰",
            "lineNumber": 101
          },
          {
            "text": "                    gaps.append(node)",
            "lineNumber": 102
          },
          {
            "text": "                elif outgoing_count == 1:",
            "lineNumber": 103
          },
          {
            "text": "                    # DECISIONãƒãƒ¼ãƒ‰ã«å‡ºå£ãŒ1ã¤ã—ã‹ãªã„å ´åˆï¼ˆé€šå¸¸ã¯2ã¤ä»¥ä¸Šå¿…è¦ï¼‰",
            "lineNumber": 104
          },
          {
            "text": "                    gaps.append(node)",
            "lineNumber": 105
          },
          {
            "text": "        ",
            "lineNumber": 106
          },
          {
            "text": "        # 2. æ¥ç¶šå…ˆ/æ¥ç¶šå…ƒæœªå®šç¾©ãƒãƒ¼ãƒ‰ï¼ˆã‚¨ãƒƒã‚¸ã®target/sourceãŒå­˜åœ¨ã—ãªã„ï¼‰",
            "lineNumber": 107
          },
          {
            "text": "        # é‡è¤‡ã‚’é˜²ããŸã‚ã«æ—¢ã«å‡¦ç†æ¸ˆã¿ã®IDã‚’è¨˜éŒ²",
            "lineNumber": 108
          },
          {
            "text": "        processed_missing_ids = set()",
            "lineNumber": 109
          },
          {
            "text": "        ",
            "lineNumber": 110
          },
          {
            "text": "        for edge in self.edges:",
            "lineNumber": 111
          }
        ]
      },
      "score": 0.28344035148620605
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 10,
            "column": 23
          },
          "endPosition": {
            "line": 22,
            "column": 31
          }
        },
        "contents": "class Node(BaseModel):\n    id: str\n    label: str\n    type: str = \"process\"\n    status: NodeStatus = NodeStatus.ACTIVE\n    subgraph_id: Optional[str] = None  # ãƒãƒ¼ãƒ‰ãŒå±ã™ã‚‹subgraphã®ID\n\nclass Edge(BaseModel):\n    source: str\n    target: str\n    label: Optional[str] = None",
        "signatures": {},
        "detailedLines": [
          {
            "text": "class Node(BaseModel):",
            "lineNumber": 13,
            "isSignature": true
          },
          {
            "text": "    id: str",
            "lineNumber": 14
          },
          {
            "text": "    label: str",
            "lineNumber": 15
          },
          {
            "text": "    type: str = \"process\"",
            "lineNumber": 16
          },
          {
            "text": "    status: NodeStatus = NodeStatus.ACTIVE",
            "lineNumber": 17
          },
          {
            "text": "    subgraph_id: Optional[str] = None  # ãƒãƒ¼ãƒ‰ãŒå±ã™ã‚‹subgraphã®ID",
            "lineNumber": 18,
            "isSignature": true
          },
          {
            "lineNumber": 19
          },
          {
            "text": "class Edge(BaseModel):",
            "lineNumber": 20,
            "isSignature": true
          },
          {
            "text": "    source: str",
            "lineNumber": 21
          },
          {
            "text": "    target: str",
            "lineNumber": 22
          },
          {
            "text": "    label: Optional[str] = None",
            "lineNumber": 23,
            "isSignature": true
          }
        ]
      },
      "score": 0.2786450982093811
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 24
          },
          "endPosition": {
            "line": 336
          }
        },
        "contents": "class Flowchart(BaseModel):\ndef to_mermaid(self) -&gt; str:\n\n            \n            # subgraphã«å±ã•ãªã„ãƒãƒ¼ãƒ‰ã‚’å®šç¾©\n            for n in nodes_outside_subgraph:\n                safe_id = f\"n_{n.id}\" if n.id == \"end\" else n.id\n                shape = self._get_node_shape(n.type)\n                \n                if shape == \"([ ])\":  # START/END\n                    lines.append(f'{safe_id}[\"{n.label}\"]')\n                elif shape == \"[ ]\":  # PROCESS\n                    lines.append(f'{safe_id}[\"{n.label}\"]')\n                elif shape == \"{ }\":  # DECISION\n                    lines.append(f'{safe_id}{{\"{n.label}\"}}')\n                elif shape == \"[/ /]\":  # IO_DATA (å¹³è¡Œå››è¾ºå½¢)\n                    lines.append(f'{safe_id}[/\"{n.label}\"/]')\n                elif shape == \"[( )]\":  # STORAGE (å††ç­’å½¢)\n                    lines.append(f'{safe_id}[(\"{n.label}\")]')\n                elif shape == \"{{ }}\":  # MISSING\n                    lines.append(f'{safe_id}{{\"{n.label}\"}}')\n                \n                color = self._get_status_color(n.status)\n                style_lines.append(f'    style {safe_id} fill:{color}')\n            \n            # subgraphã‚’å®šç¾©\n            for sg_id, sg_label in",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 25,
                "column": 1
              },
              "endPosition": {
                "line": 26,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 202,
                "column": 5
              },
              "endPosition": {
                "line": 203,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 25,
            "isSignature": true
          },
          {
            "text": "def to_mermaid(self) -&gt; str:",
            "lineNumber": 202
          },
          {
            "lineNumber": 216
          },
          {
            "text": "            ",
            "lineNumber": 217
          },
          {
            "text": "            # subgraphã«å±ã•ãªã„ãƒãƒ¼ãƒ‰ã‚’å®šç¾©",
            "lineNumber": 218
          },
          {
            "text": "            for n in nodes_outside_subgraph:",
            "lineNumber": 219
          },
          {
            "text": "                safe_id = f\"n_{n.id}\" if n.id == \"end\" else n.id",
            "lineNumber": 220
          },
          {
            "text": "                shape = self._get_node_shape(n.type)",
            "lineNumber": 221
          },
          {
            "text": "                ",
            "lineNumber": 222
          },
          {
            "text": "                if shape == \"([ ])\":  # START/END",
            "lineNumber": 223
          },
          {
            "text": "                    lines.append(f'{safe_id}[\"{n.label}\"]')",
            "lineNumber": 224
          },
          {
            "text": "                elif shape == \"[ ]\":  # PROCESS",
            "lineNumber": 225
          },
          {
            "text": "                    lines.append(f'{safe_id}[\"{n.label}\"]')",
            "lineNumber": 226
          },
          {
            "text": "                elif shape == \"{ }\":  # DECISION",
            "lineNumber": 227
          },
          {
            "text": "                    lines.append(f'{safe_id}{{\"{n.label}\"}}')",
            "lineNumber": 228
          },
          {
            "text": "                elif shape == \"[/ /]\":  # IO_DATA (å¹³è¡Œå››è¾ºå½¢)",
            "lineNumber": 229
          },
          {
            "text": "                    lines.append(f'{safe_id}[/\"{n.label}\"/]')",
            "lineNumber": 230
          },
          {
            "text": "                elif shape == \"[( )]\":  # STORAGE (å††ç­’å½¢)",
            "lineNumber": 231
          },
          {
            "text": "                    lines.append(f'{safe_id}[(\"{n.label}\")]')",
            "lineNumber": 232
          },
          {
            "text": "                elif shape == \"{{ }}\":  # MISSING",
            "lineNumber": 233
          },
          {
            "text": "                    lines.append(f'{safe_id}{{\"{n.label}\"}}')",
            "lineNumber": 234
          },
          {
            "text": "                ",
            "lineNumber": 235
          },
          {
            "text": "                color = self._get_status_color(n.status)",
            "lineNumber": 236
          },
          {
            "text": "                style_lines.append(f'    style {safe_id} fill:{color}')",
            "lineNumber": 237
          },
          {
            "text": "            ",
            "lineNumber": 238
          },
          {
            "text": "            # subgraphã‚’å®šç¾©",
            "lineNumber": 239
          },
          {
            "text": "            for sg_id, sg_label in",
            "lineNumber": 240
          }
        ]
      },
      "score": 0.27816250920295715
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 24
          },
          "endPosition": {
            "line": 336
          }
        },
        "contents": "class Flowchart(BaseModel):\n@staticmethod\ndef _get_node_shape(node_type: str) -&gt; str:\n  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯MISSING\n\n    @staticmethod\n    def _get_status_color(status: NodeStatus) -&gt; str:\n        \"\"\"ãƒãƒ¼ãƒ‰çŠ¶æ…‹ã«å¿œã˜ãŸè‰²ã‚’è¿”ã™\"\"\"\n        color_map = {\n            NodeStatus.ACTIVE: \"#90EE90\",      # ãƒ©ã‚¤ãƒˆã‚°ãƒªãƒ¼ãƒ³\n            NodeStatus.COMPLETED: \"#87CEEB\",   # ã‚¹ã‚«ã‚¤ãƒ–ãƒ«ãƒ¼\n            NodeStatus.MISSING: \"#FF6B6B\"       # èµ¤\n        }\n        return color_map.get(status, \"#D3D3D3\")  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã‚°ãƒ¬ãƒ¼\n\n    def to_mermaid(self) -&gt; str:\n        \"\"\"Flowchartã‚’Mermaidæ§‹æ–‡ã«å¤‰æ›\"\"\"\n        lines = [\"graph TD\"]\n        style_lines = []\n        \n        # subgraphãŒã‚ã‚‹å ´åˆã®å‡¦ç†\n        if self.subgraphs:\n            # subgraphã«å±ã•ãªã„ãƒãƒ¼ãƒ‰ã‚’å…ˆã«å®šç¾©\n            nodes_outside_subgraph = [n for n in self.nodes if not n.subgraph_id]\n            nodes_by_subgraph = defaultdict(list)\n            \n            # subgraphã”ã¨ã«ãƒãƒ¼ãƒ‰ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–\n            for n in self.nodes:\n                if n.subgraph_id:\n                    nodes_by_subgraph[n.subgraph_id].append(n)\n            \n            # subgraphã«å±ã•ãªã„ãƒãƒ¼ãƒ‰ã‚’å®šç¾©\n            for",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 25,
                "column": 1
              },
              "endPosition": {
                "line": 26,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 25,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 178
          },
          {
            "text": "def _get_node_shape(node_type: str) -&gt; str:",
            "lineNumber": 179
          },
          {
            "text": "  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯MISSING",
            "lineNumber": 190
          },
          {
            "lineNumber": 191
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 192
          },
          {
            "text": "    def _get_status_color(status: NodeStatus) -&gt; str:",
            "lineNumber": 193
          },
          {
            "text": "        \"\"\"ãƒãƒ¼ãƒ‰çŠ¶æ…‹ã«å¿œã˜ãŸè‰²ã‚’è¿”ã™\"\"\"",
            "lineNumber": 194
          },
          {
            "text": "        color_map = {",
            "lineNumber": 195
          },
          {
            "text": "            NodeStatus.ACTIVE: \"#90EE90\",      # ãƒ©ã‚¤ãƒˆã‚°ãƒªãƒ¼ãƒ³",
            "lineNumber": 196
          },
          {
            "text": "            NodeStatus.COMPLETED: \"#87CEEB\",   # ã‚¹ã‚«ã‚¤ãƒ–ãƒ«ãƒ¼",
            "lineNumber": 197
          },
          {
            "text": "            NodeStatus.MISSING: \"#FF6B6B\"       # èµ¤",
            "lineNumber": 198
          },
          {
            "text": "        }",
            "lineNumber": 199
          },
          {
            "text": "        return color_map.get(status, \"#D3D3D3\")  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã‚°ãƒ¬ãƒ¼",
            "lineNumber": 200
          },
          {
            "lineNumber": 201
          },
          {
            "text": "    def to_mermaid(self) -&gt; str:",
            "lineNumber": 202
          },
          {
            "text": "        \"\"\"Flowchartã‚’Mermaidæ§‹æ–‡ã«å¤‰æ›\"\"\"",
            "lineNumber": 203
          },
          {
            "text": "        lines = [\"graph TD\"]",
            "lineNumber": 204
          },
          {
            "text": "        style_lines = []",
            "lineNumber": 205
          },
          {
            "text": "        ",
            "lineNumber": 206
          },
          {
            "text": "        # subgraphãŒã‚ã‚‹å ´åˆã®å‡¦ç†",
            "lineNumber": 207
          },
          {
            "text": "        if self.subgraphs:",
            "lineNumber": 208
          },
          {
            "text": "            # subgraphã«å±ã•ãªã„ãƒãƒ¼ãƒ‰ã‚’å…ˆã«å®šç¾©",
            "lineNumber": 209
          },
          {
            "text": "            nodes_outside_subgraph = [n for n in self.nodes if not n.subgraph_id]",
            "lineNumber": 210
          },
          {
            "text": "            nodes_by_subgraph = defaultdict(list)",
            "lineNumber": 211
          },
          {
            "text": "            ",
            "lineNumber": 212
          },
          {
            "text": "            # subgraphã”ã¨ã«ãƒãƒ¼ãƒ‰ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–",
            "lineNumber": 213
          },
          {
            "text": "            for n in self.nodes:",
            "lineNumber": 214
          },
          {
            "text": "                if n.subgraph_id:",
            "lineNumber": 215
          },
          {
            "text": "                    nodes_by_subgraph[n.subgraph_id].append(n)",
            "lineNumber": 216
          },
          {
            "text": "            ",
            "lineNumber": 217
          },
          {
            "text": "            # subgraphã«å±ã•ãªã„ãƒãƒ¼ãƒ‰ã‚’å®šç¾©",
            "lineNumber": 218
          },
          {
            "text": "            for",
            "lineNumber": 219
          }
        ]
      },
      "score": 0.27305126190185547
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 24
          },
          "endPosition": {
            "line": 336
          }
        },
        "contents": "class Flowchart(BaseModel):\ndef to_mermaid(self) -&gt; str:\n\n            \n            # subgraphã‚’å®šç¾©\n            for sg_id, sg_label in self.subgraphs.items():\n                lines.append(f'    subgraph {sg_id} [\"{sg_label}\"]')\n                \n                # ã“ã®subgraphã«å±ã™ã‚‹ãƒãƒ¼ãƒ‰ã‚’å®šç¾©\n                for n in nodes_by_subgraph[sg_id]:\n                    safe_id = f\"n_{n.id}\" if n.id == \"end\" else n.id\n                    shape = self._get_node_shape(n.type)\n                    \n                    if shape == \"([ ])\":  # START/END\n                        lines.append(f'        {safe_id}[\"{n.label}\"]')\n                    elif shape == \"[ ]\":  # PROCESS\n                        lines.append(f'        {safe_id}[\"{n.label}\"]')\n                    elif shape == \"{ }\":  # DECISION\n                        lines.append(f'        {safe_id}{{\"{n.label}\"}}')\n                    elif shape == \"[/ /]\":  # IO_DATA (å¹³è¡Œå››è¾ºå½¢)\n                        lines.append(f'        {safe_id}[/\"{n.label}\"/]')\n                    elif shape == \"[( )]\":  # STORAGE (å††ç­’å½¢)\n                        lines.append(f'        {safe_id}[(\"{n.label}\")]')\n                    elif shape == \"{{ }}\":  # MISSING\n                        lines.append(f'        {safe_id}{{\"{n.label}\"}}')\n                    \n                    color = self._get_status_color(n.status)\n                    style_lines.append(f'    style {safe_id} fill:{color}')\n                \n                lines.append('    end')\n        else:\n            # subgraphãŒãªã„å ´åˆã¯å¾“æ¥é€šã‚Š\n            for",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 25,
                "column": 1
              },
              "endPosition": {
                "line": 26,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 202,
                "column": 5
              },
              "endPosition": {
                "line": 203,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 25,
            "isSignature": true
          },
          {
            "text": "def to_mermaid(self) -&gt; str:",
            "lineNumber": 202
          },
          {
            "lineNumber": 237
          },
          {
            "text": "            ",
            "lineNumber": 238
          },
          {
            "text": "            # subgraphã‚’å®šç¾©",
            "lineNumber": 239
          },
          {
            "text": "            for sg_id, sg_label in self.subgraphs.items():",
            "lineNumber": 240
          },
          {
            "text": "                lines.append(f'    subgraph {sg_id} [\"{sg_label}\"]')",
            "lineNumber": 241
          },
          {
            "text": "                ",
            "lineNumber": 242
          },
          {
            "text": "                # ã“ã®subgraphã«å±ã™ã‚‹ãƒãƒ¼ãƒ‰ã‚’å®šç¾©",
            "lineNumber": 243
          },
          {
            "text": "                for n in nodes_by_subgraph[sg_id]:",
            "lineNumber": 244
          },
          {
            "text": "                    safe_id = f\"n_{n.id}\" if n.id == \"end\" else n.id",
            "lineNumber": 245
          },
          {
            "text": "                    shape = self._get_node_shape(n.type)",
            "lineNumber": 246
          },
          {
            "text": "                    ",
            "lineNumber": 247
          },
          {
            "text": "                    if shape == \"([ ])\":  # START/END",
            "lineNumber": 248
          },
          {
            "text": "                        lines.append(f'        {safe_id}[\"{n.label}\"]')",
            "lineNumber": 249
          },
          {
            "text": "                    elif shape == \"[ ]\":  # PROCESS",
            "lineNumber": 250
          },
          {
            "text": "                        lines.append(f'        {safe_id}[\"{n.label}\"]')",
            "lineNumber": 251
          },
          {
            "text": "                    elif shape == \"{ }\":  # DECISION",
            "lineNumber": 252
          },
          {
            "text": "                        lines.append(f'        {safe_id}{{\"{n.label}\"}}')",
            "lineNumber": 253
          },
          {
            "text": "                    elif shape == \"[/ /]\":  # IO_DATA (å¹³è¡Œå››è¾ºå½¢)",
            "lineNumber": 254
          },
          {
            "text": "                        lines.append(f'        {safe_id}[/\"{n.label}\"/]')",
            "lineNumber": 255
          },
          {
            "text": "                    elif shape == \"[( )]\":  # STORAGE (å††ç­’å½¢)",
            "lineNumber": 256
          },
          {
            "text": "                        lines.append(f'        {safe_id}[(\"{n.label}\")]')",
            "lineNumber": 257
          },
          {
            "text": "                    elif shape == \"{{ }}\":  # MISSING",
            "lineNumber": 258
          },
          {
            "text": "                        lines.append(f'        {safe_id}{{\"{n.label}\"}}')",
            "lineNumber": 259
          },
          {
            "text": "                    ",
            "lineNumber": 260
          },
          {
            "text": "                    color = self._get_status_color(n.status)",
            "lineNumber": 261
          },
          {
            "text": "                    style_lines.append(f'    style {safe_id} fill:{color}')",
            "lineNumber": 262
          },
          {
            "text": "                ",
            "lineNumber": 263
          },
          {
            "text": "                lines.append('    end')",
            "lineNumber": 264
          },
          {
            "text": "        else:",
            "lineNumber": 265
          },
          {
            "text": "            # subgraphãŒãªã„å ´åˆã¯å¾“æ¥é€šã‚Š",
            "lineNumber": 266
          },
          {
            "text": "            for",
            "lineNumber": 267
          }
        ]
      },
      "score": 0.26848506927490234
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 24
          },
          "endPosition": {
            "line": 336,
            "column": 31
          }
        },
        "contents": "class Flowchart(BaseModel):\n\n\n    def to_toon_format(self) -&gt; str:\n        \"\"\"Flowchartã‚’TOONå½¢å¼ï¼ˆMarkdownï¼‰ã«å¤‰æ›\"\"\"\n        lines = []\n        \n        # Subgraphå®šç¾©ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰\n        if self.subgraphs:\n            for sg_id, sg_label in self.subgraphs.items():\n                lines.append(\"[Subgraph]\")\n                lines.append(f\"id: {sg_id}\")\n                lines.append(f\"label: {sg_label}\")\n                lines.append(\"\")\n        \n        # ãƒãƒ¼ãƒ‰å®šç¾©\n        for node in self.nodes:\n            lines.append(\"[Node]\")\n            lines.append(f\"id: {node.id}\")\n            lines.append(f\"label: {node.label}\")\n            lines.append(f\"type: {node.type}\")\n            if node.status != NodeStatus.ACTIVE:\n                lines.append(f\"status: {node.status.value}\")\n            if node.subgraph_id:\n                lines.append(f\"subgraph: {node.subgraph_id}\")\n            lines.append(\"\")\n        \n        # ã‚¨ãƒƒã‚¸å®šç¾©\n        for edge in self.edges:\n            lines.append(\"[Edge]\")\n            lines.append(f\"source: {edge.source}\")\n            lines.append(f\"target: {edge.target}\")\n            if edge.label:\n                lines.append(f\"label: {edge.label}\")\n            lines.append(\"\")\n        \n        return \"\\n\".join(lines)",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 25,
                "column": 1
              },
              "endPosition": {
                "line": 26,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 25,
            "isSignature": true
          },
          {
            "lineNumber": 302
          },
          {
            "lineNumber": 303
          },
          {
            "text": "    def to_toon_format(self) -&gt; str:",
            "lineNumber": 304
          },
          {
            "text": "        \"\"\"Flowchartã‚’TOONå½¢å¼ï¼ˆMarkdownï¼‰ã«å¤‰æ›\"\"\"",
            "lineNumber": 305
          },
          {
            "text": "        lines = []",
            "lineNumber": 306
          },
          {
            "text": "        ",
            "lineNumber": 307
          },
          {
            "text": "        # Subgraphå®šç¾©ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰",
            "lineNumber": 308
          },
          {
            "text": "        if self.subgraphs:",
            "lineNumber": 309
          },
          {
            "text": "            for sg_id, sg_label in self.subgraphs.items():",
            "lineNumber": 310
          },
          {
            "text": "                lines.append(\"[Subgraph]\")",
            "lineNumber": 311
          },
          {
            "text": "                lines.append(f\"id: {sg_id}\")",
            "lineNumber": 312
          },
          {
            "text": "                lines.append(f\"label: {sg_label}\")",
            "lineNumber": 313
          },
          {
            "text": "                lines.append(\"\")",
            "lineNumber": 314
          },
          {
            "text": "        ",
            "lineNumber": 315
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰å®šç¾©",
            "lineNumber": 316
          },
          {
            "text": "        for node in self.nodes:",
            "lineNumber": 317
          },
          {
            "text": "            lines.append(\"[Node]\")",
            "lineNumber": 318
          },
          {
            "text": "            lines.append(f\"id: {node.id}\")",
            "lineNumber": 319
          },
          {
            "text": "            lines.append(f\"label: {node.label}\")",
            "lineNumber": 320
          },
          {
            "text": "            lines.append(f\"type: {node.type}\")",
            "lineNumber": 321
          },
          {
            "text": "            if node.status != NodeStatus.ACTIVE:",
            "lineNumber": 322
          },
          {
            "text": "                lines.append(f\"status: {node.status.value}\")",
            "lineNumber": 323
          },
          {
            "text": "            if node.subgraph_id:",
            "lineNumber": 324
          },
          {
            "text": "                lines.append(f\"subgraph: {node.subgraph_id}\")",
            "lineNumber": 325
          },
          {
            "text": "            lines.append(\"\")",
            "lineNumber": 326
          },
          {
            "text": "        ",
            "lineNumber": 327
          },
          {
            "text": "        # ã‚¨ãƒƒã‚¸å®šç¾©",
            "lineNumber": 328
          },
          {
            "text": "        for edge in self.edges:",
            "lineNumber": 329
          },
          {
            "text": "            lines.append(\"[Edge]\")",
            "lineNumber": 330
          },
          {
            "text": "            lines.append(f\"source: {edge.source}\")",
            "lineNumber": 331
          },
          {
            "text": "            lines.append(f\"target: {edge.target}\")",
            "lineNumber": 332
          },
          {
            "text": "            if edge.label:",
            "lineNumber": 333
          },
          {
            "text": "                lines.append(f\"label: {edge.label}\")",
            "lineNumber": 334
          },
          {
            "text": "            lines.append(\"\")",
            "lineNumber": 335
          },
          {
            "text": "        ",
            "lineNumber": 336
          },
          {
            "text": "        return \"\\n\".join(lines)",
            "lineNumber": 337,
            "isSignature": true
          }
        ]
      },
      "score": 0.26683956384658813
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\mermaid_parser.py",
        "range": {
          "startPosition": {
            "line": 5
          },
          "endPosition": {
            "line": 178,
            "column": 24
          }
        },
        "contents": "class MermaidParser:\n@staticmethod\ndef parse(mermaid_text: str) -&gt; Flowchart:\n\n        \n        if \"end\" not in node_types:\n            # endãƒãƒ¼ãƒ‰ãŒãªã„å ´åˆã€node_endãŒã‚ã‚Œã°ãã‚Œã‚’endã«è¨­å®š\n            end_node = next((n for n in nodes if n.id == \"node_end\"), None)\n            if end_node:\n                end_node.type = \"end\"\n            else:\n                # çµ‚äº†ãƒãƒ¼ãƒ‰ãŒãªã„å ´åˆã€æœ€å¾Œã®ãƒãƒ¼ãƒ‰ã‚’endã«è¨­å®š\n                if nodes:\n                    nodes[-1].type = \"end\"\n        \n        return Flowchart(nodes=nodes, edges=edges, subgraphs=None)\n    \n    @staticmethod\n    def _determine_node_type(shape_start: str, shape_end: str) -&gt; str:\n        \"\"\"\n        Mermaidã®å½¢çŠ¶ã‹ã‚‰ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®šã—ã¾ã™ã€‚\n        \n        Args:\n            shape_start: å½¢çŠ¶ã®é–‹å§‹æ–‡å­—ï¼ˆ[, {, (ï¼‰\n            shape_end: å½¢çŠ¶ã®çµ‚äº†æ–‡å­—ï¼ˆ], }, )ï¼‰\n            \n        Returns:\n            ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ï¼ˆstart, end, process, decisionï¼‰\n        \"\"\"\n        # ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ ([ ]) -&gt; start/end\n        if shape_start == \"(\" and shape_end == \")\":\n            return \"start\"  # æœ€åˆã«è¦‹ã¤ã‹ã£ãŸã‚‚ã®ã¯startã€æœ€å¾Œã¯endã«è¨­å®šã•ã‚Œã‚‹\n        \n        # è±å½¢ { } -&gt; decision\n        if shape_start == \"{\" and shape_end == \"}\":\n            return \"decision\"\n        \n        # é•·æ–¹å½¢ [ ] -&gt; process\n        if shape_start == \"[\" and shape_end == \"]\":\n            return \"process\"\n        \n        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯process\n        return \"process\"",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 6,
                "column": 1
              },
              "endPosition": {
                "line": 7,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 9,
                "column": 5
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 10,
                "column": 5
              },
              "endPosition": {
                "line": 11,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class MermaidParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "@staticmethod",
            "lineNumber": 9
          },
          {
            "text": "def parse(mermaid_text: str) -&gt; Flowchart:",
            "lineNumber": 10
          },
          {
            "lineNumber": 140
          },
          {
            "text": "        ",
            "lineNumber": 141
          },
          {
            "text": "        if \"end\" not in node_types:",
            "lineNumber": 142
          },
          {
            "text": "            # endãƒãƒ¼ãƒ‰ãŒãªã„å ´åˆã€node_endãŒã‚ã‚Œã°ãã‚Œã‚’endã«è¨­å®š",
            "lineNumber": 143
          },
          {
            "text": "            end_node = next((n for n in nodes if n.id == \"node_end\"), None)",
            "lineNumber": 144
          },
          {
            "text": "            if end_node:",
            "lineNumber": 145
          },
          {
            "text": "                end_node.type = \"end\"",
            "lineNumber": 146
          },
          {
            "text": "            else:",
            "lineNumber": 147
          },
          {
            "text": "                # çµ‚äº†ãƒãƒ¼ãƒ‰ãŒãªã„å ´åˆã€æœ€å¾Œã®ãƒãƒ¼ãƒ‰ã‚’endã«è¨­å®š",
            "lineNumber": 148
          },
          {
            "text": "                if nodes:",
            "lineNumber": 149
          },
          {
            "text": "                    nodes[-1].type = \"end\"",
            "lineNumber": 150
          },
          {
            "text": "        ",
            "lineNumber": 151
          },
          {
            "text": "        return Flowchart(nodes=nodes, edges=edges, subgraphs=None)",
            "lineNumber": 152
          },
          {
            "text": "    ",
            "lineNumber": 153
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 154
          },
          {
            "text": "    def _determine_node_type(shape_start: str, shape_end: str) -&gt; str:",
            "lineNumber": 155
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 156
          },
          {
            "text": "        Mermaidã®å½¢çŠ¶ã‹ã‚‰ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®šã—ã¾ã™ã€‚",
            "lineNumber": 157
          },
          {
            "text": "        ",
            "lineNumber": 158
          },
          {
            "text": "        Args:",
            "lineNumber": 159
          },
          {
            "text": "            shape_start: å½¢çŠ¶ã®é–‹å§‹æ–‡å­—ï¼ˆ[, {, (ï¼‰",
            "lineNumber": 160
          },
          {
            "text": "            shape_end: å½¢çŠ¶ã®çµ‚äº†æ–‡å­—ï¼ˆ], }, )ï¼‰",
            "lineNumber": 161
          },
          {
            "text": "            ",
            "lineNumber": 162
          },
          {
            "text": "        Returns:",
            "lineNumber": 163
          },
          {
            "text": "            ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ï¼ˆstart, end, process, decisionï¼‰",
            "lineNumber": 164
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 165
          },
          {
            "text": "        # ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ ([ ]) -&gt; start/end",
            "lineNumber": 166
          },
          {
            "text": "        if shape_start == \"(\" and shape_end == \")\":",
            "lineNumber": 167
          },
          {
            "text": "            return \"start\"  # æœ€åˆã«è¦‹ã¤ã‹ã£ãŸã‚‚ã®ã¯startã€æœ€å¾Œã¯endã«è¨­å®šã•ã‚Œã‚‹",
            "lineNumber": 168
          },
          {
            "text": "        ",
            "lineNumber": 169
          },
          {
            "text": "        # è±å½¢ { } -&gt; decision",
            "lineNumber": 170
          },
          {
            "text": "        if shape_start == \"{\" and shape_end == \"}\":",
            "lineNumber": 171
          },
          {
            "text": "            return \"decision\"",
            "lineNumber": 172
          },
          {
            "text": "        ",
            "lineNumber": 173
          },
          {
            "text": "        # é•·æ–¹å½¢ [ ] -&gt; process",
            "lineNumber": 174
          },
          {
            "text": "        if shape_start == \"[\" and shape_end == \"]\":",
            "lineNumber": 175
          },
          {
            "text": "            return \"process\"",
            "lineNumber": 176
          },
          {
            "text": "        ",
            "lineNumber": 177
          },
          {
            "text": "        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯process",
            "lineNumber": 178
          },
          {
            "text": "        return \"process\"",
            "lineNumber": 179,
            "isSignature": true
          }
        ]
      },
      "score": 0.26061224937438965
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 24
          },
          "endPosition": {
            "line": 336
          }
        },
        "contents": "class Flowchart(BaseModel):\ndef to_mermaid(self) -&gt; str:\n\n        else:\n            # subgraphãŒãªã„å ´åˆã¯å¾“æ¥é€šã‚Š\n            for n in self.nodes:\n                safe_id = f\"n_{n.id}\" if n.id == \"end\" else n.id\n                shape = self._get_node_shape(n.type)\n                \n                if shape == \"([ ])\":  # START/END\n                    lines.append(f'{safe_id}[\"{n.label}\"]')\n                elif shape == \"[ ]\":  # PROCESS\n                    lines.append(f'{safe_id}[\"{n.label}\"]')\n                elif shape == \"{ }\":  # DECISION\n                    lines.append(f'{safe_id}{{\"{n.label}\"}}')\n                elif shape == \"[/ /]\":  # IO_DATA (å¹³è¡Œå››è¾ºå½¢)\n                    lines.append(f'{safe_id}[/\"{n.label}\"/]')\n                elif shape == \"[( )]\":  # STORAGE (å††ç­’å½¢)\n                    lines.append(f'{safe_id}[(\"{n.label}\")]')\n                elif shape == \"{{ }}\":  # MISSING\n                    lines.append(f'{safe_id}{{\"{n.label}\"}}')\n                \n                color = self._get_status_color(n.status)\n                style_lines.append(f'    style {safe_id} fill:{color}')\n        \n        # ã‚¨ãƒƒã‚¸å®šç¾©\n        for e in self.edges:\n            src = f\"n_{e.source}\" if e.source == \"end\" else e.source\n            tgt = f\"n_{e.target}\" if e.target == \"end\" else e.target\n            \n            if e.label:\n                lines.append(f'{src}--&gt;|\"{e.label}\"|{tgt}')\n            else:\n                lines.append(f'{src}--&gt;{tgt}')\n        \n        # ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©ã‚’è¿½åŠ \n        if style_lines:\n            lines.append(\"\")\n            lines.extend(style_lines)\n            \n        return \"\\n\".join(lines)\n\n    def to_toon_format(self) -&gt; str:\n        \"\"\"Flowchartã‚’TOONå½¢å¼ï¼ˆMarkdownï¼‰ã«å¤‰æ›\"\"\"",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 25,
                "column": 1
              },
              "endPosition": {
                "line": 26,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 202,
                "column": 5
              },
              "endPosition": {
                "line": 203,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 25,
            "isSignature": true
          },
          {
            "text": "def to_mermaid(self) -&gt; str:",
            "lineNumber": 202
          },
          {
            "lineNumber": 264
          },
          {
            "text": "        else:",
            "lineNumber": 265
          },
          {
            "text": "            # subgraphãŒãªã„å ´åˆã¯å¾“æ¥é€šã‚Š",
            "lineNumber": 266
          },
          {
            "text": "            for n in self.nodes:",
            "lineNumber": 267
          },
          {
            "text": "                safe_id = f\"n_{n.id}\" if n.id == \"end\" else n.id",
            "lineNumber": 268
          },
          {
            "text": "                shape = self._get_node_shape(n.type)",
            "lineNumber": 269
          },
          {
            "text": "                ",
            "lineNumber": 270
          },
          {
            "text": "                if shape == \"([ ])\":  # START/END",
            "lineNumber": 271
          },
          {
            "text": "                    lines.append(f'{safe_id}[\"{n.label}\"]')",
            "lineNumber": 272
          },
          {
            "text": "                elif shape == \"[ ]\":  # PROCESS",
            "lineNumber": 273
          },
          {
            "text": "                    lines.append(f'{safe_id}[\"{n.label}\"]')",
            "lineNumber": 274
          },
          {
            "text": "                elif shape == \"{ }\":  # DECISION",
            "lineNumber": 275
          },
          {
            "text": "                    lines.append(f'{safe_id}{{\"{n.label}\"}}')",
            "lineNumber": 276
          },
          {
            "text": "                elif shape == \"[/ /]\":  # IO_DATA (å¹³è¡Œå››è¾ºå½¢)",
            "lineNumber": 277
          },
          {
            "text": "                    lines.append(f'{safe_id}[/\"{n.label}\"/]')",
            "lineNumber": 278
          },
          {
            "text": "                elif shape == \"[( )]\":  # STORAGE (å††ç­’å½¢)",
            "lineNumber": 279
          },
          {
            "text": "                    lines.append(f'{safe_id}[(\"{n.label}\")]')",
            "lineNumber": 280
          },
          {
            "text": "                elif shape == \"{{ }}\":  # MISSING",
            "lineNumber": 281
          },
          {
            "text": "                    lines.append(f'{safe_id}{{\"{n.label}\"}}')",
            "lineNumber": 282
          },
          {
            "text": "                ",
            "lineNumber": 283
          },
          {
            "text": "                color = self._get_status_color(n.status)",
            "lineNumber": 284
          },
          {
            "text": "                style_lines.append(f'    style {safe_id} fill:{color}')",
            "lineNumber": 285
          },
          {
            "text": "        ",
            "lineNumber": 286
          },
          {
            "text": "        # ã‚¨ãƒƒã‚¸å®šç¾©",
            "lineNumber": 287
          },
          {
            "text": "        for e in self.edges:",
            "lineNumber": 288
          },
          {
            "text": "            src = f\"n_{e.source}\" if e.source == \"end\" else e.source",
            "lineNumber": 289
          },
          {
            "text": "            tgt = f\"n_{e.target}\" if e.target == \"end\" else e.target",
            "lineNumber": 290
          },
          {
            "text": "            ",
            "lineNumber": 291
          },
          {
            "text": "            if e.label:",
            "lineNumber": 292
          },
          {
            "text": "                lines.append(f'{src}--&gt;|\"{e.label}\"|{tgt}')",
            "lineNumber": 293
          },
          {
            "text": "            else:",
            "lineNumber": 294
          },
          {
            "text": "                lines.append(f'{src}--&gt;{tgt}')",
            "lineNumber": 295
          },
          {
            "text": "        ",
            "lineNumber": 296
          },
          {
            "text": "        # ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©ã‚’è¿½åŠ ",
            "lineNumber": 297
          },
          {
            "text": "        if style_lines:",
            "lineNumber": 298
          },
          {
            "text": "            lines.append(\"\")",
            "lineNumber": 299
          },
          {
            "text": "            lines.extend(style_lines)",
            "lineNumber": 300
          },
          {
            "text": "            ",
            "lineNumber": 301
          },
          {
            "text": "        return \"\\n\".join(lines)",
            "lineNumber": 302
          },
          {
            "lineNumber": 303
          },
          {
            "text": "    def to_toon_format(self) -&gt; str:",
            "lineNumber": 304
          },
          {
            "text": "        \"\"\"Flowchartã‚’TOONå½¢å¼ï¼ˆMarkdownï¼‰ã«å¤‰æ›\"\"\"",
            "lineNumber": 305
          }
        ]
      },
      "score": 0.2585527002811432
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\toon_parser.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 80
          }
        },
        "contents": "import re\nfrom typing import Dict, Optional\nfrom core.schemas import Node, Edge, Flowchart, NodeStatus\nfrom core.exceptions import TOONParseError\n\nclass TOONParser:\n    @staticmethod\n    def parse(text: str) -&gt; Flowchart:\n        # Markdownã®è£…é£¾ï¼ˆ&#96;&#96;&#96;toon...&#96;&#96;&#96;ï¼‰ãŒã‚ã‚Œã°é™¤å»\n        clean_text = re.sub(r'&#96;&#96;&#96;[a-zA-Z]*\\n?', '', text)\n        clean_text = clean_text.replace('&#96;&#96;&#96;', '').strip()\n\n        nodes = []\n        edges = []\n        subgraphs: Optional[Dict[str, str]] = None\n\n        # [Subgraph]ã‚¿ã‚°ã§åˆ†å‰²ã—ã¦æŠ½å‡º\n        subgraph_matches = re.split(r'\\[Subgraph\\]', clean_text, flags=re.IGNORECASE)[1:]\n        if subgraph_matches:\n            subgraphs = {}\n            for block in subgraph_matches:\n                data = TOONParser._parse_block(re.split(r'\\[', block)[0])\n                if 'id' in data and 'label' in data:\n                    sg_id = data['id'].strip()\n                    sg_label = data['label'].strip()\n                    subgraphs[sg_id] = sg_label\n\n        # [Node]ã‚¿ã‚°ã§åˆ†å‰²ã—ã¦æŠ½å‡º\n        node_matches = re.split(r'\\[Node\\]', clean_text, flags=re.IGNORECASE)[1:]\n        for block in node_matches:\n            # æ¬¡ã®ã‚¿ã‚°ã®æ‰‹å‰ã¾ã§ã‚’ãƒ‘ãƒ¼ã‚¹\n            data",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import re",
            "lineNumber": 1
          },
          {
            "text": "from typing import Dict, Optional",
            "lineNumber": 2
          },
          {
            "text": "from core.schemas import Node, Edge, Flowchart, NodeStatus",
            "lineNumber": 3
          },
          {
            "text": "from core.exceptions import TOONParseError",
            "lineNumber": 4
          },
          {
            "lineNumber": 5
          },
          {
            "text": "class TOONParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 7
          },
          {
            "text": "    def parse(text: str) -&gt; Flowchart:",
            "lineNumber": 8
          },
          {
            "text": "        # Markdownã®è£…é£¾ï¼ˆ&#96;&#96;&#96;toon...&#96;&#96;&#96;ï¼‰ãŒã‚ã‚Œã°é™¤å»",
            "lineNumber": 9
          },
          {
            "text": "        clean_text = re.sub(r'&#96;&#96;&#96;[a-zA-Z]*\\n?', '', text)",
            "lineNumber": 10
          },
          {
            "text": "        clean_text = clean_text.replace('&#96;&#96;&#96;', '').strip()",
            "lineNumber": 11
          },
          {
            "lineNumber": 12
          },
          {
            "text": "        nodes = []",
            "lineNumber": 13
          },
          {
            "text": "        edges = []",
            "lineNumber": 14
          },
          {
            "text": "        subgraphs: Optional[Dict[str, str]] = None",
            "lineNumber": 15
          },
          {
            "lineNumber": 16
          },
          {
            "text": "        # [Subgraph]ã‚¿ã‚°ã§åˆ†å‰²ã—ã¦æŠ½å‡º",
            "lineNumber": 17
          },
          {
            "text": "        subgraph_matches = re.split(r'\\[Subgraph\\]', clean_text, flags=re.IGNORECASE)[1:]",
            "lineNumber": 18
          },
          {
            "text": "        if subgraph_matches:",
            "lineNumber": 19
          },
          {
            "text": "            subgraphs = {}",
            "lineNumber": 20
          },
          {
            "text": "            for block in subgraph_matches:",
            "lineNumber": 21
          },
          {
            "text": "                data = TOONParser._parse_block(re.split(r'\\[', block)[0])",
            "lineNumber": 22
          },
          {
            "text": "                if 'id' in data and 'label' in data:",
            "lineNumber": 23
          },
          {
            "text": "                    sg_id = data['id'].strip()",
            "lineNumber": 24
          },
          {
            "text": "                    sg_label = data['label'].strip()",
            "lineNumber": 25
          },
          {
            "text": "                    subgraphs[sg_id] = sg_label",
            "lineNumber": 26
          },
          {
            "lineNumber": 27
          },
          {
            "text": "        # [Node]ã‚¿ã‚°ã§åˆ†å‰²ã—ã¦æŠ½å‡º",
            "lineNumber": 28
          },
          {
            "text": "        node_matches = re.split(r'\\[Node\\]', clean_text, flags=re.IGNORECASE)[1:]",
            "lineNumber": 29
          },
          {
            "text": "        for block in node_matches:",
            "lineNumber": 30
          },
          {
            "text": "            # æ¬¡ã®ã‚¿ã‚°ã®æ‰‹å‰ã¾ã§ã‚’ãƒ‘ãƒ¼ã‚¹",
            "lineNumber": 31
          },
          {
            "text": "            data",
            "lineNumber": 32
          }
        ]
      },
      "score": 0.2550468444824219
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\rules.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 26
          }
        },
        "contents": "# Skills: Flowchart Logic Expert\n\n## Core Rules\n- **Logical Integrity**: å…¨ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ã¯å¿…ãšã€Œé–‹å§‹ã€ã‹ã‚‰å§‹ã¾ã‚Šã€Œçµ‚äº†ã€ã¸åˆ°é”ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚\n- **Reserved Word Protection**: Mermaid.js ã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã‚’é˜²ããŸã‚ã€çµ‚äº†ãƒãƒ¼ãƒ‰ã® ID ã«ã¯å¿…ãš &#96;node_end&#96; ã‚’ä½¿ç”¨ã—ã€ID å˜ä½“ã§ &#96;end&#96; ã‚’ä½¿ç”¨ã—ã¦ã¯ãªã‚‰ãªã„ã€‚\n- **Node Classification**:\n  - &#96;start&#96;: ãƒ•ãƒ­ãƒ¼ã®èµ·ç‚¹ã€‚\n  - &#96;end&#96;: ãƒ•ãƒ­ãƒ¼ã®çµ‚ç€ç‚¹ã€‚\n  - &#96;process&#96;: å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚„ä½œæ¥­ã€‚\n  - &#96;decision&#96;: äºŒè€…æŠä¸€ã€ã¾ãŸã¯å¤šè‚¢é¸æŠã®åˆ†å²ç‚¹ã€‚\n- **Atomic Steps**: 1ã¤ã®ãƒãƒ¼ãƒ‰ã«è¤‡æ•°ã®å·¥ç¨‹ã‚’è©°ã‚è¾¼ã¾ãšã€å¯èƒ½ãªé™ã‚Šæœ€å°å˜ä½ã«åˆ†å‰²ã™ã‚‹ã“ã¨ã€‚\n\n## Constraints\n- Windows / Python 3.10+ ç’°å¢ƒã§å‹•ä½œã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã‚ã‚‹ã“ã¨ã‚’æ„è­˜ã™ã‚‹ã“ã¨ã€‚\n- æ—¥æœ¬èªãƒ©ãƒ™ãƒ«ã¯å¸¸ã«æ­£ç¢ºã«ã€ã‹ã¤ç°¡æ½”ã«è¡¨ç¾ã™ã‚‹ã“ã¨ã€‚\n\n## Output Size Limits\n- **ãƒãƒ¼ãƒ‰æ•°ã®åˆ¶é™**: 1ã¤ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã«å«ã¾ã‚Œã‚‹ãƒãƒ¼ãƒ‰æ•°ã¯æœ€å¤§30å€‹ã¾ã§ã¨ã™ã‚‹ã€‚ã“ã‚Œã‚’è¶…ãˆã‚‹å ´åˆã¯ã€è¤‡æ•°ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã«åˆ†å‰²ã™ã‚‹ã‹ã€ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚\n- **ã‚¨ãƒƒã‚¸æ•°ã®åˆ¶é™**: ã‚¨ãƒƒã‚¸æ•°ã¯æœ€å¤§50å€‹ã¾ã§ã¨ã™ã‚‹ã€‚è¤‡é›‘ãªåˆ†å²ãŒå¤šã„å ´åˆã¯ã€ä¸»è¦ãªãƒ‘ã‚¹ã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚\n- **éƒ¨åˆ†çš„ãªãƒ•ãƒ­ãƒ¼ã®ç”Ÿæˆã‚’æ¨å¥¨**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã‚„éƒ¨åˆ†ã‚’æŒ‡å®šã—ã¦ã„ã‚‹å ´åˆã€ãã®éƒ¨åˆ†ã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚å…¨ãƒ«ãƒ¼ãƒˆã‚’å«ã‚€å¿…è¦ã¯ãªã„ã€‚\n- **æ®µéšçš„ãªç”Ÿæˆ**: å¤§è¦æ¨¡ãªãƒ—ãƒ­ã‚»ã‚¹ã‚’å¯è¦–åŒ–ã™ã‚‹å ´åˆã€ã¾ãšä¸»è¦ãªãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆã—ã€è©³ç´°ã¯å¾Œã‹ã‚‰è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã™ã‚‹ã€‚\n- **Streamlitè¡¨ç¤ºã®æœ€é©åŒ–**: Streamlitã§ãƒãƒ¼ãƒ¡ã‚¤ãƒ‰å›³ã‚’è¡¨ç¤ºã™ã‚‹éš›ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ã—ã€éåº¦ã«è¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã¯é¿ã‘ã‚‹ã“ã¨ã€‚\n\n## Subgraph Usage\n- **è¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–**: é–¢é€£ã™ã‚‹ãƒãƒ¼ãƒ‰ãŒ5å€‹ä»¥ä¸Šã‚ã‚‹å ´åˆã€ã¾ãŸã¯ç‰¹å®šã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ã¨ã—ã¦ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã§ãã‚‹å ´åˆã¯ã€&#96;[Subgraph]&#96;ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦è¦–èªæ€§ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ã€‚\n- **subgraphã®å‘½å**: subgraphã®IDã¨labelã¯ã€ãã®ãƒ•ãƒ­ãƒ¼ã®å†…å®¹ã‚’æ˜ç¢ºã«ç¤ºã™ã‚‚ã®ã¨ã™ã‚‹ã“ã¨ã€‚",
        "signatures": {},
        "detailedLines": [
          {
            "text": "# Skills: Flowchart Logic Expert",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "## Core Rules",
            "lineNumber": 3
          },
          {
            "text": "- **Logical Integrity**: å…¨ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ã¯å¿…ãšã€Œé–‹å§‹ã€ã‹ã‚‰å§‹ã¾ã‚Šã€Œçµ‚äº†ã€ã¸åˆ°é”ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚",
            "lineNumber": 4
          },
          {
            "text": "- **Reserved Word Protection**: Mermaid.js ã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã‚’é˜²ããŸã‚ã€çµ‚äº†ãƒãƒ¼ãƒ‰ã® ID ã«ã¯å¿…ãš &#96;node_end&#96; ã‚’ä½¿ç”¨ã—ã€ID å˜ä½“ã§ &#96;end&#96; ã‚’ä½¿ç”¨ã—ã¦ã¯ãªã‚‰ãªã„ã€‚",
            "lineNumber": 5
          },
          {
            "text": "- **Node Classification**:",
            "lineNumber": 6
          },
          {
            "text": "  - &#96;start&#96;: ãƒ•ãƒ­ãƒ¼ã®èµ·ç‚¹ã€‚",
            "lineNumber": 7
          },
          {
            "text": "  - &#96;end&#96;: ãƒ•ãƒ­ãƒ¼ã®çµ‚ç€ç‚¹ã€‚",
            "lineNumber": 8
          },
          {
            "text": "  - &#96;process&#96;: å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚„ä½œæ¥­ã€‚",
            "lineNumber": 9
          },
          {
            "text": "  - &#96;decision&#96;: äºŒè€…æŠä¸€ã€ã¾ãŸã¯å¤šè‚¢é¸æŠã®åˆ†å²ç‚¹ã€‚",
            "lineNumber": 10
          },
          {
            "text": "- **Atomic Steps**: 1ã¤ã®ãƒãƒ¼ãƒ‰ã«è¤‡æ•°ã®å·¥ç¨‹ã‚’è©°ã‚è¾¼ã¾ãšã€å¯èƒ½ãªé™ã‚Šæœ€å°å˜ä½ã«åˆ†å‰²ã™ã‚‹ã“ã¨ã€‚",
            "lineNumber": 11
          },
          {
            "lineNumber": 12
          },
          {
            "text": "## Constraints",
            "lineNumber": 13
          },
          {
            "text": "- Windows / Python 3.10+ ç’°å¢ƒã§å‹•ä½œã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã‚ã‚‹ã“ã¨ã‚’æ„è­˜ã™ã‚‹ã“ã¨ã€‚",
            "lineNumber": 14
          },
          {
            "text": "- æ—¥æœ¬èªãƒ©ãƒ™ãƒ«ã¯å¸¸ã«æ­£ç¢ºã«ã€ã‹ã¤ç°¡æ½”ã«è¡¨ç¾ã™ã‚‹ã“ã¨ã€‚",
            "lineNumber": 15
          },
          {
            "lineNumber": 16
          },
          {
            "text": "## Output Size Limits",
            "lineNumber": 17
          },
          {
            "text": "- **ãƒãƒ¼ãƒ‰æ•°ã®åˆ¶é™**: 1ã¤ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã«å«ã¾ã‚Œã‚‹ãƒãƒ¼ãƒ‰æ•°ã¯æœ€å¤§30å€‹ã¾ã§ã¨ã™ã‚‹ã€‚ã“ã‚Œã‚’è¶…ãˆã‚‹å ´åˆã¯ã€è¤‡æ•°ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã«åˆ†å‰²ã™ã‚‹ã‹ã€ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚",
            "lineNumber": 18
          },
          {
            "text": "- **ã‚¨ãƒƒã‚¸æ•°ã®åˆ¶é™**: ã‚¨ãƒƒã‚¸æ•°ã¯æœ€å¤§50å€‹ã¾ã§ã¨ã™ã‚‹ã€‚è¤‡é›‘ãªåˆ†å²ãŒå¤šã„å ´åˆã¯ã€ä¸»è¦ãªãƒ‘ã‚¹ã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚",
            "lineNumber": 19
          },
          {
            "text": "- **éƒ¨åˆ†çš„ãªãƒ•ãƒ­ãƒ¼ã®ç”Ÿæˆã‚’æ¨å¥¨**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã‚„éƒ¨åˆ†ã‚’æŒ‡å®šã—ã¦ã„ã‚‹å ´åˆã€ãã®éƒ¨åˆ†ã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚å…¨ãƒ«ãƒ¼ãƒˆã‚’å«ã‚€å¿…è¦ã¯ãªã„ã€‚",
            "lineNumber": 20
          },
          {
            "text": "- **æ®µéšçš„ãªç”Ÿæˆ**: å¤§è¦æ¨¡ãªãƒ—ãƒ­ã‚»ã‚¹ã‚’å¯è¦–åŒ–ã™ã‚‹å ´åˆã€ã¾ãšä¸»è¦ãªãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆã—ã€è©³ç´°ã¯å¾Œã‹ã‚‰è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã™ã‚‹ã€‚",
            "lineNumber": 21
          },
          {
            "text": "- **Streamlitè¡¨ç¤ºã®æœ€é©åŒ–**: Streamlitã§ãƒãƒ¼ãƒ¡ã‚¤ãƒ‰å›³ã‚’è¡¨ç¤ºã™ã‚‹éš›ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ã—ã€éåº¦ã«è¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã¯é¿ã‘ã‚‹ã“ã¨ã€‚",
            "lineNumber": 22
          },
          {
            "lineNumber": 23
          },
          {
            "text": "## Subgraph Usage",
            "lineNumber": 24
          },
          {
            "text": "- **è¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–**: é–¢é€£ã™ã‚‹ãƒãƒ¼ãƒ‰ãŒ5å€‹ä»¥ä¸Šã‚ã‚‹å ´åˆã€ã¾ãŸã¯ç‰¹å®šã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ã¨ã—ã¦ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã§ãã‚‹å ´åˆã¯ã€&#96;[Subgraph]&#96;ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦è¦–èªæ€§ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ã€‚",
            "lineNumber": 25
          },
          {
            "text": "- **subgraphã®å‘½å**: subgraphã®IDã¨labelã¯ã€ãã®ãƒ•ãƒ­ãƒ¼ã®å†…å®¹ã‚’æ˜ç¢ºã«ç¤ºã™ã‚‚ã®ã¨ã™ã‚‹ã“ã¨ã€‚",
            "lineNumber": 26
          }
        ]
      },
      "score": 0.2508164644241333
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\Project.md",
        "range": {
          "startPosition": {
            "line": 28
          },
          "endPosition": {
            "line": 71
          }
        },
        "contents": "### 3.2 è¦–è¦šçš„æ‹¡å¼µï¼ˆå›³è§£ï¼‰æ©Ÿèƒ½\n\n* **Mermaid.jsã«ã‚ˆã‚‹æç”»:** TOONã®å„ã‚¿ã‚¤ãƒ—ã‚’ç‰¹å®šã®å½¢çŠ¶ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦è¡¨ç¤ºã™ã‚‹ã€‚\n* **ã€Œè«–ç†ã®ç©´ã€ã®æ¤œçŸ¥:** å‡ºå£ã®ãªã„åˆ†å²ã‚„ã€æ¥ç¶šå…ˆãŒæœªå®šç¾©ã®ãƒãƒ¼ãƒ‰ã‚’ &#96;MISSING&#96;ï¼ˆå…­è§’å½¢ãƒ»èµ¤è‰²ï¼‰ã¨ã—ã¦å¼·èª¿è¡¨ç¤ºã™ã‚‹ã€‚\n* **ã‚¹ã‚¿ã‚¤ãƒ«åˆ¶å¾¡:** ç¾åœ¨é€²è¡Œä¸­ã®ãƒãƒ¼ãƒ‰ã‚„å®Œäº†ã—ãŸå·¥ç¨‹ã‚’è‰²åˆ†ã‘ã—ã¦è¦–è¦šçš„ã«å¼·èª¿ã™ã‚‹ã€‚\n\n### 3.3 çŠ¶æ…‹ç®¡ç†æ©Ÿèƒ½\n\n* Streamlitã® &#96;session_state&#96; ã‚’åˆ©ç”¨ã—ã€å¯¾è©±ã®é€²æ—ã¨TOONã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’åŒæœŸã™ã‚‹ã€‚\n\n---\n\n## 4. ãƒ‡ãƒ¼ã‚¿å®šç¾©ï¼ˆTOON-Mermaid ãƒãƒƒãƒ”ãƒ³ã‚°ï¼‰\n\nç¾å ´ä½œæ¥­ã§ã®ã€Œè¦‹ã‚„ã™ã•ã€ã¨ã€Œç›´æ„Ÿæ€§ã€ã‚’é‡è¦–ã—ãŸå®šç¾©ã‚’æ¡ç”¨ã™ã‚‹ã€‚\n\n| ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ— | Mermaidå½¢çŠ¶ | è¨˜æ³• | æ„å‘³ãƒ»å½¹å‰² |\n| --- | --- | --- | --- |\n| **START/END** | ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ | &#96;([ ])&#96; | ãƒ•ãƒ­ãƒ¼ã®èµ·ç‚¹ãƒ»çµ‚ç€ç‚¹ã€‚ |\n| **PROCESS** | é•·æ–¹å½¢ | &#96;[ ]&#96; | å…·ä½“çš„ãªä½œæ¥­å†…å®¹ã‚„å‘½ä»¤ã€‚ |\n| **DECISION** | è±å½¢ | &#96;{ }&#96; | æ¡ä»¶åˆ†å²ã€‚Yes/Noãªã©ã®ãƒ«ãƒ¼ãƒˆåˆ†ã‘ã€‚ |\n| **IO_DATA** | å¹³è¡Œå››è¾ºå½¢ | &#96;[/ /]&#96; | ç”»é¢å…¥åŠ›ã‚„æ‰‹å‹•æ“ä½œã€‚ |\n| **STORAGE** | å††ç­’å½¢ | &#96;[( )]&#96; | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ“ä½œã€‚ |\n| **MISSING** | å…­è§’å½¢ï¼ˆèµ¤ï¼‰ | &#96;{{ }}&#96; | **æœªå®Ÿè£…ãƒ»è¦æ¤œè¨ç®‡æ‰€ã€‚** |\n\n---\n\n## 5. UI/UX è¨­è¨ˆæ¡ˆ\n\nç¾å ´ã§ã®ä½œæ¥­åŠ¹ç‡ã‚’æœ€å¤§åŒ–ã™ã‚‹ã€Œ3ãƒšã‚¤ãƒ³æ§‹æˆã€ã‚’æƒ³å®šã™ã‚‹ã€‚\n\n1. **å·¦ãƒšã‚¤ãƒ³ï¼ˆChatï¼‰:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒAIã¨å¯¾è©±ã™ã‚‹ã‚¨ãƒªã‚¢ã€‚\n2. **ä¸­å¤®ãƒšã‚¤ãƒ³ï¼ˆFlowchartï¼‰:** Mermaid.jsã«ã‚ˆã£ã¦æç”»ã•ã‚Œã‚‹å‹•çš„ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã€‚\n3. **å³ãƒšã‚¤ãƒ³ï¼ˆSourceï¼‰:** ç¾åœ¨ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã€‚\n\n---\n\n## 6. éæ©Ÿèƒ½è¦ä»¶\n\n* **æ‹¡å¼µæ€§:** TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…±é€šè¨€èªã¨ã™ã‚‹ã“ã¨ã§ã€å°†æ¥çš„ã«Pythonã‚³ãƒ¼ãƒ‰ã®è‡ªå‹•ç”Ÿæˆæ©Ÿèƒ½ãªã©ã‚’è¿½åŠ å¯èƒ½ã«ã™ã‚‹ã€‚\n* **å …ç‰¢æ€§:** è»½é‡LLMãŒãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ãŸå ´åˆã§ã‚‚ã€ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ã«ã‚ˆã£ã¦å›³è§£ãŒå´©ã‚Œã‚‹ã®ã‚’é˜²æ­¢ã™ã‚‹ã€‚\n* **è»½é‡åŒ–:** 2æ®µéšç›®ã®è§£æã«Gemma:4bç­‰ã®å°å‹ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®é«˜é€ŸåŒ–ã‚’å›³ã‚‹ã€‚",
        "signatures": {},
        "detailedLines": [
          {
            "text": "### 3.2 è¦–è¦šçš„æ‹¡å¼µï¼ˆå›³è§£ï¼‰æ©Ÿèƒ½",
            "lineNumber": 30
          },
          {
            "lineNumber": 31
          },
          {
            "text": "* **Mermaid.jsã«ã‚ˆã‚‹æç”»:** TOONã®å„ã‚¿ã‚¤ãƒ—ã‚’ç‰¹å®šã®å½¢çŠ¶ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦è¡¨ç¤ºã™ã‚‹ã€‚",
            "lineNumber": 32
          },
          {
            "text": "* **ã€Œè«–ç†ã®ç©´ã€ã®æ¤œçŸ¥:** å‡ºå£ã®ãªã„åˆ†å²ã‚„ã€æ¥ç¶šå…ˆãŒæœªå®šç¾©ã®ãƒãƒ¼ãƒ‰ã‚’ &#96;MISSING&#96;ï¼ˆå…­è§’å½¢ãƒ»èµ¤è‰²ï¼‰ã¨ã—ã¦å¼·èª¿è¡¨ç¤ºã™ã‚‹ã€‚",
            "lineNumber": 33
          },
          {
            "text": "* **ã‚¹ã‚¿ã‚¤ãƒ«åˆ¶å¾¡:** ç¾åœ¨é€²è¡Œä¸­ã®ãƒãƒ¼ãƒ‰ã‚„å®Œäº†ã—ãŸå·¥ç¨‹ã‚’è‰²åˆ†ã‘ã—ã¦è¦–è¦šçš„ã«å¼·èª¿ã™ã‚‹ã€‚",
            "lineNumber": 34
          },
          {
            "lineNumber": 35
          },
          {
            "text": "### 3.3 çŠ¶æ…‹ç®¡ç†æ©Ÿèƒ½",
            "lineNumber": 36
          },
          {
            "lineNumber": 37
          },
          {
            "text": "* Streamlitã® &#96;session_state&#96; ã‚’åˆ©ç”¨ã—ã€å¯¾è©±ã®é€²æ—ã¨TOONã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’åŒæœŸã™ã‚‹ã€‚",
            "lineNumber": 38
          },
          {
            "lineNumber": 39
          },
          {
            "text": "---",
            "lineNumber": 40
          },
          {
            "lineNumber": 41
          },
          {
            "text": "## 4. ãƒ‡ãƒ¼ã‚¿å®šç¾©ï¼ˆTOON-Mermaid ãƒãƒƒãƒ”ãƒ³ã‚°ï¼‰",
            "lineNumber": 42
          },
          {
            "lineNumber": 43
          },
          {
            "text": "ç¾å ´ä½œæ¥­ã§ã®ã€Œè¦‹ã‚„ã™ã•ã€ã¨ã€Œç›´æ„Ÿæ€§ã€ã‚’é‡è¦–ã—ãŸå®šç¾©ã‚’æ¡ç”¨ã™ã‚‹ã€‚",
            "lineNumber": 44
          },
          {
            "lineNumber": 45
          },
          {
            "text": "| ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ— | Mermaidå½¢çŠ¶ | è¨˜æ³• | æ„å‘³ãƒ»å½¹å‰² |",
            "lineNumber": 46
          },
          {
            "text": "| --- | --- | --- | --- |",
            "lineNumber": 47
          },
          {
            "text": "| **START/END** | ã‚¹ã‚¿ã‚¸ã‚¢ãƒ å½¢ | &#96;([ ])&#96; | ãƒ•ãƒ­ãƒ¼ã®èµ·ç‚¹ãƒ»çµ‚ç€ç‚¹ã€‚ |",
            "lineNumber": 48
          },
          {
            "text": "| **PROCESS** | é•·æ–¹å½¢ | &#96;[ ]&#96; | å…·ä½“çš„ãªä½œæ¥­å†…å®¹ã‚„å‘½ä»¤ã€‚ |",
            "lineNumber": 49
          },
          {
            "text": "| **DECISION** | è±å½¢ | &#96;{ }&#96; | æ¡ä»¶åˆ†å²ã€‚Yes/Noãªã©ã®ãƒ«ãƒ¼ãƒˆåˆ†ã‘ã€‚ |",
            "lineNumber": 50
          },
          {
            "text": "| **IO_DATA** | å¹³è¡Œå››è¾ºå½¢ | &#96;[/ /]&#96; | ç”»é¢å…¥åŠ›ã‚„æ‰‹å‹•æ“ä½œã€‚ |",
            "lineNumber": 51
          },
          {
            "text": "| **STORAGE** | å††ç­’å½¢ | &#96;[( )]&#96; | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ“ä½œã€‚ |",
            "lineNumber": 52
          },
          {
            "text": "| **MISSING** | å…­è§’å½¢ï¼ˆèµ¤ï¼‰ | &#96;{{ }}&#96; | **æœªå®Ÿè£…ãƒ»è¦æ¤œè¨ç®‡æ‰€ã€‚** |",
            "lineNumber": 53
          },
          {
            "lineNumber": 54
          },
          {
            "text": "---",
            "lineNumber": 55
          },
          {
            "lineNumber": 56
          },
          {
            "text": "## 5. UI/UX è¨­è¨ˆæ¡ˆ",
            "lineNumber": 57
          },
          {
            "lineNumber": 58
          },
          {
            "text": "ç¾å ´ã§ã®ä½œæ¥­åŠ¹ç‡ã‚’æœ€å¤§åŒ–ã™ã‚‹ã€Œ3ãƒšã‚¤ãƒ³æ§‹æˆã€ã‚’æƒ³å®šã™ã‚‹ã€‚",
            "lineNumber": 59
          },
          {
            "lineNumber": 60
          },
          {
            "text": "1. **å·¦ãƒšã‚¤ãƒ³ï¼ˆChatï¼‰:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒAIã¨å¯¾è©±ã™ã‚‹ã‚¨ãƒªã‚¢ã€‚",
            "lineNumber": 61
          },
          {
            "text": "2. **ä¸­å¤®ãƒšã‚¤ãƒ³ï¼ˆFlowchartï¼‰:** Mermaid.jsã«ã‚ˆã£ã¦æç”»ã•ã‚Œã‚‹å‹•çš„ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã€‚",
            "lineNumber": 62
          },
          {
            "text": "3. **å³ãƒšã‚¤ãƒ³ï¼ˆSourceï¼‰:** ç¾åœ¨ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã€‚",
            "lineNumber": 63
          },
          {
            "lineNumber": 64
          },
          {
            "text": "---",
            "lineNumber": 65
          },
          {
            "lineNumber": 66
          },
          {
            "text": "## 6. éæ©Ÿèƒ½è¦ä»¶",
            "lineNumber": 67
          },
          {
            "lineNumber": 68
          },
          {
            "text": "* **æ‹¡å¼µæ€§:** TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…±é€šè¨€èªã¨ã™ã‚‹ã“ã¨ã§ã€å°†æ¥çš„ã«Pythonã‚³ãƒ¼ãƒ‰ã®è‡ªå‹•ç”Ÿæˆæ©Ÿèƒ½ãªã©ã‚’è¿½åŠ å¯èƒ½ã«ã™ã‚‹ã€‚",
            "lineNumber": 69
          },
          {
            "text": "* **å …ç‰¢æ€§:** è»½é‡LLMãŒãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ãŸå ´åˆã§ã‚‚ã€ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ã«ã‚ˆã£ã¦å›³è§£ãŒå´©ã‚Œã‚‹ã®ã‚’é˜²æ­¢ã™ã‚‹ã€‚",
            "lineNumber": 70
          },
          {
            "text": "* **è»½é‡åŒ–:** 2æ®µéšç›®ã®è§£æã«Gemma:4bç­‰ã®å°å‹ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®é«˜é€ŸåŒ–ã‚’å›³ã‚‹ã€‚",
            "lineNumber": 71
          }
        ]
      },
      "score": 0.24933844804763794
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\storage\\sessions\\flow_md.json",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 65
          }
        },
        "contents": "[\n    {\n        \"nodes\": [\n            {\n                \"id\": \"start\",\n                \"label\": \"é–‹å§‹\",\n                \"type\": \"start\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"task1\",\n                \"label\": \"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\",\n                \"type\": \"process\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"task2\",\n                \"label\": \"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\",\n                \"type\": \"process\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"decision1\",\n                \"label\": \"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\",\n                \"type\": \"decision\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"task3\",\n                \"label\": \"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\",\n                \"type\": \"process\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"decision2\",\n                \"label\": \"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\",\n                \"type\": \"decision\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"task4\",\n                \"label\": \"è¡¨ç¤ºãŒãŠã‹ã—ã„\",\n                \"type\": \"process\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"decision3\",\n                \"label\": \"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\",\n                \"type\": \"decision\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"task5\",\n                \"label\": \"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\",\n                \"type\": \"process\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"task6\",\n                \"label\": \"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\",\n                \"type\": \"process\",\n                \"status\": \"active\"\n            },\n            {\n                \"id\": \"task7\",",
        "signatures": {},
        "detailedLines": [
          {
            "text": "[",
            "lineNumber": 1
          },
          {
            "text": "    {",
            "lineNumber": 2
          },
          {
            "text": "        \"nodes\": [",
            "lineNumber": 3
          },
          {
            "text": "            {",
            "lineNumber": 4
          },
          {
            "text": "                \"id\": \"start\",",
            "lineNumber": 5
          },
          {
            "text": "                \"label\": \"é–‹å§‹\",",
            "lineNumber": 6
          },
          {
            "text": "                \"type\": \"start\",",
            "lineNumber": 7
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 8
          },
          {
            "text": "            },",
            "lineNumber": 9
          },
          {
            "text": "            {",
            "lineNumber": 10
          },
          {
            "text": "                \"id\": \"task1\",",
            "lineNumber": 11
          },
          {
            "text": "                \"label\": \"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\",",
            "lineNumber": 12
          },
          {
            "text": "                \"type\": \"process\",",
            "lineNumber": 13
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 14
          },
          {
            "text": "            },",
            "lineNumber": 15
          },
          {
            "text": "            {",
            "lineNumber": 16
          },
          {
            "text": "                \"id\": \"task2\",",
            "lineNumber": 17
          },
          {
            "text": "                \"label\": \"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\",",
            "lineNumber": 18
          },
          {
            "text": "                \"type\": \"process\",",
            "lineNumber": 19
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 20
          },
          {
            "text": "            },",
            "lineNumber": 21
          },
          {
            "text": "            {",
            "lineNumber": 22
          },
          {
            "text": "                \"id\": \"decision1\",",
            "lineNumber": 23
          },
          {
            "text": "                \"label\": \"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\",",
            "lineNumber": 24
          },
          {
            "text": "                \"type\": \"decision\",",
            "lineNumber": 25
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 26
          },
          {
            "text": "            },",
            "lineNumber": 27
          },
          {
            "text": "            {",
            "lineNumber": 28
          },
          {
            "text": "                \"id\": \"task3\",",
            "lineNumber": 29
          },
          {
            "text": "                \"label\": \"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\",",
            "lineNumber": 30
          },
          {
            "text": "                \"type\": \"process\",",
            "lineNumber": 31
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 32
          },
          {
            "text": "            },",
            "lineNumber": 33
          },
          {
            "text": "            {",
            "lineNumber": 34
          },
          {
            "text": "                \"id\": \"decision2\",",
            "lineNumber": 35
          },
          {
            "text": "                \"label\": \"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\",",
            "lineNumber": 36
          },
          {
            "text": "                \"type\": \"decision\",",
            "lineNumber": 37
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 38
          },
          {
            "text": "            },",
            "lineNumber": 39
          },
          {
            "text": "            {",
            "lineNumber": 40
          },
          {
            "text": "                \"id\": \"task4\",",
            "lineNumber": 41
          },
          {
            "text": "                \"label\": \"è¡¨ç¤ºãŒãŠã‹ã—ã„\",",
            "lineNumber": 42
          },
          {
            "text": "                \"type\": \"process\",",
            "lineNumber": 43
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 44
          },
          {
            "text": "            },",
            "lineNumber": 45
          },
          {
            "text": "            {",
            "lineNumber": 46
          },
          {
            "text": "                \"id\": \"decision3\",",
            "lineNumber": 47
          },
          {
            "text": "                \"label\": \"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\",",
            "lineNumber": 48
          },
          {
            "text": "                \"type\": \"decision\",",
            "lineNumber": 49
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 50
          },
          {
            "text": "            },",
            "lineNumber": 51
          },
          {
            "text": "            {",
            "lineNumber": 52
          },
          {
            "text": "                \"id\": \"task5\",",
            "lineNumber": 53
          },
          {
            "text": "                \"label\": \"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\",",
            "lineNumber": 54
          },
          {
            "text": "                \"type\": \"process\",",
            "lineNumber": 55
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 56
          },
          {
            "text": "            },",
            "lineNumber": 57
          },
          {
            "text": "            {",
            "lineNumber": 58
          },
          {
            "text": "                \"id\": \"task6\",",
            "lineNumber": 59
          },
          {
            "text": "                \"label\": \"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\",",
            "lineNumber": 60
          },
          {
            "text": "                \"type\": \"process\",",
            "lineNumber": 61
          },
          {
            "text": "                \"status\": \"active\"",
            "lineNumber": 62
          },
          {
            "text": "            },",
            "lineNumber": 63
          },
          {
            "text": "            {",
            "lineNumber": 64
          },
          {
            "text": "                \"id\": \"task7\",",
            "lineNumber": 65
          }
        ]
      },
      "score": 0.242406964302063
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\TOON_BASE.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 86,
            "column": 16
          }
        },
        "contents": "# Output Format: TOON (Token-Oriented Object Notation)\n\nå›ç­”ã¯ä»¥ä¸‹ã®ãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ã®ã¿ã§æ§‹æˆã—ã¦ãã ã•ã„ã€‚è§£èª¬ã‚„å°å…¥æ–‡ã¯ä¸€åˆ‡ç¦æ­¢ã—ã¾ã™ã€‚\n\n## Output Size Guidelines\n- **ãƒãƒ¼ãƒ‰æ•°**: æœ€å¤§30å€‹ã¾ã§ï¼ˆStreamlitã§ã®è¡¨ç¤ºãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ï¼‰\n- **ã‚¨ãƒƒã‚¸æ•°**: æœ€å¤§50å€‹ã¾ã§\n- **éƒ¨åˆ†çš„ãªãƒ•ãƒ­ãƒ¼ã®ç”Ÿæˆ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã‚„éƒ¨åˆ†ã‚’æŒ‡å®šã—ã¦ã„ã‚‹å ´åˆã€ãã®éƒ¨åˆ†ã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚å…¨ãƒ«ãƒ¼ãƒˆã‚’å«ã‚€å¿…è¦ã¯ãªã„ã€‚\n- **è¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ã®å ´åˆ**: ã¾ãšä¸»è¦ãªãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆã—ã€è©³ç´°ã¯å¾Œã‹ã‚‰è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã™ã‚‹ã€‚\n\n[Subgraph]\nid: (subgraphã®ID)\nlabel: (subgraphã®ãƒ©ãƒ™ãƒ«)\nâ€» ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼šè¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã™ã‚‹å ´åˆã«ä½¿ç”¨\n\n[Node]\nid: (è‹±æ•°å­—ID)\nlabel: (å·¥ç¨‹å)\ntype: (start | end | process | decision | io_data | storage)\nsubgraph: (subgraphã®ID) â€» ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼šã“ã®ãƒãƒ¼ãƒ‰ãŒå±ã™ã‚‹subgraph\n\n[Edge]\nsource: (ç™ºä¿¡å…ƒID)\ntarget: (å®›å…ˆID)\nlabel: (åˆ†å²æ¡ä»¶ãŒã‚ã‚‹å ´åˆã®ã¿)\n\n## Examples\n\n### åŸºæœ¬çš„ãªä¾‹\n[Node]\nid: start\nlabel: é–‹å§‹\ntype: start\n[Node]\nid: task1\nlabel: å‡¦ç†\ntype: process\n[Node]\nid: node_end\nlabel: çµ‚äº†\ntype: end\n[Edge]\nsource: start\ntarget: task1\n[Edge]\nsource: task1\ntarget: node_end\n\n### subgraphã‚’ä½¿ç”¨ã—ãŸä¾‹\n[Subgraph]\nid: flow1\nlabel: è©³ç´°å‡¦ç†ãƒ•ãƒ­ãƒ¼\n\n[Node]\nid: start\nlabel: é–‹å§‹\ntype: start\n[Node]\nid: task1\nlabel: å‡¦ç†\ntype: process\n[Node]\nid: check1\nlabel: ãƒã‚§ãƒƒã‚¯\ntype: decision\nsubgraph: flow1\n[Node]\nid: task2\nlabel: è©³ç´°å‡¦ç†\ntype: process\nsubgraph: flow1\n[Node]\nid: node_end\nlabel: çµ‚äº†\ntype: end\n[Edge]\nsource: start\ntarget: task1\n[Edge]\nsource: task1\ntarget: check1\n[Edge]\nsource: check1\ntarget: task2\n[Edge]\nsource: task2\ntarget: node_end",
        "signatures": {},
        "detailedLines": [
          {
            "text": "# Output Format: TOON (Token-Oriented Object Notation)",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "å›ç­”ã¯ä»¥ä¸‹ã®ãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ã®ã¿ã§æ§‹æˆã—ã¦ãã ã•ã„ã€‚è§£èª¬ã‚„å°å…¥æ–‡ã¯ä¸€åˆ‡ç¦æ­¢ã—ã¾ã™ã€‚",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "## Output Size Guidelines",
            "lineNumber": 5
          },
          {
            "text": "- **ãƒãƒ¼ãƒ‰æ•°**: æœ€å¤§30å€‹ã¾ã§ï¼ˆStreamlitã§ã®è¡¨ç¤ºãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ï¼‰",
            "lineNumber": 6
          },
          {
            "text": "- **ã‚¨ãƒƒã‚¸æ•°**: æœ€å¤§50å€‹ã¾ã§",
            "lineNumber": 7
          },
          {
            "text": "- **éƒ¨åˆ†çš„ãªãƒ•ãƒ­ãƒ¼ã®ç”Ÿæˆ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã‚„éƒ¨åˆ†ã‚’æŒ‡å®šã—ã¦ã„ã‚‹å ´åˆã€ãã®éƒ¨åˆ†ã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚å…¨ãƒ«ãƒ¼ãƒˆã‚’å«ã‚€å¿…è¦ã¯ãªã„ã€‚",
            "lineNumber": 8
          },
          {
            "text": "- **è¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ã®å ´åˆ**: ã¾ãšä¸»è¦ãªãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆã—ã€è©³ç´°ã¯å¾Œã‹ã‚‰è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã™ã‚‹ã€‚",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "text": "[Subgraph]",
            "lineNumber": 11
          },
          {
            "text": "id: (subgraphã®ID)",
            "lineNumber": 12
          },
          {
            "text": "label: (subgraphã®ãƒ©ãƒ™ãƒ«)",
            "lineNumber": 13
          },
          {
            "text": "â€» ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼šè¤‡é›‘ãªãƒ•ãƒ­ãƒ¼ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã™ã‚‹å ´åˆã«ä½¿ç”¨",
            "lineNumber": 14
          },
          {
            "lineNumber": 15
          },
          {
            "text": "[Node]",
            "lineNumber": 16
          },
          {
            "text": "id: (è‹±æ•°å­—ID)",
            "lineNumber": 17
          },
          {
            "text": "label: (å·¥ç¨‹å)",
            "lineNumber": 18
          },
          {
            "text": "type: (start | end | process | decision | io_data | storage)",
            "lineNumber": 19
          },
          {
            "text": "subgraph: (subgraphã®ID) â€» ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼šã“ã®ãƒãƒ¼ãƒ‰ãŒå±ã™ã‚‹subgraph",
            "lineNumber": 20
          },
          {
            "lineNumber": 21
          },
          {
            "text": "[Edge]",
            "lineNumber": 22
          },
          {
            "text": "source: (ç™ºä¿¡å…ƒID)",
            "lineNumber": 23
          },
          {
            "text": "target: (å®›å…ˆID)",
            "lineNumber": 24
          },
          {
            "text": "label: (åˆ†å²æ¡ä»¶ãŒã‚ã‚‹å ´åˆã®ã¿)",
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "text": "## Examples",
            "lineNumber": 27
          },
          {
            "lineNumber": 28
          },
          {
            "text": "### åŸºæœ¬çš„ãªä¾‹",
            "lineNumber": 29
          },
          {
            "text": "[Node]",
            "lineNumber": 30
          },
          {
            "text": "id: start",
            "lineNumber": 31
          },
          {
            "text": "label: é–‹å§‹",
            "lineNumber": 32
          },
          {
            "text": "type: start",
            "lineNumber": 33
          },
          {
            "text": "[Node]",
            "lineNumber": 34
          },
          {
            "text": "id: task1",
            "lineNumber": 35
          },
          {
            "text": "label: å‡¦ç†",
            "lineNumber": 36
          },
          {
            "text": "type: process",
            "lineNumber": 37
          },
          {
            "text": "[Node]",
            "lineNumber": 38
          },
          {
            "text": "id: node_end",
            "lineNumber": 39
          },
          {
            "text": "label: çµ‚äº†",
            "lineNumber": 40
          },
          {
            "text": "type: end",
            "lineNumber": 41
          },
          {
            "text": "[Edge]",
            "lineNumber": 42
          },
          {
            "text": "source: start",
            "lineNumber": 43
          },
          {
            "text": "target: task1",
            "lineNumber": 44
          },
          {
            "text": "[Edge]",
            "lineNumber": 45
          },
          {
            "text": "source: task1",
            "lineNumber": 46
          },
          {
            "text": "target: node_end",
            "lineNumber": 47
          },
          {
            "lineNumber": 48
          },
          {
            "text": "### subgraphã‚’ä½¿ç”¨ã—ãŸä¾‹",
            "lineNumber": 49
          },
          {
            "text": "[Subgraph]",
            "lineNumber": 50
          },
          {
            "text": "id: flow1",
            "lineNumber": 51
          },
          {
            "text": "label: è©³ç´°å‡¦ç†ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 52
          },
          {
            "lineNumber": 53
          },
          {
            "text": "[Node]",
            "lineNumber": 54
          },
          {
            "text": "id: start",
            "lineNumber": 55
          },
          {
            "text": "label: é–‹å§‹",
            "lineNumber": 56
          },
          {
            "text": "type: start",
            "lineNumber": 57
          },
          {
            "text": "[Node]",
            "lineNumber": 58
          },
          {
            "text": "id: task1",
            "lineNumber": 59
          },
          {
            "text": "label: å‡¦ç†",
            "lineNumber": 60
          },
          {
            "text": "type: process",
            "lineNumber": 61
          },
          {
            "text": "[Node]",
            "lineNumber": 62
          },
          {
            "text": "id: check1",
            "lineNumber": 63
          },
          {
            "text": "label: ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 64
          },
          {
            "text": "type: decision",
            "lineNumber": 65
          },
          {
            "text": "subgraph: flow1",
            "lineNumber": 66
          },
          {
            "text": "[Node]",
            "lineNumber": 67
          },
          {
            "text": "id: task2",
            "lineNumber": 68
          },
          {
            "text": "label: è©³ç´°å‡¦ç†",
            "lineNumber": 69
          },
          {
            "text": "type: process",
            "lineNumber": 70
          },
          {
            "text": "subgraph: flow1",
            "lineNumber": 71
          },
          {
            "text": "[Node]",
            "lineNumber": 72
          },
          {
            "text": "id: node_end",
            "lineNumber": 73
          },
          {
            "text": "label: çµ‚äº†",
            "lineNumber": 74
          },
          {
            "text": "type: end",
            "lineNumber": 75
          },
          {
            "text": "[Edge]",
            "lineNumber": 76
          },
          {
            "text": "source: start",
            "lineNumber": 77
          },
          {
            "text": "target: task1",
            "lineNumber": 78
          },
          {
            "text": "[Edge]",
            "lineNumber": 79
          },
          {
            "text": "source: task1",
            "lineNumber": 80
          },
          {
            "text": "target: check1",
            "lineNumber": 81
          },
          {
            "text": "[Edge]",
            "lineNumber": 82
          },
          {
            "text": "source: check1",
            "lineNumber": 83
          },
          {
            "text": "target: task2",
            "lineNumber": 84
          },
          {
            "text": "[Edge]",
            "lineNumber": 85
          },
          {
            "text": "source: task2",
            "lineNumber": 86
          },
          {
            "text": "target: node_end",
            "lineNumber": 87
          }
        ]
      },
      "score": 0.23991453647613525
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\flow.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 47
          }
        },
        "contents": "&#96;&#96;&#96;mermaid\ngraph TD\n    start[\"é–‹å§‹\"]\n    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]\n    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]\n    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]\n    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}\n    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}\n    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]\n    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]\n    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]\n    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]\n    task10[\"æµå‹•ã«æˆ»ã™\"]\n    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}\n    node_end[\"çµ‚äº†\"]\n    \n    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼\n    start--&gt;task1\n    task1--&gt;task2\n    task2--&gt;decision1\n    \n    %% å†ç¾ã—ãªã„å ´åˆ\n    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10\n    task10--&gt;decision_recurrence\n    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1\n    \n    %% å†ç¾ã™ã‚‹å ´åˆ\n    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3\n    task3--&gt;decision2\n    \n    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²\n    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4\n    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8\n    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9\n    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other\n    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "&#96;&#96;&#96;mermaid",
            "lineNumber": 1
          },
          {
            "text": "graph TD",
            "lineNumber": 2
          },
          {
            "text": "    start[\"é–‹å§‹\"]",
            "lineNumber": 3
          },
          {
            "text": "    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]",
            "lineNumber": 4
          },
          {
            "text": "    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]",
            "lineNumber": 5
          },
          {
            "text": "    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 6
          },
          {
            "text": "    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]",
            "lineNumber": 7
          },
          {
            "text": "    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}",
            "lineNumber": 8
          },
          {
            "text": "    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 9
          },
          {
            "text": "    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}",
            "lineNumber": 10
          },
          {
            "text": "    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 11
          },
          {
            "text": "    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 12
          },
          {
            "text": "    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]",
            "lineNumber": 13
          },
          {
            "text": "    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]",
            "lineNumber": 14
          },
          {
            "text": "    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]",
            "lineNumber": 15
          },
          {
            "text": "    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]",
            "lineNumber": 16
          },
          {
            "text": "    task10[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 17
          },
          {
            "text": "    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}",
            "lineNumber": 18
          },
          {
            "text": "    node_end[\"çµ‚äº†\"]",
            "lineNumber": 19
          },
          {
            "text": "    ",
            "lineNumber": 20
          },
          {
            "text": "    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 21
          },
          {
            "text": "    start--&gt;task1",
            "lineNumber": 22
          },
          {
            "text": "    task1--&gt;task2",
            "lineNumber": 23
          },
          {
            "text": "    task2--&gt;decision1",
            "lineNumber": 24
          },
          {
            "text": "    ",
            "lineNumber": 25
          },
          {
            "text": "    %% å†ç¾ã—ãªã„å ´åˆ",
            "lineNumber": 26
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 27
          },
          {
            "text": "    task10--&gt;decision_recurrence",
            "lineNumber": 28
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end",
            "lineNumber": 29
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1",
            "lineNumber": 30
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2",
            "lineNumber": 31
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3",
            "lineNumber": 32
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4",
            "lineNumber": 33
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1",
            "lineNumber": 34
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1",
            "lineNumber": 35
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1",
            "lineNumber": 36
          },
          {
            "text": "    ",
            "lineNumber": 37
          },
          {
            "text": "    %% å†ç¾ã™ã‚‹å ´åˆ",
            "lineNumber": 38
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3",
            "lineNumber": 39
          },
          {
            "text": "    task3--&gt;decision2",
            "lineNumber": 40
          },
          {
            "text": "    ",
            "lineNumber": 41
          },
          {
            "text": "    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²",
            "lineNumber": 42
          },
          {
            "text": "    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4",
            "lineNumber": 43
          },
          {
            "text": "    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8",
            "lineNumber": 44
          },
          {
            "text": "    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9",
            "lineNumber": 45
          },
          {
            "text": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other",
            "lineNumber": 46
          },
          {
            "text": "    ",
            "lineNumber": 47
          }
        ]
      },
      "score": 0.23153619468212128
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\mermaid_parser.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 178
          }
        },
        "contents": "import re\nfrom typing import List, Dict, Tuple\nfrom core.schemas import Node, Edge, Flowchart, NodeStatus\nfrom core.exceptions import TOONParseError\n\nclass MermaidParser:\n    \"\"\"Mermaidå½¢å¼ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹ãƒ‘ãƒ¼ã‚µãƒ¼\"\"\"\n    \n    @staticmethod\n    def parse(mermaid_text: str) -&gt; Flowchart:\n        \"\"\"\n        Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚\n        \n        Args:\n            mermaid_text: Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆ\n            \n        Returns:\n            Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ\n        \"\"\"\n        # Markdownã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’é™¤å»\n        clean_text = re.sub(r'&#96;&#96;&#96;mermaid\\s*\\n?', '', mermaid_text)\n        clean_text = clean_text.replace('&#96;&#96;&#96;', '').strip()\n        \n        lines = [line.strip() for line in clean_text.split('\\n') if line.strip()]\n        \n        nodes = []\n        edges = []\n        node_map = {}  # ID -&gt; Node ã®ãƒãƒƒãƒ”ãƒ³ã‚°\n        \n        # ãƒãƒ¼ãƒ‰å®šç¾©ã¨ã‚¨ãƒƒã‚¸å®šç¾©ã‚’æŠ½å‡º\n        in_subgraph = False\n        for line in lines:\n            # ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—\n            if line.startswith('%%'):\n                continue",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import re",
            "lineNumber": 1
          },
          {
            "text": "from typing import List, Dict, Tuple",
            "lineNumber": 2
          },
          {
            "text": "from core.schemas import Node, Edge, Flowchart, NodeStatus",
            "lineNumber": 3
          },
          {
            "text": "from core.exceptions import TOONParseError",
            "lineNumber": 4
          },
          {
            "lineNumber": 5
          },
          {
            "text": "class MermaidParser:",
            "lineNumber": 6,
            "isSignature": true
          },
          {
            "text": "    \"\"\"Mermaidå½¢å¼ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹ãƒ‘ãƒ¼ã‚µãƒ¼\"\"\"",
            "lineNumber": 7
          },
          {
            "text": "    ",
            "lineNumber": 8
          },
          {
            "text": "    @staticmethod",
            "lineNumber": 9
          },
          {
            "text": "    def parse(mermaid_text: str) -&gt; Flowchart:",
            "lineNumber": 10
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 11
          },
          {
            "text": "        Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚",
            "lineNumber": 12
          },
          {
            "text": "        ",
            "lineNumber": 13
          },
          {
            "text": "        Args:",
            "lineNumber": 14
          },
          {
            "text": "            mermaid_text: Mermaidå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆ",
            "lineNumber": 15
          },
          {
            "text": "            ",
            "lineNumber": 16
          },
          {
            "text": "        Returns:",
            "lineNumber": 17
          },
          {
            "text": "            Flowchartã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ",
            "lineNumber": 18
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 19
          },
          {
            "text": "        # Markdownã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’é™¤å»",
            "lineNumber": 20
          },
          {
            "text": "        clean_text = re.sub(r'&#96;&#96;&#96;mermaid\\s*\\n?', '', mermaid_text)",
            "lineNumber": 21
          },
          {
            "text": "        clean_text = clean_text.replace('&#96;&#96;&#96;', '').strip()",
            "lineNumber": 22
          },
          {
            "text": "        ",
            "lineNumber": 23
          },
          {
            "text": "        lines = [line.strip() for line in clean_text.split('\\n') if line.strip()]",
            "lineNumber": 24
          },
          {
            "text": "        ",
            "lineNumber": 25
          },
          {
            "text": "        nodes = []",
            "lineNumber": 26
          },
          {
            "text": "        edges = []",
            "lineNumber": 27
          },
          {
            "text": "        node_map = {}  # ID -&gt; Node ã®ãƒãƒƒãƒ”ãƒ³ã‚°",
            "lineNumber": 28
          },
          {
            "text": "        ",
            "lineNumber": 29
          },
          {
            "text": "        # ãƒãƒ¼ãƒ‰å®šç¾©ã¨ã‚¨ãƒƒã‚¸å®šç¾©ã‚’æŠ½å‡º",
            "lineNumber": 30
          },
          {
            "text": "        in_subgraph = False",
            "lineNumber": 31
          },
          {
            "text": "        for line in lines:",
            "lineNumber": 32
          },
          {
            "text": "            # ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—",
            "lineNumber": 33
          },
          {
            "text": "            if line.startswith('%%'):",
            "lineNumber": 34
          },
          {
            "text": "                continue",
            "lineNumber": 35
          }
        ]
      },
      "score": 0.22888803482055664
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\schemas.py",
        "range": {
          "startPosition": {
            "line": 24
          },
          "endPosition": {
            "line": 336
          }
        },
        "contents": "class Flowchart(BaseModel):\n\n\n    @model_validator(mode='after')\n    def validate_edges_reference_nodes(self):\n        \"\"\"ã‚¨ãƒƒã‚¸ãŒæœ‰åŠ¹ãªãƒãƒ¼ãƒ‰IDã‚’å‚ç…§ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆè­¦å‘Šã®ã¿ã€è«–ç†ã®ç©´æ¤œçŸ¥ã§è‡ªå‹•ä¿®æ­£ï¼‰\"\"\"\n        node_ids = {node.id for node in self.nodes}\n        \n        # ã‚¨ãƒƒã‚¸ã®æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆè­¦å‘Šã®ã¿ã€ä¾‹å¤–ã¯æŠ•ã’ãªã„ï¼‰\n        invalid_edges = []\n        for edge in self.edges:\n            if edge.source not in node_ids:\n                invalid_edges.append(f\"source '{edge.source}' ãŒå­˜åœ¨ã—ã¾ã›ã‚“\")\n            if edge.target not in node_ids:\n                invalid_edges.append(f\"target '{edge.target}' ãŒå­˜åœ¨ã—ã¾ã›ã‚“\")\n        \n        if invalid_edges:\n            # è­¦å‘Šã®ã¿ã‚’å‡ºåŠ›ï¼ˆè«–ç†ã®ç©´æ¤œçŸ¥ã§è‡ªå‹•ä¿®æ­£ã•ã‚Œã‚‹ï¼‰\n            warnings.warn(\n                f\"ç„¡åŠ¹ãªã‚¨ãƒƒã‚¸ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸï¼ˆè«–ç†ã®ç©´æ¤œçŸ¥ã§è‡ªå‹•ä¿®æ­£ã•ã‚Œã¾ã™ï¼‰: {', '.join(invalid_edges)}\",\n                UserWarning\n            )\n        \n        return self\n\n    def detect_logic_gaps(self) -&gt; List[Node]:\n        ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 25,
                "column": 1
              },
              "endPosition": {
                "line": 26,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Flowchart(BaseModel):",
            "lineNumber": 25,
            "isSignature": true
          },
          {
            "lineNumber": 53
          },
          {
            "lineNumber": 54
          },
          {
            "text": "    @model_validator(mode='after')",
            "lineNumber": 55
          },
          {
            "text": "    def validate_edges_reference_nodes(self):",
            "lineNumber": 56
          },
          {
            "text": "        \"\"\"ã‚¨ãƒƒã‚¸ãŒæœ‰åŠ¹ãªãƒãƒ¼ãƒ‰IDã‚’å‚ç…§ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆè­¦å‘Šã®ã¿ã€è«–ç†ã®ç©´æ¤œçŸ¥ã§è‡ªå‹•ä¿®æ­£ï¼‰\"\"\"",
            "lineNumber": 57
          },
          {
            "text": "        node_ids = {node.id for node in self.nodes}",
            "lineNumber": 58
          },
          {
            "text": "        ",
            "lineNumber": 59
          },
          {
            "text": "        # ã‚¨ãƒƒã‚¸ã®æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆè­¦å‘Šã®ã¿ã€ä¾‹å¤–ã¯æŠ•ã’ãªã„ï¼‰",
            "lineNumber": 60
          },
          {
            "text": "        invalid_edges = []",
            "lineNumber": 61
          },
          {
            "text": "        for edge in self.edges:",
            "lineNumber": 62
          },
          {
            "text": "            if edge.source not in node_ids:",
            "lineNumber": 63
          },
          {
            "text": "                invalid_edges.append(f\"source '{edge.source}' ãŒå­˜åœ¨ã—ã¾ã›ã‚“\")",
            "lineNumber": 64
          },
          {
            "text": "            if edge.target not in node_ids:",
            "lineNumber": 65
          },
          {
            "text": "                invalid_edges.append(f\"target '{edge.target}' ãŒå­˜åœ¨ã—ã¾ã›ã‚“\")",
            "lineNumber": 66
          },
          {
            "text": "        ",
            "lineNumber": 67
          },
          {
            "text": "        if invalid_edges:",
            "lineNumber": 68
          },
          {
            "text": "            # è­¦å‘Šã®ã¿ã‚’å‡ºåŠ›ï¼ˆè«–ç†ã®ç©´æ¤œçŸ¥ã§è‡ªå‹•ä¿®æ­£ã•ã‚Œã‚‹ï¼‰",
            "lineNumber": 69
          },
          {
            "text": "            warnings.warn(",
            "lineNumber": 70
          },
          {
            "text": "                f\"ç„¡åŠ¹ãªã‚¨ãƒƒã‚¸ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸï¼ˆè«–ç†ã®ç©´æ¤œçŸ¥ã§è‡ªå‹•ä¿®æ­£ã•ã‚Œã¾ã™ï¼‰: {', '.join(invalid_edges)}\",",
            "lineNumber": 71
          },
          {
            "text": "                UserWarning",
            "lineNumber": 72
          },
          {
            "text": "            )",
            "lineNumber": 73
          },
          {
            "text": "        ",
            "lineNumber": 74
          },
          {
            "text": "        return self",
            "lineNumber": 75
          },
          {
            "lineNumber": 76
          },
          {
            "text": "    def detect_logic_gaps(self) -&gt; List[Node]:",
            "lineNumber": 77
          },
          {
            "text": "        ",
            "lineNumber": 78
          }
        ]
      },
      "score": 0.22155989706516266
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\frontend\\index.html",
        "range": {
          "startPosition": {
            "line": 27
          },
          "endPosition": {
            "line": 51
          }
        },
        "contents": "            \n            subgraphs.forEach((subgraph, index) =&gt; {\n                // subgraphã®å¢ƒç•Œç·šï¼ˆrectï¼‰ã‚’æ¤œå‡º\n                const rect = subgraph.querySelector('rect');\n                // subgraphã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆtextè¦ç´ ï¼‰ã‚’æ¤œå‡º\n                const titleText = subgraph.querySelector('text');\n                \n                if (rect) {\n                    // å¢ƒç•Œç·šã‚’ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹\n                    rect.style.cursor = 'pointer';\n                    rect.setAttribute('data-subgraph-index', index);\n                    \n                    // ã‚¿ã‚¤ãƒˆãƒ«ã‚‚ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹\n                    if (titleText) {\n                        titleText.style.cursor = 'pointer';\n                        titleText.setAttribute('data-subgraph-index', index);\n                    }\n                    \n                    // æŠ˜ã‚ŠãŸãŸã¿çŠ¶æ…‹ã‚’ç®¡ç†ï¼ˆdataå±æ€§ã§ä¿å­˜ï¼‰\n                    let isCollapsed = false;\n                    \n                    const toggleCollapse = function(e) {\n                        e.stopPropagation();\n                        isCollapsed = !isCollapsed;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "            ",
            "lineNumber": 28
          },
          {
            "text": "            subgraphs.forEach((subgraph, index) =&gt; {",
            "lineNumber": 29
          },
          {
            "text": "                // subgraphã®å¢ƒç•Œç·šï¼ˆrectï¼‰ã‚’æ¤œå‡º",
            "lineNumber": 30
          },
          {
            "text": "                const rect = subgraph.querySelector('rect');",
            "lineNumber": 31
          },
          {
            "text": "                // subgraphã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆtextè¦ç´ ï¼‰ã‚’æ¤œå‡º",
            "lineNumber": 32
          },
          {
            "text": "                const titleText = subgraph.querySelector('text');",
            "lineNumber": 33
          },
          {
            "text": "                ",
            "lineNumber": 34
          },
          {
            "text": "                if (rect) {",
            "lineNumber": 35
          },
          {
            "text": "                    // å¢ƒç•Œç·šã‚’ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹",
            "lineNumber": 36
          },
          {
            "text": "                    rect.style.cursor = 'pointer';",
            "lineNumber": 37
          },
          {
            "text": "                    rect.setAttribute('data-subgraph-index', index);",
            "lineNumber": 38
          },
          {
            "text": "                    ",
            "lineNumber": 39
          },
          {
            "text": "                    // ã‚¿ã‚¤ãƒˆãƒ«ã‚‚ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹",
            "lineNumber": 40
          },
          {
            "text": "                    if (titleText) {",
            "lineNumber": 41
          },
          {
            "text": "                        titleText.style.cursor = 'pointer';",
            "lineNumber": 42
          },
          {
            "text": "                        titleText.setAttribute('data-subgraph-index', index);",
            "lineNumber": 43
          },
          {
            "text": "                    }",
            "lineNumber": 44
          },
          {
            "text": "                    ",
            "lineNumber": 45
          },
          {
            "text": "                    // æŠ˜ã‚ŠãŸãŸã¿çŠ¶æ…‹ã‚’ç®¡ç†ï¼ˆdataå±æ€§ã§ä¿å­˜ï¼‰",
            "lineNumber": 46
          },
          {
            "text": "                    let isCollapsed = false;",
            "lineNumber": 47
          },
          {
            "text": "                    ",
            "lineNumber": 48
          },
          {
            "text": "                    const toggleCollapse = function(e) {",
            "lineNumber": 49
          },
          {
            "text": "                        e.stopPropagation();",
            "lineNumber": 50
          },
          {
            "text": "                        isCollapsed = !isCollapsed;",
            "lineNumber": 51
          }
        ]
      },
      "score": 0.21458320319652557
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\storage\\toon_files\\flow_md.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 47
          }
        },
        "contents": "&#96;&#96;&#96;mermaid\ngraph TD\n    start[\"é–‹å§‹\"]\n    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]\n    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]\n    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]\n    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}\n    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}\n    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]\n    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]\n    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]\n    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]\n    task10[\"æµå‹•ã«æˆ»ã™\"]\n    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}\n    node_end[\"çµ‚äº†\"]\n    \n    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼\n    start--&gt;task1\n    task1--&gt;task2\n    task2--&gt;decision1\n    \n    %% å†ç¾ã—ãªã„å ´åˆ\n    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10\n    task10--&gt;decision_recurrence\n    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1\n    \n    %% å†ç¾ã™ã‚‹å ´åˆ\n    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3\n    task3--&gt;decision2\n    \n    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²\n    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4\n    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8\n    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9\n    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other\n    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "&#96;&#96;&#96;mermaid",
            "lineNumber": 1
          },
          {
            "text": "graph TD",
            "lineNumber": 2
          },
          {
            "text": "    start[\"é–‹å§‹\"]",
            "lineNumber": 3
          },
          {
            "text": "    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]",
            "lineNumber": 4
          },
          {
            "text": "    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]",
            "lineNumber": 5
          },
          {
            "text": "    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 6
          },
          {
            "text": "    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]",
            "lineNumber": 7
          },
          {
            "text": "    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}",
            "lineNumber": 8
          },
          {
            "text": "    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 9
          },
          {
            "text": "    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}",
            "lineNumber": 10
          },
          {
            "text": "    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 11
          },
          {
            "text": "    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 12
          },
          {
            "text": "    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]",
            "lineNumber": 13
          },
          {
            "text": "    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]",
            "lineNumber": 14
          },
          {
            "text": "    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]",
            "lineNumber": 15
          },
          {
            "text": "    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]",
            "lineNumber": 16
          },
          {
            "text": "    task10[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 17
          },
          {
            "text": "    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}",
            "lineNumber": 18
          },
          {
            "text": "    node_end[\"çµ‚äº†\"]",
            "lineNumber": 19
          },
          {
            "text": "    ",
            "lineNumber": 20
          },
          {
            "text": "    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 21
          },
          {
            "text": "    start--&gt;task1",
            "lineNumber": 22
          },
          {
            "text": "    task1--&gt;task2",
            "lineNumber": 23
          },
          {
            "text": "    task2--&gt;decision1",
            "lineNumber": 24
          },
          {
            "text": "    ",
            "lineNumber": 25
          },
          {
            "text": "    %% å†ç¾ã—ãªã„å ´åˆ",
            "lineNumber": 26
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 27
          },
          {
            "text": "    task10--&gt;decision_recurrence",
            "lineNumber": 28
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end",
            "lineNumber": 29
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1",
            "lineNumber": 30
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2",
            "lineNumber": 31
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3",
            "lineNumber": 32
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4",
            "lineNumber": 33
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1",
            "lineNumber": 34
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1",
            "lineNumber": 35
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1",
            "lineNumber": 36
          },
          {
            "text": "    ",
            "lineNumber": 37
          },
          {
            "text": "    %% å†ç¾ã™ã‚‹å ´åˆ",
            "lineNumber": 38
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3",
            "lineNumber": 39
          },
          {
            "text": "    task3--&gt;decision2",
            "lineNumber": 40
          },
          {
            "text": "    ",
            "lineNumber": 41
          },
          {
            "text": "    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²",
            "lineNumber": 42
          },
          {
            "text": "    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4",
            "lineNumber": 43
          },
          {
            "text": "    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8",
            "lineNumber": 44
          },
          {
            "text": "    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9",
            "lineNumber": 45
          },
          {
            "text": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other",
            "lineNumber": 46
          },
          {
            "text": "    ",
            "lineNumber": 47
          }
        ]
      },
      "score": 0.20691704750061035
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


å®Ÿè£…è¨ˆç”»ã‚’ä½œæˆä¸­ã€‚è¦ä»¶ã‚’ç¢ºèªã—ã¾ã™ã€‚


---

<tool-use data-tool-type="unknown" data-tool-name="ask_question">
<details>
<summary>Tool use: **ask_question**</summary>


Parameters:

```json
{
  "questions": [
    {
      "id": "selection_method",
      "prompt": "ãƒãƒ¼ãƒ‰ã‚„ãƒ•ãƒ­ãƒ¼ç¯„å›²ã‚’ã©ã®ã‚ˆã†ã«é¸æŠã—ã¾ã™ã‹ï¼Ÿ",
      "options": [
        {
          "id": "ui_select",
          "label": "UIã§ç›´æ¥é¸æŠï¼ˆãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆä¸Šã§ã‚¯ãƒªãƒƒã‚¯ã€è¤‡æ•°é¸æŠå¯ï¼‰"
        },
        {
          "id": "id_input",
          "label": "ãƒãƒ¼ãƒ‰IDã‚„ã‚¨ãƒƒã‚¸ã‚’ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã§æŒ‡å®š"
        },
        {
          "id": "hybrid_selection",
          "label": "ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼ˆUIé¸æŠ + ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã®ä¸¡æ–¹ï¼‰"
        }
      ]
    },
    {
      "id": "change_scope",
      "prompt": "å¤‰æ›´ç¯„å›²ã®æŒ‡å®šæ–¹æ³•ã¯ï¼Ÿ",
      "options": [
        {
          "id": "node_only",
          "label": "å˜ä¸€ãƒãƒ¼ãƒ‰ã®ã¿ï¼ˆãã®ãƒãƒ¼ãƒ‰ã¨æ¥ç¶šã‚¨ãƒƒã‚¸ï¼‰"
        },
        {
          "id": "subgraph",
          "label": "subgraphå…¨ä½“ï¼ˆsubgraphå†…ã®å…¨ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ï¼‰"
        },
        {
          "id": "flow_path",
          "label": "ãƒ•ãƒ­ãƒ¼ãƒ‘ã‚¹ï¼ˆé–‹å§‹ãƒãƒ¼ãƒ‰ã‹ã‚‰çµ‚äº†ãƒãƒ¼ãƒ‰ã¾ã§ã®çµŒè·¯ï¼‰"
        },
        {
          "id": "custom_range",
          "label": "ã‚«ã‚¹ã‚¿ãƒ ç¯„å›²ï¼ˆè¤‡æ•°ãƒãƒ¼ãƒ‰ã‚’è‡ªç”±ã«é¸æŠï¼‰"
        }
      ],
      "allowMultiple": true
    }
  ]
}
```
Additional data:

```json
{
  "status": "submitted"
}
```
Result:

```json
{
  "answers": [
    {
      "questionId": "selection_method",
      "selectedOptionIds": [
        "hybrid_selection"
      ],
      "freeformText": ""
    },
    {
      "questionId": "change_scope",
      "selectedOptionIds": [
        "node_only"
      ],
      "freeformText": ""
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


å›ç­”ã‚’åæ˜ ã—ã¦å®Ÿè£…è¨ˆç”»ã‚’ä½œæˆä¸­ã€‚


---

Cancelled

---

_**User**_

Implement the plan as specified, it is attached for your reference. Do NOT edit the plan file itself.

To-do's from the plan have already been created. Do not create them again. Mark them as in_progress as you work, starting with the first one. Don't stop until you have completed all the to-dos.

---

_**Agent (model default, mode Agent)**_



---


è¨ˆç”»ã«åŸºã¥ã„ã¦å®Ÿè£…ã‚’é–‹å§‹ã€‚è¨ˆç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã€TODOãƒªã‚¹ãƒˆã‚’æŠŠæ¡ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: c:\Users\btsi1\.cursor\plans\ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆéƒ¨åˆ†å¤‰æ›´æ©Ÿèƒ½_f97a0ecc.plan.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: frontend/index.html</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: app.py</summary>

</details>
</tool-use>

---



---


Phase 1ã‹ã‚‰å®Ÿè£…ã‚’é–‹å§‹ã€‚ã¾ãšé¸æŠçŠ¶æ…‹ã®ç®¡ç†ã‚’è¿½åŠ ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: app.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---



---


é¸æŠçŠ¶æ…‹ã®ç®¡ç†ã‚’è¿½åŠ æ¸ˆã¿ã€‚æ¬¡ã«ã€é¸æŠç¯„å›²ã®æŠ½å‡ºæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: core/flow_extractor.py</summary>

</details>

</tool-use>

---



---


éƒ¨åˆ†å¤‰æ›´ã®ãƒãƒ¼ã‚¸æ©Ÿèƒ½ã‚’å®Ÿè£…ä¸­ã€‚


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: core/flow_merger.py</summary>

</details>

</tool-use>

---



---


LLMClientã«éƒ¨åˆ†å¤‰æ›´ç”¨ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ä¸­ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/llm_client.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: core/llm_client.py</summary>

</details>

</tool-use>

---



---


app.pyã«ãƒãƒ¼ãƒ‰é¸æŠUIã¨éƒ¨åˆ†å¤‰æ›´å‡¦ç†ã‚’è¿½åŠ ä¸­ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: app.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "^from|^import",
  "path": "app.py",
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "^from|^import",
    "path": "app.py",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain": {
        "content": {
          "matches": [
            {
              "file": "app.py",
              "matches": [
                {
                  "lineNumber": 1,
                  "content": "import streamlit as st"
                },
                {
                  "lineNumber": 2,
                  "content": "import streamlit.components.v1 as components"
                },
                {
                  "lineNumber": 3,
                  "content": "import base64"
                },
                {
                  "lineNumber": 4,
                  "content": "from core.schemas import Node, Edge, Flowchart"
                },
                {
                  "lineNumber": 5,
                  "content": "from core.llm_client import LLMClient"
                },
                {
                  "lineNumber": 6,
                  "content": "from core.toon_parser import TOONParser"
                },
                {
                  "lineNumber": 7,
                  "content": "from core.history_mgr import HistoryManager"
                },
                {
                  "lineNumber": 8,
                  "content": "from core.exceptions import LLMAPIError, TOONParseError, FlowchartValidationError"
                },
                {
                  "lineNumber": 9,
                  "content": "from pathlib import Path"
                }
              ]
            }
          ],
          "totalLines": 9,
          "totalMatchedLines": 9
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: app.py</summary>

</details>
</tool-use>

---



---


app.pyã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’è¿½åŠ ã—ã€ãƒãƒ¼ãƒ‰é¸æŠUIã¨éƒ¨åˆ†å¤‰æ›´å‡¦ç†ã‚’å®Ÿè£…ä¸­ã€‚


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---



---


frontend/index.htmlã«ãƒãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯æ©Ÿèƒ½ã‚’è¿½åŠ ä¸­ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: frontend/index.html</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: frontend/index.html</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: frontend/index.html</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: frontend/index.html</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: frontend/index.html</summary>

</details>

</tool-use>

---



---


Streamlitã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åŒæ–¹å‘é€šä¿¡ã‚’ç¢ºèªã—ã€UIé¸æŠã®å®Ÿè£…ã‚’èª¿æ•´ä¸­ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: app.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "How does Streamlit components.html handle JavaScript messages or communication from iframe?",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\frontend\\index.html",
        "range": {
          "startPosition": {
            "line": 87
          },
          "endPosition": {
            "line": 120
          }
        },
        "contents": "                node.addEventListener('click', function(e) {\n                    e.stopPropagation();\n                    \n                    // Streamlitã«ãƒãƒ¼ãƒ‰IDã‚’é€ä¿¡\n                    // Streamlitã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé€šä¿¡ã‚’ä½¿ç”¨\n                    if (window.parent &amp;&amp; window.parent !== window) {\n                        window.parent.postMessage({\n                            type: 'streamlit:setComponentValue',\n                            value: {\n                                type: 'node_selected',\n                                nodeId: nodeId\n                            }\n                        }, '*');\n                    }\n                    \n                    // ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º\n                    toggleNodeHighlight(node);\n                });\n            });\n        }\n        \n        function addCollapseFunctionality(svgElement) {\n            // subgraphã®æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ã‚’è¿½åŠ \n            // Mermaid.jsãŒç”Ÿæˆã™ã‚‹SVGã®æ§‹é€ ã«åŸºã¥ã„ã¦å®Ÿè£…\n            \n            // subgraphã®ã‚°ãƒ«ãƒ¼ãƒ—è¦ç´ ã‚’æ¤œå‡ºï¼ˆclass=\"cluster\"ã‚’å«ã‚€&lt;g&gt;è¦ç´ ï¼‰\n            const subgraphs = svgElement.querySelectorAll('g.cluster');\n            \n            subgraphs.forEach((subgraph, index) =&gt; {\n                // subgraphã®å¢ƒç•Œç·šï¼ˆrectï¼‰ã‚’æ¤œå‡º\n                const rect = subgraph.querySelector('rect');\n                // subgraphã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆtextè¦ç´ ï¼‰ã‚’æ¤œå‡º\n                const titleText = subgraph.querySelector('text');",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                node.addEventListener('click', function(e) {",
            "lineNumber": 88
          },
          {
            "text": "                    e.stopPropagation();",
            "lineNumber": 89
          },
          {
            "text": "                    ",
            "lineNumber": 90
          },
          {
            "text": "                    // Streamlitã«ãƒãƒ¼ãƒ‰IDã‚’é€ä¿¡",
            "lineNumber": 91
          },
          {
            "text": "                    // Streamlitã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé€šä¿¡ã‚’ä½¿ç”¨",
            "lineNumber": 92
          },
          {
            "text": "                    if (window.parent &amp;&amp; window.parent !== window) {",
            "lineNumber": 93
          },
          {
            "text": "                        window.parent.postMessage({",
            "lineNumber": 94
          },
          {
            "text": "                            type: 'streamlit:setComponentValue',",
            "lineNumber": 95
          },
          {
            "text": "                            value: {",
            "lineNumber": 96
          },
          {
            "text": "                                type: 'node_selected',",
            "lineNumber": 97
          },
          {
            "text": "                                nodeId: nodeId",
            "lineNumber": 98
          },
          {
            "text": "                            }",
            "lineNumber": 99
          },
          {
            "text": "                        }, '*');",
            "lineNumber": 100
          },
          {
            "text": "                    }",
            "lineNumber": 101
          },
          {
            "text": "                    ",
            "lineNumber": 102
          },
          {
            "text": "                    // ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º",
            "lineNumber": 103
          },
          {
            "text": "                    toggleNodeHighlight(node);",
            "lineNumber": 104
          },
          {
            "text": "                });",
            "lineNumber": 105
          },
          {
            "text": "            });",
            "lineNumber": 106
          },
          {
            "text": "        }",
            "lineNumber": 107
          },
          {
            "text": "        ",
            "lineNumber": 108
          },
          {
            "text": "        function addCollapseFunctionality(svgElement) {",
            "lineNumber": 109
          },
          {
            "text": "            // subgraphã®æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ã‚’è¿½åŠ ",
            "lineNumber": 110
          },
          {
            "text": "            // Mermaid.jsãŒç”Ÿæˆã™ã‚‹SVGã®æ§‹é€ ã«åŸºã¥ã„ã¦å®Ÿè£…",
            "lineNumber": 111
          },
          {
            "text": "            ",
            "lineNumber": 112
          },
          {
            "text": "            // subgraphã®ã‚°ãƒ«ãƒ¼ãƒ—è¦ç´ ã‚’æ¤œå‡ºï¼ˆclass=\"cluster\"ã‚’å«ã‚€&lt;g&gt;è¦ç´ ï¼‰",
            "lineNumber": 113
          },
          {
            "text": "            const subgraphs = svgElement.querySelectorAll('g.cluster');",
            "lineNumber": 114
          },
          {
            "text": "            ",
            "lineNumber": 115
          },
          {
            "text": "            subgraphs.forEach((subgraph, index) =&gt; {",
            "lineNumber": 116
          },
          {
            "text": "                // subgraphã®å¢ƒç•Œç·šï¼ˆrectï¼‰ã‚’æ¤œå‡º",
            "lineNumber": 117
          },
          {
            "text": "                const rect = subgraph.querySelector('rect');",
            "lineNumber": 118
          },
          {
            "text": "                // subgraphã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆtextè¦ç´ ï¼‰ã‚’æ¤œå‡º",
            "lineNumber": 119
          },
          {
            "text": "                const titleText = subgraph.querySelector('text');",
            "lineNumber": 120
          }
        ]
      },
      "score": 0.3133828938007355
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 445,
            "column": 32
          },
          "endPosition": {
            "line": 494,
            "column": 28
          }
        },
        "contents": "                        \n                        with st.expander(\"ğŸ” LLMã®ç”Ÿå‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰\", expanded=True):\n                            st.info(\"ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’TOONå½¢å¼ã¨ã—ã¦è§£é‡ˆã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€å¤±æ•—ã—ã¾ã—ãŸã€‚\")\n                            st.code(raw_toon_text)\n        else:\n            st.warning(\"æŒ‡ç¤ºã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n\nwith col_flow:\n    st.subheader(\"ğŸ“Š ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ\")\n    # Mermaidæç”»å‡¦ç†\n    mermaid_code = current_flow.to_mermaid()\n    b64_mermaid = base64.b64encode(mermaid_code.encode('utf-8')).decode('utf-8')\n\n    html_path = Path(\"frontend/index.html\")\n    if html_path.exists():\n        html_content = html_path.read_text(encoding='utf-8')\n        components.html(\n            f\"\"\"\n            {html_content}\n            &lt;script&gt;\n                window.onload = () =&gt; {{\n                    window.postMessage({{ \n                        type: \"render\", \n                        base64Code: \"{b64_mermaid}\" \n                    }}, \"*\");\n                }};\n            &lt;/script&gt;\n            \"\"\",\n            height=800,\n            scrolling=True,\n        )\n    else:\n        st.error(\"frontend/index.html ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\")\n\nwith col_source:\n    st.subheader(\"ğŸ“„ TOONå½¢å¼ï¼ˆSourceï¼‰\")\n    \n    # TOONå½¢å¼ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ\n    toon_text = current_flow.to_toon_format()\n    \n    with st.expander(\"TOONå½¢å¼ã‚’è¡¨ç¤º\", expanded=True):\n        st.code(toon_text, language=\"markdown\")\n    \n    # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³\n    st.download_button(\n        label=\"ğŸ“¥ TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\",\n        data=toon_text,\n        file_name=f\"{session_name}_toon.md\",\n        mime=\"text/markdown\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                        ",
            "lineNumber": 447
          },
          {
            "text": "                        with st.expander(\"ğŸ” LLMã®ç”Ÿå‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰\", expanded=True):",
            "lineNumber": 448
          },
          {
            "text": "                            st.info(\"ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’TOONå½¢å¼ã¨ã—ã¦è§£é‡ˆã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€å¤±æ•—ã—ã¾ã—ãŸã€‚\")",
            "lineNumber": 449
          },
          {
            "text": "                            st.code(raw_toon_text)",
            "lineNumber": 450
          },
          {
            "text": "        else:",
            "lineNumber": 451
          },
          {
            "text": "            st.warning(\"æŒ‡ç¤ºã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 452
          },
          {
            "lineNumber": 453
          },
          {
            "text": "with col_flow:",
            "lineNumber": 454
          },
          {
            "text": "    st.subheader(\"ğŸ“Š ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ\")",
            "lineNumber": 455
          },
          {
            "text": "    # Mermaidæç”»å‡¦ç†",
            "lineNumber": 456
          },
          {
            "text": "    mermaid_code = current_flow.to_mermaid()",
            "lineNumber": 457
          },
          {
            "text": "    b64_mermaid = base64.b64encode(mermaid_code.encode('utf-8')).decode('utf-8')",
            "lineNumber": 458
          },
          {
            "lineNumber": 459
          },
          {
            "text": "    html_path = Path(\"frontend/index.html\")",
            "lineNumber": 460
          },
          {
            "text": "    if html_path.exists():",
            "lineNumber": 461
          },
          {
            "text": "        html_content = html_path.read_text(encoding='utf-8')",
            "lineNumber": 462
          },
          {
            "text": "        components.html(",
            "lineNumber": 463
          },
          {
            "text": "            f\"\"\"",
            "lineNumber": 464
          },
          {
            "text": "            {html_content}",
            "lineNumber": 465
          },
          {
            "text": "            &lt;script&gt;",
            "lineNumber": 466
          },
          {
            "text": "                window.onload = () =&gt; {{",
            "lineNumber": 467
          },
          {
            "text": "                    window.postMessage({{ ",
            "lineNumber": 468
          },
          {
            "text": "                        type: \"render\", ",
            "lineNumber": 469
          },
          {
            "text": "                        base64Code: \"{b64_mermaid}\" ",
            "lineNumber": 470
          },
          {
            "text": "                    }}, \"*\");",
            "lineNumber": 471
          },
          {
            "text": "                }};",
            "lineNumber": 472
          },
          {
            "text": "            &lt;/script&gt;",
            "lineNumber": 473
          },
          {
            "text": "            \"\"\",",
            "lineNumber": 474
          },
          {
            "text": "            height=800,",
            "lineNumber": 475
          },
          {
            "text": "            scrolling=True,",
            "lineNumber": 476
          },
          {
            "text": "        )",
            "lineNumber": 477
          },
          {
            "text": "    else:",
            "lineNumber": 478
          },
          {
            "text": "        st.error(\"frontend/index.html ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\")",
            "lineNumber": 479
          },
          {
            "lineNumber": 480
          },
          {
            "text": "with col_source:",
            "lineNumber": 481
          },
          {
            "text": "    st.subheader(\"ğŸ“„ TOONå½¢å¼ï¼ˆSourceï¼‰\")",
            "lineNumber": 482
          },
          {
            "text": "    ",
            "lineNumber": 483
          },
          {
            "text": "    # TOONå½¢å¼ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ",
            "lineNumber": 484
          },
          {
            "text": "    toon_text = current_flow.to_toon_format()",
            "lineNumber": 485
          },
          {
            "text": "    ",
            "lineNumber": 486
          },
          {
            "text": "    with st.expander(\"TOONå½¢å¼ã‚’è¡¨ç¤º\", expanded=True):",
            "lineNumber": 487
          },
          {
            "text": "        st.code(toon_text, language=\"markdown\")",
            "lineNumber": 488
          },
          {
            "text": "    ",
            "lineNumber": 489
          },
          {
            "text": "    # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³",
            "lineNumber": 490
          },
          {
            "text": "    st.download_button(",
            "lineNumber": 491
          },
          {
            "text": "        label=\"ğŸ“¥ TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\",",
            "lineNumber": 492
          },
          {
            "text": "        data=toon_text,",
            "lineNumber": 493
          },
          {
            "text": "        file_name=f\"{session_name}_toon.md\",",
            "lineNumber": 494
          },
          {
            "text": "        mime=\"text/markdown\"",
            "lineNumber": 495
          }
        ]
      },
      "score": 0.302825391292572
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 348,
            "column": 77
          },
          "endPosition": {
            "line": 386,
            "column": 69
          }
        },
        "contents": "                    \n                    # éƒ¨åˆ†ãƒ•ãƒ­ãƒ¼ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¿½åŠ æŒ‡ç¤ºã‚’ä»˜ä¸\n                    enhanced_prompt = user_prompt\n                    if partial_mode:\n                        enhanced_prompt = user_prompt + \"\\n\\nã€é‡è¦ã€‘ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚å…¨ãƒ«ãƒ¼ãƒˆã‚’å«ã‚€å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒãƒ¼ãƒ‰æ•°ã¯30å€‹ä»¥ä¸‹ã€ã‚¨ãƒƒã‚¸æ•°ã¯50å€‹ä»¥ä¸‹ã«ã—ã¦ãã ã•ã„ã€‚\"\n                    \n                    raw_toon_text = client.generate_flow(enhanced_prompt, context_flowchart)\n                    \n                    # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯\n                    if client.is_question_response(raw_toon_text):\n                        # è³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜\n                        st.session_state.conversation_context = user_prompt\n                        st.session_state.pending_questions = raw_toon_text\n                        st.session_state.question_responses = []\n                        st.session_state.append_mode_for_question = append_mode  # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜\n                        st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n                        st.rerun()\n                    else:\n                        # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼\n                        is_valid, validation_message = client.validate_output_size(raw_toon_text)\n                        if not is_valid:\n                            st.warning(validation_message)\n                            st.info(\"ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã‹ã€ãƒ•ãƒ­ãƒ¼ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\")\n                        \n                        # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹\n                        new_flow = TOONParser.parse(raw_toon_text)\n                        \n                        # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨\n                        new_flow = new_flow.apply_logic_gap_detection()\n                        \n                        # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ\n                        if append_mode:\n                            merged_flow = history_mgr.append_toon_log(session_name, new_flow)\n                            st.session_state.history.append(merged_flow)\n                            st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")\n                        else:\n                            # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ \n                            st.session_state.history.append(new_flow)",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                    ",
            "lineNumber": 350
          },
          {
            "text": "                    # éƒ¨åˆ†ãƒ•ãƒ­ãƒ¼ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¿½åŠ æŒ‡ç¤ºã‚’ä»˜ä¸",
            "lineNumber": 351
          },
          {
            "text": "                    enhanced_prompt = user_prompt",
            "lineNumber": 352
          },
          {
            "text": "                    if partial_mode:",
            "lineNumber": 353
          },
          {
            "text": "                        enhanced_prompt = user_prompt + \"\\n\\nã€é‡è¦ã€‘ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚å…¨ãƒ«ãƒ¼ãƒˆã‚’å«ã‚€å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒãƒ¼ãƒ‰æ•°ã¯30å€‹ä»¥ä¸‹ã€ã‚¨ãƒƒã‚¸æ•°ã¯50å€‹ä»¥ä¸‹ã«ã—ã¦ãã ã•ã„ã€‚\"",
            "lineNumber": 354
          },
          {
            "text": "                    ",
            "lineNumber": 355
          },
          {
            "text": "                    raw_toon_text = client.generate_flow(enhanced_prompt, context_flowchart)",
            "lineNumber": 356
          },
          {
            "text": "                    ",
            "lineNumber": 357
          },
          {
            "text": "                    # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 358
          },
          {
            "text": "                    if client.is_question_response(raw_toon_text):",
            "lineNumber": 359
          },
          {
            "text": "                        # è³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜",
            "lineNumber": 360
          },
          {
            "text": "                        st.session_state.conversation_context = user_prompt",
            "lineNumber": 361
          },
          {
            "text": "                        st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 362
          },
          {
            "text": "                        st.session_state.question_responses = []",
            "lineNumber": 363
          },
          {
            "text": "                        st.session_state.append_mode_for_question = append_mode  # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜",
            "lineNumber": 364
          },
          {
            "text": "                        st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 365
          },
          {
            "text": "                        st.rerun()",
            "lineNumber": 366
          },
          {
            "text": "                    else:",
            "lineNumber": 367
          },
          {
            "text": "                        # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼",
            "lineNumber": 368
          },
          {
            "text": "                        is_valid, validation_message = client.validate_output_size(raw_toon_text)",
            "lineNumber": 369
          },
          {
            "text": "                        if not is_valid:",
            "lineNumber": 370
          },
          {
            "text": "                            st.warning(validation_message)",
            "lineNumber": 371
          },
          {
            "text": "                            st.info(\"ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã‹ã€ãƒ•ãƒ­ãƒ¼ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 372
          },
          {
            "text": "                        ",
            "lineNumber": 373
          },
          {
            "text": "                        # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹",
            "lineNumber": 374
          },
          {
            "text": "                        new_flow = TOONParser.parse(raw_toon_text)",
            "lineNumber": 375
          },
          {
            "text": "                        ",
            "lineNumber": 376
          },
          {
            "text": "                        # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨",
            "lineNumber": 377
          },
          {
            "text": "                        new_flow = new_flow.apply_logic_gap_detection()",
            "lineNumber": 378
          },
          {
            "text": "                        ",
            "lineNumber": 379
          },
          {
            "text": "                        # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ",
            "lineNumber": 380
          },
          {
            "text": "                        if append_mode:",
            "lineNumber": 381
          },
          {
            "text": "                            merged_flow = history_mgr.append_toon_log(session_name, new_flow)",
            "lineNumber": 382
          },
          {
            "text": "                            st.session_state.history.append(merged_flow)",
            "lineNumber": 383
          },
          {
            "text": "                            st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")",
            "lineNumber": 384
          },
          {
            "text": "                        else:",
            "lineNumber": 385
          },
          {
            "text": "                            # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ ",
            "lineNumber": 386
          },
          {
            "text": "                            st.session_state.history.append(new_flow)",
            "lineNumber": 387
          }
        ]
      },
      "score": 0.2063279002904892
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\frontend\\index.html",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 30,
            "column": 12
          }
        },
        "contents": "&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/npm/mermaid@10.9.5/dist/mermaid.min.js\"&gt;&lt;/script&gt;\n    &lt;style&gt;\n        body { margin: 0; background: white; overflow: auto; }\n        #container { display: flex; justify-content: center; padding: 20px; min-height: 100%; }\n        #graph { width: 100%; overflow: auto; }\n        svg { max-width: 100%; height: auto; display: block; }\n        .subgraph-title { cursor: pointer; }\n        .subgraph-title:hover { opacity: 0.7; }\n        .subgraph-collapsed .subgraph-content { display: none; }\n        .node-selected { \n            stroke: #ff6b6b !important; \n            stroke-width: 3px !important; \n            filter: drop-shadow(0 0 5px rgba(255, 107, 107, 0.5));\n        }\n        .node-clickable { cursor: pointer; }\n        .node-clickable:hover { opacity: 0.8; }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"container\"&gt;\n        &lt;div id=\"graph\"&gt;&lt;/div&gt;\n    &lt;/div&gt;\n    &lt;script&gt;\n        mermaid.initialize({ startOnLoad: false, theme: 'default' });\n\n        // ãƒãƒ¼ãƒ‰IDã‚’æŠ½å‡ºã™ã‚‹é–¢æ•°\n        function extractNodeId(nodeElement) {\n            ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "&lt;!DOCTYPE html&gt;",
            "lineNumber": 1
          },
          {
            "text": "&lt;html&gt;",
            "lineNumber": 2
          },
          {
            "text": "&lt;head&gt;",
            "lineNumber": 3
          },
          {
            "text": "    &lt;script src=\"https://cdn.jsdelivr.net/npm/mermaid@10.9.5/dist/mermaid.min.js\"&gt;&lt;/script&gt;",
            "lineNumber": 4
          },
          {
            "text": "    &lt;style&gt;",
            "lineNumber": 5
          },
          {
            "text": "        body { margin: 0; background: white; overflow: auto; }",
            "lineNumber": 6
          },
          {
            "text": "        #container { display: flex; justify-content: center; padding: 20px; min-height: 100%; }",
            "lineNumber": 7
          },
          {
            "text": "        #graph { width: 100%; overflow: auto; }",
            "lineNumber": 8
          },
          {
            "text": "        svg { max-width: 100%; height: auto; display: block; }",
            "lineNumber": 9
          },
          {
            "text": "        .subgraph-title { cursor: pointer; }",
            "lineNumber": 10
          },
          {
            "text": "        .subgraph-title:hover { opacity: 0.7; }",
            "lineNumber": 11
          },
          {
            "text": "        .subgraph-collapsed .subgraph-content { display: none; }",
            "lineNumber": 12
          },
          {
            "text": "        .node-selected { ",
            "lineNumber": 13
          },
          {
            "text": "            stroke: #ff6b6b !important; ",
            "lineNumber": 14
          },
          {
            "text": "            stroke-width: 3px !important; ",
            "lineNumber": 15
          },
          {
            "text": "            filter: drop-shadow(0 0 5px rgba(255, 107, 107, 0.5));",
            "lineNumber": 16
          },
          {
            "text": "        }",
            "lineNumber": 17
          },
          {
            "text": "        .node-clickable { cursor: pointer; }",
            "lineNumber": 18
          },
          {
            "text": "        .node-clickable:hover { opacity: 0.8; }",
            "lineNumber": 19
          },
          {
            "text": "    &lt;/style&gt;",
            "lineNumber": 20
          },
          {
            "text": "&lt;/head&gt;",
            "lineNumber": 21
          },
          {
            "text": "&lt;body&gt;",
            "lineNumber": 22
          },
          {
            "text": "    &lt;div id=\"container\"&gt;",
            "lineNumber": 23
          },
          {
            "text": "        &lt;div id=\"graph\"&gt;&lt;/div&gt;",
            "lineNumber": 24
          },
          {
            "text": "    &lt;/div&gt;",
            "lineNumber": 25
          },
          {
            "text": "    &lt;script&gt;",
            "lineNumber": 26
          },
          {
            "text": "        mermaid.initialize({ startOnLoad: false, theme: 'default' });",
            "lineNumber": 27
          },
          {
            "lineNumber": 28
          },
          {
            "text": "        // ãƒãƒ¼ãƒ‰IDã‚’æŠ½å‡ºã™ã‚‹é–¢æ•°",
            "lineNumber": 29
          },
          {
            "text": "        function extractNodeId(nodeElement) {",
            "lineNumber": 30
          },
          {
            "text": "            ",
            "lineNumber": 31
          }
        ]
      },
      "score": 0.18022550642490387
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 119,
            "column": 36
          },
          "endPosition": {
            "line": 156,
            "column": 54
          }
        },
        "contents": "else:\n    st.sidebar.info(\"ä¿å­˜ã•ã‚ŒãŸTOONãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“\")\n\n# --- ãƒ‡ãƒãƒƒã‚°æƒ…å ±ï¼šOllamaè¨­å®š ---\nst.sidebar.divider()\nst.sidebar.subheader(\"âš™ï¸ Ollamaè¨­å®š\")\ntry:\n    ollama_config = st.secrets.get(\"ollama\", {})\n    base_url = ollama_config.get(\"base_url\", \"http://localhost:11434\")\n    model = ollama_config.get(\"model\", \"llama3.2\")\n    config_source = \"secrets.toml\"\nexcept (AttributeError, FileNotFoundError, ImportError, RuntimeError):\n    import os\n    base_url = os.getenv(\"OLLAMA_BASE_URL\", \"http://localhost:11434\")\n    model = os.getenv(\"OLLAMA_MODEL\", \"llama3.2\")\n    config_source = \"ç’°å¢ƒå¤‰æ•°\"\n\nst.sidebar.text(f\"è¨­å®šå…ƒ: {config_source}\")\nst.sidebar.text(f\"ãƒ™ãƒ¼ã‚¹URL: {base_url}\")\nst.sidebar.text(f\"ãƒ¢ãƒ‡ãƒ«: {model}\")\n\n# --- æç”»ã¨å±¥æ­´ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ ---\nst.divider()\n\n# å±¥æ­´ã‚’é¡ã‚‹ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼\nif len(st.session_state.history) &gt; 1:\n    history_index = st.sidebar.slider(\n        \"å±¥æ­´ã‚’é¡ã‚‹\", \n        min_value=0, \n        max_value=len(st.session_state.history) - 1, \n        value=len(st.session_state.history) - 1\n    )\nelse:\n    history_index = 0\n    st.sidebar.info(\"ç¾åœ¨ã¯åˆæœŸçŠ¶æ…‹ã§ã™ã€‚\")\n\ncurrent_flow = st.session_state.history[history_index]",
        "signatures": {},
        "detailedLines": [
          {
            "text": "else:",
            "lineNumber": 121
          },
          {
            "text": "    st.sidebar.info(\"ä¿å­˜ã•ã‚ŒãŸTOONãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“\")",
            "lineNumber": 122
          },
          {
            "lineNumber": 123
          },
          {
            "text": "# --- ãƒ‡ãƒãƒƒã‚°æƒ…å ±ï¼šOllamaè¨­å®š ---",
            "lineNumber": 124
          },
          {
            "text": "st.sidebar.divider()",
            "lineNumber": 125
          },
          {
            "text": "st.sidebar.subheader(\"âš™ï¸ Ollamaè¨­å®š\")",
            "lineNumber": 126
          },
          {
            "text": "try:",
            "lineNumber": 127
          },
          {
            "text": "    ollama_config = st.secrets.get(\"ollama\", {})",
            "lineNumber": 128
          },
          {
            "text": "    base_url = ollama_config.get(\"base_url\", \"http://localhost:11434\")",
            "lineNumber": 129
          },
          {
            "text": "    model = ollama_config.get(\"model\", \"llama3.2\")",
            "lineNumber": 130
          },
          {
            "text": "    config_source = \"secrets.toml\"",
            "lineNumber": 131
          },
          {
            "text": "except (AttributeError, FileNotFoundError, ImportError, RuntimeError):",
            "lineNumber": 132
          },
          {
            "text": "    import os",
            "lineNumber": 133
          },
          {
            "text": "    base_url = os.getenv(\"OLLAMA_BASE_URL\", \"http://localhost:11434\")",
            "lineNumber": 134
          },
          {
            "text": "    model = os.getenv(\"OLLAMA_MODEL\", \"llama3.2\")",
            "lineNumber": 135
          },
          {
            "text": "    config_source = \"ç’°å¢ƒå¤‰æ•°\"",
            "lineNumber": 136
          },
          {
            "lineNumber": 137
          },
          {
            "text": "st.sidebar.text(f\"è¨­å®šå…ƒ: {config_source}\")",
            "lineNumber": 138
          },
          {
            "text": "st.sidebar.text(f\"ãƒ™ãƒ¼ã‚¹URL: {base_url}\")",
            "lineNumber": 139
          },
          {
            "text": "st.sidebar.text(f\"ãƒ¢ãƒ‡ãƒ«: {model}\")",
            "lineNumber": 140
          },
          {
            "lineNumber": 141
          },
          {
            "text": "# --- æç”»ã¨å±¥æ­´ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ ---",
            "lineNumber": 142
          },
          {
            "text": "st.divider()",
            "lineNumber": 143
          },
          {
            "lineNumber": 144
          },
          {
            "text": "# å±¥æ­´ã‚’é¡ã‚‹ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼",
            "lineNumber": 145
          },
          {
            "text": "if len(st.session_state.history) &gt; 1:",
            "lineNumber": 146
          },
          {
            "text": "    history_index = st.sidebar.slider(",
            "lineNumber": 147
          },
          {
            "text": "        \"å±¥æ­´ã‚’é¡ã‚‹\", ",
            "lineNumber": 148
          },
          {
            "text": "        min_value=0, ",
            "lineNumber": 149
          },
          {
            "text": "        max_value=len(st.session_state.history) - 1, ",
            "lineNumber": 150
          },
          {
            "text": "        value=len(st.session_state.history) - 1",
            "lineNumber": 151
          },
          {
            "text": "    )",
            "lineNumber": 152
          },
          {
            "text": "else:",
            "lineNumber": 153
          },
          {
            "text": "    history_index = 0",
            "lineNumber": 154
          },
          {
            "text": "    st.sidebar.info(\"ç¾åœ¨ã¯åˆæœŸçŠ¶æ…‹ã§ã™ã€‚\")",
            "lineNumber": 155
          },
          {
            "lineNumber": 156
          },
          {
            "text": "current_flow = st.session_state.history[history_index]",
            "lineNumber": 157
          }
        ]
      },
      "score": 0.16683363914489746
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 223,
            "column": 74
          },
          "endPosition": {
            "line": 255,
            "column": 77
          }
        },
        "contents": "                                # å†åº¦è³ªå•ãŒæ¥ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°\n                                st.session_state.conversation_context = combined_prompt\n                                st.session_state.pending_questions = raw_toon_text\n                                st.session_state.question_responses = []  # æ–°ã—ã„è³ªå•ãªã®ã§å›ç­”ã‚’ãƒªã‚»ãƒƒãƒˆ\n                                st.info(\"LLMã‹ã‚‰è¿½åŠ ã®è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n                                st.rerun()\n                            else:\n                                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼\n                                is_valid, validation_message = client.validate_output_size(raw_toon_text)\n                                if not is_valid:\n                                    st.warning(validation_message)\n                                    st.info(\"ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã‹ã€ãƒ•ãƒ­ãƒ¼ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\")\n                                \n                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹æˆåŠŸæ™‚ã®ã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ\n                                st.session_state.conversation_context = None\n                                st.session_state.pending_questions = None\n                                st.session_state.question_responses = []\n                                \n                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹\n                                new_flow = TOONParser.parse(raw_toon_text)\n                                \n                                # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨\n                                new_flow = new_flow.apply_logic_gap_detection()\n                                \n                                # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ\n                                if append_mode_flag:\n                                    merged_flow = history_mgr.append_toon_log(session_name, new_flow)\n                                    st.session_state.history.append(merged_flow)\n                                    st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")\n                                else:\n                                    # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ \n                                    st.session_state.history.append(new_flow)",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                                # å†åº¦è³ªå•ãŒæ¥ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°",
            "lineNumber": 225
          },
          {
            "text": "                                st.session_state.conversation_context = combined_prompt",
            "lineNumber": 226
          },
          {
            "text": "                                st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 227
          },
          {
            "text": "                                st.session_state.question_responses = []  # æ–°ã—ã„è³ªå•ãªã®ã§å›ç­”ã‚’ãƒªã‚»ãƒƒãƒˆ",
            "lineNumber": 228
          },
          {
            "text": "                                st.info(\"LLMã‹ã‚‰è¿½åŠ ã®è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 229
          },
          {
            "text": "                                st.rerun()",
            "lineNumber": 230
          },
          {
            "text": "                            else:",
            "lineNumber": 231
          },
          {
            "text": "                                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼",
            "lineNumber": 232
          },
          {
            "text": "                                is_valid, validation_message = client.validate_output_size(raw_toon_text)",
            "lineNumber": 233
          },
          {
            "text": "                                if not is_valid:",
            "lineNumber": 234
          },
          {
            "text": "                                    st.warning(validation_message)",
            "lineNumber": 235
          },
          {
            "text": "                                    st.info(\"ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã‹ã€ãƒ•ãƒ­ãƒ¼ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 236
          },
          {
            "text": "                                ",
            "lineNumber": 237
          },
          {
            "text": "                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹æˆåŠŸæ™‚ã®ã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ",
            "lineNumber": 238
          },
          {
            "text": "                                st.session_state.conversation_context = None",
            "lineNumber": 239
          },
          {
            "text": "                                st.session_state.pending_questions = None",
            "lineNumber": 240
          },
          {
            "text": "                                st.session_state.question_responses = []",
            "lineNumber": 241
          },
          {
            "text": "                                ",
            "lineNumber": 242
          },
          {
            "text": "                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹",
            "lineNumber": 243
          },
          {
            "text": "                                new_flow = TOONParser.parse(raw_toon_text)",
            "lineNumber": 244
          },
          {
            "text": "                                ",
            "lineNumber": 245
          },
          {
            "text": "                                # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨",
            "lineNumber": 246
          },
          {
            "text": "                                new_flow = new_flow.apply_logic_gap_detection()",
            "lineNumber": 247
          },
          {
            "text": "                                ",
            "lineNumber": 248
          },
          {
            "text": "                                # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ",
            "lineNumber": 249
          },
          {
            "text": "                                if append_mode_flag:",
            "lineNumber": 250
          },
          {
            "text": "                                    merged_flow = history_mgr.append_toon_log(session_name, new_flow)",
            "lineNumber": 251
          },
          {
            "text": "                                    st.session_state.history.append(merged_flow)",
            "lineNumber": 252
          },
          {
            "text": "                                    st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")",
            "lineNumber": 253
          },
          {
            "text": "                                else:",
            "lineNumber": 254
          },
          {
            "text": "                                    # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ ",
            "lineNumber": 255
          },
          {
            "text": "                                    st.session_state.history.append(new_flow)",
            "lineNumber": 256
          }
        ]
      },
      "score": 0.16096723079681396
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 50,
            "column": 50
          }
        },
        "contents": "import streamlit as st\nimport streamlit.components.v1 as components\nimport base64\nfrom core.schemas import Node, Edge, Flowchart\nfrom core.llm_client import LLMClient\nfrom core.toon_parser import TOONParser\nfrom core.history_mgr import HistoryManager\nfrom core.exceptions import LLMAPIError, TOONParseError, FlowchartValidationError\nfrom core.flow_extractor import FlowExtractor\nfrom core.flow_merger import FlowMerger\nfrom pathlib import Path\n\nst.set_page_config(layout=\"wide\")\nst.title(\"Flowchart Generator &amp; History Manager\")\n\n# 1. ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–\nhistory_mgr = HistoryManager()\n\n# 2. ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´ã®åˆæœŸåŒ–\nif 'history' not in st.session_state:\n    # åˆæœŸçŠ¶æ…‹ï¼šé–‹å§‹ã¨çµ‚äº†ã®ã¿ã®æ§‹æˆ\n    initial_flow = Flowchart(\n        nodes=[\n            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),\n            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")\n        ],\n        edges=[Edge(source=\"start\", target=\"node_end\")]\n    )\n    st.session_state.history = [initial_flow]\n\n# 3. è³ªå•å¿œç­”ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®åˆæœŸåŒ–\nif 'conversation_context' not in st.session_state:\n    st.session_state.conversation_context = None  # å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\nif 'pending_questions' not in st.session_state:\n    st.session_state.pending_questions = None  # ç¾åœ¨ã®è³ªå•ãƒ†ã‚­ã‚¹ãƒˆ\nif 'question_responses' not in st.session_state:\n    st.session_state.question_responses = []  # å›ç­”ã®ãƒªã‚¹ãƒˆ\nif 'append_mode_for_question' not in st.session_state:\n    st.session_state.append_mode_for_question = False  # è³ªå•æ™‚ã®å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®š\nif 'selected_node_ids' not in st.session_state:\n    st.session_state.selected_node_ids = []  # é¸æŠã•ã‚ŒãŸãƒãƒ¼ãƒ‰IDã®ãƒªã‚¹ãƒˆ\nif 'selection_mode' not in st.session_state:\n    st.session_state.selection_mode = 'text'  # 'text' or 'ui'\n\n# --- ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼šã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† ---\nst.sidebar.header(\"ğŸ’¾ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†\")\n\n# ä¿å­˜æ¸ˆã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä¸€è¦§ã‚’å–å¾—\nsaved_sessions = history_mgr.list_sessions()\n\n# ã‚»ãƒƒã‚·ãƒ§ãƒ³åã®å…¥åŠ›ï¼ˆæ–°è¦ä½œæˆç”¨ï¼‰",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import streamlit as st",
            "lineNumber": 1
          },
          {
            "text": "import streamlit.components.v1 as components",
            "lineNumber": 2
          },
          {
            "text": "import base64",
            "lineNumber": 3
          },
          {
            "text": "from core.schemas import Node, Edge, Flowchart",
            "lineNumber": 4
          },
          {
            "text": "from core.llm_client import LLMClient",
            "lineNumber": 5
          },
          {
            "text": "from core.toon_parser import TOONParser",
            "lineNumber": 6
          },
          {
            "text": "from core.history_mgr import HistoryManager",
            "lineNumber": 7
          },
          {
            "text": "from core.exceptions import LLMAPIError, TOONParseError, FlowchartValidationError",
            "lineNumber": 8
          },
          {
            "text": "from core.flow_extractor import FlowExtractor",
            "lineNumber": 9
          },
          {
            "text": "from core.flow_merger import FlowMerger",
            "lineNumber": 10
          },
          {
            "text": "from pathlib import Path",
            "lineNumber": 11
          },
          {
            "lineNumber": 12
          },
          {
            "text": "st.set_page_config(layout=\"wide\")",
            "lineNumber": 13
          },
          {
            "text": "st.title(\"Flowchart Generator &amp; History Manager\")",
            "lineNumber": 14
          },
          {
            "lineNumber": 15
          },
          {
            "text": "# 1. ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–",
            "lineNumber": 16
          },
          {
            "text": "history_mgr = HistoryManager()",
            "lineNumber": 17
          },
          {
            "lineNumber": 18
          },
          {
            "text": "# 2. ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´ã®åˆæœŸåŒ–",
            "lineNumber": 19
          },
          {
            "text": "if 'history' not in st.session_state:",
            "lineNumber": 20
          },
          {
            "text": "    # åˆæœŸçŠ¶æ…‹ï¼šé–‹å§‹ã¨çµ‚äº†ã®ã¿ã®æ§‹æˆ",
            "lineNumber": 21
          },
          {
            "text": "    initial_flow = Flowchart(",
            "lineNumber": 22
          },
          {
            "text": "        nodes=[",
            "lineNumber": 23
          },
          {
            "text": "            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),",
            "lineNumber": 24
          },
          {
            "text": "            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")",
            "lineNumber": 25
          },
          {
            "text": "        ],",
            "lineNumber": 26
          },
          {
            "text": "        edges=[Edge(source=\"start\", target=\"node_end\")]",
            "lineNumber": 27
          },
          {
            "text": "    )",
            "lineNumber": 28
          },
          {
            "text": "    st.session_state.history = [initial_flow]",
            "lineNumber": 29
          },
          {
            "lineNumber": 30
          },
          {
            "text": "# 3. è³ªå•å¿œç­”ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®åˆæœŸåŒ–",
            "lineNumber": 31
          },
          {
            "text": "if 'conversation_context' not in st.session_state:",
            "lineNumber": 32
          },
          {
            "text": "    st.session_state.conversation_context = None  # å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ",
            "lineNumber": 33
          },
          {
            "text": "if 'pending_questions' not in st.session_state:",
            "lineNumber": 34
          },
          {
            "text": "    st.session_state.pending_questions = None  # ç¾åœ¨ã®è³ªå•ãƒ†ã‚­ã‚¹ãƒˆ",
            "lineNumber": 35
          },
          {
            "text": "if 'question_responses' not in st.session_state:",
            "lineNumber": 36
          },
          {
            "text": "    st.session_state.question_responses = []  # å›ç­”ã®ãƒªã‚¹ãƒˆ",
            "lineNumber": 37
          },
          {
            "text": "if 'append_mode_for_question' not in st.session_state:",
            "lineNumber": 38
          },
          {
            "text": "    st.session_state.append_mode_for_question = False  # è³ªå•æ™‚ã®å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®š",
            "lineNumber": 39
          },
          {
            "text": "if 'selected_node_ids' not in st.session_state:",
            "lineNumber": 40
          },
          {
            "text": "    st.session_state.selected_node_ids = []  # é¸æŠã•ã‚ŒãŸãƒãƒ¼ãƒ‰IDã®ãƒªã‚¹ãƒˆ",
            "lineNumber": 41
          },
          {
            "text": "if 'selection_mode' not in st.session_state:",
            "lineNumber": 42
          },
          {
            "text": "    st.session_state.selection_mode = 'text'  # 'text' or 'ui'",
            "lineNumber": 43
          },
          {
            "lineNumber": 44
          },
          {
            "text": "# --- ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼šã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† ---",
            "lineNumber": 45
          },
          {
            "text": "st.sidebar.header(\"ğŸ’¾ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†\")",
            "lineNumber": 46
          },
          {
            "lineNumber": 47
          },
          {
            "text": "# ä¿å­˜æ¸ˆã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä¸€è¦§ã‚’å–å¾—",
            "lineNumber": 48
          },
          {
            "text": "saved_sessions = history_mgr.list_sessions()",
            "lineNumber": 49
          },
          {
            "lineNumber": 50
          },
          {
            "text": "# ã‚»ãƒƒã‚·ãƒ§ãƒ³åã®å…¥åŠ›ï¼ˆæ–°è¦ä½œæˆç”¨ï¼‰",
            "lineNumber": 51
          }
        ]
      },
      "score": 0.16039569675922394
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 279,
            "column": 46
          },
          "endPosition": {
            "line": 314,
            "column": 57
          }
        },
        "contents": "                                else:\n                                    st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")\n                                    with st.expander(\"ğŸ” LLMã®ç”Ÿå‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰\", expanded=True):\n                                        st.info(\"ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’TOONå½¢å¼ã¨ã—ã¦è§£é‡ˆã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€å¤±æ•—ã—ã¾ã—ãŸã€‚\")\n                                        st.code(raw_toon_text)\n                            else:\n                                st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")\n                        except Exception as e:\n                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ\n                            st.session_state.conversation_context = temp_context\n                            st.session_state.pending_questions = temp_questions\n                            st.session_state.question_responses = temp_responses\n                            \n                            # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯\n                            if 'raw_toon_text' in locals() and raw_toon_text:\n                                try:\n                                    client = LLMClient()\n                                    if client.is_question_response(raw_toon_text):\n                                        st.session_state.conversation_context = combined_prompt\n                                        st.session_state.pending_questions = raw_toon_text\n                                        st.session_state.question_responses = []\n                                        st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n                                        st.rerun()\n                                except:\n                                    pass\n                            \n                            st.error(f\"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}\")\n                else:\n                    st.warning(\"å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n        \n        with col_cancel:\n            if st.button(\"ã‚­ãƒ£ãƒ³ã‚»ãƒ«\", use_container_width=True):\n                # ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ\n                st.session_state.conversation_context = None\n                st.session_state.pending_questions = None",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                                else:",
            "lineNumber": 281
          },
          {
            "text": "                                    st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 282
          },
          {
            "text": "                                    with st.expander(\"ğŸ” LLMã®ç”Ÿå‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰\", expanded=True):",
            "lineNumber": 283
          },
          {
            "text": "                                        st.info(\"ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’TOONå½¢å¼ã¨ã—ã¦è§£é‡ˆã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€å¤±æ•—ã—ã¾ã—ãŸã€‚\")",
            "lineNumber": 284
          },
          {
            "text": "                                        st.code(raw_toon_text)",
            "lineNumber": 285
          },
          {
            "text": "                            else:",
            "lineNumber": 286
          },
          {
            "text": "                                st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 287
          },
          {
            "text": "                        except Exception as e:",
            "lineNumber": 288
          },
          {
            "text": "                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ",
            "lineNumber": 289
          },
          {
            "text": "                            st.session_state.conversation_context = temp_context",
            "lineNumber": 290
          },
          {
            "text": "                            st.session_state.pending_questions = temp_questions",
            "lineNumber": 291
          },
          {
            "text": "                            st.session_state.question_responses = temp_responses",
            "lineNumber": 292
          },
          {
            "text": "                            ",
            "lineNumber": 293
          },
          {
            "text": "                            # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 294
          },
          {
            "text": "                            if 'raw_toon_text' in locals() and raw_toon_text:",
            "lineNumber": 295
          },
          {
            "text": "                                try:",
            "lineNumber": 296
          },
          {
            "text": "                                    client = LLMClient()",
            "lineNumber": 297
          },
          {
            "text": "                                    if client.is_question_response(raw_toon_text):",
            "lineNumber": 298
          },
          {
            "text": "                                        st.session_state.conversation_context = combined_prompt",
            "lineNumber": 299
          },
          {
            "text": "                                        st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 300
          },
          {
            "text": "                                        st.session_state.question_responses = []",
            "lineNumber": 301
          },
          {
            "text": "                                        st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 302
          },
          {
            "text": "                                        st.rerun()",
            "lineNumber": 303
          },
          {
            "text": "                                except:",
            "lineNumber": 304
          },
          {
            "text": "                                    pass",
            "lineNumber": 305
          },
          {
            "text": "                            ",
            "lineNumber": 306
          },
          {
            "text": "                            st.error(f\"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 307
          },
          {
            "text": "                else:",
            "lineNumber": 308
          },
          {
            "text": "                    st.warning(\"å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 309
          },
          {
            "text": "        ",
            "lineNumber": 310
          },
          {
            "text": "        with col_cancel:",
            "lineNumber": 311
          },
          {
            "text": "            if st.button(\"ã‚­ãƒ£ãƒ³ã‚»ãƒ«\", use_container_width=True):",
            "lineNumber": 312
          },
          {
            "text": "                # ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ",
            "lineNumber": 313
          },
          {
            "text": "                st.session_state.conversation_context = None",
            "lineNumber": 314
          },
          {
            "text": "                st.session_state.pending_questions = None",
            "lineNumber": 315
          }
        ]
      },
      "score": 0.15315769612789154
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 151,
            "column": 5
          },
          "endPosition": {
            "line": 187,
            "column": 23
          }
        },
        "contents": "else:\n    history_index = 0\n    st.sidebar.info(\"ç¾åœ¨ã¯åˆæœŸçŠ¶æ…‹ã§ã™ã€‚\")\n\ncurrent_flow = st.session_state.history[history_index]\n\n# 3ãƒšã‚¤ãƒ³æ§‹æˆ: å·¦ï¼ˆChat/Inputï¼‰ã€ä¸­å¤®ï¼ˆFlowchartï¼‰ã€å³ï¼ˆSourceï¼‰\ncol_chat, col_flow, col_source = st.columns([1, 2, 1])\n\nwith col_chat:\n    st.subheader(\"ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ\")\n    \n    # è³ªå•ãŒä¿ç•™ä¸­ã®å ´åˆã¯è³ªå•ã‚’è¡¨ç¤ºã—ã€å›ç­”å…¥åŠ›æ¬„ã‚’è¡¨ç¤º\n    if st.session_state.pending_questions:\n        # è³ªå•ã¨å›ç­”ã®å±¥æ­´ã‚’è¡¨ç¤º\n        if st.session_state.conversation_context:\n            with st.expander(\"ğŸ“ ä¼šè©±å±¥æ­´\", expanded=False):\n                st.markdown(\"**å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:**\")\n                st.text(st.session_state.conversation_context)\n                \n                if st.session_state.question_responses:\n                    st.markdown(\"**ã“ã‚Œã¾ã§ã®å›ç­”:**\")\n                    for i, response in enumerate(st.session_state.question_responses, 1):\n                        st.markdown(f\"{i}. {response}\")\n        \n        st.info(\"ğŸ“‹ LLMã‹ã‚‰ã®è³ªå•:\")\n        st.markdown(st.session_state.pending_questions)\n        \n        st.divider()\n        st.subheader(\"ğŸ’­ å›ç­”ã‚’å…¥åŠ›\")\n        \n        # å›ç­”å…¥åŠ›æ¬„\n        user_answer = st.text_area(\n            \"è³ªå•ã«å¯¾ã™ã‚‹å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\",\n            placeholder=\"å›ç­”ã‚’å…¥åŠ›...\",\n            height=100,",
        "signatures": {},
        "detailedLines": [
          {
            "text": "else:",
            "lineNumber": 153
          },
          {
            "text": "    history_index = 0",
            "lineNumber": 154
          },
          {
            "text": "    st.sidebar.info(\"ç¾åœ¨ã¯åˆæœŸçŠ¶æ…‹ã§ã™ã€‚\")",
            "lineNumber": 155
          },
          {
            "lineNumber": 156
          },
          {
            "text": "current_flow = st.session_state.history[history_index]",
            "lineNumber": 157
          },
          {
            "lineNumber": 158
          },
          {
            "text": "# 3ãƒšã‚¤ãƒ³æ§‹æˆ: å·¦ï¼ˆChat/Inputï¼‰ã€ä¸­å¤®ï¼ˆFlowchartï¼‰ã€å³ï¼ˆSourceï¼‰",
            "lineNumber": 159
          },
          {
            "text": "col_chat, col_flow, col_source = st.columns([1, 2, 1])",
            "lineNumber": 160
          },
          {
            "lineNumber": 161
          },
          {
            "text": "with col_chat:",
            "lineNumber": 162
          },
          {
            "text": "    st.subheader(\"ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ\")",
            "lineNumber": 163
          },
          {
            "text": "    ",
            "lineNumber": 164
          },
          {
            "text": "    # è³ªå•ãŒä¿ç•™ä¸­ã®å ´åˆã¯è³ªå•ã‚’è¡¨ç¤ºã—ã€å›ç­”å…¥åŠ›æ¬„ã‚’è¡¨ç¤º",
            "lineNumber": 165
          },
          {
            "text": "    if st.session_state.pending_questions:",
            "lineNumber": 166
          },
          {
            "text": "        # è³ªå•ã¨å›ç­”ã®å±¥æ­´ã‚’è¡¨ç¤º",
            "lineNumber": 167
          },
          {
            "text": "        if st.session_state.conversation_context:",
            "lineNumber": 168
          },
          {
            "text": "            with st.expander(\"ğŸ“ ä¼šè©±å±¥æ­´\", expanded=False):",
            "lineNumber": 169
          },
          {
            "text": "                st.markdown(\"**å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:**\")",
            "lineNumber": 170
          },
          {
            "text": "                st.text(st.session_state.conversation_context)",
            "lineNumber": 171
          },
          {
            "text": "                ",
            "lineNumber": 172
          },
          {
            "text": "                if st.session_state.question_responses:",
            "lineNumber": 173
          },
          {
            "text": "                    st.markdown(\"**ã“ã‚Œã¾ã§ã®å›ç­”:**\")",
            "lineNumber": 174
          },
          {
            "text": "                    for i, response in enumerate(st.session_state.question_responses, 1):",
            "lineNumber": 175
          },
          {
            "text": "                        st.markdown(f\"{i}. {response}\")",
            "lineNumber": 176
          },
          {
            "text": "        ",
            "lineNumber": 177
          },
          {
            "text": "        st.info(\"ğŸ“‹ LLMã‹ã‚‰ã®è³ªå•:\")",
            "lineNumber": 178
          },
          {
            "text": "        st.markdown(st.session_state.pending_questions)",
            "lineNumber": 179
          },
          {
            "text": "        ",
            "lineNumber": 180
          },
          {
            "text": "        st.divider()",
            "lineNumber": 181
          },
          {
            "text": "        st.subheader(\"ğŸ’­ å›ç­”ã‚’å…¥åŠ›\")",
            "lineNumber": 182
          },
          {
            "text": "        ",
            "lineNumber": 183
          },
          {
            "text": "        # å›ç­”å…¥åŠ›æ¬„",
            "lineNumber": 184
          },
          {
            "text": "        user_answer = st.text_area(",
            "lineNumber": 185
          },
          {
            "text": "            \"è³ªå•ã«å¯¾ã™ã‚‹å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\",",
            "lineNumber": 186
          },
          {
            "text": "            placeholder=\"å›ç­”ã‚’å…¥åŠ›...\",",
            "lineNumber": 187
          },
          {
            "text": "            height=100,",
            "lineNumber": 188
          }
        ]
      },
      "score": 0.1522558331489563
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\llm_client.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 395
          }
        },
        "contents": "import os\nimport requests\nimport re\nfrom pathlib import Path\nfrom typing import Optional\nfrom core.exceptions import LLMAPIError\nfrom core.schemas import Flowchart\n\nclass LLMClient:\n    def __init__(self):\n        # Streamlitã®secretsã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã‚€ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ä»˜ãï¼‰\n        try:\n            import streamlit as st\n            # st.secretsãŒåˆ©ç”¨å¯èƒ½ãªå ´åˆï¼ˆStreamlitå®Ÿè¡Œç’°å¢ƒï¼‰\n            ollama_config = st.secrets.get(\"ollama\", {})\n            self.base_url = ollama_config.get(\"base_url\", \"http://localhost:11434\")\n            self.model = ollama_config.get(\"model\", \"llama3.2\")\n        except (AttributeError, FileNotFoundError, ImportError, RuntimeError):\n            # secrets.tomlãŒå­˜åœ¨ã—ãªã„å ´åˆã€ã¾ãŸã¯Streamlitå¤–ã§å®Ÿè¡Œã•ã‚Œã‚‹å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯\n            # ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã‚€ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒãªã©ï¼‰\n            self.base_url = os.getenv(\"OLLAMA_BASE_URL\", \"http://localhost:11434\")\n            self.model = os.getenv(\"OLLAMA_MODEL\", \"llama3.2\")\n        \n        # APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ\n        self.api_url = f\"{self.base_url}/api/chat\"\n\n        # rules.md (Skills) ã¨ TOON_BASE.md (Format) ã‚’èª­ã¿è¾¼ã‚€\n        # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‚’æ˜ç¤ºçš„ã«æŒ‡å®šï¼ˆStreamlitã®å®Ÿè¡Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¾å­˜ã—ãªã„ï¼‰\n        base_dir = Path(__file__).parent.parent\n        rules_path = base_dir / \"rules.md\"\n        base_path = base_dir / \"TOON_BASE.md\"\n        \n        rules_text = self._load_file(rules_path, \"Skills: Standard Flow Logic\")\n        base_text = self._load_file(base_path, \"Format: TOON Output\")\n        \n        # æƒ…å ±åé›†ã®æŒ‡ç¤ºã‚’è¿½åŠ \n        information_gathering_instruction",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import os",
            "lineNumber": 1
          },
          {
            "text": "import requests",
            "lineNumber": 2
          },
          {
            "text": "import re",
            "lineNumber": 3
          },
          {
            "text": "from pathlib import Path",
            "lineNumber": 4
          },
          {
            "text": "from typing import Optional",
            "lineNumber": 5
          },
          {
            "text": "from core.exceptions import LLMAPIError",
            "lineNumber": 6
          },
          {
            "text": "from core.schemas import Flowchart",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "class LLMClient:",
            "lineNumber": 9,
            "isSignature": true
          },
          {
            "text": "    def __init__(self):",
            "lineNumber": 10
          },
          {
            "text": "        # Streamlitã®secretsã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã‚€ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ä»˜ãï¼‰",
            "lineNumber": 11
          },
          {
            "text": "        try:",
            "lineNumber": 12
          },
          {
            "text": "            import streamlit as st",
            "lineNumber": 13
          },
          {
            "text": "            # st.secretsãŒåˆ©ç”¨å¯èƒ½ãªå ´åˆï¼ˆStreamlitå®Ÿè¡Œç’°å¢ƒï¼‰",
            "lineNumber": 14
          },
          {
            "text": "            ollama_config = st.secrets.get(\"ollama\", {})",
            "lineNumber": 15
          },
          {
            "text": "            self.base_url = ollama_config.get(\"base_url\", \"http://localhost:11434\")",
            "lineNumber": 16
          },
          {
            "text": "            self.model = ollama_config.get(\"model\", \"llama3.2\")",
            "lineNumber": 17
          },
          {
            "text": "        except (AttributeError, FileNotFoundError, ImportError, RuntimeError):",
            "lineNumber": 18
          },
          {
            "text": "            # secrets.tomlãŒå­˜åœ¨ã—ãªã„å ´åˆã€ã¾ãŸã¯Streamlitå¤–ã§å®Ÿè¡Œã•ã‚Œã‚‹å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯",
            "lineNumber": 19
          },
          {
            "text": "            # ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã‚€ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒãªã©ï¼‰",
            "lineNumber": 20
          },
          {
            "text": "            self.base_url = os.getenv(\"OLLAMA_BASE_URL\", \"http://localhost:11434\")",
            "lineNumber": 21
          },
          {
            "text": "            self.model = os.getenv(\"OLLAMA_MODEL\", \"llama3.2\")",
            "lineNumber": 22
          },
          {
            "text": "        ",
            "lineNumber": 23
          },
          {
            "text": "        # APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ",
            "lineNumber": 24
          },
          {
            "text": "        self.api_url = f\"{self.base_url}/api/chat\"",
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "text": "        # rules.md (Skills) ã¨ TOON_BASE.md (Format) ã‚’èª­ã¿è¾¼ã‚€",
            "lineNumber": 27
          },
          {
            "text": "        # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‚’æ˜ç¤ºçš„ã«æŒ‡å®šï¼ˆStreamlitã®å®Ÿè¡Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¾å­˜ã—ãªã„ï¼‰",
            "lineNumber": 28
          },
          {
            "text": "        base_dir = Path(__file__).parent.parent",
            "lineNumber": 29
          },
          {
            "text": "        rules_path = base_dir / \"rules.md\"",
            "lineNumber": 30
          },
          {
            "text": "        base_path = base_dir / \"TOON_BASE.md\"",
            "lineNumber": 31
          },
          {
            "text": "        ",
            "lineNumber": 32
          },
          {
            "text": "        rules_text = self._load_file(rules_path, \"Skills: Standard Flow Logic\")",
            "lineNumber": 33
          },
          {
            "text": "        base_text = self._load_file(base_path, \"Format: TOON Output\")",
            "lineNumber": 34
          },
          {
            "text": "        ",
            "lineNumber": 35
          },
          {
            "text": "        # æƒ…å ±åé›†ã®æŒ‡ç¤ºã‚’è¿½åŠ ",
            "lineNumber": 36
          },
          {
            "text": "        information_gathering_instruction",
            "lineNumber": 37
          }
        ]
      },
      "score": 0.14207535982131958
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 207,
            "column": 70
          },
          "endPosition": {
            "line": 225,
            "column": 71
          }
        },
        "contents": "                    append_mode_flag = st.session_state.append_mode_for_question\n                    \n                    # ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ä¸€æ™‚çš„ã«ä¿å­˜ï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ã«å¾©å…ƒã™ã‚‹ãŸã‚ï¼‰\n                    temp_context = st.session_state.conversation_context\n                    temp_questions = st.session_state.pending_questions\n                    temp_responses = st.session_state.question_responses.copy()\n                    \n                    # å†é€ä¿¡å‡¦ç†\n                    with st.spinner(\"LLMãŒãƒ•ãƒ­ãƒ¼ã‚’è¨­è¨ˆä¸­...\"):\n                        raw_toon_text = \"\"\n                        try:\n                            client = LLMClient()\n                            raw_toon_text = client.generate_flow(combined_prompt, current_flow if append_mode_flag else None)\n                            \n                            # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯\n                            if client.is_question_response(raw_toon_text):\n                                # å†åº¦è³ªå•ãŒæ¥ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°\n                                st.session_state.conversation_context =",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                    append_mode_flag = st.session_state.append_mode_for_question",
            "lineNumber": 209
          },
          {
            "text": "                    ",
            "lineNumber": 210
          },
          {
            "text": "                    # ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ä¸€æ™‚çš„ã«ä¿å­˜ï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ã«å¾©å…ƒã™ã‚‹ãŸã‚ï¼‰",
            "lineNumber": 211
          },
          {
            "text": "                    temp_context = st.session_state.conversation_context",
            "lineNumber": 212
          },
          {
            "text": "                    temp_questions = st.session_state.pending_questions",
            "lineNumber": 213
          },
          {
            "text": "                    temp_responses = st.session_state.question_responses.copy()",
            "lineNumber": 214
          },
          {
            "text": "                    ",
            "lineNumber": 215
          },
          {
            "text": "                    # å†é€ä¿¡å‡¦ç†",
            "lineNumber": 216
          },
          {
            "text": "                    with st.spinner(\"LLMãŒãƒ•ãƒ­ãƒ¼ã‚’è¨­è¨ˆä¸­...\"):",
            "lineNumber": 217
          },
          {
            "text": "                        raw_toon_text = \"\"",
            "lineNumber": 218
          },
          {
            "text": "                        try:",
            "lineNumber": 219
          },
          {
            "text": "                            client = LLMClient()",
            "lineNumber": 220
          },
          {
            "text": "                            raw_toon_text = client.generate_flow(combined_prompt, current_flow if append_mode_flag else None)",
            "lineNumber": 221
          },
          {
            "text": "                            ",
            "lineNumber": 222
          },
          {
            "text": "                            # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 223
          },
          {
            "text": "                            if client.is_question_response(raw_toon_text):",
            "lineNumber": 224
          },
          {
            "text": "                                # å†åº¦è³ªå•ãŒæ¥ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°",
            "lineNumber": 225
          },
          {
            "text": "                                st.session_state.conversation_context =",
            "lineNumber": 226
          }
        ]
      },
      "score": 0.1404411941766739
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 185,
            "column": 65
          },
          "endPosition": {
            "line": 210,
            "column": 20
          }
        },
        "contents": ",\n            placeholder=\"å›ç­”ã‚’å…¥åŠ›...\",\n            height=100,\n            key=\"answer_input\"\n        )\n        \n        col_answer, col_cancel = st.columns([2, 1])\n        with col_answer:\n            if st.button(\"å›ç­”ã‚’é€ä¿¡\", type=\"primary\", use_container_width=True):\n                if user_answer:\n                    # å›ç­”ã‚’åé›†\n                    st.session_state.question_responses.append(user_answer)\n                    \n                    # å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€è³ªå•ã€å›ç­”ã‚’çµ„ã¿åˆã‚ã›ã¦å†é€ä¿¡\n                    combined_prompt = st.session_state.conversation_context\n                    if st.session_state.pending_questions:\n                        combined_prompt += f\"\\n\\nè³ªå•:\\n{st.session_state.pending_questions}\\n\"\n                    if st.session_state.question_responses:\n                        combined_prompt += \"\\n\\nå›ç­”:\\n\"\n                        for i, response in enumerate(st.session_state.question_responses, 1):\n                            combined_prompt += f\"{i}. {response}\\n\"\n                    \n                    # è³ªå•æ™‚ã®å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜\n                    append_mode_flag = st.session_state.append_mode_for_question\n                    \n                    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": ",",
            "lineNumber": 186
          },
          {
            "text": "            placeholder=\"å›ç­”ã‚’å…¥åŠ›...\",",
            "lineNumber": 187
          },
          {
            "text": "            height=100,",
            "lineNumber": 188
          },
          {
            "text": "            key=\"answer_input\"",
            "lineNumber": 189
          },
          {
            "text": "        )",
            "lineNumber": 190
          },
          {
            "text": "        ",
            "lineNumber": 191
          },
          {
            "text": "        col_answer, col_cancel = st.columns([2, 1])",
            "lineNumber": 192
          },
          {
            "text": "        with col_answer:",
            "lineNumber": 193
          },
          {
            "text": "            if st.button(\"å›ç­”ã‚’é€ä¿¡\", type=\"primary\", use_container_width=True):",
            "lineNumber": 194
          },
          {
            "text": "                if user_answer:",
            "lineNumber": 195
          },
          {
            "text": "                    # å›ç­”ã‚’åé›†",
            "lineNumber": 196
          },
          {
            "text": "                    st.session_state.question_responses.append(user_answer)",
            "lineNumber": 197
          },
          {
            "text": "                    ",
            "lineNumber": 198
          },
          {
            "text": "                    # å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€è³ªå•ã€å›ç­”ã‚’çµ„ã¿åˆã‚ã›ã¦å†é€ä¿¡",
            "lineNumber": 199
          },
          {
            "text": "                    combined_prompt = st.session_state.conversation_context",
            "lineNumber": 200
          },
          {
            "text": "                    if st.session_state.pending_questions:",
            "lineNumber": 201
          },
          {
            "text": "                        combined_prompt += f\"\\n\\nè³ªå•:\\n{st.session_state.pending_questions}\\n\"",
            "lineNumber": 202
          },
          {
            "text": "                    if st.session_state.question_responses:",
            "lineNumber": 203
          },
          {
            "text": "                        combined_prompt += \"\\n\\nå›ç­”:\\n\"",
            "lineNumber": 204
          },
          {
            "text": "                        for i, response in enumerate(st.session_state.question_responses, 1):",
            "lineNumber": 205
          },
          {
            "text": "                            combined_prompt += f\"{i}. {response}\\n\"",
            "lineNumber": 206
          },
          {
            "text": "                    ",
            "lineNumber": 207
          },
          {
            "text": "                    # è³ªå•æ™‚ã®å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜",
            "lineNumber": 208
          },
          {
            "text": "                    append_mode_flag = st.session_state.append_mode_for_question",
            "lineNumber": 209
          },
          {
            "text": "                    ",
            "lineNumber": 210
          },
          {
            "text": "                    ",
            "lineNumber": 211
          }
        ]
      },
      "score": 0.13714660704135895
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\llm_client.py",
        "range": {
          "startPosition": {
            "line": 8
          },
          "endPosition": {
            "line": 395
          }
        },
        "contents": "class LLMClient:\ndef generate_partial_change(\n        self, \n        user_input: str, \n        target_flowchart: Flowchart,\n        full_flowchart: Flowchart\n    ) -&gt; str:\n{target_toon}\n\nå¤‰æ›´æŒ‡ç¤º: {user_input}\n\né‡è¦:\n- startã¨endãƒãƒ¼ãƒ‰ã¯å¤‰æ›´å¯¾è±¡å¤–ã§ã™ã€‚ã“ã‚Œã‚‰ã®ãƒãƒ¼ãƒ‰ã‚’å«ã‚ãªã„ã§ãã ã•ã„ã€‚\n- é¸æŠã•ã‚ŒãŸç¯„å›²ã®ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã®ã¿ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚\n- é¸æŠç¯„å›²å¤–ã®ãƒãƒ¼ãƒ‰ã‚„ã‚¨ãƒƒã‚¸ã¯å¤‰æ›´ã—ãªã„ã§ãã ã•ã„ã€‚\n- æ–°ã—ã„ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹å ´åˆã¯ã€æ—¢å­˜ã®ãƒãƒ¼ãƒ‰IDã¨é‡è¤‡ã—ãªã„ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚\n- å¤‰æ›´çµæœã¯TOONå½¢å¼ã§è¿”ã—ã¦ãã ã•ã„ã€‚\n\"\"\"\n            \n            # Ollama HTTP APIã‚’ç›´æ¥å‘¼ã³å‡ºã—\n            payload = {\n                \"model\": self.model,\n                \"messages\": [\n                    {\"role\": \"system\", \"content\": self.system_instruction},\n                    {\"role\": \"user\", \"content\": full_context}\n                ],\n                \"options\": {\n                    \"temperature\": 0.7\n                },\n                \"stream\": False\n            }\n            \n            # localhostã¸ã®æ¥ç¶šã§ã¯ãƒ—ãƒ­ã‚­ã‚·ã‚’ä½¿ç”¨ã—ãªã„\n            proxies = {\"http\": None, \"https\": None} if \"localhost\" in self.base_url or \"127.0.0.1\" in self.base_url else None\n            \n            response = requests.post(\n                self.api_url,\n                json=payload,\n                timeout=300,\n                proxies=proxies\n            )\n            \n            response.raise_for_status()\n            result = response.json()\n            \n            if result and 'message' in result and 'content' in result['message']:\n                toon_text = result['message']['content']\n                \n                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼ï¼ˆè³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰\n                if not self.is_question_response(toon_text):\n                    is_valid, validation_message = self.validate_output_size(toon_text)\n                    if not is_valid:\n                        warning_comment = f\"&lt;!-- {validation_message} --&gt;\\n\"\n                        toon_text = warning_comment + toon_text\n                \n                return toon_text\n            else:\n                raise ValueError(\"ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰æœ‰åŠ¹ãªå¿œç­”ãŒå¾—ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚\")\n                \n        except ValueError:\n            raise",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 9,
                "column": 1
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 145,
                "column": 5
              },
              "endPosition": {
                "line": 146,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class LLMClient:",
            "lineNumber": 9,
            "isSignature": true
          },
          {
            "text": "def generate_partial_change(",
            "lineNumber": 145
          },
          {
            "text": "        self, ",
            "lineNumber": 146
          },
          {
            "text": "        user_input: str, ",
            "lineNumber": 147
          },
          {
            "text": "        target_flowchart: Flowchart,",
            "lineNumber": 148
          },
          {
            "text": "        full_flowchart: Flowchart",
            "lineNumber": 149
          },
          {
            "text": "    ) -&gt; str:",
            "lineNumber": 150
          },
          {
            "text": "{target_toon}",
            "lineNumber": 173
          },
          {
            "lineNumber": 174
          },
          {
            "text": "å¤‰æ›´æŒ‡ç¤º: {user_input}",
            "lineNumber": 175
          },
          {
            "lineNumber": 176
          },
          {
            "text": "é‡è¦:",
            "lineNumber": 177
          },
          {
            "text": "- startã¨endãƒãƒ¼ãƒ‰ã¯å¤‰æ›´å¯¾è±¡å¤–ã§ã™ã€‚ã“ã‚Œã‚‰ã®ãƒãƒ¼ãƒ‰ã‚’å«ã‚ãªã„ã§ãã ã•ã„ã€‚",
            "lineNumber": 178
          },
          {
            "text": "- é¸æŠã•ã‚ŒãŸç¯„å›²ã®ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã®ã¿ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚",
            "lineNumber": 179
          },
          {
            "text": "- é¸æŠç¯„å›²å¤–ã®ãƒãƒ¼ãƒ‰ã‚„ã‚¨ãƒƒã‚¸ã¯å¤‰æ›´ã—ãªã„ã§ãã ã•ã„ã€‚",
            "lineNumber": 180
          },
          {
            "text": "- æ–°ã—ã„ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹å ´åˆã¯ã€æ—¢å­˜ã®ãƒãƒ¼ãƒ‰IDã¨é‡è¤‡ã—ãªã„ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚",
            "lineNumber": 181
          },
          {
            "text": "- å¤‰æ›´çµæœã¯TOONå½¢å¼ã§è¿”ã—ã¦ãã ã•ã„ã€‚",
            "lineNumber": 182
          },
          {
            "text": "\"\"\"",
            "lineNumber": 183
          },
          {
            "text": "            ",
            "lineNumber": 184
          },
          {
            "text": "            # Ollama HTTP APIã‚’ç›´æ¥å‘¼ã³å‡ºã—",
            "lineNumber": 185
          },
          {
            "text": "            payload = {",
            "lineNumber": 186
          },
          {
            "text": "                \"model\": self.model,",
            "lineNumber": 187
          },
          {
            "text": "                \"messages\": [",
            "lineNumber": 188
          },
          {
            "text": "                    {\"role\": \"system\", \"content\": self.system_instruction},",
            "lineNumber": 189
          },
          {
            "text": "                    {\"role\": \"user\", \"content\": full_context}",
            "lineNumber": 190
          },
          {
            "text": "                ],",
            "lineNumber": 191
          },
          {
            "text": "                \"options\": {",
            "lineNumber": 192
          },
          {
            "text": "                    \"temperature\": 0.7",
            "lineNumber": 193
          },
          {
            "text": "                },",
            "lineNumber": 194
          },
          {
            "text": "                \"stream\": False",
            "lineNumber": 195
          },
          {
            "text": "            }",
            "lineNumber": 196
          },
          {
            "text": "            ",
            "lineNumber": 197
          },
          {
            "text": "            # localhostã¸ã®æ¥ç¶šã§ã¯ãƒ—ãƒ­ã‚­ã‚·ã‚’ä½¿ç”¨ã—ãªã„",
            "lineNumber": 198
          },
          {
            "text": "            proxies = {\"http\": None, \"https\": None} if \"localhost\" in self.base_url or \"127.0.0.1\" in self.base_url else None",
            "lineNumber": 199
          },
          {
            "text": "            ",
            "lineNumber": 200
          },
          {
            "text": "            response = requests.post(",
            "lineNumber": 201
          },
          {
            "text": "                self.api_url,",
            "lineNumber": 202
          },
          {
            "text": "                json=payload,",
            "lineNumber": 203
          },
          {
            "text": "                timeout=300,",
            "lineNumber": 204
          },
          {
            "text": "                proxies=proxies",
            "lineNumber": 205
          },
          {
            "text": "            )",
            "lineNumber": 206
          },
          {
            "text": "            ",
            "lineNumber": 207
          },
          {
            "text": "            response.raise_for_status()",
            "lineNumber": 208
          },
          {
            "text": "            result = response.json()",
            "lineNumber": 209
          },
          {
            "text": "            ",
            "lineNumber": 210
          },
          {
            "text": "            if result and 'message' in result and 'content' in result['message']:",
            "lineNumber": 211
          },
          {
            "text": "                toon_text = result['message']['content']",
            "lineNumber": 212
          },
          {
            "text": "                ",
            "lineNumber": 213
          },
          {
            "text": "                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼ï¼ˆè³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰",
            "lineNumber": 214
          },
          {
            "text": "                if not self.is_question_response(toon_text):",
            "lineNumber": 215
          },
          {
            "text": "                    is_valid, validation_message = self.validate_output_size(toon_text)",
            "lineNumber": 216
          },
          {
            "text": "                    if not is_valid:",
            "lineNumber": 217
          },
          {
            "text": "                        warning_comment = f\"&lt;!-- {validation_message} --&gt;\\n\"",
            "lineNumber": 218
          },
          {
            "text": "                        toon_text = warning_comment + toon_text",
            "lineNumber": 219
          },
          {
            "text": "                ",
            "lineNumber": 220
          },
          {
            "text": "                return toon_text",
            "lineNumber": 221
          },
          {
            "text": "            else:",
            "lineNumber": 222
          },
          {
            "text": "                raise ValueError(\"ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰æœ‰åŠ¹ãªå¿œç­”ãŒå¾—ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚\")",
            "lineNumber": 223
          },
          {
            "text": "                ",
            "lineNumber": 224
          },
          {
            "text": "        except ValueError:",
            "lineNumber": 225
          },
          {
            "text": "            raise",
            "lineNumber": 226
          }
        ]
      },
      "score": 0.1369161605834961
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 263,
            "column": 62
          },
          "endPosition": {
            "line": 282,
            "column": 40
          }
        },
        "contents": "                            st.info(\"OllamaãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ã€ãƒ¢ãƒ‡ãƒ«ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚\")\n                        except TOONParseError as e:\n                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ\n                            st.session_state.conversation_context = temp_context\n                            st.session_state.pending_questions = temp_questions\n                            st.session_state.question_responses = temp_responses\n                            \n                            # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯\n                            if 'raw_toon_text' in locals() and raw_toon_text:\n                                if client.is_question_response(raw_toon_text):\n                                    # è³ªå•å½¢å¼ã®å¿œç­”ã ã£ãŸå ´åˆ\n                                    st.session_state.conversation_context = combined_prompt\n                                    st.session_state.pending_questions = raw_toon_text\n                                    st.session_state.question_responses = []\n                                    st.info(\"LLMã‹ã‚‰è¿½åŠ ã®è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n                                    st.rerun()\n                                else:\n                                    st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")\n                                    with",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                            st.info(\"OllamaãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ã€ãƒ¢ãƒ‡ãƒ«ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 265
          },
          {
            "text": "                        except TOONParseError as e:",
            "lineNumber": 266
          },
          {
            "text": "                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ",
            "lineNumber": 267
          },
          {
            "text": "                            st.session_state.conversation_context = temp_context",
            "lineNumber": 268
          },
          {
            "text": "                            st.session_state.pending_questions = temp_questions",
            "lineNumber": 269
          },
          {
            "text": "                            st.session_state.question_responses = temp_responses",
            "lineNumber": 270
          },
          {
            "text": "                            ",
            "lineNumber": 271
          },
          {
            "text": "                            # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 272
          },
          {
            "text": "                            if 'raw_toon_text' in locals() and raw_toon_text:",
            "lineNumber": 273
          },
          {
            "text": "                                if client.is_question_response(raw_toon_text):",
            "lineNumber": 274
          },
          {
            "text": "                                    # è³ªå•å½¢å¼ã®å¿œç­”ã ã£ãŸå ´åˆ",
            "lineNumber": 275
          },
          {
            "text": "                                    st.session_state.conversation_context = combined_prompt",
            "lineNumber": 276
          },
          {
            "text": "                                    st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 277
          },
          {
            "text": "                                    st.session_state.question_responses = []",
            "lineNumber": 278
          },
          {
            "text": "                                    st.info(\"LLMã‹ã‚‰è¿½åŠ ã®è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 279
          },
          {
            "text": "                                    st.rerun()",
            "lineNumber": 280
          },
          {
            "text": "                                else:",
            "lineNumber": 281
          },
          {
            "text": "                                    st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 282
          },
          {
            "text": "                                    with",
            "lineNumber": 283
          }
        ]
      },
      "score": 0.127791166305542
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 382,
            "column": 72
          },
          "endPosition": {
            "line": 408,
            "column": 44
          }
        },
        "contents": "                            st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")\n                        else:\n                            # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ \n                            st.session_state.history.append(new_flow)\n                        \n                        st.rerun()\n                except LLMAPIError as e:\n                    # LLM APIã‚¨ãƒ©ãƒ¼\n                    st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {e}\")\n                    st.info(\"OllamaãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ã€ãƒ¢ãƒ‡ãƒ«ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚\")\n                except TOONParseError as e:\n                    # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼\n                    # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯\n                    if 'raw_toon_text' in locals() and raw_toon_text:\n                        client = LLMClient()\n                        if client.is_question_response(raw_toon_text):\n                            # è³ªå•å½¢å¼ã®å¿œç­”ã ã£ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜\n                            st.session_state.conversation_context = user_prompt\n                            st.session_state.pending_questions = raw_toon_text\n                            st.session_state.question_responses = []\n                            st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n                            st.rerun()\n                        else:\n                            # æœ¬å½“ã«ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã®å ´åˆ\n                            st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")\n                            with st.expander",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                            st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")",
            "lineNumber": 384
          },
          {
            "text": "                        else:",
            "lineNumber": 385
          },
          {
            "text": "                            # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ ",
            "lineNumber": 386
          },
          {
            "text": "                            st.session_state.history.append(new_flow)",
            "lineNumber": 387
          },
          {
            "text": "                        ",
            "lineNumber": 388
          },
          {
            "text": "                        st.rerun()",
            "lineNumber": 389
          },
          {
            "text": "                except LLMAPIError as e:",
            "lineNumber": 390
          },
          {
            "text": "                    # LLM APIã‚¨ãƒ©ãƒ¼",
            "lineNumber": 391
          },
          {
            "text": "                    st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {e}\")",
            "lineNumber": 392
          },
          {
            "text": "                    st.info(\"OllamaãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ã€ãƒ¢ãƒ‡ãƒ«ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 393
          },
          {
            "text": "                except TOONParseError as e:",
            "lineNumber": 394
          },
          {
            "text": "                    # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼",
            "lineNumber": 395
          },
          {
            "text": "                    # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 396
          },
          {
            "text": "                    if 'raw_toon_text' in locals() and raw_toon_text:",
            "lineNumber": 397
          },
          {
            "text": "                        client = LLMClient()",
            "lineNumber": 398
          },
          {
            "text": "                        if client.is_question_response(raw_toon_text):",
            "lineNumber": 399
          },
          {
            "text": "                            # è³ªå•å½¢å¼ã®å¿œç­”ã ã£ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜",
            "lineNumber": 400
          },
          {
            "text": "                            st.session_state.conversation_context = user_prompt",
            "lineNumber": 401
          },
          {
            "text": "                            st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 402
          },
          {
            "text": "                            st.session_state.question_responses = []",
            "lineNumber": 403
          },
          {
            "text": "                            st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 404
          },
          {
            "text": "                            st.rerun()",
            "lineNumber": 405
          },
          {
            "text": "                        else:",
            "lineNumber": 406
          },
          {
            "text": "                            # æœ¬å½“ã«ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã®å ´åˆ",
            "lineNumber": 407
          },
          {
            "text": "                            st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 408
          },
          {
            "text": "                            with st.expander",
            "lineNumber": 409
          }
        ]
      },
      "score": 0.11969880014657974
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 404,
            "column": 38
          },
          "endPosition": {
            "line": 424,
            "column": 26
          }
        },
        "contents": "                        else:\n                            # æœ¬å½“ã«ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã®å ´åˆ\n                            st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")\n                            with st.expander(\"ğŸ” LLMã®ç”Ÿå‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰\", expanded=True):\n                                st.info(\"ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’TOONå½¢å¼ã¨ã—ã¦è§£é‡ˆã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€å¤±æ•—ã—ã¾ã—ãŸã€‚\")\n                                st.code(raw_toon_text)\n                    else:\n                        st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")\n                except FlowchartValidationError as e:\n                    # Flowchartãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ï¼ˆè­¦å‘Šã¨ã—ã¦è¡¨ç¤ºã€è‡ªå‹•ä¿®æ­£ã‚’è©¦è¡Œï¼‰\n                    st.warning(f\"ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®æ¤œè¨¼ã§å•é¡Œã‚’æ¤œå‡ºã—ã¾ã—ãŸ: {e}\")\n                    st.info(\"è«–ç†ã®ç©´æ¤œçŸ¥ã§è‡ªå‹•ä¿®æ­£ã‚’è©¦è¡Œã—ã¾ã™ã€‚\")\n                    # è‡ªå‹•ä¿®æ­£ã‚’è©¦è¡Œï¼ˆæ—¢ã«apply_logic_gap_detectionãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹ãŒã€å†åº¦è©¦è¡Œï¼‰\n                    try:\n                        if 'new_flow' in locals():\n                            corrected_flow = new_flow.apply_logic_gap_detection()\n                            st.session_state.history.append(corrected_flow)\n                            st.success(\"è‡ªå‹•ä¿®æ­£ãŒå®Œäº†ã—ã¾ã—ãŸã€‚\")\n                            st.rerun()\n                    except",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                        else:",
            "lineNumber": 406
          },
          {
            "text": "                            # æœ¬å½“ã«ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã®å ´åˆ",
            "lineNumber": 407
          },
          {
            "text": "                            st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 408
          },
          {
            "text": "                            with st.expander(\"ğŸ” LLMã®ç”Ÿå‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰\", expanded=True):",
            "lineNumber": 409
          },
          {
            "text": "                                st.info(\"ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’TOONå½¢å¼ã¨ã—ã¦è§£é‡ˆã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€å¤±æ•—ã—ã¾ã—ãŸã€‚\")",
            "lineNumber": 410
          },
          {
            "text": "                                st.code(raw_toon_text)",
            "lineNumber": 411
          },
          {
            "text": "                    else:",
            "lineNumber": 412
          },
          {
            "text": "                        st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 413
          },
          {
            "text": "                except FlowchartValidationError as e:",
            "lineNumber": 414
          },
          {
            "text": "                    # Flowchartãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ï¼ˆè­¦å‘Šã¨ã—ã¦è¡¨ç¤ºã€è‡ªå‹•ä¿®æ­£ã‚’è©¦è¡Œï¼‰",
            "lineNumber": 415
          },
          {
            "text": "                    st.warning(f\"ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®æ¤œè¨¼ã§å•é¡Œã‚’æ¤œå‡ºã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 416
          },
          {
            "text": "                    st.info(\"è«–ç†ã®ç©´æ¤œçŸ¥ã§è‡ªå‹•ä¿®æ­£ã‚’è©¦è¡Œã—ã¾ã™ã€‚\")",
            "lineNumber": 417
          },
          {
            "text": "                    # è‡ªå‹•ä¿®æ­£ã‚’è©¦è¡Œï¼ˆæ—¢ã«apply_logic_gap_detectionãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹ãŒã€å†åº¦è©¦è¡Œï¼‰",
            "lineNumber": 418
          },
          {
            "text": "                    try:",
            "lineNumber": 419
          },
          {
            "text": "                        if 'new_flow' in locals():",
            "lineNumber": 420
          },
          {
            "text": "                            corrected_flow = new_flow.apply_logic_gap_detection()",
            "lineNumber": 421
          },
          {
            "text": "                            st.session_state.history.append(corrected_flow)",
            "lineNumber": 422
          },
          {
            "text": "                            st.success(\"è‡ªå‹•ä¿®æ­£ãŒå®Œäº†ã—ã¾ã—ãŸã€‚\")",
            "lineNumber": 423
          },
          {
            "text": "                            st.rerun()",
            "lineNumber": 424
          },
          {
            "text": "                    except",
            "lineNumber": 425
          }
        ]
      },
      "score": 0.10820615291595459
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 422,
            "column": 78
          },
          "endPosition": {
            "line": 447,
            "column": 24
          }
        },
        "contents": "                            st.rerun()\n                    except Exception as correction_error:\n                        st.error(f\"è‡ªå‹•ä¿®æ­£ã«å¤±æ•—ã—ã¾ã—ãŸ: {correction_error}\")\n                except ValueError as e:\n                    # ãã®ä»–ã®ValueErrorï¼ˆãƒ¢ãƒ‡ãƒ«å¿œç­”ã‚¨ãƒ©ãƒ¼ãªã©ï¼‰\n                    st.error(f\"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}\")\n                except Exception as e:\n                    # äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼\n                    st.error(f\"äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}\")\n                    # ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šã‚¨ãƒ©ãƒ¼æ™‚ã«ç”Ÿå‡ºåŠ›ã‚’ç¢ºèªã§ãã‚‹ã‚¨ã‚¯ã‚¹ãƒ‘ãƒ³ãƒ€ãƒ¼ã‚’è¡¨ç¤º\n                    if 'raw_toon_text' in locals() and raw_toon_text:\n                        # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯\n                        try:\n                            client = LLMClient()\n                            if client.is_question_response(raw_toon_text):\n                                # è³ªå•å½¢å¼ã®å¿œç­”ã ã£ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜\n                                st.session_state.conversation_context = user_prompt\n                                st.session_state.pending_questions = raw_toon_text\n                                st.session_state.question_responses = []\n                                st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n                                st.rerun()\n                        except:\n                            pass\n                        \n                        ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                            st.rerun()",
            "lineNumber": 424
          },
          {
            "text": "                    except Exception as correction_error:",
            "lineNumber": 425
          },
          {
            "text": "                        st.error(f\"è‡ªå‹•ä¿®æ­£ã«å¤±æ•—ã—ã¾ã—ãŸ: {correction_error}\")",
            "lineNumber": 426
          },
          {
            "text": "                except ValueError as e:",
            "lineNumber": 427
          },
          {
            "text": "                    # ãã®ä»–ã®ValueErrorï¼ˆãƒ¢ãƒ‡ãƒ«å¿œç­”ã‚¨ãƒ©ãƒ¼ãªã©ï¼‰",
            "lineNumber": 428
          },
          {
            "text": "                    st.error(f\"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 429
          },
          {
            "text": "                except Exception as e:",
            "lineNumber": 430
          },
          {
            "text": "                    # äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼",
            "lineNumber": 431
          },
          {
            "text": "                    st.error(f\"äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 432
          },
          {
            "text": "                    # ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šã‚¨ãƒ©ãƒ¼æ™‚ã«ç”Ÿå‡ºåŠ›ã‚’ç¢ºèªã§ãã‚‹ã‚¨ã‚¯ã‚¹ãƒ‘ãƒ³ãƒ€ãƒ¼ã‚’è¡¨ç¤º",
            "lineNumber": 433
          },
          {
            "text": "                    if 'raw_toon_text' in locals() and raw_toon_text:",
            "lineNumber": 434
          },
          {
            "text": "                        # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 435
          },
          {
            "text": "                        try:",
            "lineNumber": 436
          },
          {
            "text": "                            client = LLMClient()",
            "lineNumber": 437
          },
          {
            "text": "                            if client.is_question_response(raw_toon_text):",
            "lineNumber": 438
          },
          {
            "text": "                                # è³ªå•å½¢å¼ã®å¿œç­”ã ã£ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜",
            "lineNumber": 439
          },
          {
            "text": "                                st.session_state.conversation_context = user_prompt",
            "lineNumber": 440
          },
          {
            "text": "                                st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 441
          },
          {
            "text": "                                st.session_state.question_responses = []",
            "lineNumber": 442
          },
          {
            "text": "                                st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 443
          },
          {
            "text": "                                st.rerun()",
            "lineNumber": 444
          },
          {
            "text": "                        except:",
            "lineNumber": 445
          },
          {
            "text": "                            pass",
            "lineNumber": 446
          },
          {
            "text": "                        ",
            "lineNumber": 447
          },
          {
            "text": "                        ",
            "lineNumber": 448
          }
        ]
      },
      "score": 0.10695713758468628
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 330,
            "column": 140
          },
          "endPosition": {
            "line": 351,
            "column": 49
          }
        },
        "contents": "\"\n    )\n    \n    user_prompt = st.text_area(\n        \"ã©ã®ã‚ˆã†ãªãƒ—ãƒ­ã‚»ã‚¹ã‚’å¯è¦–åŒ–ã—ãŸã„ã§ã™ã‹ï¼Ÿ\", \n        placeholder=\"ä¾‹ï¼šãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®æ•…éšœè¨ºæ–­æ‰‹é †ã‚’ãƒ•ãƒ­ãƒ¼ã«ã—ã¦\",\n        help=\"è‡ªç„¶è¨€èªã§å…¥åŠ›ã™ã‚‹ã¨LLMãŒTOONå½¢å¼ã‚’ç”Ÿæˆã—ã€ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’æ›´æ–°ã—ã¾ã™ã€‚\",\n        height=150\n    )\n    \n    if st.button(\"ãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆ\", type=\"primary\", use_container_width=True):\n        if user_prompt:\n            with st.spinner(\"LLMãŒãƒ•ãƒ­ãƒ¼ã‚’è¨­è¨ˆä¸­...\"):\n                raw_toon_text = \"\"\n                try:\n                    # LLMã¨ã®é€šä¿¡\n                    client = LLMClient()\n                    # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯æ—¢å­˜ã®Flowchartã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦æ¸¡ã™\n                    context_flowchart = current_flow if append_mode else None\n                    \n                    # éƒ¨åˆ†ãƒ•ãƒ­ãƒ¼ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¿½åŠ æŒ‡ç¤ºã‚’ä»˜ä¸\n                    enhanced_prompt = user_prompt",
        "signatures": {},
        "detailedLines": [
          {
            "text": "\"",
            "lineNumber": 331
          },
          {
            "text": "    )",
            "lineNumber": 332
          },
          {
            "text": "    ",
            "lineNumber": 333
          },
          {
            "text": "    user_prompt = st.text_area(",
            "lineNumber": 334
          },
          {
            "text": "        \"ã©ã®ã‚ˆã†ãªãƒ—ãƒ­ã‚»ã‚¹ã‚’å¯è¦–åŒ–ã—ãŸã„ã§ã™ã‹ï¼Ÿ\", ",
            "lineNumber": 335
          },
          {
            "text": "        placeholder=\"ä¾‹ï¼šãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®æ•…éšœè¨ºæ–­æ‰‹é †ã‚’ãƒ•ãƒ­ãƒ¼ã«ã—ã¦\",",
            "lineNumber": 336
          },
          {
            "text": "        help=\"è‡ªç„¶è¨€èªã§å…¥åŠ›ã™ã‚‹ã¨LLMãŒTOONå½¢å¼ã‚’ç”Ÿæˆã—ã€ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’æ›´æ–°ã—ã¾ã™ã€‚\",",
            "lineNumber": 337
          },
          {
            "text": "        height=150",
            "lineNumber": 338
          },
          {
            "text": "    )",
            "lineNumber": 339
          },
          {
            "text": "    ",
            "lineNumber": 340
          },
          {
            "text": "    if st.button(\"ãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆ\", type=\"primary\", use_container_width=True):",
            "lineNumber": 341
          },
          {
            "text": "        if user_prompt:",
            "lineNumber": 342
          },
          {
            "text": "            with st.spinner(\"LLMãŒãƒ•ãƒ­ãƒ¼ã‚’è¨­è¨ˆä¸­...\"):",
            "lineNumber": 343
          },
          {
            "text": "                raw_toon_text = \"\"",
            "lineNumber": 344
          },
          {
            "text": "                try:",
            "lineNumber": 345
          },
          {
            "text": "                    # LLMã¨ã®é€šä¿¡",
            "lineNumber": 346
          },
          {
            "text": "                    client = LLMClient()",
            "lineNumber": 347
          },
          {
            "text": "                    # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯æ—¢å­˜ã®Flowchartã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦æ¸¡ã™",
            "lineNumber": 348
          },
          {
            "text": "                    context_flowchart = current_flow if append_mode else None",
            "lineNumber": 349
          },
          {
            "text": "                    ",
            "lineNumber": 350
          },
          {
            "text": "                    # éƒ¨åˆ†ãƒ•ãƒ­ãƒ¼ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¿½åŠ æŒ‡ç¤ºã‚’ä»˜ä¸",
            "lineNumber": 351
          },
          {
            "text": "                    enhanced_prompt = user_prompt",
            "lineNumber": 352
          }
        ]
      },
      "score": 0.0982419028878212
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 75,
            "column": 34
          },
          "endPosition": {
            "line": 121,
            "column": 72
          }
        },
        "contents": "                st.sidebar.error(f\"å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")\n        else:\n            st.sidebar.warning(\"ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\")\n\n# ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®èª­ã¿è¾¼ã¿ï¼ˆé¸æŠå¼ï¼‰\nst.sidebar.subheader(\"ğŸ“‚ ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’èª­ã¿è¾¼ã‚€\")\nif saved_sessions:\n    selected_session = st.sidebar.selectbox(\n        \"ä¿å­˜æ¸ˆã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é¸æŠ\",\n        [\"\"] + saved_sessions,\n        key=\"session_selector\"\n    )\n    if selected_session and st.sidebar.button(\"é¸æŠã—ãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’èª­ã¿è¾¼ã¿\", use_container_width=True):\n        try:\n            loaded_history = history_mgr.load_session(selected_session)\n            if loaded_history:\n                st.session_state.history = loaded_history\n                st.sidebar.success(f\"'{selected_session}' ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ\")\n                st.rerun()\n            else:\n                st.sidebar.error(\"ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ\")\n        except ValueError as e:\n            st.sidebar.error(str(e))\n        except Exception as e:\n            st.sidebar.error(f\"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}\")\nelse:\n    st.sidebar.info(\"ä¿å­˜ã•ã‚ŒãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ã‚ã‚Šã¾ã›ã‚“\")\n\n# TOONãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿\nst.sidebar.subheader(\"ğŸ“„ TOONãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†\")\ntoon_files = history_mgr.list_toon_files()\nif toon_files:\n    selected_toon = st.sidebar.selectbox(\"TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ\", [\"\"] + toon_files)\n    if selected_toon and st.sidebar.button(\"TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿\"):\n        try:\n            loaded_flow = history_mgr.load_toon_file(selected_toon)\n            if loaded_flow:\n                st.session_state.history = [loaded_flow]\n                st.sidebar.success(f\"'{selected_toon}' ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ\")\n                st.rerun()\n            else:\n                st.sidebar.error(\"TOONãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\")\n        except ValueError as e:\n            st.sidebar.error(str(e))\nelse:\n    st.sidebar.info(\"ä¿å­˜ã•ã‚ŒãŸTOONãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“\")",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                st.sidebar.error(f\"å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 77
          },
          {
            "text": "        else:",
            "lineNumber": 78
          },
          {
            "text": "            st.sidebar.warning(\"ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\")",
            "lineNumber": 79
          },
          {
            "lineNumber": 80
          },
          {
            "text": "# ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®èª­ã¿è¾¼ã¿ï¼ˆé¸æŠå¼ï¼‰",
            "lineNumber": 81
          },
          {
            "text": "st.sidebar.subheader(\"ğŸ“‚ ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’èª­ã¿è¾¼ã‚€\")",
            "lineNumber": 82
          },
          {
            "text": "if saved_sessions:",
            "lineNumber": 83
          },
          {
            "text": "    selected_session = st.sidebar.selectbox(",
            "lineNumber": 84
          },
          {
            "text": "        \"ä¿å­˜æ¸ˆã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é¸æŠ\",",
            "lineNumber": 85
          },
          {
            "text": "        [\"\"] + saved_sessions,",
            "lineNumber": 86
          },
          {
            "text": "        key=\"session_selector\"",
            "lineNumber": 87
          },
          {
            "text": "    )",
            "lineNumber": 88
          },
          {
            "text": "    if selected_session and st.sidebar.button(\"é¸æŠã—ãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’èª­ã¿è¾¼ã¿\", use_container_width=True):",
            "lineNumber": 89
          },
          {
            "text": "        try:",
            "lineNumber": 90
          },
          {
            "text": "            loaded_history = history_mgr.load_session(selected_session)",
            "lineNumber": 91
          },
          {
            "text": "            if loaded_history:",
            "lineNumber": 92
          },
          {
            "text": "                st.session_state.history = loaded_history",
            "lineNumber": 93
          },
          {
            "text": "                st.sidebar.success(f\"'{selected_session}' ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ\")",
            "lineNumber": 94
          },
          {
            "text": "                st.rerun()",
            "lineNumber": 95
          },
          {
            "text": "            else:",
            "lineNumber": 96
          },
          {
            "text": "                st.sidebar.error(\"ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ\")",
            "lineNumber": 97
          },
          {
            "text": "        except ValueError as e:",
            "lineNumber": 98
          },
          {
            "text": "            st.sidebar.error(str(e))",
            "lineNumber": 99
          },
          {
            "text": "        except Exception as e:",
            "lineNumber": 100
          },
          {
            "text": "            st.sidebar.error(f\"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 101
          },
          {
            "text": "else:",
            "lineNumber": 102
          },
          {
            "text": "    st.sidebar.info(\"ä¿å­˜ã•ã‚ŒãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ã‚ã‚Šã¾ã›ã‚“\")",
            "lineNumber": 103
          },
          {
            "lineNumber": 104
          },
          {
            "text": "# TOONãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿",
            "lineNumber": 105
          },
          {
            "text": "st.sidebar.subheader(\"ğŸ“„ TOONãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†\")",
            "lineNumber": 106
          },
          {
            "text": "toon_files = history_mgr.list_toon_files()",
            "lineNumber": 107
          },
          {
            "text": "if toon_files:",
            "lineNumber": 108
          },
          {
            "text": "    selected_toon = st.sidebar.selectbox(\"TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ\", [\"\"] + toon_files)",
            "lineNumber": 109
          },
          {
            "text": "    if selected_toon and st.sidebar.button(\"TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿\"):",
            "lineNumber": 110
          },
          {
            "text": "        try:",
            "lineNumber": 111
          },
          {
            "text": "            loaded_flow = history_mgr.load_toon_file(selected_toon)",
            "lineNumber": 112
          },
          {
            "text": "            if loaded_flow:",
            "lineNumber": 113
          },
          {
            "text": "                st.session_state.history = [loaded_flow]",
            "lineNumber": 114
          },
          {
            "text": "                st.sidebar.success(f\"'{selected_toon}' ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ\")",
            "lineNumber": 115
          },
          {
            "text": "                st.rerun()",
            "lineNumber": 116
          },
          {
            "text": "            else:",
            "lineNumber": 117
          },
          {
            "text": "                st.sidebar.error(\"TOONãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\")",
            "lineNumber": 118
          },
          {
            "text": "        except ValueError as e:",
            "lineNumber": 119
          },
          {
            "text": "            st.sidebar.error(str(e))",
            "lineNumber": 120
          },
          {
            "text": "else:",
            "lineNumber": 121
          },
          {
            "text": "    st.sidebar.info(\"ä¿å­˜ã•ã‚ŒãŸTOONãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“\")",
            "lineNumber": 122
          }
        ]
      },
      "score": 0.09521496295928955
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---

_**User**_

@storage/toon_files/flow_md.md ã“ã®ãƒãƒ¼ãƒ¡ã‚¤ãƒ‰å›³ã‚’æ•´ç†ã—ã¦ãã ã•ã„ã€‚
ä¸æ˜ãªç‚¹ãŒã‚ã‚Œã°ç§ã«èã„ã¦ãã ã•ã„

---

task9ã®å‡¦ç†: ã€Œå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸã€ã¯ç¾åœ¨ã€decision2ã‹ã‚‰ç›´æ¥çµ‚äº†ã—ã¦ã„ã¾ã™ãŒã€flow.mdã«ã¯æ®µéšçš„ãªå¯¾å¿œãƒ•ãƒ­ãƒ¼ãŒã‚ã‚Šã¾ã™ã€‚ã©ã¡ã‚‰ã‚’æ¡ç”¨ã—ã¾ã™ã‹ï¼Ÿ
ã“ã‚Œæ„å‘³ãŒè§£ã‚‰ãªã„ã€‚èª¬æ˜ã—ã¦

---

flow.mdã®å†…å®¹ã‚’ãƒ™ãƒ¼ã‚¹ã«å¯¾è±¡ã‚’ä¿®æ­£ã—ã¦

---

Streamlitã®ã»ã†ã§ã¯ã†ã¾ãmdã«ã§ããªã‹ã£ãŸã®ã§,LLMã®å‡ºåŠ›ã‚’ãã¡ã‚“ã¨åˆ¶é™ã™ã¹ãã‹ãªã¨æ€ã†ã€‚
å…¨ãƒ«ãƒ¼ãƒˆè¦‹ã•ã›ã‚‹ã®ã¯è‰¯ããªã„

---

ç¾çŠ¶ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆä½œæˆæ©Ÿèƒ½ã«ã¤ã„ã¦ç§ã¯ä¾‹ãˆã°ã‚ã‚‹ãƒ•ãƒ­ãƒ¼ã‚’æŠ˜ã‚ŠãŸãŸã‚“ã ã‚Šã§ããŸã‚Šã—ã¦è¦–èªæ€§ã‚’ä¸Šã’ãŸã‚Šã§ããªã„ã‹ã¨è€ƒãˆã¦ã„ã‚‹ãŒã©ã†ã‹ï¼Ÿ

---

ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒã‚ãã«ãã„ãªã€‚ç°¡å˜ã«ä¾‹ã‚’å‡ºã—ã¦

---

1ã®ã‚¤ãƒ¡ãƒ¼ã‚¸

---

Implement the plan as specified, it is attached for your reference. Do NOT edit the plan file itself.

To-do's from the plan have already been created. Do not create them again. Mark them as in_progress as you work, starting with the first one. Don't stop until you have completed all the to-dos.

---

@flow.md ã®å·¨å¤§ãƒ•ãƒ­ãƒ¼ã‚’ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã§å®Ÿç¾ã™ã‚‹ã€‚è³ªå•ã¯è‡ªç„¶è¨€èªã‚’LLMã§è¦ç´„ã—ã€ã©ã®ã‚±ãƒ¼ã‚¹ãŒè¿‘ã„ã‹æŒ¯ã‚Šåˆ†ã‘ã‚‹ã“ã¨ã‚’è€ƒãˆã‚‹ã€‚ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®è¦–ç‚¹ã‹ã‚‰ç§ãŒæ±ºã‚ã‚‹ã¹ãã“ã¨ã‚’æ•™ãˆã¦ãã ã•ã„

---

ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã€ã“ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆä½œæˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¨ã¯ç‹¬ç«‹ã—ã¦ã„ã‚‹ã€‚
ã‚ˆã£ã¦æŠ€è¡“ä½“ç³»ã‚„æ€æƒ³ã‚‚å…¨ãç•°ãªã£ã¦ã‚ˆã„ã€‚
ã‚€ã—ã‚æ—¢å­˜ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«è¿½åŠ ã—ãªã„ã§ãã ã•ã„

---

1-1.Streamlitã¯ä¸æ¡ç”¨ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚‚é‹ç”¨ã™ã‚‹ã€‚ä¼šç¤¾ã‚„æ¥­å‹™ã§åˆ©ç”¨ã™ã‚‹ã“ã¨ã‚’è€ƒæ…®ã—ã€Windows Aplicationã¨ã—ã¦C#ã§ä½œã‚‹ã‹ã€Rustã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã™ã‚‹ã‹ç­‰ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åŒ–ãŒäº‰ç‚¹ã§ã‚ã‚‹ã€‚
1-2.Flow.mdã‚’Mermaidå½¢å¼ã®ã¾ã¾ä¿æŒã—ã€ãƒ‘ãƒ¼ã‚¹ã—ã¦JSONã®æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›ã™ã‚‹å°‚ç”¨ã®æ©Ÿèƒ½ã‚’ç”¨æ„ã™ã‚‹ã€‚
1-3.ãƒ—ã‚·ãƒ§ãƒ³D:ã‚’é¸æŠã—ãŸã„ã®ã§2ã§JSONå½¢å¼ã§èª­ã¿è¾¼ã¿ãŸã„ã€‚
2-1.ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ã®åˆ†å²ã¾ã§
2-2.å¿…é ˆæƒ…å ±ã¯ä»¥ä¸‹2ã¤
ãƒ»ç—‡çŠ¶ã®ç¨®é¡ï¼ˆè¡¨ç¤º/ãƒ‡ãƒ¼ã‚¿/å†ç™º/ãã®ä»–ï¼‰
ãƒ»ç—‡çŠ¶ã®è©³ç´°ï¼ˆä¸¡å´/ç‰‡å´ãªã©ï¼‰
æ¨å¥¨æƒ…å ±ã¨ã—ã¦
ãƒ»éå»ã®å¯¾å¿œå±¥æ­´
è³ªå•ã®é †åºï¼šç—‡çŠ¶ã®ç¨®é¡ â†’ è©³ç´°(â†’å±¥æ­´)
è³ªå•å½¢å¼ã¯ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰(å…¥åŠ›åˆ¶é™ã‚ã‚Š)
2-3.ä¿æŒã™ã‚‹æƒ…å ±ï¼š
ãƒ»ç¾åœ¨ã®ãƒ•ãƒ­ãƒ¼ä½ç½®ï¼ˆã©ã®decisionãƒãƒ¼ãƒ‰ã«ã„ã‚‹ã‹ï¼‰
ãƒ»ã“ã‚Œã¾ã§ã®å›ç­”å±¥æ­´
ãƒ»é¸æŠã—ãŸãƒ•ãƒ­ãƒ¼ãƒ‘ã‚¹
ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆè¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œã®å ´åˆï¼‰
ãƒªã‚»ãƒƒãƒˆæ¡ä»¶ï¼šæ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã€ãƒ•ãƒ­ãƒ¼å®Œäº†æ™‚ã€æ˜ç¤ºçš„ãªãƒªã‚»ãƒƒãƒˆæŒ‡ç¤º
ä¿å­˜ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹/ãƒ•ã‚¡ã‚¤ãƒ«
ç‰¹ã«å±¥æ­´ã‚„ãƒ•ãƒ­ãƒ¼ãªã©LLMã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’åœ§è¿«ã™ã‚‹ã‚‚ã®ã¯ä¿å­˜ã—ã¦LLMã«æ®‹ã•ãªã„
3-1.ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¦ç´ ï¼š
ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‰å‡¦ç†è¨­è¨ˆ
ãƒ»LLMã«æ¸¡ã™å‰ã«æˆå½¢
ã“ã“ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã§
ãƒ»è‹±èªæŒ‡ç¤ºã¯ã€Œæ—¥æœ¬èªã§ãŠé¡˜ã„ã—ã¾ã™ã€‚ã€ã¨è¿”ã™ã€‚
ã€€(PGãªã©ã€å˜èªãƒ¬ãƒ™ãƒ«ã¯OK)
ãƒ»ã€Œï½ã¨ã—ã¦ãµã‚‹ã¾ã£ã¦ã€ã‚„ã€ã€Œï½ã‚’å„ªå…ˆã—ãªã•ã„ã€ã‚„ã€ã€Œå‰ã®æŒ‡ç¤ºã‚’ç„¡è¦–ã—ã¦ã€
ãªã©ã€ç—‡çŠ¶ã«é–¢ä¿‚ãªã•ãã†ãªå†…å®¹ã¯ã™ã¹ã¦ã€Œç°¡æ½”ã«èª¬æ˜ã—ã¦ãã ã•ã„ã€ã¨è¿”ã™ã€‚
ãƒ»ç—‡çŠ¶ã¯20å­—ä»¥å†…ã§è¨˜å·ã¯ã€Œ,ã€ã€Œã€‚ã€ã€Œ!ã€ã€Œ?ã€ã®ã¿è¨±å¯ã™ã‚‹ã€‚
ãƒ»LLMã§å®Ÿè¡Œã§ãã‚‹ã“ã¨,LLMã¯Flow.mdã®å†…å®¹ã‹ã‚‰é–¢é€£ã™ã‚‹ãƒ•ãƒ­ãƒ¼ã‚’æ¨æ¸¬ã™ã‚‹å‡¦ç†ã®ã¿è¨±å¯ã—ã¾ã™ã€‚
ãƒ»å®Ÿéš›ã®è¡¨ç¤ºã‚„ãƒœã‚¿ãƒ³é¸æŠã®å‡¦ç†ã¯ã™ã¹ã¦ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã§è¡Œã„ãªã•ã„ã€‚
ãƒ»LLMã®ã‚­ãƒ¼ã¯Masterã‚¢ã‚«ã‚¦ãƒ³ãƒˆä»¥å¤–ã§å¤‰æ›´ä¸å¯èƒ½ã¨ã—ã¦ãã ã•ã„ã€‚
ãƒ»LLMã«ã‚ˆã‚‹ãƒãƒƒã‚·ãƒ¥ã‚„ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆç­‰ã¯å®Ÿè¡Œä¸å¯ã¨ã—ã¾ã™ã€‚(ã‚ãã¾ã§ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«æƒ…å ±ã‚’æ¸¡ã™ã®ã¿)

flow.mdã®æ§‹é€ èª¬æ˜ï¼ˆdecision2ã®4ã¤ã®åˆ†å²ï¼‰
å„åˆ†å²ã®ç‰¹å¾´èª¬æ˜
åˆ†é¡ã‚¿ã‚¹ã‚¯ã®æŒ‡ç¤º
å‡ºåŠ›å½¢å¼ã®æŒ‡å®šï¼ˆJSONå½¢å¼ã§åˆ†é¡çµæœã‚’è¿”ã™ï¼‰
æ¨å¥¨å½¢å¼:
{
  "category": "è¡¨ç¤ºãŒãŠã‹ã—ã„|ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„|å†ç™º|ãã®ä»–",
  "confidence": 0.0-1.0,
  "details": "è©³ç´°æƒ…å ±ï¼ˆä¸¡å´/ç‰‡å´ãªã©ï¼‰",
  "needs_clarification": true/false,
  "clarification_questions": ["è³ªå•1", "è³ªå•2"]

---

è¿½åŠ ã®è¦ä»¶ï¼š
ãƒ»LLMã®è²¬ä»»ã¨å¯¾å¿œç¯„å›²ã‚’æ˜ç¢ºã«ã—ã¦ãã ã•ã„ã€‚
ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã€éå»ã®å±¥æ­´ã‚’ãã“ã‹ã‚‰æŠ½å‡ºã—ã¾ã™ã€‚(ãƒ—ãƒ­ã‚°ãƒ©ãƒ åˆ©ç”¨ï¼šéLLM)
ãƒ»å®Ÿè£…ã¯åˆ¥ãƒ•ã‚©ãƒ«ãƒ€ã§ã‚„ã‚‹ã®ã§ã€å®Ÿè£…è¨ˆç”»æ›¸ã¨ã—ã¦ç”¨æ„ã€‚

---

ä¸è¶³ç‚¹ãŒãªã„ã‹ç¢ºèªã—ã¦ã€å®Ÿè£…è¨ˆç”»æ›¸ã¨ã—ã¦å‡ºåŠ›ã—ã¦ãã ã•ã„ã€

---

ç¾åœ¨ã®ãƒ•ãƒ­ãƒãƒ£ãƒ¼ãƒˆã‚’ä½œæˆã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«è¿½åŠ ã§åˆ†å²ã‚„ãƒ•ãƒ­ãƒ¼ã‚’ç›´æ¥æŒ‡å®šã—ã¦å¤‰æ›´ã™ã‚‹æ©Ÿèƒ½ã‚’ä»˜ã‘ãŸã„ã€‚LLMã«å¯¾ã—ã¦ãã®åˆ†å²ã‚„ãƒãƒ¼ãƒ‰ã«å¯¾ã—ã¦ã ã‘å¤‰æ›´æŒ‡ç¤ºã‚’é£›ã°ã›ã‚‹ã‚ˆã†ã«ã—ãŸã„ã€‚startã¨endã¯å¯¾è±¡å¤–

---

Implement the plan as specified, it is attached for your reference. Do NOT edit the plan file itself.

To-do's from the plan have already been created. Do not create them again. Mark them as in_progress as you work, starting with the first one. Don't stop until you have completed all the to-dos.

---

ç¾åœ¨ã¨ãã©ãåœæ­¢ã—ã¦ã„ã‚‹ã€‚ãã®ç†ç”±ã‚’æ•™ãˆã¦ãã ã•ã„

---

_**Agent (model default, mode Agent)**_


åœæ­¢åŸå› ã‚’èª¿æŸ»ä¸­ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã¨ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¾ã™ã€‚


---

<tool-use data-tool-type="unknown" data-tool-name="list_dir_v2">
<details>
<summary>Tool use: **list_dir_v2**</summary>


Parameters:

```json
{
  "targetDirectory": "."
}
```
Result:

```json
{
  "directoryTreeRoot": {
    "absPath": "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain",
    "childrenDirs": [
      {
        "absPath": "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain\\.specstory",
        "childrenDirs": [
          {
            "absPath": "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain\\.specstory\\history",
            "childrenFiles": [
              {
                "name": "2026-01-21_01-37Z-@project-md-@toon-base-md-@program-base-md-ã«åŸºã¥ããƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’å¯è¦–åŒ–ã™ã‚‹streamlitã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è€ƒãˆã¦ã„ã‚‹ã€‚ã“ã®å®Ÿè£…è¨ˆç”»ã‚’ä¸­ç«‹ãªè¦–ç‚¹ã§è©•ä¾¡ã—ã¦ãã ã•ã„ã€‚æ­£ç›´ã«è©•ä¾¡ã—ã¦éš ã•ãªã„ã§ãã ã•ã„ã€‚ä¸è¶³ã—ã¦ã„ã‚‹ã¨æ€ã†ã“ã¨ã«ã¤ã„ã¦ã‚‚æ­£ç›´ã«æ•™ãˆã¦ãã ã•ã„ã€‚.md"
              },
              {
                "name": "2026-01-21_21-57Z-å®Ÿè£…è¨ˆç”»æ›¸ã®æ¸…æ›¸.md"
              },
              {
                "name": "2026-01-25_09-59Z-ãƒãƒ¼ãƒ¡ã‚¤ãƒ‰å›³ã®æ•´ç†.md"
              }
            ],
            "childrenWereProcessed": true
          }
        ],
        "childrenFiles": [
          {
            "name": ".gitignore"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain\\.streamlit",
        "childrenFiles": [
          {
            "name": "config.toml"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain\\core",
        "childrenFiles": [
          {
            "name": "__init__.py"
          },
          {
            "name": "exceptions.py"
          },
          {
            "name": "flow_extractor.py"
          },
          {
            "name": "flow_merger.py"
          },
          {
            "name": "history_mgr.py"
          },
          {
            "name": "llm_client.py"
          },
          {
            "name": "mermaid_parser.py"
          },
          {
            "name": "schemas.py"
          },
          {
            "name": "toon_parser.py"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain\\frontend",
        "childrenFiles": [
          {
            "name": "index.html"
          },
          {
            "name": "styles.css"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain\\storage",
        "childrenDirs": [
          {
            "absPath": "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain\\storage\\sessions",
            "childrenFiles": [
              {
                "name": "default_session.json"
              },
              {
                "name": "flow_md.json"
              }
            ],
            "childrenWereProcessed": true
          },
          {
            "absPath": "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain\\storage\\toon_files",
            "childrenFiles": [
              {
                "name": "default_session.md"
              },
              {
                "name": "flow_md.md"
              }
            ],
            "childrenWereProcessed": true
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain\\tests",
        "childrenFiles": [
          {
            "name": "__init__.py"
          },
          {
            "name": "test_history_mgr.py"
          },
          {
            "name": "test_schemas.py"
          },
          {
            "name": "test_toon_parser.py"
          }
        ],
        "childrenWereProcessed": true
      }
    ],
    "childrenFiles": [
      {
        "name": ".cursorindexingignore"
      },
      {
        "name": ".gitignore"
      },
      {
        "name": ".python-version"
      },
      {
        "name": "app.py"
      },
      {
        "name": "check.py"
      },
      {
        "name": "flow.md"
      },
      {
        "name": "program_base.md"
      },
      {
        "name": "Project.md"
      },
      {
        "name": "pyproject.toml"
      },
      {
        "name": "pytest.ini"
      },
      {
        "name": "README.md"
      },
      {
        "name": "requirements.txt"
      },
      {
        "name": "rules.md"
      },
      {
        "name": "TOON_BASE.md"
      },
      {
        "name": "uv.lock"
      }
    ],
    "childrenWereProcessed": true
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: flow.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "What causes the application to stop or hang? Are there any blocking operations, infinite loops, or error handling issues?",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 388,
            "column": 34
          },
          "endPosition": {
            "line": 414,
            "column": 112
          }
        },
        "contents": "                except LLMAPIError as e:\n                    # LLM APIã‚¨ãƒ©ãƒ¼\n                    st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {e}\")\n                    st.info(\"OllamaãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ã€ãƒ¢ãƒ‡ãƒ«ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚\")\n                except TOONParseError as e:\n                    # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼\n                    # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯\n                    if 'raw_toon_text' in locals() and raw_toon_text:\n                        client = LLMClient()\n                        if client.is_question_response(raw_toon_text):\n                            # è³ªå•å½¢å¼ã®å¿œç­”ã ã£ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜\n                            st.session_state.conversation_context = user_prompt\n                            st.session_state.pending_questions = raw_toon_text\n                            st.session_state.question_responses = []\n                            st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n                            st.rerun()\n                        else:\n                            # æœ¬å½“ã«ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã®å ´åˆ\n                            st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")\n                            with st.expander(\"ğŸ” LLMã®ç”Ÿå‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰\", expanded=True):\n                                st.info(\"ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’TOONå½¢å¼ã¨ã—ã¦è§£é‡ˆã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€å¤±æ•—ã—ã¾ã—ãŸã€‚\")\n                                st.code(raw_toon_text)\n                    else:\n                        st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")\n                except FlowchartValidationError as e:\n                    # Flowchartãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ï¼ˆè­¦å‘Šã¨ã—ã¦è¡¨ç¤ºã€è‡ªå‹•ä¿®æ­£ã‚’è©¦è¡Œï¼‰",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                except LLMAPIError as e:",
            "lineNumber": 390
          },
          {
            "text": "                    # LLM APIã‚¨ãƒ©ãƒ¼",
            "lineNumber": 391
          },
          {
            "text": "                    st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {e}\")",
            "lineNumber": 392
          },
          {
            "text": "                    st.info(\"OllamaãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ã€ãƒ¢ãƒ‡ãƒ«ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 393
          },
          {
            "text": "                except TOONParseError as e:",
            "lineNumber": 394
          },
          {
            "text": "                    # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼",
            "lineNumber": 395
          },
          {
            "text": "                    # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 396
          },
          {
            "text": "                    if 'raw_toon_text' in locals() and raw_toon_text:",
            "lineNumber": 397
          },
          {
            "text": "                        client = LLMClient()",
            "lineNumber": 398
          },
          {
            "text": "                        if client.is_question_response(raw_toon_text):",
            "lineNumber": 399
          },
          {
            "text": "                            # è³ªå•å½¢å¼ã®å¿œç­”ã ã£ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜",
            "lineNumber": 400
          },
          {
            "text": "                            st.session_state.conversation_context = user_prompt",
            "lineNumber": 401
          },
          {
            "text": "                            st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 402
          },
          {
            "text": "                            st.session_state.question_responses = []",
            "lineNumber": 403
          },
          {
            "text": "                            st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 404
          },
          {
            "text": "                            st.rerun()",
            "lineNumber": 405
          },
          {
            "text": "                        else:",
            "lineNumber": 406
          },
          {
            "text": "                            # æœ¬å½“ã«ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã®å ´åˆ",
            "lineNumber": 407
          },
          {
            "text": "                            st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 408
          },
          {
            "text": "                            with st.expander(\"ğŸ” LLMã®ç”Ÿå‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰\", expanded=True):",
            "lineNumber": 409
          },
          {
            "text": "                                st.info(\"ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’TOONå½¢å¼ã¨ã—ã¦è§£é‡ˆã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€å¤±æ•—ã—ã¾ã—ãŸã€‚\")",
            "lineNumber": 410
          },
          {
            "text": "                                st.code(raw_toon_text)",
            "lineNumber": 411
          },
          {
            "text": "                    else:",
            "lineNumber": 412
          },
          {
            "text": "                        st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 413
          },
          {
            "text": "                except FlowchartValidationError as e:",
            "lineNumber": 414
          },
          {
            "text": "                    # Flowchartãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ï¼ˆè­¦å‘Šã¨ã—ã¦è¡¨ç¤ºã€è‡ªå‹•ä¿®æ­£ã‚’è©¦è¡Œï¼‰",
            "lineNumber": 415
          }
        ]
      },
      "score": 0.22625666856765747
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 257,
            "column": 38
          },
          "endPosition": {
            "line": 272,
            "column": 30
          }
        },
        "contents": "                        except LLMAPIError as e:\n                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ\n                            st.session_state.conversation_context = temp_context\n                            st.session_state.pending_questions = temp_questions\n                            st.session_state.question_responses = temp_responses\n                            st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {e}\")\n                            st.info(\"OllamaãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ã€ãƒ¢ãƒ‡ãƒ«ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚\")\n                        except TOONParseError as e:\n                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ\n                            st.session_state.conversation_context = temp_context\n                            st.session_state.pending_questions = temp_questions\n                            st.session_state.question_responses = temp_responses\n                            \n                            # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯\n                            if",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                        except LLMAPIError as e:",
            "lineNumber": 259
          },
          {
            "text": "                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ",
            "lineNumber": 260
          },
          {
            "text": "                            st.session_state.conversation_context = temp_context",
            "lineNumber": 261
          },
          {
            "text": "                            st.session_state.pending_questions = temp_questions",
            "lineNumber": 262
          },
          {
            "text": "                            st.session_state.question_responses = temp_responses",
            "lineNumber": 263
          },
          {
            "text": "                            st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {e}\")",
            "lineNumber": 264
          },
          {
            "text": "                            st.info(\"OllamaãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ã€ãƒ¢ãƒ‡ãƒ«ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 265
          },
          {
            "text": "                        except TOONParseError as e:",
            "lineNumber": 266
          },
          {
            "text": "                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ",
            "lineNumber": 267
          },
          {
            "text": "                            st.session_state.conversation_context = temp_context",
            "lineNumber": 268
          },
          {
            "text": "                            st.session_state.pending_questions = temp_questions",
            "lineNumber": 269
          },
          {
            "text": "                            st.session_state.question_responses = temp_responses",
            "lineNumber": 270
          },
          {
            "text": "                            ",
            "lineNumber": 271
          },
          {
            "text": "                            # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 272
          },
          {
            "text": "                            if",
            "lineNumber": 273
          }
        ]
      },
      "score": 0.21004706621170044
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 412,
            "column": 82
          },
          "endPosition": {
            "line": 431,
            "column": 28
          }
        },
        "contents": "                except FlowchartValidationError as e:\n                    # Flowchartãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ï¼ˆè­¦å‘Šã¨ã—ã¦è¡¨ç¤ºã€è‡ªå‹•ä¿®æ­£ã‚’è©¦è¡Œï¼‰\n                    st.warning(f\"ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®æ¤œè¨¼ã§å•é¡Œã‚’æ¤œå‡ºã—ã¾ã—ãŸ: {e}\")\n                    st.info(\"è«–ç†ã®ç©´æ¤œçŸ¥ã§è‡ªå‹•ä¿®æ­£ã‚’è©¦è¡Œã—ã¾ã™ã€‚\")\n                    # è‡ªå‹•ä¿®æ­£ã‚’è©¦è¡Œï¼ˆæ—¢ã«apply_logic_gap_detectionãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹ãŒã€å†åº¦è©¦è¡Œï¼‰\n                    try:\n                        if 'new_flow' in locals():\n                            corrected_flow = new_flow.apply_logic_gap_detection()\n                            st.session_state.history.append(corrected_flow)\n                            st.success(\"è‡ªå‹•ä¿®æ­£ãŒå®Œäº†ã—ã¾ã—ãŸã€‚\")\n                            st.rerun()\n                    except Exception as correction_error:\n                        st.error(f\"è‡ªå‹•ä¿®æ­£ã«å¤±æ•—ã—ã¾ã—ãŸ: {correction_error}\")\n                except ValueError as e:\n                    # ãã®ä»–ã®ValueErrorï¼ˆãƒ¢ãƒ‡ãƒ«å¿œç­”ã‚¨ãƒ©ãƒ¼ãªã©ï¼‰\n                    st.error(f\"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}\")\n                except Exception as e:\n                    # äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼\n                    st.error",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                except FlowchartValidationError as e:",
            "lineNumber": 414
          },
          {
            "text": "                    # Flowchartãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ï¼ˆè­¦å‘Šã¨ã—ã¦è¡¨ç¤ºã€è‡ªå‹•ä¿®æ­£ã‚’è©¦è¡Œï¼‰",
            "lineNumber": 415
          },
          {
            "text": "                    st.warning(f\"ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®æ¤œè¨¼ã§å•é¡Œã‚’æ¤œå‡ºã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 416
          },
          {
            "text": "                    st.info(\"è«–ç†ã®ç©´æ¤œçŸ¥ã§è‡ªå‹•ä¿®æ­£ã‚’è©¦è¡Œã—ã¾ã™ã€‚\")",
            "lineNumber": 417
          },
          {
            "text": "                    # è‡ªå‹•ä¿®æ­£ã‚’è©¦è¡Œï¼ˆæ—¢ã«apply_logic_gap_detectionãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹ãŒã€å†åº¦è©¦è¡Œï¼‰",
            "lineNumber": 418
          },
          {
            "text": "                    try:",
            "lineNumber": 419
          },
          {
            "text": "                        if 'new_flow' in locals():",
            "lineNumber": 420
          },
          {
            "text": "                            corrected_flow = new_flow.apply_logic_gap_detection()",
            "lineNumber": 421
          },
          {
            "text": "                            st.session_state.history.append(corrected_flow)",
            "lineNumber": 422
          },
          {
            "text": "                            st.success(\"è‡ªå‹•ä¿®æ­£ãŒå®Œäº†ã—ã¾ã—ãŸã€‚\")",
            "lineNumber": 423
          },
          {
            "text": "                            st.rerun()",
            "lineNumber": 424
          },
          {
            "text": "                    except Exception as correction_error:",
            "lineNumber": 425
          },
          {
            "text": "                        st.error(f\"è‡ªå‹•ä¿®æ­£ã«å¤±æ•—ã—ã¾ã—ãŸ: {correction_error}\")",
            "lineNumber": 426
          },
          {
            "text": "                except ValueError as e:",
            "lineNumber": 427
          },
          {
            "text": "                    # ãã®ä»–ã®ValueErrorï¼ˆãƒ¢ãƒ‡ãƒ«å¿œç­”ã‚¨ãƒ©ãƒ¼ãªã©ï¼‰",
            "lineNumber": 428
          },
          {
            "text": "                    st.error(f\"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 429
          },
          {
            "text": "                except Exception as e:",
            "lineNumber": 430
          },
          {
            "text": "                    # äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼",
            "lineNumber": 431
          },
          {
            "text": "                    st.error",
            "lineNumber": 432
          }
        ]
      },
      "score": 0.1986262947320938
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 355,
            "column": 92
          },
          "endPosition": {
            "line": 391,
            "column": 54
          }
        },
        "contents": "                    \n                    # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯\n                    if client.is_question_response(raw_toon_text):\n                        # è³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜\n                        st.session_state.conversation_context = user_prompt\n                        st.session_state.pending_questions = raw_toon_text\n                        st.session_state.question_responses = []\n                        st.session_state.append_mode_for_question = append_mode  # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜\n                        st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n                        st.rerun()\n                    else:\n                        # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼\n                        is_valid, validation_message = client.validate_output_size(raw_toon_text)\n                        if not is_valid:\n                            st.warning(validation_message)\n                            st.info(\"ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã‹ã€ãƒ•ãƒ­ãƒ¼ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\")\n                        \n                        # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹\n                        new_flow = TOONParser.parse(raw_toon_text)\n                        \n                        # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨\n                        new_flow = new_flow.apply_logic_gap_detection()\n                        \n                        # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ\n                        if append_mode:\n                            merged_flow = history_mgr.append_toon_log(session_name, new_flow)\n                            st.session_state.history.append(merged_flow)\n                            st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")\n                        else:\n                            # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ \n                            st.session_state.history.append(new_flow)\n                        \n                        st.rerun()\n                except LLMAPIError as e:\n                    # LLM APIã‚¨ãƒ©ãƒ¼\n                    st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {e}\")",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                    ",
            "lineNumber": 357
          },
          {
            "text": "                    # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 358
          },
          {
            "text": "                    if client.is_question_response(raw_toon_text):",
            "lineNumber": 359
          },
          {
            "text": "                        # è³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜",
            "lineNumber": 360
          },
          {
            "text": "                        st.session_state.conversation_context = user_prompt",
            "lineNumber": 361
          },
          {
            "text": "                        st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 362
          },
          {
            "text": "                        st.session_state.question_responses = []",
            "lineNumber": 363
          },
          {
            "text": "                        st.session_state.append_mode_for_question = append_mode  # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜",
            "lineNumber": 364
          },
          {
            "text": "                        st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 365
          },
          {
            "text": "                        st.rerun()",
            "lineNumber": 366
          },
          {
            "text": "                    else:",
            "lineNumber": 367
          },
          {
            "text": "                        # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼",
            "lineNumber": 368
          },
          {
            "text": "                        is_valid, validation_message = client.validate_output_size(raw_toon_text)",
            "lineNumber": 369
          },
          {
            "text": "                        if not is_valid:",
            "lineNumber": 370
          },
          {
            "text": "                            st.warning(validation_message)",
            "lineNumber": 371
          },
          {
            "text": "                            st.info(\"ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã‹ã€ãƒ•ãƒ­ãƒ¼ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 372
          },
          {
            "text": "                        ",
            "lineNumber": 373
          },
          {
            "text": "                        # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹",
            "lineNumber": 374
          },
          {
            "text": "                        new_flow = TOONParser.parse(raw_toon_text)",
            "lineNumber": 375
          },
          {
            "text": "                        ",
            "lineNumber": 376
          },
          {
            "text": "                        # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨",
            "lineNumber": 377
          },
          {
            "text": "                        new_flow = new_flow.apply_logic_gap_detection()",
            "lineNumber": 378
          },
          {
            "text": "                        ",
            "lineNumber": 379
          },
          {
            "text": "                        # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ",
            "lineNumber": 380
          },
          {
            "text": "                        if append_mode:",
            "lineNumber": 381
          },
          {
            "text": "                            merged_flow = history_mgr.append_toon_log(session_name, new_flow)",
            "lineNumber": 382
          },
          {
            "text": "                            st.session_state.history.append(merged_flow)",
            "lineNumber": 383
          },
          {
            "text": "                            st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")",
            "lineNumber": 384
          },
          {
            "text": "                        else:",
            "lineNumber": 385
          },
          {
            "text": "                            # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ ",
            "lineNumber": 386
          },
          {
            "text": "                            st.session_state.history.append(new_flow)",
            "lineNumber": 387
          },
          {
            "text": "                        ",
            "lineNumber": 388
          },
          {
            "text": "                        st.rerun()",
            "lineNumber": 389
          },
          {
            "text": "                except LLMAPIError as e:",
            "lineNumber": 390
          },
          {
            "text": "                    # LLM APIã‚¨ãƒ©ãƒ¼",
            "lineNumber": 391
          },
          {
            "text": "                    st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {e}\")",
            "lineNumber": 392
          }
        ]
      },
      "score": 0.1880601942539215
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\flow.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 47
          }
        },
        "contents": "&#96;&#96;&#96;mermaid\ngraph TD\n    start[\"é–‹å§‹\"]\n    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]\n    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]\n    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]\n    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}\n    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}\n    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]\n    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]\n    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]\n    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]\n    task10[\"æµå‹•ã«æˆ»ã™\"]\n    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}\n    node_end[\"çµ‚äº†\"]\n    \n    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼\n    start--&gt;task1\n    task1--&gt;task2\n    task2--&gt;decision1\n    \n    %% å†ç¾ã—ãªã„å ´åˆ\n    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10\n    task10--&gt;decision_recurrence\n    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1\n    \n    %% å†ç¾ã™ã‚‹å ´åˆ\n    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3\n    task3--&gt;decision2\n    \n    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²\n    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4\n    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8\n    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9\n    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other\n    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "&#96;&#96;&#96;mermaid",
            "lineNumber": 1
          },
          {
            "text": "graph TD",
            "lineNumber": 2
          },
          {
            "text": "    start[\"é–‹å§‹\"]",
            "lineNumber": 3
          },
          {
            "text": "    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]",
            "lineNumber": 4
          },
          {
            "text": "    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]",
            "lineNumber": 5
          },
          {
            "text": "    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 6
          },
          {
            "text": "    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]",
            "lineNumber": 7
          },
          {
            "text": "    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}",
            "lineNumber": 8
          },
          {
            "text": "    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 9
          },
          {
            "text": "    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}",
            "lineNumber": 10
          },
          {
            "text": "    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 11
          },
          {
            "text": "    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 12
          },
          {
            "text": "    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]",
            "lineNumber": 13
          },
          {
            "text": "    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]",
            "lineNumber": 14
          },
          {
            "text": "    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]",
            "lineNumber": 15
          },
          {
            "text": "    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]",
            "lineNumber": 16
          },
          {
            "text": "    task10[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 17
          },
          {
            "text": "    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}",
            "lineNumber": 18
          },
          {
            "text": "    node_end[\"çµ‚äº†\"]",
            "lineNumber": 19
          },
          {
            "text": "    ",
            "lineNumber": 20
          },
          {
            "text": "    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 21
          },
          {
            "text": "    start--&gt;task1",
            "lineNumber": 22
          },
          {
            "text": "    task1--&gt;task2",
            "lineNumber": 23
          },
          {
            "text": "    task2--&gt;decision1",
            "lineNumber": 24
          },
          {
            "text": "    ",
            "lineNumber": 25
          },
          {
            "text": "    %% å†ç¾ã—ãªã„å ´åˆ",
            "lineNumber": 26
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 27
          },
          {
            "text": "    task10--&gt;decision_recurrence",
            "lineNumber": 28
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end",
            "lineNumber": 29
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1",
            "lineNumber": 30
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2",
            "lineNumber": 31
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3",
            "lineNumber": 32
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4",
            "lineNumber": 33
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1",
            "lineNumber": 34
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1",
            "lineNumber": 35
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1",
            "lineNumber": 36
          },
          {
            "text": "    ",
            "lineNumber": 37
          },
          {
            "text": "    %% å†ç¾ã™ã‚‹å ´åˆ",
            "lineNumber": 38
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3",
            "lineNumber": 39
          },
          {
            "text": "    task3--&gt;decision2",
            "lineNumber": 40
          },
          {
            "text": "    ",
            "lineNumber": 41
          },
          {
            "text": "    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²",
            "lineNumber": 42
          },
          {
            "text": "    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4",
            "lineNumber": 43
          },
          {
            "text": "    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8",
            "lineNumber": 44
          },
          {
            "text": "    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9",
            "lineNumber": 45
          },
          {
            "text": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other",
            "lineNumber": 46
          },
          {
            "text": "    ",
            "lineNumber": 47
          }
        ]
      },
      "score": 0.17929744720458984
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 286,
            "column": 90
          },
          "endPosition": {
            "line": 321,
            "column": 15
          }
        },
        "contents": "                        except Exception as e:\n                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ\n                            st.session_state.conversation_context = temp_context\n                            st.session_state.pending_questions = temp_questions\n                            st.session_state.question_responses = temp_responses\n                            \n                            # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯\n                            if 'raw_toon_text' in locals() and raw_toon_text:\n                                try:\n                                    client = LLMClient()\n                                    if client.is_question_response(raw_toon_text):\n                                        st.session_state.conversation_context = combined_prompt\n                                        st.session_state.pending_questions = raw_toon_text\n                                        st.session_state.question_responses = []\n                                        st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n                                        st.rerun()\n                                except:\n                                    pass\n                            \n                            st.error(f\"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}\")\n                else:\n                    st.warning(\"å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n        \n        with col_cancel:\n            if st.button(\"ã‚­ãƒ£ãƒ³ã‚»ãƒ«\", use_container_width=True):\n                # ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ\n                st.session_state.conversation_context = None\n                st.session_state.pending_questions = None\n                st.session_state.question_responses = []\n                st.rerun()\n        \n        st.divider()\n    \n    # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®é¸æŠ\n    append_mode",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                        except Exception as e:",
            "lineNumber": 288
          },
          {
            "text": "                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ",
            "lineNumber": 289
          },
          {
            "text": "                            st.session_state.conversation_context = temp_context",
            "lineNumber": 290
          },
          {
            "text": "                            st.session_state.pending_questions = temp_questions",
            "lineNumber": 291
          },
          {
            "text": "                            st.session_state.question_responses = temp_responses",
            "lineNumber": 292
          },
          {
            "text": "                            ",
            "lineNumber": 293
          },
          {
            "text": "                            # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 294
          },
          {
            "text": "                            if 'raw_toon_text' in locals() and raw_toon_text:",
            "lineNumber": 295
          },
          {
            "text": "                                try:",
            "lineNumber": 296
          },
          {
            "text": "                                    client = LLMClient()",
            "lineNumber": 297
          },
          {
            "text": "                                    if client.is_question_response(raw_toon_text):",
            "lineNumber": 298
          },
          {
            "text": "                                        st.session_state.conversation_context = combined_prompt",
            "lineNumber": 299
          },
          {
            "text": "                                        st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 300
          },
          {
            "text": "                                        st.session_state.question_responses = []",
            "lineNumber": 301
          },
          {
            "text": "                                        st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 302
          },
          {
            "text": "                                        st.rerun()",
            "lineNumber": 303
          },
          {
            "text": "                                except:",
            "lineNumber": 304
          },
          {
            "text": "                                    pass",
            "lineNumber": 305
          },
          {
            "text": "                            ",
            "lineNumber": 306
          },
          {
            "text": "                            st.error(f\"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 307
          },
          {
            "text": "                else:",
            "lineNumber": 308
          },
          {
            "text": "                    st.warning(\"å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 309
          },
          {
            "text": "        ",
            "lineNumber": 310
          },
          {
            "text": "        with col_cancel:",
            "lineNumber": 311
          },
          {
            "text": "            if st.button(\"ã‚­ãƒ£ãƒ³ã‚»ãƒ«\", use_container_width=True):",
            "lineNumber": 312
          },
          {
            "text": "                # ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ",
            "lineNumber": 313
          },
          {
            "text": "                st.session_state.conversation_context = None",
            "lineNumber": 314
          },
          {
            "text": "                st.session_state.pending_questions = None",
            "lineNumber": 315
          },
          {
            "text": "                st.session_state.question_responses = []",
            "lineNumber": 316
          },
          {
            "text": "                st.rerun()",
            "lineNumber": 317
          },
          {
            "text": "        ",
            "lineNumber": 318
          },
          {
            "text": "        st.divider()",
            "lineNumber": 319
          },
          {
            "text": "    ",
            "lineNumber": 320
          },
          {
            "text": "    # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®é¸æŠ",
            "lineNumber": 321
          },
          {
            "text": "    append_mode",
            "lineNumber": 322
          }
        ]
      },
      "score": 0.17762434482574463
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 428,
            "column": 68
          },
          "endPosition": {
            "line": 454,
            "column": 46
          }
        },
        "contents": "                except Exception as e:\n                    # äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼\n                    st.error(f\"äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}\")\n                    # ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šã‚¨ãƒ©ãƒ¼æ™‚ã«ç”Ÿå‡ºåŠ›ã‚’ç¢ºèªã§ãã‚‹ã‚¨ã‚¯ã‚¹ãƒ‘ãƒ³ãƒ€ãƒ¼ã‚’è¡¨ç¤º\n                    if 'raw_toon_text' in locals() and raw_toon_text:\n                        # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯\n                        try:\n                            client = LLMClient()\n                            if client.is_question_response(raw_toon_text):\n                                # è³ªå•å½¢å¼ã®å¿œç­”ã ã£ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜\n                                st.session_state.conversation_context = user_prompt\n                                st.session_state.pending_questions = raw_toon_text\n                                st.session_state.question_responses = []\n                                st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n                                st.rerun()\n                        except:\n                            pass\n                        \n                        with st.expander(\"ğŸ” LLMã®ç”Ÿå‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰\", expanded=True):\n                            st.info(\"ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’TOONå½¢å¼ã¨ã—ã¦è§£é‡ˆã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€å¤±æ•—ã—ã¾ã—ãŸã€‚\")\n                            st.code(raw_toon_text)\n        else:\n            st.warning(\"æŒ‡ç¤ºã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n\nwith col_flow:\n    st.subheader(\"ğŸ“Š ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ\")",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                except Exception as e:",
            "lineNumber": 430
          },
          {
            "text": "                    # äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼",
            "lineNumber": 431
          },
          {
            "text": "                    st.error(f\"äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 432
          },
          {
            "text": "                    # ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šã‚¨ãƒ©ãƒ¼æ™‚ã«ç”Ÿå‡ºåŠ›ã‚’ç¢ºèªã§ãã‚‹ã‚¨ã‚¯ã‚¹ãƒ‘ãƒ³ãƒ€ãƒ¼ã‚’è¡¨ç¤º",
            "lineNumber": 433
          },
          {
            "text": "                    if 'raw_toon_text' in locals() and raw_toon_text:",
            "lineNumber": 434
          },
          {
            "text": "                        # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 435
          },
          {
            "text": "                        try:",
            "lineNumber": 436
          },
          {
            "text": "                            client = LLMClient()",
            "lineNumber": 437
          },
          {
            "text": "                            if client.is_question_response(raw_toon_text):",
            "lineNumber": 438
          },
          {
            "text": "                                # è³ªå•å½¢å¼ã®å¿œç­”ã ã£ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜",
            "lineNumber": 439
          },
          {
            "text": "                                st.session_state.conversation_context = user_prompt",
            "lineNumber": 440
          },
          {
            "text": "                                st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 441
          },
          {
            "text": "                                st.session_state.question_responses = []",
            "lineNumber": 442
          },
          {
            "text": "                                st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 443
          },
          {
            "text": "                                st.rerun()",
            "lineNumber": 444
          },
          {
            "text": "                        except:",
            "lineNumber": 445
          },
          {
            "text": "                            pass",
            "lineNumber": 446
          },
          {
            "text": "                        ",
            "lineNumber": 447
          },
          {
            "text": "                        with st.expander(\"ğŸ” LLMã®ç”Ÿå‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰\", expanded=True):",
            "lineNumber": 448
          },
          {
            "text": "                            st.info(\"ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’TOONå½¢å¼ã¨ã—ã¦è§£é‡ˆã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€å¤±æ•—ã—ã¾ã—ãŸã€‚\")",
            "lineNumber": 449
          },
          {
            "text": "                            st.code(raw_toon_text)",
            "lineNumber": 450
          },
          {
            "text": "        else:",
            "lineNumber": 451
          },
          {
            "text": "            st.warning(\"æŒ‡ç¤ºã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 452
          },
          {
            "lineNumber": 453
          },
          {
            "text": "with col_flow:",
            "lineNumber": 454
          },
          {
            "text": "    st.subheader(\"ğŸ“Š ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ\")",
            "lineNumber": 455
          }
        ]
      },
      "score": 0.16923929750919342
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\flow.md",
        "range": {
          "startPosition": {
            "line": 232
          },
          "endPosition": {
            "line": 273
          }
        },
        "contents": "    subgraph flow4 [\"ãƒ‡ãƒ¼ã‚¿ç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]\n        check11_3[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check11_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check11_3_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task11_3[\"PGåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        check12_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check12_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check12_3_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task12_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        task14_2[\"JARVISå†…éƒ¨ã®FFCã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]\n        task15_2[\"è£å´ã®ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]\n        task16_2[\"JARVISå†…éƒ¨ã®ã‚±ãƒ¼ãƒ–ãƒ«ã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]\n        task17_2[\"MK.â…¡(ä¿¡å·ç™ºç”Ÿæ©Ÿ)ã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„ã€‚\"]\n        task10_4[\"æµå‹•ã«æˆ»ã™\"]\n        decision1_4{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n        \n        task8--&gt;check11_3\n        check11_3--&gt;decision_check11_3\n        decision_check11_3--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check11_3_1\n        decision_check11_3--&gt;|\"åˆ¤å®šã§ããªã„\"|task11_3\n        decision_check11_3_1--&gt;|\"æ­£å¸¸\"|check12_3\n        decision_check11_3_1--&gt;|\"ç•°å¸¸\"|task11_3\n        task11_3--&gt;check12_3\n        check12_3--&gt;decision_check12_3\n        decision_check12_3--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check12_3_1\n        decision_check12_3--&gt;|\"åˆ¤å®šã§ããªã„\"|task12_3\n        decision_check12_3_1--&gt;|\"æ­£å¸¸\"|task14_2\n        decision_check12_3_1--&gt;|\"ç•°å¸¸\"|task12_3\n        task12_3--&gt;task14_2\n        task14_2--&gt;task15_2\n        task15_2--&gt;task16_2\n        task16_2--&gt;task17_2\n        task17_2--&gt;task10_4\n        task10_4--&gt;decision1_4\n        decision1_4--&gt;|\"å†ç¾ã—ãªã„\"|task10\n        decision1_4--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer\n    end\n    \n    %% ã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\n    subgraph flow6 [\"ãã®ä»–ã®ç—‡çŠ¶ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]\n        task_other_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã®FFCã‚’äº¤æ›ã™ã‚‹\"]",
        "signatures": {},
        "detailedLines": [
          {
            "text": "    subgraph flow4 [\"ãƒ‡ãƒ¼ã‚¿ç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 233
          },
          {
            "text": "        check11_3[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 234
          },
          {
            "text": "        decision_check11_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 235
          },
          {
            "text": "        decision_check11_3_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 236
          },
          {
            "text": "        task11_3[\"PGåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 237
          },
          {
            "text": "        check12_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 238
          },
          {
            "text": "        decision_check12_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 239
          },
          {
            "text": "        decision_check12_3_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 240
          },
          {
            "text": "        task12_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 241
          },
          {
            "text": "        task14_2[\"JARVISå†…éƒ¨ã®FFCã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]",
            "lineNumber": 242
          },
          {
            "text": "        task15_2[\"è£å´ã®ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]",
            "lineNumber": 243
          },
          {
            "text": "        task16_2[\"JARVISå†…éƒ¨ã®ã‚±ãƒ¼ãƒ–ãƒ«ã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]",
            "lineNumber": 244
          },
          {
            "text": "        task17_2[\"MK.â…¡(ä¿¡å·ç™ºç”Ÿæ©Ÿ)ã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„ã€‚\"]",
            "lineNumber": 245
          },
          {
            "text": "        task10_4[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 246
          },
          {
            "text": "        decision1_4{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 247
          },
          {
            "text": "        ",
            "lineNumber": 248
          },
          {
            "text": "        task8--&gt;check11_3",
            "lineNumber": 249
          },
          {
            "text": "        check11_3--&gt;decision_check11_3",
            "lineNumber": 250
          },
          {
            "text": "        decision_check11_3--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check11_3_1",
            "lineNumber": 251
          },
          {
            "text": "        decision_check11_3--&gt;|\"åˆ¤å®šã§ããªã„\"|task11_3",
            "lineNumber": 252
          },
          {
            "text": "        decision_check11_3_1--&gt;|\"æ­£å¸¸\"|check12_3",
            "lineNumber": 253
          },
          {
            "text": "        decision_check11_3_1--&gt;|\"ç•°å¸¸\"|task11_3",
            "lineNumber": 254
          },
          {
            "text": "        task11_3--&gt;check12_3",
            "lineNumber": 255
          },
          {
            "text": "        check12_3--&gt;decision_check12_3",
            "lineNumber": 256
          },
          {
            "text": "        decision_check12_3--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check12_3_1",
            "lineNumber": 257
          },
          {
            "text": "        decision_check12_3--&gt;|\"åˆ¤å®šã§ããªã„\"|task12_3",
            "lineNumber": 258
          },
          {
            "text": "        decision_check12_3_1--&gt;|\"æ­£å¸¸\"|task14_2",
            "lineNumber": 259
          },
          {
            "text": "        decision_check12_3_1--&gt;|\"ç•°å¸¸\"|task12_3",
            "lineNumber": 260
          },
          {
            "text": "        task12_3--&gt;task14_2",
            "lineNumber": 261
          },
          {
            "text": "        task14_2--&gt;task15_2",
            "lineNumber": 262
          },
          {
            "text": "        task15_2--&gt;task16_2",
            "lineNumber": 263
          },
          {
            "text": "        task16_2--&gt;task17_2",
            "lineNumber": 264
          },
          {
            "text": "        task17_2--&gt;task10_4",
            "lineNumber": 265
          },
          {
            "text": "        task10_4--&gt;decision1_4",
            "lineNumber": 266
          },
          {
            "text": "        decision1_4--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 267
          },
          {
            "text": "        decision1_4--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer",
            "lineNumber": 268
          },
          {
            "text": "    end",
            "lineNumber": 269
          },
          {
            "text": "    ",
            "lineNumber": 270
          },
          {
            "text": "    %% ã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 271
          },
          {
            "text": "    subgraph flow6 [\"ãã®ä»–ã®ç—‡çŠ¶ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 272
          },
          {
            "text": "        task_other_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã®FFCã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 273
          }
        ]
      },
      "score": 0.1655154973268509
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\storage\\toon_files\\flow_md.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 47
          }
        },
        "contents": "&#96;&#96;&#96;mermaid\ngraph TD\n    start[\"é–‹å§‹\"]\n    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]\n    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]\n    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]\n    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}\n    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}\n    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]\n    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]\n    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]\n    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]\n    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]\n    task10[\"æµå‹•ã«æˆ»ã™\"]\n    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}\n    node_end[\"çµ‚äº†\"]\n    \n    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼\n    start--&gt;task1\n    task1--&gt;task2\n    task2--&gt;decision1\n    \n    %% å†ç¾ã—ãªã„å ´åˆ\n    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10\n    task10--&gt;decision_recurrence\n    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1\n    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1\n    \n    %% å†ç¾ã™ã‚‹å ´åˆ\n    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3\n    task3--&gt;decision2\n    \n    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²\n    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4\n    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8\n    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9\n    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other\n    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "&#96;&#96;&#96;mermaid",
            "lineNumber": 1
          },
          {
            "text": "graph TD",
            "lineNumber": 2
          },
          {
            "text": "    start[\"é–‹å§‹\"]",
            "lineNumber": 3
          },
          {
            "text": "    task1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚µãƒ³ãƒ—ãƒ«ï¼ˆç•°å¸¸ãªã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«äº¤æ›\"]",
            "lineNumber": 4
          },
          {
            "text": "    task2[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ç¢ºèª\"]",
            "lineNumber": 5
          },
          {
            "text": "    decision1{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 6
          },
          {
            "text": "    task3[\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹å ´åˆã®å‡¦ç†\"]",
            "lineNumber": 7
          },
          {
            "text": "    decision2{\"ç—‡çŠ¶ã®ç¨®é¡ã‚’åˆ¤å®š\"}",
            "lineNumber": 8
          },
          {
            "text": "    task4[\"è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 9
          },
          {
            "text": "    decision3{\"è¡¨ç¤ºã®å•é¡Œã®è©³ç´°ã‚’åˆ¤å®š\"}",
            "lineNumber": 10
          },
          {
            "text": "    task5[\"ä¸¡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 11
          },
          {
            "text": "    task6[\"ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„\"]",
            "lineNumber": 12
          },
          {
            "text": "    task7[\"ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„\"]",
            "lineNumber": 13
          },
          {
            "text": "    task8[\"ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"]",
            "lineNumber": 14
          },
          {
            "text": "    task9[\"ç—‡çŠ¶:å†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"]",
            "lineNumber": 15
          },
          {
            "text": "    task_other[\"ãã®ä»–ã®ç—‡çŠ¶\"]",
            "lineNumber": 16
          },
          {
            "text": "    task10[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 17
          },
          {
            "text": "    decision_recurrence{\"ç—‡çŠ¶ãŒå†ç™ºã—ãŸã‹ï¼Ÿ\"}",
            "lineNumber": 18
          },
          {
            "text": "    node_end[\"çµ‚äº†\"]",
            "lineNumber": 19
          },
          {
            "text": "    ",
            "lineNumber": 20
          },
          {
            "text": "    %% ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 21
          },
          {
            "text": "    start--&gt;task1",
            "lineNumber": 22
          },
          {
            "text": "    task1--&gt;task2",
            "lineNumber": 23
          },
          {
            "text": "    task2--&gt;decision1",
            "lineNumber": 24
          },
          {
            "text": "    ",
            "lineNumber": 25
          },
          {
            "text": "    %% å†ç¾ã—ãªã„å ´åˆ",
            "lineNumber": 26
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 27
          },
          {
            "text": "    task10--&gt;decision_recurrence",
            "lineNumber": 28
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã—ãªã„\"|node_end",
            "lineNumber": 29
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow1ã‹ã‚‰ï¼‰\"|decision1_1",
            "lineNumber": 30
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow2ã‹ã‚‰ï¼‰\"|decision1_2",
            "lineNumber": 31
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow3ã‹ã‚‰ï¼‰\"|decision1_3",
            "lineNumber": 32
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow4ã‹ã‚‰ï¼‰\"|decision1_4",
            "lineNumber": 33
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow5ã‹ã‚‰ï¼‰\"|decision9_1",
            "lineNumber": 34
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆflow6ã‹ã‚‰ï¼‰\"|decision_other_1",
            "lineNumber": 35
          },
          {
            "text": "    decision_recurrence--&gt;|\"å†ç™ºã™ã‚‹ï¼ˆæœ€åˆã®åˆ¤å®šã‹ã‚‰ï¼‰\"|decision1",
            "lineNumber": 36
          },
          {
            "text": "    ",
            "lineNumber": 37
          },
          {
            "text": "    %% å†ç¾ã™ã‚‹å ´åˆ",
            "lineNumber": 38
          },
          {
            "text": "    decision1--&gt;|\"å†ç¾ã™ã‚‹\"|task3",
            "lineNumber": 39
          },
          {
            "text": "    task3--&gt;decision2",
            "lineNumber": 40
          },
          {
            "text": "    ",
            "lineNumber": 41
          },
          {
            "text": "    %% ç—‡çŠ¶ã®ç¨®é¡ã«ã‚ˆã‚‹åˆ†å²",
            "lineNumber": 42
          },
          {
            "text": "    decision2--&gt;|\"1ï¼šè¡¨ç¤ºãŒãŠã‹ã—ã„\"|task4",
            "lineNumber": 43
          },
          {
            "text": "    decision2--&gt;|\"2ï¼šãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„\"|task8",
            "lineNumber": 44
          },
          {
            "text": "    decision2--&gt;|\"3ï¼šå†ç¾ã—ãªã‹ã£ãŸJARVISã‚’æµå‹•ã«æˆ»ã—ãŸãŒã€1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸ\"|task9",
            "lineNumber": 45
          },
          {
            "text": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other",
            "lineNumber": 46
          },
          {
            "text": "    ",
            "lineNumber": 47
          }
        ]
      },
      "score": 0.16384053230285645
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\llm_client.py",
        "range": {
          "startPosition": {
            "line": 8
          },
          "endPosition": {
            "line": 395
          }
        },
        "contents": "class LLMClient:\ndef generate_partial_change(\n        self, \n        user_input: str, \n        target_flowchart: Flowchart,\n        full_flowchart: Flowchart\n    ) -&gt; str:\n\n        except requests.exceptions.Timeout as e:\n            raise LLMAPIError(\n                f\"Ollama APIã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚\\n\"\n                f\"ãƒ¢ãƒ‡ãƒ«å: {self.model}\\n\"\n                f\"ã‚¨ãƒ©ãƒ¼è©³ç´°: {str(e)}\"\n            ) from e\n        except requests.exceptions.HTTPError as e:\n            error_detail = \"\"\n            try:\n                error_response = response.json()\n                if 'error' in error_response:\n                    error_detail = f\"\\nã‚¨ãƒ©ãƒ¼å†…å®¹: {error_response['error']}\"\n            except:\n                pass\n            \n            raise LLMAPIError(\n                f\"Ollama APIã§HTTPã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚\\n\"\n                f\"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰: {response.status_code}\\n\"\n                f\"ãƒ™ãƒ¼ã‚¹URL: {self.base_url}\\n\"\n                f\"ãƒ¢ãƒ‡ãƒ«å: {self.model}\\n\"\n                f\"{error_detail}\\n\"\n                f\"ã‚¨ãƒ©ãƒ¼è©³ç´°: {str(e)}\"\n            ) from e\n        except Exception as e:\n            error_msg = str(e)\n            if \"Connection\" in error_msg or \"connect\" in error_msg.lower():\n                raise LLMAPIError(\n                    f\"Ollamaã¸ã®æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚\\n\"\n                    f\"ç¢ºèªäº‹é …:\\n\"\n                    f\"1. OllamaãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ï¼ˆ&#96;ollama serve&#96;ã¾ãŸã¯Ollamaã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ï¼‰\\n\"\n                    f\"2. ãƒ™ãƒ¼ã‚¹URL: {self.base_url}\\n\"\n                    f\"3. ãƒ¢ãƒ‡ãƒ«å: {self.model}ï¼ˆ&#96;ollama pull {self.model}&#96;ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼‰\\n\"\n                    f\"4. ã‚¨ãƒ©ãƒ¼è©³ç´°: {error_msg}\"\n                ) from e\n            raise LLMAPIError(f\"Ollama APIã¨ã®é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ: {error_msg}\") from e\n\n    def generate_flow(self, user_input: str, current_flowchart: Optional[Flowchart] = None) -&gt; str:\n        ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 9,
                "column": 1
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 145,
                "column": 5
              },
              "endPosition": {
                "line": 151,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class LLMClient:",
            "lineNumber": 9,
            "isSignature": true
          },
          {
            "text": "def generate_partial_change(",
            "lineNumber": 145
          },
          {
            "text": "        self, ",
            "lineNumber": 146
          },
          {
            "text": "        user_input: str, ",
            "lineNumber": 147
          },
          {
            "text": "        target_flowchart: Flowchart,",
            "lineNumber": 148
          },
          {
            "text": "        full_flowchart: Flowchart",
            "lineNumber": 149
          },
          {
            "text": "    ) -&gt; str:",
            "lineNumber": 150
          },
          {
            "lineNumber": 235
          },
          {
            "text": "        except requests.exceptions.Timeout as e:",
            "lineNumber": 236
          },
          {
            "text": "            raise LLMAPIError(",
            "lineNumber": 237
          },
          {
            "text": "                f\"Ollama APIã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚\\n\"",
            "lineNumber": 238
          },
          {
            "text": "                f\"ãƒ¢ãƒ‡ãƒ«å: {self.model}\\n\"",
            "lineNumber": 239
          },
          {
            "text": "                f\"ã‚¨ãƒ©ãƒ¼è©³ç´°: {str(e)}\"",
            "lineNumber": 240
          },
          {
            "text": "            ) from e",
            "lineNumber": 241
          },
          {
            "text": "        except requests.exceptions.HTTPError as e:",
            "lineNumber": 242
          },
          {
            "text": "            error_detail = \"\"",
            "lineNumber": 243
          },
          {
            "text": "            try:",
            "lineNumber": 244
          },
          {
            "text": "                error_response = response.json()",
            "lineNumber": 245
          },
          {
            "text": "                if 'error' in error_response:",
            "lineNumber": 246
          },
          {
            "text": "                    error_detail = f\"\\nã‚¨ãƒ©ãƒ¼å†…å®¹: {error_response['error']}\"",
            "lineNumber": 247
          },
          {
            "text": "            except:",
            "lineNumber": 248
          },
          {
            "text": "                pass",
            "lineNumber": 249
          },
          {
            "text": "            ",
            "lineNumber": 250
          },
          {
            "text": "            raise LLMAPIError(",
            "lineNumber": 251
          },
          {
            "text": "                f\"Ollama APIã§HTTPã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚\\n\"",
            "lineNumber": 252
          },
          {
            "text": "                f\"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰: {response.status_code}\\n\"",
            "lineNumber": 253
          },
          {
            "text": "                f\"ãƒ™ãƒ¼ã‚¹URL: {self.base_url}\\n\"",
            "lineNumber": 254
          },
          {
            "text": "                f\"ãƒ¢ãƒ‡ãƒ«å: {self.model}\\n\"",
            "lineNumber": 255
          },
          {
            "text": "                f\"{error_detail}\\n\"",
            "lineNumber": 256
          },
          {
            "text": "                f\"ã‚¨ãƒ©ãƒ¼è©³ç´°: {str(e)}\"",
            "lineNumber": 257
          },
          {
            "text": "            ) from e",
            "lineNumber": 258
          },
          {
            "text": "        except Exception as e:",
            "lineNumber": 259
          },
          {
            "text": "            error_msg = str(e)",
            "lineNumber": 260
          },
          {
            "text": "            if \"Connection\" in error_msg or \"connect\" in error_msg.lower():",
            "lineNumber": 261
          },
          {
            "text": "                raise LLMAPIError(",
            "lineNumber": 262
          },
          {
            "text": "                    f\"Ollamaã¸ã®æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚\\n\"",
            "lineNumber": 263
          },
          {
            "text": "                    f\"ç¢ºèªäº‹é …:\\n\"",
            "lineNumber": 264
          },
          {
            "text": "                    f\"1. OllamaãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ï¼ˆ&#96;ollama serve&#96;ã¾ãŸã¯Ollamaã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ï¼‰\\n\"",
            "lineNumber": 265
          },
          {
            "text": "                    f\"2. ãƒ™ãƒ¼ã‚¹URL: {self.base_url}\\n\"",
            "lineNumber": 266
          },
          {
            "text": "                    f\"3. ãƒ¢ãƒ‡ãƒ«å: {self.model}ï¼ˆ&#96;ollama pull {self.model}&#96;ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼‰\\n\"",
            "lineNumber": 267
          },
          {
            "text": "                    f\"4. ã‚¨ãƒ©ãƒ¼è©³ç´°: {error_msg}\"",
            "lineNumber": 268
          },
          {
            "text": "                ) from e",
            "lineNumber": 269
          },
          {
            "text": "            raise LLMAPIError(f\"Ollama APIã¨ã®é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ: {error_msg}\") from e",
            "lineNumber": 270
          },
          {
            "lineNumber": 271
          },
          {
            "text": "    def generate_flow(self, user_input: str, current_flowchart: Optional[Flowchart] = None) -&gt; str:",
            "lineNumber": 272
          },
          {
            "text": "        ",
            "lineNumber": 273
          }
        ]
      },
      "score": 0.15728390216827393
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\storage\\toon_files\\flow_md.md",
        "range": {
          "startPosition": {
            "line": 232
          },
          "endPosition": {
            "line": 273
          }
        },
        "contents": "    subgraph flow4 [\"ãƒ‡ãƒ¼ã‚¿ç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]\n        check11_3[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check11_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check11_3_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task11_3[\"PGåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        check12_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check12_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check12_3_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task12_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        task14_2[\"JARVISå†…éƒ¨ã®FFCã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]\n        task15_2[\"è£å´ã®ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]\n        task16_2[\"JARVISå†…éƒ¨ã®ã‚±ãƒ¼ãƒ–ãƒ«ã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]\n        task17_2[\"MK.â…¡(ä¿¡å·ç™ºç”Ÿæ©Ÿ)ã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„ã€‚\"]\n        task10_4[\"æµå‹•ã«æˆ»ã™\"]\n        decision1_4{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n        \n        task8--&gt;check11_3\n        check11_3--&gt;decision_check11_3\n        decision_check11_3--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check11_3_1\n        decision_check11_3--&gt;|\"åˆ¤å®šã§ããªã„\"|task11_3\n        decision_check11_3_1--&gt;|\"æ­£å¸¸\"|check12_3\n        decision_check11_3_1--&gt;|\"ç•°å¸¸\"|task11_3\n        task11_3--&gt;check12_3\n        check12_3--&gt;decision_check12_3\n        decision_check12_3--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check12_3_1\n        decision_check12_3--&gt;|\"åˆ¤å®šã§ããªã„\"|task12_3\n        decision_check12_3_1--&gt;|\"æ­£å¸¸\"|task14_2\n        decision_check12_3_1--&gt;|\"ç•°å¸¸\"|task12_3\n        task12_3--&gt;task14_2\n        task14_2--&gt;task15_2\n        task15_2--&gt;task16_2\n        task16_2--&gt;task17_2\n        task17_2--&gt;task10_4\n        task10_4--&gt;decision1_4\n        decision1_4--&gt;|\"å†ç¾ã—ãªã„\"|task10\n        decision1_4--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer\n    end\n    \n    %% ã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\n    subgraph flow6 [\"ãã®ä»–ã®ç—‡çŠ¶ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]\n        task_other_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã®FFCã‚’äº¤æ›ã™ã‚‹\"]",
        "signatures": {},
        "detailedLines": [
          {
            "text": "    subgraph flow4 [\"ãƒ‡ãƒ¼ã‚¿ç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 233
          },
          {
            "text": "        check11_3[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 234
          },
          {
            "text": "        decision_check11_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 235
          },
          {
            "text": "        decision_check11_3_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 236
          },
          {
            "text": "        task11_3[\"PGåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 237
          },
          {
            "text": "        check12_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 238
          },
          {
            "text": "        decision_check12_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 239
          },
          {
            "text": "        decision_check12_3_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 240
          },
          {
            "text": "        task12_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 241
          },
          {
            "text": "        task14_2[\"JARVISå†…éƒ¨ã®FFCã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]",
            "lineNumber": 242
          },
          {
            "text": "        task15_2[\"è£å´ã®ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]",
            "lineNumber": 243
          },
          {
            "text": "        task16_2[\"JARVISå†…éƒ¨ã®ã‚±ãƒ¼ãƒ–ãƒ«ã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]",
            "lineNumber": 244
          },
          {
            "text": "        task17_2[\"MK.â…¡(ä¿¡å·ç™ºç”Ÿæ©Ÿ)ã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„ã€‚\"]",
            "lineNumber": 245
          },
          {
            "text": "        task10_4[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 246
          },
          {
            "text": "        decision1_4{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 247
          },
          {
            "text": "        ",
            "lineNumber": 248
          },
          {
            "text": "        task8--&gt;check11_3",
            "lineNumber": 249
          },
          {
            "text": "        check11_3--&gt;decision_check11_3",
            "lineNumber": 250
          },
          {
            "text": "        decision_check11_3--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check11_3_1",
            "lineNumber": 251
          },
          {
            "text": "        decision_check11_3--&gt;|\"åˆ¤å®šã§ããªã„\"|task11_3",
            "lineNumber": 252
          },
          {
            "text": "        decision_check11_3_1--&gt;|\"æ­£å¸¸\"|check12_3",
            "lineNumber": 253
          },
          {
            "text": "        decision_check11_3_1--&gt;|\"ç•°å¸¸\"|task11_3",
            "lineNumber": 254
          },
          {
            "text": "        task11_3--&gt;check12_3",
            "lineNumber": 255
          },
          {
            "text": "        check12_3--&gt;decision_check12_3",
            "lineNumber": 256
          },
          {
            "text": "        decision_check12_3--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check12_3_1",
            "lineNumber": 257
          },
          {
            "text": "        decision_check12_3--&gt;|\"åˆ¤å®šã§ããªã„\"|task12_3",
            "lineNumber": 258
          },
          {
            "text": "        decision_check12_3_1--&gt;|\"æ­£å¸¸\"|task14_2",
            "lineNumber": 259
          },
          {
            "text": "        decision_check12_3_1--&gt;|\"ç•°å¸¸\"|task12_3",
            "lineNumber": 260
          },
          {
            "text": "        task12_3--&gt;task14_2",
            "lineNumber": 261
          },
          {
            "text": "        task14_2--&gt;task15_2",
            "lineNumber": 262
          },
          {
            "text": "        task15_2--&gt;task16_2",
            "lineNumber": 263
          },
          {
            "text": "        task16_2--&gt;task17_2",
            "lineNumber": 264
          },
          {
            "text": "        task17_2--&gt;task10_4",
            "lineNumber": 265
          },
          {
            "text": "        task10_4--&gt;decision1_4",
            "lineNumber": 266
          },
          {
            "text": "        decision1_4--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 267
          },
          {
            "text": "        decision1_4--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer",
            "lineNumber": 268
          },
          {
            "text": "    end",
            "lineNumber": 269
          },
          {
            "text": "    ",
            "lineNumber": 270
          },
          {
            "text": "    %% ã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 271
          },
          {
            "text": "    subgraph flow6 [\"ãã®ä»–ã®ç—‡çŠ¶ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 272
          },
          {
            "text": "        task_other_1[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã®FFCã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 273
          }
        ]
      },
      "score": 0.15714794397354126
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\llm_client.py",
        "range": {
          "startPosition": {
            "line": 8
          },
          "endPosition": {
            "line": 395
          }
        },
        "contents": "class LLMClient:\ndef generate_flow(self, user_input: str, current_flowchart: Optional[Flowchart] = None) -&gt; str:\n\n        except requests.exceptions.ConnectionError as e:\n            # æ¥ç¶šã‚¨ãƒ©ãƒ¼ã®å ´åˆ\n            raise LLMAPIError(\n                f\"Ollamaã¸ã®æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚\\n\"\n                f\"ç¢ºèªäº‹é …:\\n\"\n                f\"1. OllamaãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ï¼ˆ&#96;ollama serve&#96;ã¾ãŸã¯Ollamaã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ï¼‰\\n\"\n                f\"2. ãƒ™ãƒ¼ã‚¹URL: {self.base_url}\\n\"\n                f\"3. ãƒ¢ãƒ‡ãƒ«å: {self.model}ï¼ˆ&#96;ollama pull {self.model}&#96;ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼‰\\n\"\n                f\"4. ã‚¨ãƒ©ãƒ¼è©³ç´°: {str(e)}\"\n            ) from e\n        except requests.exceptions.Timeout as e:\n            raise LLMAPIError(\n                f\"Ollama APIã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚\\n\"\n                f\"ãƒ¢ãƒ‡ãƒ«å: {self.model}\\n\"\n                f\"ã‚¨ãƒ©ãƒ¼è©³ç´°: {str(e)}\"\n            ) from e\n        except requests.exceptions.HTTPError as e:\n            # HTTPã‚¨ãƒ©ãƒ¼ã®å ´åˆï¼ˆ404, 500ãªã©ï¼‰\n            error_detail = \"\"\n            try:\n                error_response = response.json()\n                if 'error' in error_response:\n                    error_detail = f\"\\nã‚¨ãƒ©ãƒ¼å†…å®¹: {error_response['error']}\"\n            except:\n                pass\n            \n            raise LLMAPIError(\n                f\"Ollama APIã§HTTPã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚\\n\"\n                f\"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰: {response.status_code}\\n\"\n                f\"ãƒ™ãƒ¼ã‚¹URL: {self.base_url}\\n\"\n                f\"ãƒ¢ãƒ‡ãƒ«å: {self.model}\\n\"\n                f\"{error_detail}\\n\"\n                f\"ã‚¨ãƒ©ãƒ¼è©³ç´°: {str(e)}\"\n            ) from e\n        except Exception as e:\n            # ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼\n            error_msg = str(e)",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 9,
                "column": 1
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 272,
                "column": 5
              },
              "endPosition": {
                "line": 273,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class LLMClient:",
            "lineNumber": 9,
            "isSignature": true
          },
          {
            "text": "def generate_flow(self, user_input: str, current_flowchart: Optional[Flowchart] = None) -&gt; str:",
            "lineNumber": 272
          },
          {
            "lineNumber": 349
          },
          {
            "text": "        except requests.exceptions.ConnectionError as e:",
            "lineNumber": 350
          },
          {
            "text": "            # æ¥ç¶šã‚¨ãƒ©ãƒ¼ã®å ´åˆ",
            "lineNumber": 351
          },
          {
            "text": "            raise LLMAPIError(",
            "lineNumber": 352
          },
          {
            "text": "                f\"Ollamaã¸ã®æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚\\n\"",
            "lineNumber": 353
          },
          {
            "text": "                f\"ç¢ºèªäº‹é …:\\n\"",
            "lineNumber": 354
          },
          {
            "text": "                f\"1. OllamaãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ï¼ˆ&#96;ollama serve&#96;ã¾ãŸã¯Ollamaã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ï¼‰\\n\"",
            "lineNumber": 355
          },
          {
            "text": "                f\"2. ãƒ™ãƒ¼ã‚¹URL: {self.base_url}\\n\"",
            "lineNumber": 356
          },
          {
            "text": "                f\"3. ãƒ¢ãƒ‡ãƒ«å: {self.model}ï¼ˆ&#96;ollama pull {self.model}&#96;ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼‰\\n\"",
            "lineNumber": 357
          },
          {
            "text": "                f\"4. ã‚¨ãƒ©ãƒ¼è©³ç´°: {str(e)}\"",
            "lineNumber": 358
          },
          {
            "text": "            ) from e",
            "lineNumber": 359
          },
          {
            "text": "        except requests.exceptions.Timeout as e:",
            "lineNumber": 360
          },
          {
            "text": "            raise LLMAPIError(",
            "lineNumber": 361
          },
          {
            "text": "                f\"Ollama APIã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚\\n\"",
            "lineNumber": 362
          },
          {
            "text": "                f\"ãƒ¢ãƒ‡ãƒ«å: {self.model}\\n\"",
            "lineNumber": 363
          },
          {
            "text": "                f\"ã‚¨ãƒ©ãƒ¼è©³ç´°: {str(e)}\"",
            "lineNumber": 364
          },
          {
            "text": "            ) from e",
            "lineNumber": 365
          },
          {
            "text": "        except requests.exceptions.HTTPError as e:",
            "lineNumber": 366
          },
          {
            "text": "            # HTTPã‚¨ãƒ©ãƒ¼ã®å ´åˆï¼ˆ404, 500ãªã©ï¼‰",
            "lineNumber": 367
          },
          {
            "text": "            error_detail = \"\"",
            "lineNumber": 368
          },
          {
            "text": "            try:",
            "lineNumber": 369
          },
          {
            "text": "                error_response = response.json()",
            "lineNumber": 370
          },
          {
            "text": "                if 'error' in error_response:",
            "lineNumber": 371
          },
          {
            "text": "                    error_detail = f\"\\nã‚¨ãƒ©ãƒ¼å†…å®¹: {error_response['error']}\"",
            "lineNumber": 372
          },
          {
            "text": "            except:",
            "lineNumber": 373
          },
          {
            "text": "                pass",
            "lineNumber": 374
          },
          {
            "text": "            ",
            "lineNumber": 375
          },
          {
            "text": "            raise LLMAPIError(",
            "lineNumber": 376
          },
          {
            "text": "                f\"Ollama APIã§HTTPã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚\\n\"",
            "lineNumber": 377
          },
          {
            "text": "                f\"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰: {response.status_code}\\n\"",
            "lineNumber": 378
          },
          {
            "text": "                f\"ãƒ™ãƒ¼ã‚¹URL: {self.base_url}\\n\"",
            "lineNumber": 379
          },
          {
            "text": "                f\"ãƒ¢ãƒ‡ãƒ«å: {self.model}\\n\"",
            "lineNumber": 380
          },
          {
            "text": "                f\"{error_detail}\\n\"",
            "lineNumber": 381
          },
          {
            "text": "                f\"ã‚¨ãƒ©ãƒ¼è©³ç´°: {str(e)}\"",
            "lineNumber": 382
          },
          {
            "text": "            ) from e",
            "lineNumber": 383
          },
          {
            "text": "        except Exception as e:",
            "lineNumber": 384
          },
          {
            "text": "            # ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼",
            "lineNumber": 385
          },
          {
            "text": "            error_msg = str(e)",
            "lineNumber": 386
          }
        ]
      },
      "score": 0.1507863998413086
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\flow.md",
        "range": {
          "startPosition": {
            "line": 45
          },
          "endPosition": {
            "line": 87
          }
        },
        "contents": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other\n    \n    %% ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã¸ã®é€£çµ¡ï¼ˆå…¨ãƒ¢ãƒ¼ãƒ‰å…±é€šï¼‰\n    contact_manufacturer[\"ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã«é€£çµ¡\"]\n    \n    %% å†ç¾ã—ãªã‹ã£ãŸJARVISãŒ1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸå ´åˆã®ç¹°ã‚Šè¿”ã—å‡¦ç†ãƒ•ãƒ­ãƒ¼\n    subgraph flow5 [\"å†ç™ºæ™‚ã®æ®µéšçš„å¯¾å¿œãƒ•ãƒ­ãƒ¼\"]\n        check9_1[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check9_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check9_1_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task9_1[\"PGåŸºæ¿ã‚’äº¤æ›\"]\n        task9_2[\"æµå‹•ã«æˆ»ã™\"]\n        decision9_1{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}\n        check9_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check9_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check9_3_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task9_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›\"]\n        task9_4[\"æµå‹•ã«æˆ»ã™\"]\n        decision9_2{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}\n        check9_5[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check9_5{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check9_5_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task9_5[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›\"]\n        task9_6[\"æµå‹•ã«æˆ»ã™\"]\n        decision9_3{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}\n        check9_7[\"å†…éƒ¨ã®FFCã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check9_7{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check9_7_1{\"å†…éƒ¨ã®FFCã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task9_7[\"å†…éƒ¨ã®FFCã‚’äº¤æ›\"]\n        task9_8[\"æµå‹•ã«æˆ»ã™\"]\n        decision9_4{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}\n        task9_9[\"æ‹…å½“ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã«é€£çµ¡\"]\n        \n        task9--&gt;check9_1\n        check9_1--&gt;decision_check9_1\n        decision_check9_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_1_1\n        decision_check9_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_1\n        decision_check9_1_1--&gt;|\"æ­£å¸¸\"|task9_2\n        decision_check9_1_1--&gt;|\"ç•°å¸¸\"|task9_1\n        task9_1--&gt;task9_2\n        task9_2--&gt;decision9_1\n        decision9_1--&gt;|\"å‡ºã¦ããŸ\"|check9_3",
        "signatures": {},
        "detailedLines": [
          {
            "text": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other",
            "lineNumber": 46
          },
          {
            "text": "    ",
            "lineNumber": 47
          },
          {
            "text": "    %% ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã¸ã®é€£çµ¡ï¼ˆå…¨ãƒ¢ãƒ¼ãƒ‰å…±é€šï¼‰",
            "lineNumber": 48
          },
          {
            "text": "    contact_manufacturer[\"ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã«é€£çµ¡\"]",
            "lineNumber": 49
          },
          {
            "text": "    ",
            "lineNumber": 50
          },
          {
            "text": "    %% å†ç¾ã—ãªã‹ã£ãŸJARVISãŒ1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸå ´åˆã®ç¹°ã‚Šè¿”ã—å‡¦ç†ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 51
          },
          {
            "text": "    subgraph flow5 [\"å†ç™ºæ™‚ã®æ®µéšçš„å¯¾å¿œãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 52
          },
          {
            "text": "        check9_1[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 53
          },
          {
            "text": "        decision_check9_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 54
          },
          {
            "text": "        decision_check9_1_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 55
          },
          {
            "text": "        task9_1[\"PGåŸºæ¿ã‚’äº¤æ›\"]",
            "lineNumber": 56
          },
          {
            "text": "        task9_2[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 57
          },
          {
            "text": "        decision9_1{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}",
            "lineNumber": 58
          },
          {
            "text": "        check9_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 59
          },
          {
            "text": "        decision_check9_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 60
          },
          {
            "text": "        decision_check9_3_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 61
          },
          {
            "text": "        task9_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›\"]",
            "lineNumber": 62
          },
          {
            "text": "        task9_4[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 63
          },
          {
            "text": "        decision9_2{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}",
            "lineNumber": 64
          },
          {
            "text": "        check9_5[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 65
          },
          {
            "text": "        decision_check9_5{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 66
          },
          {
            "text": "        decision_check9_5_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 67
          },
          {
            "text": "        task9_5[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›\"]",
            "lineNumber": 68
          },
          {
            "text": "        task9_6[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 69
          },
          {
            "text": "        decision9_3{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}",
            "lineNumber": 70
          },
          {
            "text": "        check9_7[\"å†…éƒ¨ã®FFCã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 71
          },
          {
            "text": "        decision_check9_7{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 72
          },
          {
            "text": "        decision_check9_7_1{\"å†…éƒ¨ã®FFCã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 73
          },
          {
            "text": "        task9_7[\"å†…éƒ¨ã®FFCã‚’äº¤æ›\"]",
            "lineNumber": 74
          },
          {
            "text": "        task9_8[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 75
          },
          {
            "text": "        decision9_4{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}",
            "lineNumber": 76
          },
          {
            "text": "        task9_9[\"æ‹…å½“ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã«é€£çµ¡\"]",
            "lineNumber": 77
          },
          {
            "text": "        ",
            "lineNumber": 78
          },
          {
            "text": "        task9--&gt;check9_1",
            "lineNumber": 79
          },
          {
            "text": "        check9_1--&gt;decision_check9_1",
            "lineNumber": 80
          },
          {
            "text": "        decision_check9_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_1_1",
            "lineNumber": 81
          },
          {
            "text": "        decision_check9_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_1",
            "lineNumber": 82
          },
          {
            "text": "        decision_check9_1_1--&gt;|\"æ­£å¸¸\"|task9_2",
            "lineNumber": 83
          },
          {
            "text": "        decision_check9_1_1--&gt;|\"ç•°å¸¸\"|task9_1",
            "lineNumber": 84
          },
          {
            "text": "        task9_1--&gt;task9_2",
            "lineNumber": 85
          },
          {
            "text": "        task9_2--&gt;decision9_1",
            "lineNumber": 86
          },
          {
            "text": "        decision9_1--&gt;|\"å‡ºã¦ããŸ\"|check9_3",
            "lineNumber": 87
          }
        ]
      },
      "score": 0.1494583934545517
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\llm_client.py",
        "range": {
          "startPosition": {
            "line": 8
          },
          "endPosition": {
            "line": 395
          }
        },
        "contents": "class LLMClient:\ndef generate_flow(self, user_input: str, current_flowchart: Optional[Flowchart] = None) -&gt; str:\n\n            \n            # Ollama HTTP APIã‚’ç›´æ¥å‘¼ã³å‡ºã—\n            payload = {\n                \"model\": self.model,\n                \"messages\": [\n                    {\"role\": \"system\", \"content\": system_prompt},\n                    {\"role\": \"user\", \"content\": enhanced_input}\n                ],\n                \"options\": {\n                    \"temperature\": 0.7\n                },\n                \"stream\": False\n            }\n            \n            # localhostã¸ã®æ¥ç¶šã§ã¯ãƒ—ãƒ­ã‚­ã‚·ã‚’ä½¿ç”¨ã—ãªã„\n            proxies = {\"http\": None, \"https\": None} if \"localhost\" in self.base_url or \"127.0.0.1\" in self.base_url else None\n            \n            response = requests.post(\n                self.api_url,\n                json=payload,\n                timeout=300,  # 5åˆ†ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ\n                proxies=proxies\n            )\n            \n            # HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯\n            response.raise_for_status()\n            \n            # JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è§£æ\n            result = response.json()\n            \n            if result and 'message' in result and 'content' in result['message']:\n                toon_text = result['message']['content']\n                \n                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼ï¼ˆè³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰\n                if not self.is_question_response(toon_text):\n                    is_valid, validation_message = self.validate_output_size(toon_text)\n                    if not is_valid:\n                        # è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’TOONå½¢å¼ã®å‰ã«è¿½åŠ ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆå½¢å¼ï¼‰\n                        warning_comment = f\"&lt;!-- {validation_message} --&gt;\\n\"\n                        toon_text = warning_comment + toon_text\n                \n                return toon_text\n            else:\n                raise ValueError(\"ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰æœ‰åŠ¹ãªå¿œç­”ãŒå¾—ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚\")\n                \n        except ValueError:\n            # å†ç™ºç”Ÿã•ã›ã‚‹\n            raise\n        except requests.exceptions.ConnectionError as e:\n            # æ¥ç¶šã‚¨ãƒ©ãƒ¼ã®å ´åˆ\n            raise",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 9,
                "column": 1
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 272,
                "column": 5
              },
              "endPosition": {
                "line": 273,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class LLMClient:",
            "lineNumber": 9,
            "isSignature": true
          },
          {
            "text": "def generate_flow(self, user_input: str, current_flowchart: Optional[Flowchart] = None) -&gt; str:",
            "lineNumber": 272
          },
          {
            "lineNumber": 301
          },
          {
            "text": "            ",
            "lineNumber": 302
          },
          {
            "text": "            # Ollama HTTP APIã‚’ç›´æ¥å‘¼ã³å‡ºã—",
            "lineNumber": 303
          },
          {
            "text": "            payload = {",
            "lineNumber": 304
          },
          {
            "text": "                \"model\": self.model,",
            "lineNumber": 305
          },
          {
            "text": "                \"messages\": [",
            "lineNumber": 306
          },
          {
            "text": "                    {\"role\": \"system\", \"content\": system_prompt},",
            "lineNumber": 307
          },
          {
            "text": "                    {\"role\": \"user\", \"content\": enhanced_input}",
            "lineNumber": 308
          },
          {
            "text": "                ],",
            "lineNumber": 309
          },
          {
            "text": "                \"options\": {",
            "lineNumber": 310
          },
          {
            "text": "                    \"temperature\": 0.7",
            "lineNumber": 311
          },
          {
            "text": "                },",
            "lineNumber": 312
          },
          {
            "text": "                \"stream\": False",
            "lineNumber": 313
          },
          {
            "text": "            }",
            "lineNumber": 314
          },
          {
            "text": "            ",
            "lineNumber": 315
          },
          {
            "text": "            # localhostã¸ã®æ¥ç¶šã§ã¯ãƒ—ãƒ­ã‚­ã‚·ã‚’ä½¿ç”¨ã—ãªã„",
            "lineNumber": 316
          },
          {
            "text": "            proxies = {\"http\": None, \"https\": None} if \"localhost\" in self.base_url or \"127.0.0.1\" in self.base_url else None",
            "lineNumber": 317
          },
          {
            "text": "            ",
            "lineNumber": 318
          },
          {
            "text": "            response = requests.post(",
            "lineNumber": 319
          },
          {
            "text": "                self.api_url,",
            "lineNumber": 320
          },
          {
            "text": "                json=payload,",
            "lineNumber": 321
          },
          {
            "text": "                timeout=300,  # 5åˆ†ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ",
            "lineNumber": 322
          },
          {
            "text": "                proxies=proxies",
            "lineNumber": 323
          },
          {
            "text": "            )",
            "lineNumber": 324
          },
          {
            "text": "            ",
            "lineNumber": 325
          },
          {
            "text": "            # HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 326
          },
          {
            "text": "            response.raise_for_status()",
            "lineNumber": 327
          },
          {
            "text": "            ",
            "lineNumber": 328
          },
          {
            "text": "            # JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è§£æ",
            "lineNumber": 329
          },
          {
            "text": "            result = response.json()",
            "lineNumber": 330
          },
          {
            "text": "            ",
            "lineNumber": 331
          },
          {
            "text": "            if result and 'message' in result and 'content' in result['message']:",
            "lineNumber": 332
          },
          {
            "text": "                toon_text = result['message']['content']",
            "lineNumber": 333
          },
          {
            "text": "                ",
            "lineNumber": 334
          },
          {
            "text": "                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼ï¼ˆè³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰",
            "lineNumber": 335
          },
          {
            "text": "                if not self.is_question_response(toon_text):",
            "lineNumber": 336
          },
          {
            "text": "                    is_valid, validation_message = self.validate_output_size(toon_text)",
            "lineNumber": 337
          },
          {
            "text": "                    if not is_valid:",
            "lineNumber": 338
          },
          {
            "text": "                        # è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’TOONå½¢å¼ã®å‰ã«è¿½åŠ ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆå½¢å¼ï¼‰",
            "lineNumber": 339
          },
          {
            "text": "                        warning_comment = f\"&lt;!-- {validation_message} --&gt;\\n\"",
            "lineNumber": 340
          },
          {
            "text": "                        toon_text = warning_comment + toon_text",
            "lineNumber": 341
          },
          {
            "text": "                ",
            "lineNumber": 342
          },
          {
            "text": "                return toon_text",
            "lineNumber": 343
          },
          {
            "text": "            else:",
            "lineNumber": 344
          },
          {
            "text": "                raise ValueError(\"ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰æœ‰åŠ¹ãªå¿œç­”ãŒå¾—ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚\")",
            "lineNumber": 345
          },
          {
            "text": "                ",
            "lineNumber": 346
          },
          {
            "text": "        except ValueError:",
            "lineNumber": 347
          },
          {
            "text": "            # å†ç™ºç”Ÿã•ã›ã‚‹",
            "lineNumber": 348
          },
          {
            "text": "            raise",
            "lineNumber": 349
          },
          {
            "text": "        except requests.exceptions.ConnectionError as e:",
            "lineNumber": 350
          },
          {
            "text": "            # æ¥ç¶šã‚¨ãƒ©ãƒ¼ã®å ´åˆ",
            "lineNumber": 351
          },
          {
            "text": "            raise",
            "lineNumber": 352
          }
        ]
      },
      "score": 0.1453842967748642
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 269,
            "column": 65
          },
          "endPosition": {
            "line": 288,
            "column": 75
          }
        },
        "contents": " temp_responses\n                            \n                            # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯\n                            if 'raw_toon_text' in locals() and raw_toon_text:\n                                if client.is_question_response(raw_toon_text):\n                                    # è³ªå•å½¢å¼ã®å¿œç­”ã ã£ãŸå ´åˆ\n                                    st.session_state.conversation_context = combined_prompt\n                                    st.session_state.pending_questions = raw_toon_text\n                                    st.session_state.question_responses = []\n                                    st.info(\"LLMã‹ã‚‰è¿½åŠ ã®è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n                                    st.rerun()\n                                else:\n                                    st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")\n                                    with st.expander(\"ğŸ” LLMã®ç”Ÿå‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰\", expanded=True):\n                                        st.info(\"ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’TOONå½¢å¼ã¨ã—ã¦è§£é‡ˆã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€å¤±æ•—ã—ã¾ã—ãŸã€‚\")\n                                        st.code(raw_toon_text)\n                            else:\n                                st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")\n                        except Exception as e:\n                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ",
        "signatures": {},
        "detailedLines": [
          {
            "text": " temp_responses",
            "lineNumber": 270
          },
          {
            "text": "                            ",
            "lineNumber": 271
          },
          {
            "text": "                            # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 272
          },
          {
            "text": "                            if 'raw_toon_text' in locals() and raw_toon_text:",
            "lineNumber": 273
          },
          {
            "text": "                                if client.is_question_response(raw_toon_text):",
            "lineNumber": 274
          },
          {
            "text": "                                    # è³ªå•å½¢å¼ã®å¿œç­”ã ã£ãŸå ´åˆ",
            "lineNumber": 275
          },
          {
            "text": "                                    st.session_state.conversation_context = combined_prompt",
            "lineNumber": 276
          },
          {
            "text": "                                    st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 277
          },
          {
            "text": "                                    st.session_state.question_responses = []",
            "lineNumber": 278
          },
          {
            "text": "                                    st.info(\"LLMã‹ã‚‰è¿½åŠ ã®è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 279
          },
          {
            "text": "                                    st.rerun()",
            "lineNumber": 280
          },
          {
            "text": "                                else:",
            "lineNumber": 281
          },
          {
            "text": "                                    st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 282
          },
          {
            "text": "                                    with st.expander(\"ğŸ” LLMã®ç”Ÿå‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰\", expanded=True):",
            "lineNumber": 283
          },
          {
            "text": "                                        st.info(\"ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’TOONå½¢å¼ã¨ã—ã¦è§£é‡ˆã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€å¤±æ•—ã—ã¾ã—ãŸã€‚\")",
            "lineNumber": 284
          },
          {
            "text": "                                        st.code(raw_toon_text)",
            "lineNumber": 285
          },
          {
            "text": "                            else:",
            "lineNumber": 286
          },
          {
            "text": "                                st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 287
          },
          {
            "text": "                        except Exception as e:",
            "lineNumber": 288
          },
          {
            "text": "                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ",
            "lineNumber": 289
          }
        ]
      },
      "score": 0.14390699565410614
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\frontend\\index.html",
        "range": {
          "startPosition": {
            "line": 174
          },
          "endPosition": {
            "line": 217,
            "column": 7
          }
        },
        "contents": "        async function render(b64) {\n            const container = document.getElementById('graph');\n            try {\n                // Base64ã‚’UTF-8æ–‡å­—åˆ—ã«å¾©å·\n                const code = decodeURIComponent(escape(window.atob(b64)));\n                container.innerHTML = \"\";\n                \n                const id = \"m\" + Math.random().toString(36).substr(2, 9);\n                const { svg } = await mermaid.render(id, code);\n                container.innerHTML = svg;\n                \n                // SVGè¦ç´ ã‚’å–å¾—ã—ã¦æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ã¨ãƒãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯æ©Ÿèƒ½ã‚’è¿½åŠ \n                const svgElement = container.querySelector('svg');\n                if (svgElement) {\n                    // å°‘ã—é…å»¶ã‚’å…¥ã‚Œã¦DOMãŒå®Œå…¨ã«æ§‹ç¯‰ã•ã‚Œã‚‹ã®ã‚’å¾…ã¤\n                    setTimeout(() =&gt; {\n                        addCollapseFunctionality(svgElement);\n                        addNodeClickHandler(svgElement);\n                    }, 100);\n                }\n            } catch (e) {\n                container.innerHTML = &#96;&lt;pre style='color:red'&gt;Render Error: ${e.message}&lt;/pre&gt;&#96;;\n            }\n        }\n\n        window.addEventListener(\"message\", (event) =&gt; {\n            if (event.data.type === \"render\") {\n                render(event.data.base64Code);\n            }\n        });\n        \n        // Streamlitã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†\n        // Streamlitã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«å¾“ã†\n        if (window.parent) {\n            window.addEventListener(\"message\", (event) =&gt; {\n                // Streamlitã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†\n                if (event.data &amp;&amp; event.data.type === \"streamlit:render\") {\n                    // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‡¦ç†\n                }\n            });\n        }\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "        async function render(b64) {",
            "lineNumber": 175
          },
          {
            "text": "            const container = document.getElementById('graph');",
            "lineNumber": 176
          },
          {
            "text": "            try {",
            "lineNumber": 177
          },
          {
            "text": "                // Base64ã‚’UTF-8æ–‡å­—åˆ—ã«å¾©å·",
            "lineNumber": 178
          },
          {
            "text": "                const code = decodeURIComponent(escape(window.atob(b64)));",
            "lineNumber": 179
          },
          {
            "text": "                container.innerHTML = \"\";",
            "lineNumber": 180
          },
          {
            "text": "                ",
            "lineNumber": 181
          },
          {
            "text": "                const id = \"m\" + Math.random().toString(36).substr(2, 9);",
            "lineNumber": 182
          },
          {
            "text": "                const { svg } = await mermaid.render(id, code);",
            "lineNumber": 183
          },
          {
            "text": "                container.innerHTML = svg;",
            "lineNumber": 184
          },
          {
            "text": "                ",
            "lineNumber": 185
          },
          {
            "text": "                // SVGè¦ç´ ã‚’å–å¾—ã—ã¦æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ã¨ãƒãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯æ©Ÿèƒ½ã‚’è¿½åŠ ",
            "lineNumber": 186
          },
          {
            "text": "                const svgElement = container.querySelector('svg');",
            "lineNumber": 187
          },
          {
            "text": "                if (svgElement) {",
            "lineNumber": 188
          },
          {
            "text": "                    // å°‘ã—é…å»¶ã‚’å…¥ã‚Œã¦DOMãŒå®Œå…¨ã«æ§‹ç¯‰ã•ã‚Œã‚‹ã®ã‚’å¾…ã¤",
            "lineNumber": 189
          },
          {
            "text": "                    setTimeout(() =&gt; {",
            "lineNumber": 190
          },
          {
            "text": "                        addCollapseFunctionality(svgElement);",
            "lineNumber": 191
          },
          {
            "text": "                        addNodeClickHandler(svgElement);",
            "lineNumber": 192
          },
          {
            "text": "                    }, 100);",
            "lineNumber": 193
          },
          {
            "text": "                }",
            "lineNumber": 194
          },
          {
            "text": "            } catch (e) {",
            "lineNumber": 195
          },
          {
            "text": "                container.innerHTML = &#96;&lt;pre style='color:red'&gt;Render Error: ${e.message}&lt;/pre&gt;&#96;;",
            "lineNumber": 196
          },
          {
            "text": "            }",
            "lineNumber": 197
          },
          {
            "text": "        }",
            "lineNumber": 198
          },
          {
            "lineNumber": 199
          },
          {
            "text": "        window.addEventListener(\"message\", (event) =&gt; {",
            "lineNumber": 200
          },
          {
            "text": "            if (event.data.type === \"render\") {",
            "lineNumber": 201
          },
          {
            "text": "                render(event.data.base64Code);",
            "lineNumber": 202
          },
          {
            "text": "            }",
            "lineNumber": 203
          },
          {
            "text": "        });",
            "lineNumber": 204
          },
          {
            "text": "        ",
            "lineNumber": 205
          },
          {
            "text": "        // Streamlitã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†",
            "lineNumber": 206
          },
          {
            "text": "        // Streamlitã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«å¾“ã†",
            "lineNumber": 207
          },
          {
            "text": "        if (window.parent) {",
            "lineNumber": 208
          },
          {
            "text": "            window.addEventListener(\"message\", (event) =&gt; {",
            "lineNumber": 209
          },
          {
            "text": "                // Streamlitã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†",
            "lineNumber": 210
          },
          {
            "text": "                if (event.data &amp;&amp; event.data.type === \"streamlit:render\") {",
            "lineNumber": 211
          },
          {
            "text": "                    // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‡¦ç†",
            "lineNumber": 212
          },
          {
            "text": "                }",
            "lineNumber": 213
          },
          {
            "text": "            });",
            "lineNumber": 214
          },
          {
            "text": "        }",
            "lineNumber": 215
          },
          {
            "text": "    &lt;/script&gt;",
            "lineNumber": 216
          },
          {
            "text": "&lt;/body&gt;",
            "lineNumber": 217
          },
          {
            "text": "&lt;/html&gt;",
            "lineNumber": 218
          }
        ]
      },
      "score": 0.14293040335178375
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\llm_client.py",
        "range": {
          "startPosition": {
            "line": 8
          },
          "endPosition": {
            "line": 395
          }
        },
        "contents": "class LLMClient:\ndef generate_partial_change(\n        self, \n        user_input: str, \n        target_flowchart: Flowchart,\n        full_flowchart: Flowchart\n    ) -&gt; str:\n\n            }\n            \n            # localhostã¸ã®æ¥ç¶šã§ã¯ãƒ—ãƒ­ã‚­ã‚·ã‚’ä½¿ç”¨ã—ãªã„\n            proxies = {\"http\": None, \"https\": None} if \"localhost\" in self.base_url or \"127.0.0.1\" in self.base_url else None\n            \n            response = requests.post(\n                self.api_url,\n                json=payload,\n                timeout=300,\n                proxies=proxies\n            )\n            \n            response.raise_for_status()\n            result = response.json()\n            \n            if result and 'message' in result and 'content' in result['message']:\n                toon_text = result['message']['content']\n                \n                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼ï¼ˆè³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰\n                if not self.is_question_response(toon_text):\n                    is_valid, validation_message = self.validate_output_size(toon_text)\n                    if not is_valid:\n                        warning_comment = f\"&lt;!-- {validation_message} --&gt;\\n\"\n                        toon_text = warning_comment + toon_text\n                \n                return toon_text\n            else:\n                raise ValueError(\"ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰æœ‰åŠ¹ãªå¿œç­”ãŒå¾—ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚\")\n                \n        except ValueError:\n            raise\n        except requests.exceptions.ConnectionError as e:\n            raise LLMAPIError(\n                f\"Ollamaã¸ã®æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚\\n\"\n                f\"ç¢ºèªäº‹é …:\\n\"\n                f\"1. OllamaãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ï¼ˆ&#96;ollama serve&#96;ã¾ãŸã¯Ollamaã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ï¼‰\\n\"\n                f\"2. ãƒ™ãƒ¼ã‚¹URL: {self.base_url}\\n\"\n                f\"3. ãƒ¢ãƒ‡ãƒ«å: {self.model}ï¼ˆ&#96;ollama pull {self.model}&#96;ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼‰\\n\"\n                f\"4. ã‚¨ãƒ©ãƒ¼è©³ç´°: {str(e)}\"\n            ) from e\n        except requests.exceptions.Timeout as e:\n            raise LLMAPIError(\n                f\"",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 9,
                "column": 1
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 145,
                "column": 5
              },
              "endPosition": {
                "line": 151,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class LLMClient:",
            "lineNumber": 9,
            "isSignature": true
          },
          {
            "text": "def generate_partial_change(",
            "lineNumber": 145
          },
          {
            "text": "        self, ",
            "lineNumber": 146
          },
          {
            "text": "        user_input: str, ",
            "lineNumber": 147
          },
          {
            "text": "        target_flowchart: Flowchart,",
            "lineNumber": 148
          },
          {
            "text": "        full_flowchart: Flowchart",
            "lineNumber": 149
          },
          {
            "text": "    ) -&gt; str:",
            "lineNumber": 150
          },
          {
            "lineNumber": 195
          },
          {
            "text": "            }",
            "lineNumber": 196
          },
          {
            "text": "            ",
            "lineNumber": 197
          },
          {
            "text": "            # localhostã¸ã®æ¥ç¶šã§ã¯ãƒ—ãƒ­ã‚­ã‚·ã‚’ä½¿ç”¨ã—ãªã„",
            "lineNumber": 198
          },
          {
            "text": "            proxies = {\"http\": None, \"https\": None} if \"localhost\" in self.base_url or \"127.0.0.1\" in self.base_url else None",
            "lineNumber": 199
          },
          {
            "text": "            ",
            "lineNumber": 200
          },
          {
            "text": "            response = requests.post(",
            "lineNumber": 201
          },
          {
            "text": "                self.api_url,",
            "lineNumber": 202
          },
          {
            "text": "                json=payload,",
            "lineNumber": 203
          },
          {
            "text": "                timeout=300,",
            "lineNumber": 204
          },
          {
            "text": "                proxies=proxies",
            "lineNumber": 205
          },
          {
            "text": "            )",
            "lineNumber": 206
          },
          {
            "text": "            ",
            "lineNumber": 207
          },
          {
            "text": "            response.raise_for_status()",
            "lineNumber": 208
          },
          {
            "text": "            result = response.json()",
            "lineNumber": 209
          },
          {
            "text": "            ",
            "lineNumber": 210
          },
          {
            "text": "            if result and 'message' in result and 'content' in result['message']:",
            "lineNumber": 211
          },
          {
            "text": "                toon_text = result['message']['content']",
            "lineNumber": 212
          },
          {
            "text": "                ",
            "lineNumber": 213
          },
          {
            "text": "                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼ï¼ˆè³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰",
            "lineNumber": 214
          },
          {
            "text": "                if not self.is_question_response(toon_text):",
            "lineNumber": 215
          },
          {
            "text": "                    is_valid, validation_message = self.validate_output_size(toon_text)",
            "lineNumber": 216
          },
          {
            "text": "                    if not is_valid:",
            "lineNumber": 217
          },
          {
            "text": "                        warning_comment = f\"&lt;!-- {validation_message} --&gt;\\n\"",
            "lineNumber": 218
          },
          {
            "text": "                        toon_text = warning_comment + toon_text",
            "lineNumber": 219
          },
          {
            "text": "                ",
            "lineNumber": 220
          },
          {
            "text": "                return toon_text",
            "lineNumber": 221
          },
          {
            "text": "            else:",
            "lineNumber": 222
          },
          {
            "text": "                raise ValueError(\"ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰æœ‰åŠ¹ãªå¿œç­”ãŒå¾—ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚\")",
            "lineNumber": 223
          },
          {
            "text": "                ",
            "lineNumber": 224
          },
          {
            "text": "        except ValueError:",
            "lineNumber": 225
          },
          {
            "text": "            raise",
            "lineNumber": 226
          },
          {
            "text": "        except requests.exceptions.ConnectionError as e:",
            "lineNumber": 227
          },
          {
            "text": "            raise LLMAPIError(",
            "lineNumber": 228
          },
          {
            "text": "                f\"Ollamaã¸ã®æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚\\n\"",
            "lineNumber": 229
          },
          {
            "text": "                f\"ç¢ºèªäº‹é …:\\n\"",
            "lineNumber": 230
          },
          {
            "text": "                f\"1. OllamaãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ï¼ˆ&#96;ollama serve&#96;ã¾ãŸã¯Ollamaã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ï¼‰\\n\"",
            "lineNumber": 231
          },
          {
            "text": "                f\"2. ãƒ™ãƒ¼ã‚¹URL: {self.base_url}\\n\"",
            "lineNumber": 232
          },
          {
            "text": "                f\"3. ãƒ¢ãƒ‡ãƒ«å: {self.model}ï¼ˆ&#96;ollama pull {self.model}&#96;ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼‰\\n\"",
            "lineNumber": 233
          },
          {
            "text": "                f\"4. ã‚¨ãƒ©ãƒ¼è©³ç´°: {str(e)}\"",
            "lineNumber": 234
          },
          {
            "text": "            ) from e",
            "lineNumber": 235
          },
          {
            "text": "        except requests.exceptions.Timeout as e:",
            "lineNumber": 236
          },
          {
            "text": "            raise LLMAPIError(",
            "lineNumber": 237
          },
          {
            "text": "                f\"",
            "lineNumber": 238
          }
        ]
      },
      "score": 0.13961774110794067
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 229,
            "column": 42
          },
          "endPosition": {
            "line": 259,
            "column": 75
          }
        },
        "contents": "                            else:\n                                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼\n                                is_valid, validation_message = client.validate_output_size(raw_toon_text)\n                                if not is_valid:\n                                    st.warning(validation_message)\n                                    st.info(\"ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã‹ã€ãƒ•ãƒ­ãƒ¼ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\")\n                                \n                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹æˆåŠŸæ™‚ã®ã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ\n                                st.session_state.conversation_context = None\n                                st.session_state.pending_questions = None\n                                st.session_state.question_responses = []\n                                \n                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹\n                                new_flow = TOONParser.parse(raw_toon_text)\n                                \n                                # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨\n                                new_flow = new_flow.apply_logic_gap_detection()\n                                \n                                # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ\n                                if append_mode_flag:\n                                    merged_flow = history_mgr.append_toon_log(session_name, new_flow)\n                                    st.session_state.history.append(merged_flow)\n                                    st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")\n                                else:\n                                    # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ \n                                    st.session_state.history.append(new_flow)\n                            \n                            st.rerun()\n                        except LLMAPIError as e:\n                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                            else:",
            "lineNumber": 231
          },
          {
            "text": "                                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼",
            "lineNumber": 232
          },
          {
            "text": "                                is_valid, validation_message = client.validate_output_size(raw_toon_text)",
            "lineNumber": 233
          },
          {
            "text": "                                if not is_valid:",
            "lineNumber": 234
          },
          {
            "text": "                                    st.warning(validation_message)",
            "lineNumber": 235
          },
          {
            "text": "                                    st.info(\"ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã‹ã€ãƒ•ãƒ­ãƒ¼ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 236
          },
          {
            "text": "                                ",
            "lineNumber": 237
          },
          {
            "text": "                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹æˆåŠŸæ™‚ã®ã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ",
            "lineNumber": 238
          },
          {
            "text": "                                st.session_state.conversation_context = None",
            "lineNumber": 239
          },
          {
            "text": "                                st.session_state.pending_questions = None",
            "lineNumber": 240
          },
          {
            "text": "                                st.session_state.question_responses = []",
            "lineNumber": 241
          },
          {
            "text": "                                ",
            "lineNumber": 242
          },
          {
            "text": "                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹",
            "lineNumber": 243
          },
          {
            "text": "                                new_flow = TOONParser.parse(raw_toon_text)",
            "lineNumber": 244
          },
          {
            "text": "                                ",
            "lineNumber": 245
          },
          {
            "text": "                                # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨",
            "lineNumber": 246
          },
          {
            "text": "                                new_flow = new_flow.apply_logic_gap_detection()",
            "lineNumber": 247
          },
          {
            "text": "                                ",
            "lineNumber": 248
          },
          {
            "text": "                                # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ",
            "lineNumber": 249
          },
          {
            "text": "                                if append_mode_flag:",
            "lineNumber": 250
          },
          {
            "text": "                                    merged_flow = history_mgr.append_toon_log(session_name, new_flow)",
            "lineNumber": 251
          },
          {
            "text": "                                    st.session_state.history.append(merged_flow)",
            "lineNumber": 252
          },
          {
            "text": "                                    st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")",
            "lineNumber": 253
          },
          {
            "text": "                                else:",
            "lineNumber": 254
          },
          {
            "text": "                                    # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ ",
            "lineNumber": 255
          },
          {
            "text": "                                    st.session_state.history.append(new_flow)",
            "lineNumber": 256
          },
          {
            "text": "                            ",
            "lineNumber": 257
          },
          {
            "text": "                            st.rerun()",
            "lineNumber": 258
          },
          {
            "text": "                        except LLMAPIError as e:",
            "lineNumber": 259
          },
          {
            "text": "                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ",
            "lineNumber": 260
          }
        ]
      },
      "score": 0.1394195556640625
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 587,
            "column": 100
          },
          "endPosition": {
            "line": 628,
            "column": 28
          }
        },
        "contents": "                        else:\n                            # 2. LLMã«éƒ¨åˆ†å¤‰æ›´ã‚’ä¾é ¼\n                            client = LLMClient()\n                            changed_toon = client.generate_partial_change(\n                                change_instruction,\n                                partial_flowchart,\n                                current_flow\n                            )\n                            \n                            # 3. å¤‰æ›´çµæœã‚’ãƒ‘ãƒ¼ã‚¹\n                            parser = TOONParser()\n                            changed_partial = parser.parse(changed_toon)\n                            \n                            # 4. å…¨ä½“ãƒ•ãƒ­ãƒ¼ã«ãƒãƒ¼ã‚¸\n                            merged_flowchart = FlowMerger.merge_partial_change(\n                                current_flow,\n                                changed_partial,\n                                selected_node_ids\n                            )\n                            \n                            # 5. å±¥æ­´ã«è¿½åŠ \n                            history_mgr.append_toon_log(\n                                session_name,\n                                merged_flowchart\n                            )\n                            \n                            # 6. ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°\n                            st.session_state.history = history_mgr.load_history(session_name)\n                            st.session_state.selected_node_ids = []  # é¸æŠã‚’ã‚¯ãƒªã‚¢\n                            \n                            st.success(\"é¸æŠç¯„å›²ã®å¤‰æ›´ãŒå®Œäº†ã—ã¾ã—ãŸï¼\")\n                            st.rerun()\n                            \n                except LLMAPIError as e:\n                    st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {str(e)}\")\n                except TOONParseError as e:\n                    st.error(f\"TOONè§£æã‚¨ãƒ©ãƒ¼: {str(e)}\")\n                except FlowchartValidationError as e:\n                    st.error(f\"ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆæ¤œè¨¼ã‚¨ãƒ©ãƒ¼: {str(e)}\")\n                except Exception as e:\n                    st.error",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                        else:",
            "lineNumber": 589
          },
          {
            "text": "                            # 2. LLMã«éƒ¨åˆ†å¤‰æ›´ã‚’ä¾é ¼",
            "lineNumber": 590
          },
          {
            "text": "                            client = LLMClient()",
            "lineNumber": 591
          },
          {
            "text": "                            changed_toon = client.generate_partial_change(",
            "lineNumber": 592
          },
          {
            "text": "                                change_instruction,",
            "lineNumber": 593
          },
          {
            "text": "                                partial_flowchart,",
            "lineNumber": 594
          },
          {
            "text": "                                current_flow",
            "lineNumber": 595
          },
          {
            "text": "                            )",
            "lineNumber": 596
          },
          {
            "text": "                            ",
            "lineNumber": 597
          },
          {
            "text": "                            # 3. å¤‰æ›´çµæœã‚’ãƒ‘ãƒ¼ã‚¹",
            "lineNumber": 598
          },
          {
            "text": "                            parser = TOONParser()",
            "lineNumber": 599
          },
          {
            "text": "                            changed_partial = parser.parse(changed_toon)",
            "lineNumber": 600
          },
          {
            "text": "                            ",
            "lineNumber": 601
          },
          {
            "text": "                            # 4. å…¨ä½“ãƒ•ãƒ­ãƒ¼ã«ãƒãƒ¼ã‚¸",
            "lineNumber": 602
          },
          {
            "text": "                            merged_flowchart = FlowMerger.merge_partial_change(",
            "lineNumber": 603
          },
          {
            "text": "                                current_flow,",
            "lineNumber": 604
          },
          {
            "text": "                                changed_partial,",
            "lineNumber": 605
          },
          {
            "text": "                                selected_node_ids",
            "lineNumber": 606
          },
          {
            "text": "                            )",
            "lineNumber": 607
          },
          {
            "text": "                            ",
            "lineNumber": 608
          },
          {
            "text": "                            # 5. å±¥æ­´ã«è¿½åŠ ",
            "lineNumber": 609
          },
          {
            "text": "                            history_mgr.append_toon_log(",
            "lineNumber": 610
          },
          {
            "text": "                                session_name,",
            "lineNumber": 611
          },
          {
            "text": "                                merged_flowchart",
            "lineNumber": 612
          },
          {
            "text": "                            )",
            "lineNumber": 613
          },
          {
            "text": "                            ",
            "lineNumber": 614
          },
          {
            "text": "                            # 6. ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°",
            "lineNumber": 615
          },
          {
            "text": "                            st.session_state.history = history_mgr.load_history(session_name)",
            "lineNumber": 616
          },
          {
            "text": "                            st.session_state.selected_node_ids = []  # é¸æŠã‚’ã‚¯ãƒªã‚¢",
            "lineNumber": 617
          },
          {
            "text": "                            ",
            "lineNumber": 618
          },
          {
            "text": "                            st.success(\"é¸æŠç¯„å›²ã®å¤‰æ›´ãŒå®Œäº†ã—ã¾ã—ãŸï¼\")",
            "lineNumber": 619
          },
          {
            "text": "                            st.rerun()",
            "lineNumber": 620
          },
          {
            "text": "                            ",
            "lineNumber": 621
          },
          {
            "text": "                except LLMAPIError as e:",
            "lineNumber": 622
          },
          {
            "text": "                    st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {str(e)}\")",
            "lineNumber": 623
          },
          {
            "text": "                except TOONParseError as e:",
            "lineNumber": 624
          },
          {
            "text": "                    st.error(f\"TOONè§£æã‚¨ãƒ©ãƒ¼: {str(e)}\")",
            "lineNumber": 625
          },
          {
            "text": "                except FlowchartValidationError as e:",
            "lineNumber": 626
          },
          {
            "text": "                    st.error(f\"ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆæ¤œè¨¼ã‚¨ãƒ©ãƒ¼: {str(e)}\")",
            "lineNumber": 627
          },
          {
            "text": "                except Exception as e:",
            "lineNumber": 628
          },
          {
            "text": "                    st.error",
            "lineNumber": 629
          }
        ]
      },
      "score": 0.13681763410568237
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\flow.md",
        "range": {
          "startPosition": {
            "line": 172
          },
          "endPosition": {
            "line": 213
          }
        },
        "contents": "    %% ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\n    subgraph flow2 [\"ç‰‡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]\n        check13_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check13_2{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check13_2_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task13_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        check11_2[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check11_2{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check11_2_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task11_2[\"PGåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        check12_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check12_2{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check12_2_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task12_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        task10_2[\"æµå‹•ã«æˆ»ã™\"]\n        decision1_2{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n        \n        task6--&gt;check13_2\n        check13_2--&gt;decision_check13_2\n        decision_check13_2--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check13_2_1\n        decision_check13_2--&gt;|\"åˆ¤å®šã§ããªã„\"|task13_2\n        decision_check13_2_1--&gt;|\"æ­£å¸¸\"|check11_2\n        decision_check13_2_1--&gt;|\"ç•°å¸¸\"|task13_2\n        task13_2--&gt;check11_2\n        check11_2--&gt;decision_check11_2\n        decision_check11_2--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check11_2_1\n        decision_check11_2--&gt;|\"åˆ¤å®šã§ããªã„\"|task11_2\n        decision_check11_2_1--&gt;|\"æ­£å¸¸\"|check12_2\n        decision_check11_2_1--&gt;|\"ç•°å¸¸\"|task11_2\n        task11_2--&gt;check12_2\n        check12_2--&gt;decision_check12_2\n        decision_check12_2--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check12_2_1\n        decision_check12_2--&gt;|\"åˆ¤å®šã§ããªã„\"|task12_2\n        decision_check12_2_1--&gt;|\"æ­£å¸¸\"|task10_2\n        decision_check12_2_1--&gt;|\"ç•°å¸¸\"|task12_2\n        task12_2--&gt;task10_2\n        task10_2--&gt;decision1_2\n        decision1_2--&gt;|\"å†ç¾ã—ãªã„\"|task10\n        decision1_2--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer\n    end\n    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "    %% ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 173
          },
          {
            "text": "    subgraph flow2 [\"ç‰‡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 174
          },
          {
            "text": "        check13_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 175
          },
          {
            "text": "        decision_check13_2{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 176
          },
          {
            "text": "        decision_check13_2_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 177
          },
          {
            "text": "        task13_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 178
          },
          {
            "text": "        check11_2[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 179
          },
          {
            "text": "        decision_check11_2{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 180
          },
          {
            "text": "        decision_check11_2_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 181
          },
          {
            "text": "        task11_2[\"PGåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 182
          },
          {
            "text": "        check12_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 183
          },
          {
            "text": "        decision_check12_2{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 184
          },
          {
            "text": "        decision_check12_2_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 185
          },
          {
            "text": "        task12_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 186
          },
          {
            "text": "        task10_2[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 187
          },
          {
            "text": "        decision1_2{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 188
          },
          {
            "text": "        ",
            "lineNumber": 189
          },
          {
            "text": "        task6--&gt;check13_2",
            "lineNumber": 190
          },
          {
            "text": "        check13_2--&gt;decision_check13_2",
            "lineNumber": 191
          },
          {
            "text": "        decision_check13_2--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check13_2_1",
            "lineNumber": 192
          },
          {
            "text": "        decision_check13_2--&gt;|\"åˆ¤å®šã§ããªã„\"|task13_2",
            "lineNumber": 193
          },
          {
            "text": "        decision_check13_2_1--&gt;|\"æ­£å¸¸\"|check11_2",
            "lineNumber": 194
          },
          {
            "text": "        decision_check13_2_1--&gt;|\"ç•°å¸¸\"|task13_2",
            "lineNumber": 195
          },
          {
            "text": "        task13_2--&gt;check11_2",
            "lineNumber": 196
          },
          {
            "text": "        check11_2--&gt;decision_check11_2",
            "lineNumber": 197
          },
          {
            "text": "        decision_check11_2--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check11_2_1",
            "lineNumber": 198
          },
          {
            "text": "        decision_check11_2--&gt;|\"åˆ¤å®šã§ããªã„\"|task11_2",
            "lineNumber": 199
          },
          {
            "text": "        decision_check11_2_1--&gt;|\"æ­£å¸¸\"|check12_2",
            "lineNumber": 200
          },
          {
            "text": "        decision_check11_2_1--&gt;|\"ç•°å¸¸\"|task11_2",
            "lineNumber": 201
          },
          {
            "text": "        task11_2--&gt;check12_2",
            "lineNumber": 202
          },
          {
            "text": "        check12_2--&gt;decision_check12_2",
            "lineNumber": 203
          },
          {
            "text": "        decision_check12_2--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check12_2_1",
            "lineNumber": 204
          },
          {
            "text": "        decision_check12_2--&gt;|\"åˆ¤å®šã§ããªã„\"|task12_2",
            "lineNumber": 205
          },
          {
            "text": "        decision_check12_2_1--&gt;|\"æ­£å¸¸\"|task10_2",
            "lineNumber": 206
          },
          {
            "text": "        decision_check12_2_1--&gt;|\"ç•°å¸¸\"|task12_2",
            "lineNumber": 207
          },
          {
            "text": "        task12_2--&gt;task10_2",
            "lineNumber": 208
          },
          {
            "text": "        task10_2--&gt;decision1_2",
            "lineNumber": 209
          },
          {
            "text": "        decision1_2--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 210
          },
          {
            "text": "        decision1_2--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer",
            "lineNumber": 211
          },
          {
            "text": "    end",
            "lineNumber": 212
          },
          {
            "text": "    ",
            "lineNumber": 213
          }
        ]
      },
      "score": 0.13630230724811554
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 213,
            "column": 79
          },
          "endPosition": {
            "line": 232,
            "column": 60
          }
        },
        "contents": "                    \n                    # å†é€ä¿¡å‡¦ç†\n                    with st.spinner(\"LLMãŒãƒ•ãƒ­ãƒ¼ã‚’è¨­è¨ˆä¸­...\"):\n                        raw_toon_text = \"\"\n                        try:\n                            client = LLMClient()\n                            raw_toon_text = client.generate_flow(combined_prompt, current_flow if append_mode_flag else None)\n                            \n                            # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯\n                            if client.is_question_response(raw_toon_text):\n                                # å†åº¦è³ªå•ãŒæ¥ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°\n                                st.session_state.conversation_context = combined_prompt\n                                st.session_state.pending_questions = raw_toon_text\n                                st.session_state.question_responses = []  # æ–°ã—ã„è³ªå•ãªã®ã§å›ç­”ã‚’ãƒªã‚»ãƒƒãƒˆ\n                                st.info(\"LLMã‹ã‚‰è¿½åŠ ã®è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n                                st.rerun()\n                            else:\n                                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼\n                                is_valid, validation_message",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                    ",
            "lineNumber": 215
          },
          {
            "text": "                    # å†é€ä¿¡å‡¦ç†",
            "lineNumber": 216
          },
          {
            "text": "                    with st.spinner(\"LLMãŒãƒ•ãƒ­ãƒ¼ã‚’è¨­è¨ˆä¸­...\"):",
            "lineNumber": 217
          },
          {
            "text": "                        raw_toon_text = \"\"",
            "lineNumber": 218
          },
          {
            "text": "                        try:",
            "lineNumber": 219
          },
          {
            "text": "                            client = LLMClient()",
            "lineNumber": 220
          },
          {
            "text": "                            raw_toon_text = client.generate_flow(combined_prompt, current_flow if append_mode_flag else None)",
            "lineNumber": 221
          },
          {
            "text": "                            ",
            "lineNumber": 222
          },
          {
            "text": "                            # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 223
          },
          {
            "text": "                            if client.is_question_response(raw_toon_text):",
            "lineNumber": 224
          },
          {
            "text": "                                # å†åº¦è³ªå•ãŒæ¥ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°",
            "lineNumber": 225
          },
          {
            "text": "                                st.session_state.conversation_context = combined_prompt",
            "lineNumber": 226
          },
          {
            "text": "                                st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 227
          },
          {
            "text": "                                st.session_state.question_responses = []  # æ–°ã—ã„è³ªå•ãªã®ã§å›ç­”ã‚’ãƒªã‚»ãƒƒãƒˆ",
            "lineNumber": 228
          },
          {
            "text": "                                st.info(\"LLMã‹ã‚‰è¿½åŠ ã®è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 229
          },
          {
            "text": "                                st.rerun()",
            "lineNumber": 230
          },
          {
            "text": "                            else:",
            "lineNumber": 231
          },
          {
            "text": "                                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼",
            "lineNumber": 232
          },
          {
            "text": "                                is_valid, validation_message",
            "lineNumber": 233
          }
        ]
      },
      "score": 0.13599449396133423
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\storage\\toon_files\\flow_md.md",
        "range": {
          "startPosition": {
            "line": 45
          },
          "endPosition": {
            "line": 87
          }
        },
        "contents": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other\n    \n    %% ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã¸ã®é€£çµ¡ï¼ˆå…¨ãƒ¢ãƒ¼ãƒ‰å…±é€šï¼‰\n    contact_manufacturer[\"ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã«é€£çµ¡\"]\n    \n    %% å†ç¾ã—ãªã‹ã£ãŸJARVISãŒ1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸå ´åˆã®ç¹°ã‚Šè¿”ã—å‡¦ç†ãƒ•ãƒ­ãƒ¼\n    subgraph flow5 [\"å†ç™ºæ™‚ã®æ®µéšçš„å¯¾å¿œãƒ•ãƒ­ãƒ¼\"]\n        check9_1[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check9_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check9_1_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task9_1[\"PGåŸºæ¿ã‚’äº¤æ›\"]\n        task9_2[\"æµå‹•ã«æˆ»ã™\"]\n        decision9_1{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}\n        check9_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check9_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check9_3_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task9_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›\"]\n        task9_4[\"æµå‹•ã«æˆ»ã™\"]\n        decision9_2{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}\n        check9_5[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check9_5{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check9_5_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task9_5[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›\"]\n        task9_6[\"æµå‹•ã«æˆ»ã™\"]\n        decision9_3{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}\n        check9_7[\"å†…éƒ¨ã®FFCã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check9_7{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check9_7_1{\"å†…éƒ¨ã®FFCã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task9_7[\"å†…éƒ¨ã®FFCã‚’äº¤æ›\"]\n        task9_8[\"æµå‹•ã«æˆ»ã™\"]\n        decision9_4{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}\n        task9_9[\"æ‹…å½“ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã«é€£çµ¡\"]\n        \n        task9--&gt;check9_1\n        check9_1--&gt;decision_check9_1\n        decision_check9_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_1_1\n        decision_check9_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_1\n        decision_check9_1_1--&gt;|\"æ­£å¸¸\"|task9_2\n        decision_check9_1_1--&gt;|\"ç•°å¸¸\"|task9_1\n        task9_1--&gt;task9_2\n        task9_2--&gt;decision9_1\n        decision9_1--&gt;|\"å‡ºã¦ããŸ\"|check9_3",
        "signatures": {},
        "detailedLines": [
          {
            "text": "    decision2--&gt;|\"4ï¼šã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„\"|task_other",
            "lineNumber": 46
          },
          {
            "text": "    ",
            "lineNumber": 47
          },
          {
            "text": "    %% ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã¸ã®é€£çµ¡ï¼ˆå…¨ãƒ¢ãƒ¼ãƒ‰å…±é€šï¼‰",
            "lineNumber": 48
          },
          {
            "text": "    contact_manufacturer[\"ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã«é€£çµ¡\"]",
            "lineNumber": 49
          },
          {
            "text": "    ",
            "lineNumber": 50
          },
          {
            "text": "    %% å†ç¾ã—ãªã‹ã£ãŸJARVISãŒ1é€±é–“ä»¥å†…ã«å†åº¦å‡ºã¦ããŸå ´åˆã®ç¹°ã‚Šè¿”ã—å‡¦ç†ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 51
          },
          {
            "text": "    subgraph flow5 [\"å†ç™ºæ™‚ã®æ®µéšçš„å¯¾å¿œãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 52
          },
          {
            "text": "        check9_1[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 53
          },
          {
            "text": "        decision_check9_1{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 54
          },
          {
            "text": "        decision_check9_1_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 55
          },
          {
            "text": "        task9_1[\"PGåŸºæ¿ã‚’äº¤æ›\"]",
            "lineNumber": 56
          },
          {
            "text": "        task9_2[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 57
          },
          {
            "text": "        decision9_1{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}",
            "lineNumber": 58
          },
          {
            "text": "        check9_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 59
          },
          {
            "text": "        decision_check9_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 60
          },
          {
            "text": "        decision_check9_3_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 61
          },
          {
            "text": "        task9_3[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›\"]",
            "lineNumber": 62
          },
          {
            "text": "        task9_4[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 63
          },
          {
            "text": "        decision9_2{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}",
            "lineNumber": 64
          },
          {
            "text": "        check9_5[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 65
          },
          {
            "text": "        decision_check9_5{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 66
          },
          {
            "text": "        decision_check9_5_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 67
          },
          {
            "text": "        task9_5[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›\"]",
            "lineNumber": 68
          },
          {
            "text": "        task9_6[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 69
          },
          {
            "text": "        decision9_3{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}",
            "lineNumber": 70
          },
          {
            "text": "        check9_7[\"å†…éƒ¨ã®FFCã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 71
          },
          {
            "text": "        decision_check9_7{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 72
          },
          {
            "text": "        decision_check9_7_1{\"å†…éƒ¨ã®FFCã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 73
          },
          {
            "text": "        task9_7[\"å†…éƒ¨ã®FFCã‚’äº¤æ›\"]",
            "lineNumber": 74
          },
          {
            "text": "        task9_8[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 75
          },
          {
            "text": "        decision9_4{\"ã¾ãŸå‡ºã¦ããŸã‹ï¼Ÿ\"}",
            "lineNumber": 76
          },
          {
            "text": "        task9_9[\"æ‹…å½“ãƒ¡ãƒ¼ã‚«ãƒ»æ‹…å½“è€…ã«é€£çµ¡\"]",
            "lineNumber": 77
          },
          {
            "text": "        ",
            "lineNumber": 78
          },
          {
            "text": "        task9--&gt;check9_1",
            "lineNumber": 79
          },
          {
            "text": "        check9_1--&gt;decision_check9_1",
            "lineNumber": 80
          },
          {
            "text": "        decision_check9_1--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check9_1_1",
            "lineNumber": 81
          },
          {
            "text": "        decision_check9_1--&gt;|\"åˆ¤å®šã§ããªã„\"|task9_1",
            "lineNumber": 82
          },
          {
            "text": "        decision_check9_1_1--&gt;|\"æ­£å¸¸\"|task9_2",
            "lineNumber": 83
          },
          {
            "text": "        decision_check9_1_1--&gt;|\"ç•°å¸¸\"|task9_1",
            "lineNumber": 84
          },
          {
            "text": "        task9_1--&gt;task9_2",
            "lineNumber": 85
          },
          {
            "text": "        task9_2--&gt;decision9_1",
            "lineNumber": 86
          },
          {
            "text": "        decision9_1--&gt;|\"å‡ºã¦ããŸ\"|check9_3",
            "lineNumber": 87
          }
        ]
      },
      "score": 0.13339540362358093
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\flow.md",
        "range": {
          "startPosition": {
            "line": 210
          },
          "endPosition": {
            "line": 235
          }
        },
        "contents": "        decision1_2--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer\n    end\n    \n    %% ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\n    subgraph flow3 [\"æ”¹å–„ã•ã‚Œãªã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]\n        task14_1[\"JARVISå†…éƒ¨ã®FFCã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]\n        task15_1[\"è£å´ã®ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]\n        task16_1[\"JARVISå†…éƒ¨ã®ã‚±ãƒ¼ãƒ–ãƒ«ã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]\n        task17_1[\"MK.â…¡(ä¿¡å·ç™ºç”Ÿæ©Ÿ)ã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„ã€‚\"]\n        task10_3[\"æµå‹•ã«æˆ»ã™\"]\n        decision1_3{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n        task7--&gt;task14_1\n        task14_1--&gt;task15_1\n        task15_1--&gt;task16_1\n        task16_1--&gt;task17_1\n        task17_1--&gt;task10_3\n        task10_3--&gt;decision1_3\n        decision1_3--&gt;|\"å†ç¾ã—ãªã„\"|task10\n        decision1_3--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer\n    end\n    \n    %% ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\n    subgraph flow4 [\"ãƒ‡ãƒ¼ã‚¿ç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]\n        check11_3[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check11_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "        decision1_2--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer",
            "lineNumber": 211
          },
          {
            "text": "    end",
            "lineNumber": 212
          },
          {
            "text": "    ",
            "lineNumber": 213
          },
          {
            "text": "    %% ä¸¡å´ãƒ»ç‰‡å´ã®å¯¾å¿œã‚’ã—ã¦ã‚‚æ”¹å–„ã•ã‚Œãªã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 214
          },
          {
            "text": "    subgraph flow3 [\"æ”¹å–„ã•ã‚Œãªã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 215
          },
          {
            "text": "        task14_1[\"JARVISå†…éƒ¨ã®FFCã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]",
            "lineNumber": 216
          },
          {
            "text": "        task15_1[\"è£å´ã®ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]",
            "lineNumber": 217
          },
          {
            "text": "        task16_1[\"JARVISå†…éƒ¨ã®ã‚±ãƒ¼ãƒ–ãƒ«ã‚’äº¤æ›ã—ã¦ãã ã•ã„ã€‚\"]",
            "lineNumber": 218
          },
          {
            "text": "        task17_1[\"MK.â…¡(ä¿¡å·ç™ºç”Ÿæ©Ÿ)ã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„ã€‚\"]",
            "lineNumber": 219
          },
          {
            "text": "        task10_3[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 220
          },
          {
            "text": "        decision1_3{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 221
          },
          {
            "text": "        task7--&gt;task14_1",
            "lineNumber": 222
          },
          {
            "text": "        task14_1--&gt;task15_1",
            "lineNumber": 223
          },
          {
            "text": "        task15_1--&gt;task16_1",
            "lineNumber": 224
          },
          {
            "text": "        task16_1--&gt;task17_1",
            "lineNumber": 225
          },
          {
            "text": "        task17_1--&gt;task10_3",
            "lineNumber": 226
          },
          {
            "text": "        task10_3--&gt;decision1_3",
            "lineNumber": 227
          },
          {
            "text": "        decision1_3--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 228
          },
          {
            "text": "        decision1_3--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer",
            "lineNumber": 229
          },
          {
            "text": "    end",
            "lineNumber": 230
          },
          {
            "text": "    ",
            "lineNumber": 231
          },
          {
            "text": "    %% ãƒ‡ãƒ¼ã‚¿ãŒãŠã‹ã—ã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 232
          },
          {
            "text": "    subgraph flow4 [\"ãƒ‡ãƒ¼ã‚¿ç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 233
          },
          {
            "text": "        check11_3[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 234
          },
          {
            "text": "        decision_check11_3{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 235
          }
        ]
      },
      "score": 0.13068559765815735
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\storage\\toon_files\\flow_md.md",
        "range": {
          "startPosition": {
            "line": 172
          },
          "endPosition": {
            "line": 213
          }
        },
        "contents": "    %% ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\n    subgraph flow2 [\"ç‰‡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]\n        check13_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check13_2{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check13_2_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task13_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        check11_2[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check11_2{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check11_2_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task11_2[\"PGåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        check12_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]\n        decision_check12_2{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}\n        decision_check12_2_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}\n        task12_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]\n        task10_2[\"æµå‹•ã«æˆ»ã™\"]\n        decision1_2{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}\n        \n        task6--&gt;check13_2\n        check13_2--&gt;decision_check13_2\n        decision_check13_2--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check13_2_1\n        decision_check13_2--&gt;|\"åˆ¤å®šã§ããªã„\"|task13_2\n        decision_check13_2_1--&gt;|\"æ­£å¸¸\"|check11_2\n        decision_check13_2_1--&gt;|\"ç•°å¸¸\"|task13_2\n        task13_2--&gt;check11_2\n        check11_2--&gt;decision_check11_2\n        decision_check11_2--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check11_2_1\n        decision_check11_2--&gt;|\"åˆ¤å®šã§ããªã„\"|task11_2\n        decision_check11_2_1--&gt;|\"æ­£å¸¸\"|check12_2\n        decision_check11_2_1--&gt;|\"ç•°å¸¸\"|task11_2\n        task11_2--&gt;check12_2\n        check12_2--&gt;decision_check12_2\n        decision_check12_2--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check12_2_1\n        decision_check12_2--&gt;|\"åˆ¤å®šã§ããªã„\"|task12_2\n        decision_check12_2_1--&gt;|\"æ­£å¸¸\"|task10_2\n        decision_check12_2_1--&gt;|\"ç•°å¸¸\"|task12_2\n        task12_2--&gt;task10_2\n        task10_2--&gt;decision1_2\n        decision1_2--&gt;|\"å†ç¾ã—ãªã„\"|task10\n        decision1_2--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer\n    end\n    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "    %% ç‰‡å´ã®è¡¨ç¤ºãŒãŠã‹ã—ã„å ´åˆã®å‡¦ç†ãƒ•ãƒ­ãƒ¼",
            "lineNumber": 173
          },
          {
            "text": "    subgraph flow2 [\"ç‰‡å´è¡¨ç¤ºç•°å¸¸ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼\"]",
            "lineNumber": 174
          },
          {
            "text": "        check13_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 175
          },
          {
            "text": "        decision_check13_2{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 176
          },
          {
            "text": "        decision_check13_2_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 177
          },
          {
            "text": "        task13_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ³ã‚¿ã‚¯ãƒˆåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 178
          },
          {
            "text": "        check11_2[\"PGåŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 179
          },
          {
            "text": "        decision_check11_2{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 180
          },
          {
            "text": "        decision_check11_2_1{\"PGåŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 181
          },
          {
            "text": "        task11_2[\"PGåŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 182
          },
          {
            "text": "        check12_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’ãƒã‚§ãƒƒã‚¯\"]",
            "lineNumber": 183
          },
          {
            "text": "        decision_check12_2{\"çŠ¶æ…‹ã‚’åˆ¤å®šã§ãã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 184
          },
          {
            "text": "        decision_check12_2_1{\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã¯æ­£å¸¸ã‹ï¼Ÿ\"}",
            "lineNumber": 185
          },
          {
            "text": "        task12_2[\"ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒœãƒ¼ãƒ‰åŸºæ¿ã‚’äº¤æ›ã™ã‚‹\"]",
            "lineNumber": 186
          },
          {
            "text": "        task10_2[\"æµå‹•ã«æˆ»ã™\"]",
            "lineNumber": 187
          },
          {
            "text": "        decision1_2{\"ç—‡çŠ¶ãŒå†ç¾ã™ã‚‹ã‹ï¼Ÿ\"}",
            "lineNumber": 188
          },
          {
            "text": "        ",
            "lineNumber": 189
          },
          {
            "text": "        task6--&gt;check13_2",
            "lineNumber": 190
          },
          {
            "text": "        check13_2--&gt;decision_check13_2",
            "lineNumber": 191
          },
          {
            "text": "        decision_check13_2--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check13_2_1",
            "lineNumber": 192
          },
          {
            "text": "        decision_check13_2--&gt;|\"åˆ¤å®šã§ããªã„\"|task13_2",
            "lineNumber": 193
          },
          {
            "text": "        decision_check13_2_1--&gt;|\"æ­£å¸¸\"|check11_2",
            "lineNumber": 194
          },
          {
            "text": "        decision_check13_2_1--&gt;|\"ç•°å¸¸\"|task13_2",
            "lineNumber": 195
          },
          {
            "text": "        task13_2--&gt;check11_2",
            "lineNumber": 196
          },
          {
            "text": "        check11_2--&gt;decision_check11_2",
            "lineNumber": 197
          },
          {
            "text": "        decision_check11_2--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check11_2_1",
            "lineNumber": 198
          },
          {
            "text": "        decision_check11_2--&gt;|\"åˆ¤å®šã§ããªã„\"|task11_2",
            "lineNumber": 199
          },
          {
            "text": "        decision_check11_2_1--&gt;|\"æ­£å¸¸\"|check12_2",
            "lineNumber": 200
          },
          {
            "text": "        decision_check11_2_1--&gt;|\"ç•°å¸¸\"|task11_2",
            "lineNumber": 201
          },
          {
            "text": "        task11_2--&gt;check12_2",
            "lineNumber": 202
          },
          {
            "text": "        check12_2--&gt;decision_check12_2",
            "lineNumber": 203
          },
          {
            "text": "        decision_check12_2--&gt;|\"åˆ¤å®šã§ãã‚‹\"|decision_check12_2_1",
            "lineNumber": 204
          },
          {
            "text": "        decision_check12_2--&gt;|\"åˆ¤å®šã§ããªã„\"|task12_2",
            "lineNumber": 205
          },
          {
            "text": "        decision_check12_2_1--&gt;|\"æ­£å¸¸\"|task10_2",
            "lineNumber": 206
          },
          {
            "text": "        decision_check12_2_1--&gt;|\"ç•°å¸¸\"|task12_2",
            "lineNumber": 207
          },
          {
            "text": "        task12_2--&gt;task10_2",
            "lineNumber": 208
          },
          {
            "text": "        task10_2--&gt;decision1_2",
            "lineNumber": 209
          },
          {
            "text": "        decision1_2--&gt;|\"å†ç¾ã—ãªã„\"|task10",
            "lineNumber": 210
          },
          {
            "text": "        decision1_2--&gt;|\"å†ç¾ã™ã‚‹\"|contact_manufacturer",
            "lineNumber": 211
          },
          {
            "text": "    end",
            "lineNumber": 212
          },
          {
            "text": "    ",
            "lineNumber": 213
          }
        ]
      },
      "score": 0.12798480689525604
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---


åœæ­¢åŸå› ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã€ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªä¸­ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: app.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/llm_client.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "st\\.rerun|while|for.*in.*range|time\\.sleep",
  "path": "app.py",
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "st\\.rerun|while|for.*in.*range|time\\.sleep",
    "path": "app.py",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain": {
        "content": {
          "matches": [
            {
              "file": "app.py",
              "matches": [
                {
                  "lineNumber": 62,
                  "content": "        st.rerun()"
                },
                {
                  "lineNumber": 75,
                  "content": "                st.rerun()"
                },
                {
                  "lineNumber": 95,
                  "content": "                st.rerun()"
                },
                {
                  "lineNumber": 116,
                  "content": "                st.rerun()"
                },
                {
                  "lineNumber": 230,
                  "content": "                                st.rerun()"
                },
                {
                  "lineNumber": 258,
                  "content": "                            st.rerun()"
                },
                {
                  "lineNumber": 280,
                  "content": "                                    st.rerun()"
                },
                {
                  "lineNumber": 303,
                  "content": "                                        st.rerun()"
                },
                {
                  "lineNumber": 317,
                  "content": "                st.rerun()"
                },
                {
                  "lineNumber": 366,
                  "content": "                        st.rerun()"
                },
                {
                  "lineNumber": 389,
                  "content": "                        st.rerun()"
                },
                {
                  "lineNumber": 405,
                  "content": "                            st.rerun()"
                },
                {
                  "lineNumber": 424,
                  "content": "                            st.rerun()"
                },
                {
                  "lineNumber": 444,
                  "content": "                                st.rerun()"
                },
                {
                  "lineNumber": 559,
                  "content": "                st.rerun()"
                },
                {
                  "lineNumber": 564,
                  "content": "                st.rerun()"
                },
                {
                  "lineNumber": 620,
                  "content": "                            st.rerun()"
                }
              ]
            }
          ],
          "totalLines": 17,
          "totalMatchedLines": 17
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---


åœæ­¢ã®åŸå› å€™è£œã‚’ç‰¹å®šã€‚è©³ç´°ã‚’ç¢ºèªä¸­ã€‚


---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "st\\.rerun\\(\\)",
  "path": "app.py",
  "contextBefore": 2,
  "contextAfter": 2,
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "st\\.rerun\\(\\)",
    "path": "app.py",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain": {
        "content": {
          "matches": [
            {
              "file": "app.py",
              "matches": [
                {
                  "lineNumber": 60,
                  "content": "            history_mgr.save_toon_file(session_name, st.session_state.history[-1])",
                  "isContextLine": true
                },
                {
                  "lineNumber": 61,
                  "content": "        st.sidebar.success(f\"'{session_name}' ã‚’ä¿å­˜ã—ã¾ã—ãŸ\")",
                  "isContextLine": true
                },
                {
                  "lineNumber": 62,
                  "content": "        st.rerun()"
                },
                {
                  "lineNumber": 63,
                  "isContextLine": true
                },
                {
                  "lineNumber": 64,
                  "content": "with col_load:",
                  "isContextLine": true
                },
                {
                  "lineNumber": 73,
                  "content": "                    toon_path.unlink()",
                  "isContextLine": true
                },
                {
                  "lineNumber": 74,
                  "content": "                st.sidebar.success(f\"'{session_name}' ã‚’å‰Šé™¤ã—ã¾ã—ãŸ\")",
                  "isContextLine": true
                },
                {
                  "lineNumber": 75,
                  "content": "                st.rerun()"
                },
                {
                  "lineNumber": 76,
                  "content": "            except Exception as e:",
                  "isContextLine": true
                },
                {
                  "lineNumber": 77,
                  "content": "                st.sidebar.error(f\"å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")",
                  "isContextLine": true
                },
                {
                  "lineNumber": 93,
                  "content": "                st.session_state.history = loaded_history",
                  "isContextLine": true
                },
                {
                  "lineNumber": 94,
                  "content": "                st.sidebar.success(f\"'{selected_session}' ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ\")",
                  "isContextLine": true
                },
                {
                  "lineNumber": 95,
                  "content": "                st.rerun()"
                },
                {
                  "lineNumber": 96,
                  "content": "            else:",
                  "isContextLine": true
                },
                {
                  "lineNumber": 97,
                  "content": "                st.sidebar.error(\"ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ\")",
                  "isContextLine": true
                },
                {
                  "lineNumber": 114,
                  "content": "                st.session_state.history = [loaded_flow]",
                  "isContextLine": true
                },
                {
                  "lineNumber": 115,
                  "content": "                st.sidebar.success(f\"'{selected_toon}' ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ\")",
                  "isContextLine": true
                },
                {
                  "lineNumber": 116,
                  "content": "                st.rerun()"
                },
                {
                  "lineNumber": 117,
                  "content": "            else:",
                  "isContextLine": true
                },
                {
                  "lineNumber": 118,
                  "content": "                st.sidebar.error(\"TOONãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\")",
                  "isContextLine": true
                },
                {
                  "lineNumber": 228,
                  "content": "                                st.session_state.question_responses = []  # æ–°ã—ã„è³ªå•ãªã®ã§å›ç­”ã‚’ãƒªã‚»ãƒƒãƒˆ",
                  "isContextLine": true
                },
                {
                  "lineNumber": 229,
                  "content": "                                st.info(\"LLMã‹ã‚‰è¿½åŠ ã®è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
                  "isContextLine": true
                },
                {
                  "lineNumber": 230,
                  "content": "                                st.rerun()"
                },
                {
                  "lineNumber": 231,
                  "content": "                            else:",
                  "isContextLine": true
                },
                {
                  "lineNumber": 232,
                  "content": "                                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼",
                  "isContextLine": true
                },
                {
                  "lineNumber": 256,
                  "content": "                                    st.session_state.history.append(new_flow)",
                  "isContextLine": true
                },
                {
                  "lineNumber": 257,
                  "content": "                            ",
                  "isContextLine": true
                },
                {
                  "lineNumber": 258,
                  "content": "                            st.rerun()"
                },
                {
                  "lineNumber": 259,
                  "content": "                        except LLMAPIError as e:",
                  "isContextLine": true
                },
                {
                  "lineNumber": 260,
                  "content": "                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ",
                  "isContextLine": true
                },
                {
                  "lineNumber": 278,
                  "content": "                                    st.session_state.question_responses = []",
                  "isContextLine": true
                },
                {
                  "lineNumber": 279,
                  "content": "                                    st.info(\"LLMã‹ã‚‰è¿½åŠ ã®è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
                  "isContextLine": true
                },
                {
                  "lineNumber": 280,
                  "content": "                                    st.rerun()"
                },
                {
                  "lineNumber": 281,
                  "content": "                                else:",
                  "isContextLine": true
                },
                {
                  "lineNumber": 282,
                  "content": "                                    st.error(f\"TOONå½¢å¼ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {e}\")",
                  "isContextLine": true
                },
                {
                  "lineNumber": 301,
                  "content": "                                        st.session_state.question_responses = []",
                  "isContextLine": true
                },
                {
                  "lineNumber": 302,
                  "content": "                                        st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
                  "isContextLine": true
                },
                {
                  "lineNumber": 303,
                  "content": "                                        st.rerun()"
                },
                {
                  "lineNumber": 304,
                  "content": "                                except:",
                  "isContextLine": true
                },
                {
                  "lineNumber": 305,
                  "content": "                                    pass",
                  "isContextLine": true
                },
                {
                  "lineNumber": 315,
                  "content": "                st.session_state.pending_questions = None",
                  "isContextLine": true
                },
                {
                  "lineNumber": 316,
                  "content": "                st.session_state.question_responses = []",
                  "isContextLine": true
                },
                {
                  "lineNumber": 317,
                  "content": "                st.rerun()"
                },
                {
                  "lineNumber": 318,
                  "content": "        ",
                  "isContextLine": true
                },
                {
                  "lineNumber": 319,
                  "content": "        st.divider()",
                  "isContextLine": true
                },
                {
                  "lineNumber": 364,
                  "content": "                        st.session_state.append_mode_for_question = append_mode  # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜",
                  "isContextLine": true
                },
                {
                  "lineNumber": 365,
                  "content": "                        st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
                  "isContextLine": true
                },
                {
                  "lineNumber": 366,
                  "content": "                        st.rerun()"
                },
                {
                  "lineNumber": 367,
                  "content": "                    else:",
                  "isContextLine": true
                },
                {
                  "lineNumber": 368,
                  "content": "                        # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼",
                  "isContextLine": true
                },
                {
                  "lineNumber": 387,
                  "content": "                            st.session_state.history.append(new_flow)",
                  "isContextLine": true
                },
                {
                  "lineNumber": 388,
                  "content": "                        ",
                  "isContextLine": true
                },
                {
                  "lineNumber": 389,
                  "content": "                        st.rerun()"
                },
                {
                  "lineNumber": 390,
                  "content": "                except LLMAPIError as e:",
                  "isContextLine": true
                },
                {
                  "lineNumber": 391,
                  "content": "                    # LLM APIã‚¨ãƒ©ãƒ¼",
                  "isContextLine": true
                },
                {
                  "lineNumber": 403,
                  "content": "                            st.session_state.question_responses = []",
                  "isContextLine": true
                },
                {
                  "lineNumber": 404,
                  "content": "                            st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
                  "isContextLine": true
                },
                {
                  "lineNumber": 405,
                  "content": "                            st.rerun()"
                },
                {
                  "lineNumber": 406,
                  "content": "                        else:",
                  "isContextLine": true
                },
                {
                  "lineNumber": 407,
                  "content": "                            # æœ¬å½“ã«ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã®å ´åˆ",
                  "isContextLine": true
                },
                {
                  "lineNumber": 422,
                  "content": "                            st.session_state.history.append(corrected_flow)",
                  "isContextLine": true
                },
                {
                  "lineNumber": 423,
                  "content": "                            st.success(\"è‡ªå‹•ä¿®æ­£ãŒå®Œäº†ã—ã¾ã—ãŸã€‚\")",
                  "isContextLine": true
                },
                {
                  "lineNumber": 424,
                  "content": "                            st.rerun()"
                },
                {
                  "lineNumber": 425,
                  "content": "                    except Exception as correction_error:",
                  "isContextLine": true
                },
                {
                  "lineNumber": 426,
                  "content": "                        st.error(f\"è‡ªå‹•ä¿®æ­£ã«å¤±æ•—ã—ã¾ã—ãŸ: {correction_error}\")",
                  "isContextLine": true
                },
                {
                  "lineNumber": 442,
                  "content": "                                st.session_state.question_responses = []",
                  "isContextLine": true
                },
                {
                  "lineNumber": 443,
                  "content": "                                st.info(\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
                  "isContextLine": true
                },
                {
                  "lineNumber": 444,
                  "content": "                                st.rerun()"
                },
                {
                  "lineNumber": 445,
                  "content": "                        except:",
                  "isContextLine": true
                },
                {
                  "lineNumber": 446,
                  "content": "                            pass",
                  "isContextLine": true
                },
                {
                  "lineNumber": 557,
                  "content": "            if st.button(\"é¸æŠã‚’ã‚¯ãƒªã‚¢\", key=\"clear_selection\"):",
                  "isContextLine": true
                },
                {
                  "lineNumber": 558,
                  "content": "                st.session_state.selected_node_ids = []",
                  "isContextLine": true
                },
                {
                  "lineNumber": 559,
                  "content": "                st.rerun()"
                },
                {
                  "lineNumber": 560,
                  "content": "        with col_clear2:",
                  "isContextLine": true
                },
                {
                  "lineNumber": 561,
                  "content": "            if st.button(\"æœ€å¾Œã®é¸æŠã‚’å‰Šé™¤\", key=\"remove_last_selection\"):",
                  "isContextLine": true
                },
                {
                  "lineNumber": 562,
                  "content": "                if st.session_state.selected_node_ids:",
                  "isContextLine": true
                },
                {
                  "lineNumber": 563,
                  "content": "                    st.session_state.selected_node_ids.pop()",
                  "isContextLine": true
                },
                {
                  "lineNumber": 564,
                  "content": "                st.rerun()"
                },
                {
                  "lineNumber": 565,
                  "content": "        ",
                  "isContextLine": true
                },
                {
                  "lineNumber": 566,
                  "content": "        # éƒ¨åˆ†å¤‰æ›´ã®å…¥åŠ›",
                  "isContextLine": true
                },
                {
                  "lineNumber": 618,
                  "content": "                            ",
                  "isContextLine": true
                },
                {
                  "lineNumber": 619,
                  "content": "                            st.success(\"é¸æŠç¯„å›²ã®å¤‰æ›´ãŒå®Œäº†ã—ã¾ã—ãŸï¼\")",
                  "isContextLine": true
                },
                {
                  "lineNumber": 620,
                  "content": "                            st.rerun()"
                },
                {
                  "lineNumber": 621,
                  "content": "                            ",
                  "isContextLine": true
                },
                {
                  "lineNumber": 622,
                  "content": "                except LLMAPIError as e:",
                  "isContextLine": true
                }
              ]
            }
          ],
          "totalLines": 85,
          "totalMatchedLines": 17
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/llm_client.py</summary>

</details>
</tool-use>

---


åœæ­¢ã®åŸå› ã‚’ç‰¹å®šã—ã¾ã—ãŸã€‚ä¸»ãªå•é¡Œã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

## åœæ­¢ã®ä¸»ãªåŸå› 

### 1. **LLM APIå‘¼ã³å‡ºã—ã®é•·æ™‚é–“å¾…æ©Ÿ**
- `core/llm_client.py`ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒ300ç§’ï¼ˆ5åˆ†ï¼‰ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™
- LLMã®å¿œç­”ãŒé…ã„å ´åˆã€ã‚¢ãƒ—ãƒªãŒæœ€å¤§5åˆ†é–“åœæ­¢ã—ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™
- ç‰¹ã«`generate_flow()`ã‚„`generate_partial_change()`ã®å‘¼ã³å‡ºã—æ™‚ã«ç™ºç”Ÿ

```python
response = requests.post(
    self.api_url,
    json=payload,
    timeout=300,  # 5åˆ†é–“å¾…æ©Ÿ
    proxies=proxies
)
```

### 2. **`st.rerun()`ã®éå‰°ãªå‘¼ã³å‡ºã—ã«ã‚ˆã‚‹ç„¡é™ãƒ«ãƒ¼ãƒ—**
- `app.py`å†…ã§17ç®‡æ‰€ã§`st.rerun()`ãŒå‘¼ã°ã‚Œã¦ã„ã¾ã™
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å†…ã§`st.rerun()`ãŒå‘¼ã°ã‚Œã‚‹ã¨ã€ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ãŒç¶šãé™ã‚Šå†å®Ÿè¡ŒãŒç¹°ã‚Šè¿”ã•ã‚Œã¾ã™
- ç‰¹ã«ä»¥ä¸‹ã®ç®‡æ‰€ã§å•é¡ŒãŒç™ºç”Ÿã—ã‚„ã™ã„ã§ã™ï¼š
  - è³ªå•å¿œç­”ã®å‡¦ç†ï¼ˆ230è¡Œç›®ã€280è¡Œç›®ã€303è¡Œç›®ã€366è¡Œç›®ã€405è¡Œç›®ã€444è¡Œç›®ï¼‰
  - ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿå¾Œã®è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ï¼ˆ424è¡Œç›®ï¼‰

### 3. **è³ªå•å¿œç­”ã®ç„¡é™ãƒ«ãƒ¼ãƒ—**
- LLMãŒè³ªå•ã‚’è¿”ã—ç¶šã‘ã‚‹ã¨ã€`st.rerun()`ãŒç¹°ã‚Šè¿”ã—å‘¼ã°ã‚Œã¾ã™
- ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ãŒé©åˆ‡ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œãªã„å ´åˆã€åŒã˜è³ªå•ãŒç¹°ã‚Šè¿”ã•ã‚Œã¾ã™

### 4. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å•é¡Œ**
- ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒã™ã‚‹å‰ã«`st.rerun()`ãŒå‘¼ã°ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™
- ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ãŒç¶™ç¶šã—ã¾ã™

## æ¨å¥¨ã•ã‚Œã‚‹å¯¾ç­–

1. **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®çŸ­ç¸®**: 300ç§’ã‹ã‚‰60-120ç§’ã«çŸ­ç¸®
2. **`st.rerun()`ã®æ¡ä»¶ä»˜ãå‘¼ã³å‡ºã—**: ã‚¨ãƒ©ãƒ¼æ™‚ã¯`st.rerun()`ã‚’å‘¼ã°ãªã„
3. **è³ªå•å¿œç­”ã®ãƒ«ãƒ¼ãƒ—é˜²æ­¢**: è³ªå•å›æ•°ã«ä¸Šé™ã‚’è¨­å®š
4. **éåŒæœŸå‡¦ç†ã®æ¤œè¨**: LLMå‘¼ã³å‡ºã—ã‚’éåŒæœŸåŒ–ã—ã€UIã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„
5. **é€²æ—è¡¨ç¤ºã®æ”¹å–„**: é•·æ™‚é–“å‡¦ç†ä¸­ã¯æ˜ç¢ºãªé€²æ—è¡¨ç¤ºã‚’è¿½åŠ 

ã“ã‚Œã‚‰ã®ä¿®æ­£ã‚’å®Ÿè£…ã—ã¾ã™ã‹ï¼Ÿãã‚Œã¨ã‚‚ã€ç‰¹å®šã®åœæ­¢ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆä¾‹ï¼šLLMå‘¼ã³å‡ºã—æ™‚ã€ç‰¹å®šã®æ“ä½œæ™‚ï¼‰ã«ã¤ã„ã¦è©³ã—ãèª¿æŸ»ã—ã¾ã™ã‹ï¼Ÿ

---

_**User**_

ä¿®æ­£ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„

---

_**Agent (model default, mode Agent)**_


åœæ­¢å•é¡Œã®ä¿®æ­£ã‚’å®Ÿè£…ä¸­ã€‚ã¾ãšã€ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ä¿®æ­£ã‚’é€²ã‚ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: app.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** â€¢ Todo List</summary>

- [-] LLM APIå‘¼ã³å‡ºã—ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’300ç§’ã‹ã‚‰120ç§’ã«çŸ­ç¸®
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å†…ã®st.rerun()å‘¼ã³å‡ºã—ã‚’æ¡ä»¶ä»˜ãã«å¤‰æ›´
- [ ] è³ªå•å¿œç­”ã®ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼ˆè³ªå•å›æ•°ä¸Šé™ã‚’è¨­å®šï¼‰
- [ ] é•·æ™‚é–“å‡¦ç†ä¸­ã®é€²æ—è¡¨ç¤ºã‚’æ”¹å–„

</details>
</tool-use>

---


åœæ­¢å•é¡Œã®ä¿®æ­£ã‚’å®Ÿè£…ä¸­ã€‚ã¾ãšã€LLM APIã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’çŸ­ç¸®ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: core/llm_client.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: core/llm_client.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** â€¢ Todo List</summary>

- [x] LLM APIå‘¼ã³å‡ºã—ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’300ç§’ã‹ã‚‰120ç§’ã«çŸ­ç¸®
- [-] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å†…ã®st.rerun()å‘¼ã³å‡ºã—ã‚’æ¡ä»¶ä»˜ãã«å¤‰æ›´
- [ ] è³ªå•å¿œç­”ã®ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼ˆè³ªå•å›æ•°ä¸Šé™ã‚’è¨­å®šï¼‰
- [ ] é•·æ™‚é–“å‡¦ç†ä¸­ã®é€²æ—è¡¨ç¤ºã‚’æ”¹å–„

</details>
</tool-use>

---


è³ªå•å¿œç­”ã®ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„ã‚’å®Ÿè£…ä¸­ã€‚


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** â€¢ Todo List</summary>

- [x] LLM APIå‘¼ã³å‡ºã—ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’300ç§’ã‹ã‚‰120ç§’ã«çŸ­ç¸®
- [x] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å†…ã®st.rerun()å‘¼ã³å‡ºã—ã‚’æ¡ä»¶ä»˜ãã«å¤‰æ›´
- [x] è³ªå•å¿œç­”ã®ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼ˆè³ªå•å›æ•°ä¸Šé™ã‚’è¨­å®šï¼‰
- [-] é•·æ™‚é–“å‡¦ç†ä¸­ã®é€²æ—è¡¨ç¤ºã‚’æ”¹å–„

</details>
</tool-use>

---


é€²æ—è¡¨ç¤ºã‚’æ”¹å–„ä¸­ã€‚


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** â€¢ Todo List</summary>

- [x] LLM APIå‘¼ã³å‡ºã—ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’300ç§’ã‹ã‚‰120ç§’ã«çŸ­ç¸®
- [x] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å†…ã®st.rerun()å‘¼ã³å‡ºã—ã‚’æ¡ä»¶ä»˜ãã«å¤‰æ›´
- [x] è³ªå•å¿œç­”ã®ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼ˆè³ªå•å›æ•°ä¸Šé™ã‚’è¨­å®šï¼‰
- [x] é•·æ™‚é–“å‡¦ç†ä¸­ã®é€²æ—è¡¨ç¤ºã‚’æ”¹å–„

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="read_lints">
<details>
<summary>Tool use: **read_lints**</summary>


Parameters:

```json
{
  "paths": [
    "app.py",
    "core/llm_client.py"
  ]
}
```
Result:

```json
{
  "linterErrorsByFile": [
    {
      "relativeWorkspacePath": "app.py"
    },
    {
      "relativeWorkspacePath": "core/llm_client.py"
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---


ä¿®æ­£ã‚’å®Œäº†ã—ã¾ã—ãŸã€‚å®Ÿè£…å†…å®¹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

## å®Ÿè£…ã—ãŸä¿®æ­£å†…å®¹

### 1. **LLM APIå‘¼ã³å‡ºã—ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆçŸ­ç¸®**
- `core/llm_client.py`ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’300ç§’ï¼ˆ5åˆ†ï¼‰ã‹ã‚‰120ç§’ï¼ˆ2åˆ†ï¼‰ã«çŸ­ç¸®
- å¿œç­”ãŒé…ã„å ´åˆã§ã‚‚ã€æœ€å¤§2åˆ†ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

### 2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„**
- ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã¯`st.rerun()`ã‚’å‘¼ã°ãªã„ã‚ˆã†ã«å¤‰æ›´
- ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚’é˜²æ­¢
- ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‰‹å‹•ã§å†è©¦è¡Œå¯èƒ½

### 3. **è³ªå•å¿œç­”ã®ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢**
- è³ªå•å›æ•°ã®ä¸Šé™ã‚’5å›ã«è¨­å®šï¼ˆ`MAX_QUESTION_COUNT = 5`ï¼‰
- è³ªå•å›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã—ã€ä¸Šé™ã«é”ã—ãŸå ´åˆã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ
- è³ªå•å›æ•°ã‚’è¡¨ç¤ºï¼ˆä¾‹ï¼šã€Œè³ªå•å›æ•°: 3/5ã€ï¼‰

### 4. **é€²æ—è¡¨ç¤ºã®æ”¹å–„**
- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ 
- é•·æ™‚é–“å‡¦ç†ä¸­ã‚‚é€²æ—ã‚’è¡¨ç¤º
- ã€Œæœ€å¤§2åˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º

## ä¿®æ­£ã®åŠ¹æœ

1. å¿œç­”æ™‚é–“ã®çŸ­ç¸®: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒ2åˆ†ã«çŸ­ç¸®ã•ã‚Œã€åœæ­¢æ™‚é–“ãŒçŸ­ç¸®
2. ç„¡é™ãƒ«ãƒ¼ãƒ—ã®é˜²æ­¢: ã‚¨ãƒ©ãƒ¼æ™‚ã‚„è³ªå•ãŒç¶šãå ´åˆã§ã‚‚ã€é©åˆ‡ã«åœæ­¢
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å‘ä¸Š: é€²æ—è¡¨ç¤ºã«ã‚ˆã‚Šã€å‡¦ç†ä¸­ã§ã‚ã‚‹ã“ã¨ãŒæ˜ç¢º

ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åœæ­¢å•é¡ŒãŒæ”¹å–„ã•ã‚Œã€ã‚ˆã‚Šå®‰å®šã—ã¦å‹•ä½œã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

---

_**User**_

ã¡ã‚ƒã‚“ã¨ãƒãƒ¼ãƒ‰ã‚’æŒ‡å®šã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãã‚Œã¾ã—ãŸã‹

---

_**Agent (model default, mode Agent)**_


ãƒãƒ¼ãƒ‰é¸æŠæ©Ÿèƒ½ã®å®Ÿè£…çŠ¶æ³ã‚’ç¢ºèªä¸­ã§ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: app.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: frontend/index.html</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "node_selected|node_selected_from_ui|addNodeClickHandler",
  "path": ".",
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "node_selected|node_selected_from_ui|addNodeClickHandler",
    "path": ".",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\btsi1\\OneDrive\\ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—\\cursor\\myenv\\Chatbot_explain": {
        "content": {
          "matches": [
            {
              "file": ".\\app.py",
              "matches": [
                {
                  "lineNumber": 622,
                  "content": "    if 'node_selected_from_ui' in st.session_state:"
                },
                {
                  "lineNumber": 623,
                  "content": "        selected_node_id = st.session_state.node_selected_from_ui"
                },
                {
                  "lineNumber": 629,
                  "content": "        del st.session_state.node_selected_from_ui"
                }
              ]
            },
            {
              "file": ".\\.specstory\\history\\2026-01-25_09-59Z-ãƒãƒ¼ãƒ¡ã‚¤ãƒ‰å›³ã®æ•´ç†.md",
              "matches": [
                {
                  "lineNumber": 33880,
                  "content": "        \"contents\": \"                node.addEventListener('click', function(e) {\\n                    e.stopPropagation();\\n                    \\n                    // Streamlitã«ãƒãƒ¼ãƒ‰IDã‚’é€ä¿¡\\n                    // Streamlitã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé€šä¿¡ã‚’ä½¿ç”¨\\n                    if (window.parent &amp;amp;&amp;amp; window.parent !== window) {\\n                        window.parent.postMessage({\\n                            type: 'streamlit:setComponentValue',\\n                            value: {\\n                                type: 'node_selected',\\n                                nodeId: nodeId\\n                            }\\n                        }, '*');\\n                    }\\n                    \\n                    // ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º\\n                    toggleNodeHighlight(node);\\n                });\\n            });\\n        }\\n        \\n        function addCollapseFunctionality(svgElement) {\\n            // subgraphã®æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ã‚’è¿½åŠ \\n            // Mermaid.jsãŒç”Ÿæˆã™ã‚‹SVGã®æ§‹é€ ã«åŸºã¥ã„ã¦å®Ÿè£…\\n            \\n            // subgraph [... omitted end of long line]"
                },
                {
                  "lineNumber": 33920,
                  "content": "            \"text\": \"                                type: 'node_selected',\","
                },
                {
                  "lineNumber": 39680,
                  "content": "        \"contents\": \"        async function render(b64) {\\n            const container = document.getElementById('graph');\\n            try {\\n                // Base64ã‚’UTF-8æ–‡å­—åˆ—ã«å¾©å·\\n                const code = decodeURIComponent(escape(window.atob(b64)));\\n                container.innerHTML = \\\"\\\";\\n                \\n                const id = \\\"m\\\" + Math.random().toString(36).substr(2, 9);\\n                const { svg } = await mermaid.render(id, code);\\n                container.innerHTML = svg;\\n                \\n                // SVGè¦ç´ ã‚’å–å¾—ã—ã¦æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ã¨ãƒãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯æ©Ÿèƒ½ã‚’è¿½åŠ \\n                const svgElement = container.querySelector('svg');\\n                if (svgElement) {\\n                    // å°‘ã—é…å»¶ã‚’å…¥ã‚Œã¦DOMãŒå®Œå…¨ã«æ§‹ç¯‰ã•ã‚Œã‚‹ã®ã‚’å¾…ã¤\\n                    setTimeout(() =&amp;gt; {\\n                        addCollapseFunctionality(svgElement);\\n                        addNodeClickHandler(svgElement);\\n                    }, 100);\\n                }\\n            } catch (e) {\\n                container.innerH [... omitted end of long line]"
                },
                {
                  "lineNumber": 39752,
                  "content": "            \"text\": \"                        addNodeClickHandler(svgElement);\","
                }
              ]
            },
            {
              "file": ".\\frontend\\index.html",
              "matches": [
                {
                  "lineNumber": 70,
                  "content": "        function addNodeClickHandler(svgElement) {"
                },
                {
                  "lineNumber": 97,
                  "content": "                                type: 'node_selected',"
                },
                {
                  "lineNumber": 192,
                  "content": "                        addNodeClickHandler(svgElement);"
                }
              ]
            }
          ],
          "totalLines": 10,
          "totalMatchedLines": 10
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---


ãƒãƒ¼ãƒ‰é¸æŠæ©Ÿèƒ½ã¯éƒ¨åˆ†çš„ã«å®Ÿè£…æ¸ˆã¿ã§ã™ãŒã€UIé¸æŠï¼ˆã‚¯ãƒªãƒƒã‚¯ï¼‰ã®Streamlité€£æºãŒæœªå®Œæˆã§ã™ã€‚ä¿®æ­£ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: app.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "How does Streamlit components.html handle postMessage communication from JavaScript?",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\frontend\\index.html",
        "range": {
          "startPosition": {
            "line": 174
          },
          "endPosition": {
            "line": 217,
            "column": 7
          }
        },
        "contents": "        async function render(b64) {\n            const container = document.getElementById('graph');\n            try {\n                // Base64ã‚’UTF-8æ–‡å­—åˆ—ã«å¾©å·\n                const code = decodeURIComponent(escape(window.atob(b64)));\n                container.innerHTML = \"\";\n                \n                const id = \"m\" + Math.random().toString(36).substr(2, 9);\n                const { svg } = await mermaid.render(id, code);\n                container.innerHTML = svg;\n                \n                // SVGè¦ç´ ã‚’å–å¾—ã—ã¦æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ã¨ãƒãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯æ©Ÿèƒ½ã‚’è¿½åŠ \n                const svgElement = container.querySelector('svg');\n                if (svgElement) {\n                    // å°‘ã—é…å»¶ã‚’å…¥ã‚Œã¦DOMãŒå®Œå…¨ã«æ§‹ç¯‰ã•ã‚Œã‚‹ã®ã‚’å¾…ã¤\n                    setTimeout(() =&gt; {\n                        addCollapseFunctionality(svgElement);\n                        addNodeClickHandler(svgElement);\n                    }, 100);\n                }\n            } catch (e) {\n                container.innerHTML = &#96;&lt;pre style='color:red'&gt;Render Error: ${e.message}&lt;/pre&gt;&#96;;\n            }\n        }\n\n        window.addEventListener(\"message\", (event) =&gt; {\n            if (event.data.type === \"render\") {\n                render(event.data.base64Code);\n            }\n        });\n        \n        // Streamlitã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†\n        // Streamlitã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«å¾“ã†\n        if (window.parent) {\n            window.addEventListener(\"message\", (event) =&gt; {\n                // Streamlitã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†\n                if (event.data &amp;&amp; event.data.type === \"streamlit:render\") {\n                    // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‡¦ç†\n                }\n            });\n        }\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "        async function render(b64) {",
            "lineNumber": 175
          },
          {
            "text": "            const container = document.getElementById('graph');",
            "lineNumber": 176
          },
          {
            "text": "            try {",
            "lineNumber": 177
          },
          {
            "text": "                // Base64ã‚’UTF-8æ–‡å­—åˆ—ã«å¾©å·",
            "lineNumber": 178
          },
          {
            "text": "                const code = decodeURIComponent(escape(window.atob(b64)));",
            "lineNumber": 179
          },
          {
            "text": "                container.innerHTML = \"\";",
            "lineNumber": 180
          },
          {
            "text": "                ",
            "lineNumber": 181
          },
          {
            "text": "                const id = \"m\" + Math.random().toString(36).substr(2, 9);",
            "lineNumber": 182
          },
          {
            "text": "                const { svg } = await mermaid.render(id, code);",
            "lineNumber": 183
          },
          {
            "text": "                container.innerHTML = svg;",
            "lineNumber": 184
          },
          {
            "text": "                ",
            "lineNumber": 185
          },
          {
            "text": "                // SVGè¦ç´ ã‚’å–å¾—ã—ã¦æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ã¨ãƒãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯æ©Ÿèƒ½ã‚’è¿½åŠ ",
            "lineNumber": 186
          },
          {
            "text": "                const svgElement = container.querySelector('svg');",
            "lineNumber": 187
          },
          {
            "text": "                if (svgElement) {",
            "lineNumber": 188
          },
          {
            "text": "                    // å°‘ã—é…å»¶ã‚’å…¥ã‚Œã¦DOMãŒå®Œå…¨ã«æ§‹ç¯‰ã•ã‚Œã‚‹ã®ã‚’å¾…ã¤",
            "lineNumber": 189
          },
          {
            "text": "                    setTimeout(() =&gt; {",
            "lineNumber": 190
          },
          {
            "text": "                        addCollapseFunctionality(svgElement);",
            "lineNumber": 191
          },
          {
            "text": "                        addNodeClickHandler(svgElement);",
            "lineNumber": 192
          },
          {
            "text": "                    }, 100);",
            "lineNumber": 193
          },
          {
            "text": "                }",
            "lineNumber": 194
          },
          {
            "text": "            } catch (e) {",
            "lineNumber": 195
          },
          {
            "text": "                container.innerHTML = &#96;&lt;pre style='color:red'&gt;Render Error: ${e.message}&lt;/pre&gt;&#96;;",
            "lineNumber": 196
          },
          {
            "text": "            }",
            "lineNumber": 197
          },
          {
            "text": "        }",
            "lineNumber": 198
          },
          {
            "lineNumber": 199
          },
          {
            "text": "        window.addEventListener(\"message\", (event) =&gt; {",
            "lineNumber": 200
          },
          {
            "text": "            if (event.data.type === \"render\") {",
            "lineNumber": 201
          },
          {
            "text": "                render(event.data.base64Code);",
            "lineNumber": 202
          },
          {
            "text": "            }",
            "lineNumber": 203
          },
          {
            "text": "        });",
            "lineNumber": 204
          },
          {
            "text": "        ",
            "lineNumber": 205
          },
          {
            "text": "        // Streamlitã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†",
            "lineNumber": 206
          },
          {
            "text": "        // Streamlitã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«å¾“ã†",
            "lineNumber": 207
          },
          {
            "text": "        if (window.parent) {",
            "lineNumber": 208
          },
          {
            "text": "            window.addEventListener(\"message\", (event) =&gt; {",
            "lineNumber": 209
          },
          {
            "text": "                // Streamlitã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†",
            "lineNumber": 210
          },
          {
            "text": "                if (event.data &amp;&amp; event.data.type === \"streamlit:render\") {",
            "lineNumber": 211
          },
          {
            "text": "                    // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‡¦ç†",
            "lineNumber": 212
          },
          {
            "text": "                }",
            "lineNumber": 213
          },
          {
            "text": "            });",
            "lineNumber": 214
          },
          {
            "text": "        }",
            "lineNumber": 215
          },
          {
            "text": "    &lt;/script&gt;",
            "lineNumber": 216
          },
          {
            "text": "&lt;/body&gt;",
            "lineNumber": 217
          },
          {
            "text": "&lt;/html&gt;",
            "lineNumber": 218
          }
        ]
      },
      "score": 0.42691969871520996
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\frontend\\index.html",
        "range": {
          "startPosition": {
            "line": 87
          },
          "endPosition": {
            "line": 110
          }
        },
        "contents": "                node.addEventListener('click', function(e) {\n                    e.stopPropagation();\n                    \n                    // Streamlitã«ãƒãƒ¼ãƒ‰IDã‚’é€ä¿¡\n                    // Streamlitã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé€šä¿¡ã‚’ä½¿ç”¨\n                    if (window.parent &amp;&amp; window.parent !== window) {\n                        window.parent.postMessage({\n                            type: 'streamlit:setComponentValue',\n                            value: {\n                                type: 'node_selected',\n                                nodeId: nodeId\n                            }\n                        }, '*');\n                    }\n                    \n                    // ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º\n                    toggleNodeHighlight(node);\n                });\n            });\n        }\n        \n        function addCollapseFunctionality(svgElement) {\n            // subgraphã®æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ã‚’è¿½åŠ ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                node.addEventListener('click', function(e) {",
            "lineNumber": 88
          },
          {
            "text": "                    e.stopPropagation();",
            "lineNumber": 89
          },
          {
            "text": "                    ",
            "lineNumber": 90
          },
          {
            "text": "                    // Streamlitã«ãƒãƒ¼ãƒ‰IDã‚’é€ä¿¡",
            "lineNumber": 91
          },
          {
            "text": "                    // Streamlitã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé€šä¿¡ã‚’ä½¿ç”¨",
            "lineNumber": 92
          },
          {
            "text": "                    if (window.parent &amp;&amp; window.parent !== window) {",
            "lineNumber": 93
          },
          {
            "text": "                        window.parent.postMessage({",
            "lineNumber": 94
          },
          {
            "text": "                            type: 'streamlit:setComponentValue',",
            "lineNumber": 95
          },
          {
            "text": "                            value: {",
            "lineNumber": 96
          },
          {
            "text": "                                type: 'node_selected',",
            "lineNumber": 97
          },
          {
            "text": "                                nodeId: nodeId",
            "lineNumber": 98
          },
          {
            "text": "                            }",
            "lineNumber": 99
          },
          {
            "text": "                        }, '*');",
            "lineNumber": 100
          },
          {
            "text": "                    }",
            "lineNumber": 101
          },
          {
            "text": "                    ",
            "lineNumber": 102
          },
          {
            "text": "                    // ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º",
            "lineNumber": 103
          },
          {
            "text": "                    toggleNodeHighlight(node);",
            "lineNumber": 104
          },
          {
            "text": "                });",
            "lineNumber": 105
          },
          {
            "text": "            });",
            "lineNumber": 106
          },
          {
            "text": "        }",
            "lineNumber": 107
          },
          {
            "text": "        ",
            "lineNumber": 108
          },
          {
            "text": "        function addCollapseFunctionality(svgElement) {",
            "lineNumber": 109
          },
          {
            "text": "            // subgraphã®æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½ã‚’è¿½åŠ ",
            "lineNumber": 110
          }
        ]
      },
      "score": 0.38371559977531433
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 535,
            "column": 46
          },
          "endPosition": {
            "line": 591,
            "column": 24
          }
        },
        "contents": "    # Mermaidæç”»å‡¦ç†\n    mermaid_code = current_flow.to_mermaid()\n    b64_mermaid = base64.b64encode(mermaid_code.encode('utf-8')).decode('utf-8')\n\n    html_path = Path(\"frontend/index.html\")\n    if html_path.exists():\n        html_content = html_path.read_text(encoding='utf-8')\n        components.html(\n            f\"\"\"\n            {html_content}\n            &lt;script&gt;\n                window.onload = () =&gt; {{\n                    window.postMessage({{ \n                        type: \"render\", \n                        base64Code: \"{b64_mermaid}\" \n                    }}, \"*\");\n                }};\n            &lt;/script&gt;\n            \"\"\",\n            height=800,\n            scrolling=True,\n        )\n    else:\n        st.error(\"frontend/index.html ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\")\n\nwith col_source:\n    st.subheader(\"ğŸ“„ TOONå½¢å¼ï¼ˆSourceï¼‰\")\n    \n    # TOONå½¢å¼ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ\n    toon_text = current_flow.to_toon_format()\n    \n    with st.expander(\"TOONå½¢å¼ã‚’è¡¨ç¤º\", expanded=True):\n        st.code(toon_text, language=\"markdown\")\n    \n    # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³\n    st.download_button(\n        label=\"ğŸ“¥ TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\",\n        data=toon_text,\n        file_name=f\"{session_name}_toon.md\",\n        mime=\"text/markdown\"\n    )\n    \n    # ãƒãƒ¼ãƒ‰é¸æŠã‚»ã‚¯ã‚·ãƒ§ãƒ³\n    st.divider()\n    st.subheader(\"ğŸ¯ ãƒãƒ¼ãƒ‰é¸æŠï¼ˆéƒ¨åˆ†å¤‰æ›´ç”¨ï¼‰\")\n    \n    # é¸æŠãƒ¢ãƒ¼ãƒ‰\n    selection_mode = st.radio(\n        \"é¸æŠæ–¹æ³•\",\n        [\"UIé¸æŠ\", \"ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›\", \"ä¸¡æ–¹\"],\n        horizontal=True,\n        key=\"selection_mode_radio\"\n    )\n    \n    # ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›\n    if selection_mode in",
        "signatures": {},
        "detailedLines": [
          {
            "text": "    # Mermaidæç”»å‡¦ç†",
            "lineNumber": 537
          },
          {
            "text": "    mermaid_code = current_flow.to_mermaid()",
            "lineNumber": 538
          },
          {
            "text": "    b64_mermaid = base64.b64encode(mermaid_code.encode('utf-8')).decode('utf-8')",
            "lineNumber": 539
          },
          {
            "lineNumber": 540
          },
          {
            "text": "    html_path = Path(\"frontend/index.html\")",
            "lineNumber": 541
          },
          {
            "text": "    if html_path.exists():",
            "lineNumber": 542
          },
          {
            "text": "        html_content = html_path.read_text(encoding='utf-8')",
            "lineNumber": 543
          },
          {
            "text": "        components.html(",
            "lineNumber": 544
          },
          {
            "text": "            f\"\"\"",
            "lineNumber": 545
          },
          {
            "text": "            {html_content}",
            "lineNumber": 546
          },
          {
            "text": "            &lt;script&gt;",
            "lineNumber": 547
          },
          {
            "text": "                window.onload = () =&gt; {{",
            "lineNumber": 548
          },
          {
            "text": "                    window.postMessage({{ ",
            "lineNumber": 549
          },
          {
            "text": "                        type: \"render\", ",
            "lineNumber": 550
          },
          {
            "text": "                        base64Code: \"{b64_mermaid}\" ",
            "lineNumber": 551
          },
          {
            "text": "                    }}, \"*\");",
            "lineNumber": 552
          },
          {
            "text": "                }};",
            "lineNumber": 553
          },
          {
            "text": "            &lt;/script&gt;",
            "lineNumber": 554
          },
          {
            "text": "            \"\"\",",
            "lineNumber": 555
          },
          {
            "text": "            height=800,",
            "lineNumber": 556
          },
          {
            "text": "            scrolling=True,",
            "lineNumber": 557
          },
          {
            "text": "        )",
            "lineNumber": 558
          },
          {
            "text": "    else:",
            "lineNumber": 559
          },
          {
            "text": "        st.error(\"frontend/index.html ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\")",
            "lineNumber": 560
          },
          {
            "lineNumber": 561
          },
          {
            "text": "with col_source:",
            "lineNumber": 562
          },
          {
            "text": "    st.subheader(\"ğŸ“„ TOONå½¢å¼ï¼ˆSourceï¼‰\")",
            "lineNumber": 563
          },
          {
            "text": "    ",
            "lineNumber": 564
          },
          {
            "text": "    # TOONå½¢å¼ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ",
            "lineNumber": 565
          },
          {
            "text": "    toon_text = current_flow.to_toon_format()",
            "lineNumber": 566
          },
          {
            "text": "    ",
            "lineNumber": 567
          },
          {
            "text": "    with st.expander(\"TOONå½¢å¼ã‚’è¡¨ç¤º\", expanded=True):",
            "lineNumber": 568
          },
          {
            "text": "        st.code(toon_text, language=\"markdown\")",
            "lineNumber": 569
          },
          {
            "text": "    ",
            "lineNumber": 570
          },
          {
            "text": "    # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³",
            "lineNumber": 571
          },
          {
            "text": "    st.download_button(",
            "lineNumber": 572
          },
          {
            "text": "        label=\"ğŸ“¥ TOONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\",",
            "lineNumber": 573
          },
          {
            "text": "        data=toon_text,",
            "lineNumber": 574
          },
          {
            "text": "        file_name=f\"{session_name}_toon.md\",",
            "lineNumber": 575
          },
          {
            "text": "        mime=\"text/markdown\"",
            "lineNumber": 576
          },
          {
            "text": "    )",
            "lineNumber": 577
          },
          {
            "text": "    ",
            "lineNumber": 578
          },
          {
            "text": "    # ãƒãƒ¼ãƒ‰é¸æŠã‚»ã‚¯ã‚·ãƒ§ãƒ³",
            "lineNumber": 579
          },
          {
            "text": "    st.divider()",
            "lineNumber": 580
          },
          {
            "text": "    st.subheader(\"ğŸ¯ ãƒãƒ¼ãƒ‰é¸æŠï¼ˆéƒ¨åˆ†å¤‰æ›´ç”¨ï¼‰\")",
            "lineNumber": 581
          },
          {
            "text": "    ",
            "lineNumber": 582
          },
          {
            "text": "    # é¸æŠãƒ¢ãƒ¼ãƒ‰",
            "lineNumber": 583
          },
          {
            "text": "    selection_mode = st.radio(",
            "lineNumber": 584
          },
          {
            "text": "        \"é¸æŠæ–¹æ³•\",",
            "lineNumber": 585
          },
          {
            "text": "        [\"UIé¸æŠ\", \"ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›\", \"ä¸¡æ–¹\"],",
            "lineNumber": 586
          },
          {
            "text": "        horizontal=True,",
            "lineNumber": 587
          },
          {
            "text": "        key=\"selection_mode_radio\"",
            "lineNumber": 588
          },
          {
            "text": "    )",
            "lineNumber": 589
          },
          {
            "text": "    ",
            "lineNumber": 590
          },
          {
            "text": "    # ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›",
            "lineNumber": 591
          },
          {
            "text": "    if selection_mode in",
            "lineNumber": 592
          }
        ]
      },
      "score": 0.3525688052177429
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\frontend\\index.html",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 25
          }
        },
        "contents": "&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/npm/mermaid@10.9.5/dist/mermaid.min.js\"&gt;&lt;/script&gt;\n    &lt;style&gt;\n        body { margin: 0; background: white; overflow: auto; }\n        #container { display: flex; justify-content: center; padding: 20px; min-height: 100%; }\n        #graph { width: 100%; overflow: auto; }\n        svg { max-width: 100%; height: auto; display: block; }\n        .subgraph-title { cursor: pointer; }\n        .subgraph-title:hover { opacity: 0.7; }\n        .subgraph-collapsed .subgraph-content { display: none; }\n        .node-selected { \n            stroke: #ff6b6b !important; \n            stroke-width: 3px !important; \n            filter: drop-shadow(0 0 5px rgba(255, 107, 107, 0.5));\n        }\n        .node-clickable { cursor: pointer; }\n        .node-clickable:hover { opacity: 0.8; }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div id=\"container\"&gt;\n        &lt;div id=\"graph\"&gt;&lt;/div&gt;\n    &lt;/div&gt;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "&lt;!DOCTYPE html&gt;",
            "lineNumber": 1
          },
          {
            "text": "&lt;html&gt;",
            "lineNumber": 2
          },
          {
            "text": "&lt;head&gt;",
            "lineNumber": 3
          },
          {
            "text": "    &lt;script src=\"https://cdn.jsdelivr.net/npm/mermaid@10.9.5/dist/mermaid.min.js\"&gt;&lt;/script&gt;",
            "lineNumber": 4
          },
          {
            "text": "    &lt;style&gt;",
            "lineNumber": 5
          },
          {
            "text": "        body { margin: 0; background: white; overflow: auto; }",
            "lineNumber": 6
          },
          {
            "text": "        #container { display: flex; justify-content: center; padding: 20px; min-height: 100%; }",
            "lineNumber": 7
          },
          {
            "text": "        #graph { width: 100%; overflow: auto; }",
            "lineNumber": 8
          },
          {
            "text": "        svg { max-width: 100%; height: auto; display: block; }",
            "lineNumber": 9
          },
          {
            "text": "        .subgraph-title { cursor: pointer; }",
            "lineNumber": 10
          },
          {
            "text": "        .subgraph-title:hover { opacity: 0.7; }",
            "lineNumber": 11
          },
          {
            "text": "        .subgraph-collapsed .subgraph-content { display: none; }",
            "lineNumber": 12
          },
          {
            "text": "        .node-selected { ",
            "lineNumber": 13
          },
          {
            "text": "            stroke: #ff6b6b !important; ",
            "lineNumber": 14
          },
          {
            "text": "            stroke-width: 3px !important; ",
            "lineNumber": 15
          },
          {
            "text": "            filter: drop-shadow(0 0 5px rgba(255, 107, 107, 0.5));",
            "lineNumber": 16
          },
          {
            "text": "        }",
            "lineNumber": 17
          },
          {
            "text": "        .node-clickable { cursor: pointer; }",
            "lineNumber": 18
          },
          {
            "text": "        .node-clickable:hover { opacity: 0.8; }",
            "lineNumber": 19
          },
          {
            "text": "    &lt;/style&gt;",
            "lineNumber": 20
          },
          {
            "text": "&lt;/head&gt;",
            "lineNumber": 21
          },
          {
            "text": "&lt;body&gt;",
            "lineNumber": 22
          },
          {
            "text": "    &lt;div id=\"container\"&gt;",
            "lineNumber": 23
          },
          {
            "text": "        &lt;div id=\"graph\"&gt;&lt;/div&gt;",
            "lineNumber": 24
          },
          {
            "text": "    &lt;/div&gt;",
            "lineNumber": 25
          }
        ]
      },
      "score": 0.2333013415336609
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 246,
            "column": 46
          },
          "endPosition": {
            "line": 277,
            "column": 75
          }
        },
        "contents": "                            else:\n                                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼\n                                is_valid, validation_message = client.validate_output_size(raw_toon_text)\n                                if not is_valid:\n                                    st.warning(validation_message)\n                                    st.info(\"ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã‹ã€ãƒ•ãƒ­ãƒ¼ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\")\n                                \n                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹æˆåŠŸæ™‚ã®ã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ\n                                st.session_state.conversation_context = None\n                                st.session_state.pending_questions = None\n                                st.session_state.question_responses = []\n                                st.session_state.question_count = 0  # è³ªå•å›æ•°ã‚‚ãƒªã‚»ãƒƒãƒˆ\n                                \n                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹\n                                new_flow = TOONParser.parse(raw_toon_text)\n                                \n                                # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨\n                                new_flow = new_flow.apply_logic_gap_detection()\n                                \n                                # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ\n                                if append_mode_flag:\n                                    merged_flow = history_mgr.append_toon_log(session_name, new_flow)\n                                    st.session_state.history.append(merged_flow)\n                                    st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")\n                                else:\n                                    # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ \n                                    st.session_state.history.append(new_flow)\n                            \n                            st.rerun()\n                        except LLMAPIError as e:\n                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                            else:",
            "lineNumber": 248
          },
          {
            "text": "                                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼",
            "lineNumber": 249
          },
          {
            "text": "                                is_valid, validation_message = client.validate_output_size(raw_toon_text)",
            "lineNumber": 250
          },
          {
            "text": "                                if not is_valid:",
            "lineNumber": 251
          },
          {
            "text": "                                    st.warning(validation_message)",
            "lineNumber": 252
          },
          {
            "text": "                                    st.info(\"ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã‹ã€ãƒ•ãƒ­ãƒ¼ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 253
          },
          {
            "text": "                                ",
            "lineNumber": 254
          },
          {
            "text": "                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹æˆåŠŸæ™‚ã®ã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ",
            "lineNumber": 255
          },
          {
            "text": "                                st.session_state.conversation_context = None",
            "lineNumber": 256
          },
          {
            "text": "                                st.session_state.pending_questions = None",
            "lineNumber": 257
          },
          {
            "text": "                                st.session_state.question_responses = []",
            "lineNumber": 258
          },
          {
            "text": "                                st.session_state.question_count = 0  # è³ªå•å›æ•°ã‚‚ãƒªã‚»ãƒƒãƒˆ",
            "lineNumber": 259
          },
          {
            "text": "                                ",
            "lineNumber": 260
          },
          {
            "text": "                                # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹",
            "lineNumber": 261
          },
          {
            "text": "                                new_flow = TOONParser.parse(raw_toon_text)",
            "lineNumber": 262
          },
          {
            "text": "                                ",
            "lineNumber": 263
          },
          {
            "text": "                                # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨",
            "lineNumber": 264
          },
          {
            "text": "                                new_flow = new_flow.apply_logic_gap_detection()",
            "lineNumber": 265
          },
          {
            "text": "                                ",
            "lineNumber": 266
          },
          {
            "text": "                                # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ",
            "lineNumber": 267
          },
          {
            "text": "                                if append_mode_flag:",
            "lineNumber": 268
          },
          {
            "text": "                                    merged_flow = history_mgr.append_toon_log(session_name, new_flow)",
            "lineNumber": 269
          },
          {
            "text": "                                    st.session_state.history.append(merged_flow)",
            "lineNumber": 270
          },
          {
            "text": "                                    st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")",
            "lineNumber": 271
          },
          {
            "text": "                                else:",
            "lineNumber": 272
          },
          {
            "text": "                                    # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ ",
            "lineNumber": 273
          },
          {
            "text": "                                    st.session_state.history.append(new_flow)",
            "lineNumber": 274
          },
          {
            "text": "                            ",
            "lineNumber": 275
          },
          {
            "text": "                            st.rerun()",
            "lineNumber": 276
          },
          {
            "text": "                        except LLMAPIError as e:",
            "lineNumber": 277
          },
          {
            "text": "                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ",
            "lineNumber": 278
          }
        ]
      },
      "score": 0.18177813291549683
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\frontend\\index.html",
        "range": {
          "startPosition": {
            "line": 21
          },
          "endPosition": {
            "line": 59
          }
        },
        "contents": "&lt;body&gt;\n    &lt;div id=\"container\"&gt;\n        &lt;div id=\"graph\"&gt;&lt;/div&gt;\n    &lt;/div&gt;\n    &lt;script&gt;\n        mermaid.initialize({ startOnLoad: false, theme: 'default' });\n\n        // ãƒãƒ¼ãƒ‰IDã‚’æŠ½å‡ºã™ã‚‹é–¢æ•°\n        function extractNodeId(nodeElement) {\n            // Mermaid.jsã®æ§‹é€ : g.nodeè¦ç´ å†…ã®textè¦ç´ ã‹ã‚‰ãƒãƒ¼ãƒ‰IDã‚’å–å¾—\n            // ãƒãƒ¼ãƒ‰IDã¯é€šå¸¸ã€textè¦ç´ ã®æœ€åˆã®tspanã¾ãŸã¯textContentã«å«ã¾ã‚Œã‚‹\n            const textElement = nodeElement.querySelector('text');\n            if (!textElement) return null;\n            \n            // ãƒãƒ¼ãƒ‰IDã¯é€šå¸¸ã€Mermaidã®å†…éƒ¨IDã¨ã—ã¦gè¦ç´ ã®idå±æ€§ã«å«ã¾ã‚Œã‚‹\n            // ã¾ãŸã¯ã€textè¦ç´ ã®å†…å®¹ã‹ã‚‰æ¨æ¸¬ã™ã‚‹\n            // Mermaid.jsã®æ§‹é€ : g.node[id=\"flowchart-node-id\"]\n            const nodeId = nodeElement.getAttribute('id');\n            if (nodeId) {\n                // Mermaidã®IDå½¢å¼ã‹ã‚‰å®Ÿéš›ã®ãƒãƒ¼ãƒ‰IDã‚’æŠ½å‡º\n                // ä¾‹: \"flowchart-node-id\" -&gt; \"node-id\"\n                const match = nodeId.match(/flowchart-([^-]+(?:-[^-]+)*)/);\n                if (match) {\n                    return match[1];\n                }\n                // åˆ¥ã®å½¢å¼: ç›´æ¥IDãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆ\n                return nodeId.replace('flowchart-', '');\n            }\n            \n            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: textè¦ç´ ã®å†…å®¹ã‹ã‚‰æ¨æ¸¬ï¼ˆæœ€åˆã®è¡Œã‚’IDã¨ã—ã¦ä½¿ç”¨ï¼‰\n            const textContent = textElement.textContent || '';\n            const firstLine = textContent.split('\\n')[0].trim();\n            return firstLine || null;\n        }\n        \n        // ãƒãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹é–¢æ•°\n        function toggleNodeHighlight(nodeElement) {\n            const rect = nodeElement.querySelector('rect, circle, polygon');",
        "signatures": {},
        "detailedLines": [
          {
            "text": "&lt;body&gt;",
            "lineNumber": 22
          },
          {
            "text": "    &lt;div id=\"container\"&gt;",
            "lineNumber": 23
          },
          {
            "text": "        &lt;div id=\"graph\"&gt;&lt;/div&gt;",
            "lineNumber": 24
          },
          {
            "text": "    &lt;/div&gt;",
            "lineNumber": 25
          },
          {
            "text": "    &lt;script&gt;",
            "lineNumber": 26
          },
          {
            "text": "        mermaid.initialize({ startOnLoad: false, theme: 'default' });",
            "lineNumber": 27
          },
          {
            "lineNumber": 28
          },
          {
            "text": "        // ãƒãƒ¼ãƒ‰IDã‚’æŠ½å‡ºã™ã‚‹é–¢æ•°",
            "lineNumber": 29
          },
          {
            "text": "        function extractNodeId(nodeElement) {",
            "lineNumber": 30
          },
          {
            "text": "            // Mermaid.jsã®æ§‹é€ : g.nodeè¦ç´ å†…ã®textè¦ç´ ã‹ã‚‰ãƒãƒ¼ãƒ‰IDã‚’å–å¾—",
            "lineNumber": 31
          },
          {
            "text": "            // ãƒãƒ¼ãƒ‰IDã¯é€šå¸¸ã€textè¦ç´ ã®æœ€åˆã®tspanã¾ãŸã¯textContentã«å«ã¾ã‚Œã‚‹",
            "lineNumber": 32
          },
          {
            "text": "            const textElement = nodeElement.querySelector('text');",
            "lineNumber": 33
          },
          {
            "text": "            if (!textElement) return null;",
            "lineNumber": 34
          },
          {
            "text": "            ",
            "lineNumber": 35
          },
          {
            "text": "            // ãƒãƒ¼ãƒ‰IDã¯é€šå¸¸ã€Mermaidã®å†…éƒ¨IDã¨ã—ã¦gè¦ç´ ã®idå±æ€§ã«å«ã¾ã‚Œã‚‹",
            "lineNumber": 36
          },
          {
            "text": "            // ã¾ãŸã¯ã€textè¦ç´ ã®å†…å®¹ã‹ã‚‰æ¨æ¸¬ã™ã‚‹",
            "lineNumber": 37
          },
          {
            "text": "            // Mermaid.jsã®æ§‹é€ : g.node[id=\"flowchart-node-id\"]",
            "lineNumber": 38
          },
          {
            "text": "            const nodeId = nodeElement.getAttribute('id');",
            "lineNumber": 39
          },
          {
            "text": "            if (nodeId) {",
            "lineNumber": 40
          },
          {
            "text": "                // Mermaidã®IDå½¢å¼ã‹ã‚‰å®Ÿéš›ã®ãƒãƒ¼ãƒ‰IDã‚’æŠ½å‡º",
            "lineNumber": 41
          },
          {
            "text": "                // ä¾‹: \"flowchart-node-id\" -&gt; \"node-id\"",
            "lineNumber": 42
          },
          {
            "text": "                const match = nodeId.match(/flowchart-([^-]+(?:-[^-]+)*)/);",
            "lineNumber": 43
          },
          {
            "text": "                if (match) {",
            "lineNumber": 44
          },
          {
            "text": "                    return match[1];",
            "lineNumber": 45
          },
          {
            "text": "                }",
            "lineNumber": 46
          },
          {
            "text": "                // åˆ¥ã®å½¢å¼: ç›´æ¥IDãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆ",
            "lineNumber": 47
          },
          {
            "text": "                return nodeId.replace('flowchart-', '');",
            "lineNumber": 48
          },
          {
            "text": "            }",
            "lineNumber": 49
          },
          {
            "text": "            ",
            "lineNumber": 50
          },
          {
            "text": "            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: textè¦ç´ ã®å†…å®¹ã‹ã‚‰æ¨æ¸¬ï¼ˆæœ€åˆã®è¡Œã‚’IDã¨ã—ã¦ä½¿ç”¨ï¼‰",
            "lineNumber": 51
          },
          {
            "text": "            const textContent = textElement.textContent || '';",
            "lineNumber": 52
          },
          {
            "text": "            const firstLine = textContent.split('\\n')[0].trim();",
            "lineNumber": 53
          },
          {
            "text": "            return firstLine || null;",
            "lineNumber": 54
          },
          {
            "text": "        }",
            "lineNumber": 55
          },
          {
            "text": "        ",
            "lineNumber": 56
          },
          {
            "text": "        // ãƒãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹é–¢æ•°",
            "lineNumber": 57
          },
          {
            "text": "        function toggleNodeHighlight(nodeElement) {",
            "lineNumber": 58
          },
          {
            "text": "            const rect = nodeElement.querySelector('rect, circle, polygon');",
            "lineNumber": 59
          }
        ]
      },
      "score": 0.1814630627632141
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 48,
            "column": 47
          }
        },
        "contents": "import streamlit as st\nimport streamlit.components.v1 as components\nimport base64\nfrom core.schemas import Node, Edge, Flowchart\nfrom core.llm_client import LLMClient\nfrom core.toon_parser import TOONParser\nfrom core.history_mgr import HistoryManager\nfrom core.exceptions import LLMAPIError, TOONParseError, FlowchartValidationError\nfrom core.flow_extractor import FlowExtractor\nfrom core.flow_merger import FlowMerger\nfrom pathlib import Path\n\nst.set_page_config(layout=\"wide\")\nst.title(\"Flowchart Generator &amp; History Manager\")\n\n# 1. ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–\nhistory_mgr = HistoryManager()\n\n# 2. ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´ã®åˆæœŸåŒ–\nif 'history' not in st.session_state:\n    # åˆæœŸçŠ¶æ…‹ï¼šé–‹å§‹ã¨çµ‚äº†ã®ã¿ã®æ§‹æˆ\n    initial_flow = Flowchart(\n        nodes=[\n            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),\n            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")\n        ],\n        edges=[Edge(source=\"start\", target=\"node_end\")]\n    )\n    st.session_state.history = [initial_flow]\n\n# 3. è³ªå•å¿œç­”ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®åˆæœŸåŒ–\nif 'conversation_context' not in st.session_state:\n    st.session_state.conversation_context = None  # å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\nif 'pending_questions' not in st.session_state:\n    st.session_state.pending_questions = None  # ç¾åœ¨ã®è³ªå•ãƒ†ã‚­ã‚¹ãƒˆ\nif 'question_responses' not in st.session_state:\n    st.session_state.question_responses = []  # å›ç­”ã®ãƒªã‚¹ãƒˆ\nif 'append_mode_for_question' not in st.session_state:\n    st.session_state.append_mode_for_question = False  # è³ªå•æ™‚ã®å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®š\nif 'question_count' not in st.session_state:\n    st.session_state.question_count = 0  # è³ªå•å›æ•°ã®ã‚«ã‚¦ãƒ³ãƒˆï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼‰\nif 'selected_node_ids' not in st.session_state:\n    st.session_state.selected_node_ids = []  # é¸æŠã•ã‚ŒãŸãƒãƒ¼ãƒ‰IDã®ãƒªã‚¹ãƒˆ\nif 'selection_mode' not in st.session_state:\n    st.session_state.selection_mode = 'text'  # 'text' or 'ui'\nMAX_QUESTION_COUNT = 5  # è³ªå•å›æ•°ã®ä¸Šé™\n\n# --- ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼šã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† ---\nst.sidebar.header(\"ğŸ’¾ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†\")",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import streamlit as st",
            "lineNumber": 1
          },
          {
            "text": "import streamlit.components.v1 as components",
            "lineNumber": 2
          },
          {
            "text": "import base64",
            "lineNumber": 3
          },
          {
            "text": "from core.schemas import Node, Edge, Flowchart",
            "lineNumber": 4
          },
          {
            "text": "from core.llm_client import LLMClient",
            "lineNumber": 5
          },
          {
            "text": "from core.toon_parser import TOONParser",
            "lineNumber": 6
          },
          {
            "text": "from core.history_mgr import HistoryManager",
            "lineNumber": 7
          },
          {
            "text": "from core.exceptions import LLMAPIError, TOONParseError, FlowchartValidationError",
            "lineNumber": 8
          },
          {
            "text": "from core.flow_extractor import FlowExtractor",
            "lineNumber": 9
          },
          {
            "text": "from core.flow_merger import FlowMerger",
            "lineNumber": 10
          },
          {
            "text": "from pathlib import Path",
            "lineNumber": 11
          },
          {
            "lineNumber": 12
          },
          {
            "text": "st.set_page_config(layout=\"wide\")",
            "lineNumber": 13
          },
          {
            "text": "st.title(\"Flowchart Generator &amp; History Manager\")",
            "lineNumber": 14
          },
          {
            "lineNumber": 15
          },
          {
            "text": "# 1. ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–",
            "lineNumber": 16
          },
          {
            "text": "history_mgr = HistoryManager()",
            "lineNumber": 17
          },
          {
            "lineNumber": 18
          },
          {
            "text": "# 2. ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´ã®åˆæœŸåŒ–",
            "lineNumber": 19
          },
          {
            "text": "if 'history' not in st.session_state:",
            "lineNumber": 20
          },
          {
            "text": "    # åˆæœŸçŠ¶æ…‹ï¼šé–‹å§‹ã¨çµ‚äº†ã®ã¿ã®æ§‹æˆ",
            "lineNumber": 21
          },
          {
            "text": "    initial_flow = Flowchart(",
            "lineNumber": 22
          },
          {
            "text": "        nodes=[",
            "lineNumber": 23
          },
          {
            "text": "            Node(id=\"start\", label=\"é–‹å§‹\", type=\"start\"),",
            "lineNumber": 24
          },
          {
            "text": "            Node(id=\"node_end\", label=\"çµ‚äº†\", type=\"end\")",
            "lineNumber": 25
          },
          {
            "text": "        ],",
            "lineNumber": 26
          },
          {
            "text": "        edges=[Edge(source=\"start\", target=\"node_end\")]",
            "lineNumber": 27
          },
          {
            "text": "    )",
            "lineNumber": 28
          },
          {
            "text": "    st.session_state.history = [initial_flow]",
            "lineNumber": 29
          },
          {
            "lineNumber": 30
          },
          {
            "text": "# 3. è³ªå•å¿œç­”ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®åˆæœŸåŒ–",
            "lineNumber": 31
          },
          {
            "text": "if 'conversation_context' not in st.session_state:",
            "lineNumber": 32
          },
          {
            "text": "    st.session_state.conversation_context = None  # å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ",
            "lineNumber": 33
          },
          {
            "text": "if 'pending_questions' not in st.session_state:",
            "lineNumber": 34
          },
          {
            "text": "    st.session_state.pending_questions = None  # ç¾åœ¨ã®è³ªå•ãƒ†ã‚­ã‚¹ãƒˆ",
            "lineNumber": 35
          },
          {
            "text": "if 'question_responses' not in st.session_state:",
            "lineNumber": 36
          },
          {
            "text": "    st.session_state.question_responses = []  # å›ç­”ã®ãƒªã‚¹ãƒˆ",
            "lineNumber": 37
          },
          {
            "text": "if 'append_mode_for_question' not in st.session_state:",
            "lineNumber": 38
          },
          {
            "text": "    st.session_state.append_mode_for_question = False  # è³ªå•æ™‚ã®å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®š",
            "lineNumber": 39
          },
          {
            "text": "if 'question_count' not in st.session_state:",
            "lineNumber": 40
          },
          {
            "text": "    st.session_state.question_count = 0  # è³ªå•å›æ•°ã®ã‚«ã‚¦ãƒ³ãƒˆï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼‰",
            "lineNumber": 41
          },
          {
            "text": "if 'selected_node_ids' not in st.session_state:",
            "lineNumber": 42
          },
          {
            "text": "    st.session_state.selected_node_ids = []  # é¸æŠã•ã‚ŒãŸãƒãƒ¼ãƒ‰IDã®ãƒªã‚¹ãƒˆ",
            "lineNumber": 43
          },
          {
            "text": "if 'selection_mode' not in st.session_state:",
            "lineNumber": 44
          },
          {
            "text": "    st.session_state.selection_mode = 'text'  # 'text' or 'ui'",
            "lineNumber": 45
          },
          {
            "text": "MAX_QUESTION_COUNT = 5  # è³ªå•å›æ•°ã®ä¸Šé™",
            "lineNumber": 46
          },
          {
            "lineNumber": 47
          },
          {
            "text": "# --- ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼šã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† ---",
            "lineNumber": 48
          },
          {
            "text": "st.sidebar.header(\"ğŸ’¾ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†\")",
            "lineNumber": 49
          }
        ]
      },
      "score": 0.1725699007511139
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 588,
            "column": 5
          },
          "endPosition": {
            "line": 631,
            "column": 6
          }
        },
        "contents": "    \n    # ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›\n    if selection_mode in [\"ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›\", \"ä¸¡æ–¹\"]:\n        node_ids_input = st.text_input(\n            \"ãƒãƒ¼ãƒ‰IDï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰\",\n            placeholder=\"ä¾‹: task1, task2, decision1\",\n            help=\"å¤‰æ›´ã—ãŸã„ãƒãƒ¼ãƒ‰ã®IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚startã¨endã¯é¸æŠã§ãã¾ã›ã‚“ã€‚\",\n            key=\"node_ids_input\"\n        )\n        \n        if node_ids_input:\n            selected_ids = [id.strip() for id in node_ids_input.split(\",\")]\n            # startã¨endã‚’é™¤å¤–\n            selected_ids = [id for id in selected_ids \n                          if id not in [\"start\", \"node_end\"]]\n            # å­˜åœ¨ãƒã‚§ãƒƒã‚¯\n            valid_ids = [id for id in selected_ids \n                        if id in [n.id for n in current_flow.nodes]]\n            invalid_ids = [id for id in selected_ids if id not in valid_ids]\n            \n            if invalid_ids:\n                st.warning(f\"å­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰ID: {invalid_ids}\")\n            \n            # ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°ï¼ˆæ—¢å­˜ã®é¸æŠã«è¿½åŠ ï¼‰\n            if 'selected_node_ids' not in st.session_state:\n                st.session_state.selected_node_ids = []\n            # ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã§æŒ‡å®šã•ã‚ŒãŸIDã‚’è¿½åŠ ï¼ˆé‡è¤‡ã‚’é¿ã‘ã‚‹ï¼‰\n            for node_id in valid_ids:\n                if node_id not in st.session_state.selected_node_ids:\n                    st.session_state.selected_node_ids.append(node_id)\n    \n    # UIé¸æŠã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†ï¼ˆJavaScriptã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸãƒãƒ¼ãƒ‰é¸æŠã‚’å‡¦ç†ï¼‰\n    if 'node_selected_from_ui' in st.session_state:\n        selected_node_id = st.session_state.node_selected_from_ui\n        if selected_node_id and selected_node_id not in [\"start\", \"node_end\"]:\n            if selected_node_id in [n.id for n in current_flow.nodes]:\n                if selected_node_id not in st.session_state.selected_node_ids:\n                    st.session_state.selected_node_ids.append(selected_node_id)\n        # å‡¦ç†å¾Œã¯ã‚¯ãƒªã‚¢\n        del st.session_state.node_selected_from_ui\n    \n    # é¸æŠã•ã‚ŒãŸãƒãƒ¼ãƒ‰ã®è¡¨ç¤º\n    if",
        "signatures": {},
        "detailedLines": [
          {
            "text": "    ",
            "lineNumber": 590
          },
          {
            "text": "    # ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›",
            "lineNumber": 591
          },
          {
            "text": "    if selection_mode in [\"ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›\", \"ä¸¡æ–¹\"]:",
            "lineNumber": 592
          },
          {
            "text": "        node_ids_input = st.text_input(",
            "lineNumber": 593
          },
          {
            "text": "            \"ãƒãƒ¼ãƒ‰IDï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰\",",
            "lineNumber": 594
          },
          {
            "text": "            placeholder=\"ä¾‹: task1, task2, decision1\",",
            "lineNumber": 595
          },
          {
            "text": "            help=\"å¤‰æ›´ã—ãŸã„ãƒãƒ¼ãƒ‰ã®IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚startã¨endã¯é¸æŠã§ãã¾ã›ã‚“ã€‚\",",
            "lineNumber": 596
          },
          {
            "text": "            key=\"node_ids_input\"",
            "lineNumber": 597
          },
          {
            "text": "        )",
            "lineNumber": 598
          },
          {
            "text": "        ",
            "lineNumber": 599
          },
          {
            "text": "        if node_ids_input:",
            "lineNumber": 600
          },
          {
            "text": "            selected_ids = [id.strip() for id in node_ids_input.split(\",\")]",
            "lineNumber": 601
          },
          {
            "text": "            # startã¨endã‚’é™¤å¤–",
            "lineNumber": 602
          },
          {
            "text": "            selected_ids = [id for id in selected_ids ",
            "lineNumber": 603
          },
          {
            "text": "                          if id not in [\"start\", \"node_end\"]]",
            "lineNumber": 604
          },
          {
            "text": "            # å­˜åœ¨ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 605
          },
          {
            "text": "            valid_ids = [id for id in selected_ids ",
            "lineNumber": 606
          },
          {
            "text": "                        if id in [n.id for n in current_flow.nodes]]",
            "lineNumber": 607
          },
          {
            "text": "            invalid_ids = [id for id in selected_ids if id not in valid_ids]",
            "lineNumber": 608
          },
          {
            "text": "            ",
            "lineNumber": 609
          },
          {
            "text": "            if invalid_ids:",
            "lineNumber": 610
          },
          {
            "text": "                st.warning(f\"å­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰ID: {invalid_ids}\")",
            "lineNumber": 611
          },
          {
            "text": "            ",
            "lineNumber": 612
          },
          {
            "text": "            # ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°ï¼ˆæ—¢å­˜ã®é¸æŠã«è¿½åŠ ï¼‰",
            "lineNumber": 613
          },
          {
            "text": "            if 'selected_node_ids' not in st.session_state:",
            "lineNumber": 614
          },
          {
            "text": "                st.session_state.selected_node_ids = []",
            "lineNumber": 615
          },
          {
            "text": "            # ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã§æŒ‡å®šã•ã‚ŒãŸIDã‚’è¿½åŠ ï¼ˆé‡è¤‡ã‚’é¿ã‘ã‚‹ï¼‰",
            "lineNumber": 616
          },
          {
            "text": "            for node_id in valid_ids:",
            "lineNumber": 617
          },
          {
            "text": "                if node_id not in st.session_state.selected_node_ids:",
            "lineNumber": 618
          },
          {
            "text": "                    st.session_state.selected_node_ids.append(node_id)",
            "lineNumber": 619
          },
          {
            "text": "    ",
            "lineNumber": 620
          },
          {
            "text": "    # UIé¸æŠã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†ï¼ˆJavaScriptã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸãƒãƒ¼ãƒ‰é¸æŠã‚’å‡¦ç†ï¼‰",
            "lineNumber": 621
          },
          {
            "text": "    if 'node_selected_from_ui' in st.session_state:",
            "lineNumber": 622
          },
          {
            "text": "        selected_node_id = st.session_state.node_selected_from_ui",
            "lineNumber": 623
          },
          {
            "text": "        if selected_node_id and selected_node_id not in [\"start\", \"node_end\"]:",
            "lineNumber": 624
          },
          {
            "text": "            if selected_node_id in [n.id for n in current_flow.nodes]:",
            "lineNumber": 625
          },
          {
            "text": "                if selected_node_id not in st.session_state.selected_node_ids:",
            "lineNumber": 626
          },
          {
            "text": "                    st.session_state.selected_node_ids.append(selected_node_id)",
            "lineNumber": 627
          },
          {
            "text": "        # å‡¦ç†å¾Œã¯ã‚¯ãƒªã‚¢",
            "lineNumber": 628
          },
          {
            "text": "        del st.session_state.node_selected_from_ui",
            "lineNumber": 629
          },
          {
            "text": "    ",
            "lineNumber": 630
          },
          {
            "text": "    # é¸æŠã•ã‚ŒãŸãƒãƒ¼ãƒ‰ã®è¡¨ç¤º",
            "lineNumber": 631
          },
          {
            "text": "    if",
            "lineNumber": 632
          }
        ]
      },
      "score": 0.17160560190677643
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 128,
            "column": 43
          },
          "endPosition": {
            "line": 165,
            "column": 37
          }
        },
        "contents": "try:\n    ollama_config = st.secrets.get(\"ollama\", {})\n    base_url = ollama_config.get(\"base_url\", \"http://localhost:11434\")\n    model = ollama_config.get(\"model\", \"llama3.2\")\n    config_source = \"secrets.toml\"\nexcept (AttributeError, FileNotFoundError, ImportError, RuntimeError):\n    import os\n    base_url = os.getenv(\"OLLAMA_BASE_URL\", \"http://localhost:11434\")\n    model = os.getenv(\"OLLAMA_MODEL\", \"llama3.2\")\n    config_source = \"ç’°å¢ƒå¤‰æ•°\"\n\nst.sidebar.text(f\"è¨­å®šå…ƒ: {config_source}\")\nst.sidebar.text(f\"ãƒ™ãƒ¼ã‚¹URL: {base_url}\")\nst.sidebar.text(f\"ãƒ¢ãƒ‡ãƒ«: {model}\")\n\n# --- æç”»ã¨å±¥æ­´ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ ---\nst.divider()\n\n# å±¥æ­´ã‚’é¡ã‚‹ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼\nif len(st.session_state.history) &gt; 1:\n    history_index = st.sidebar.slider(\n        \"å±¥æ­´ã‚’é¡ã‚‹\", \n        min_value=0, \n        max_value=len(st.session_state.history) - 1, \n        value=len(st.session_state.history) - 1\n    )\nelse:\n    history_index = 0\n    st.sidebar.info(\"ç¾åœ¨ã¯åˆæœŸçŠ¶æ…‹ã§ã™ã€‚\")\n\ncurrent_flow = st.session_state.history[history_index]\n\n# 3ãƒšã‚¤ãƒ³æ§‹æˆ: å·¦ï¼ˆChat/Inputï¼‰ã€ä¸­å¤®ï¼ˆFlowchartï¼‰ã€å³ï¼ˆSourceï¼‰\ncol_chat, col_flow, col_source = st.columns([1, 2, 1])\n\nwith col_chat:\n    st.subheader(\"ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ\")",
        "signatures": {},
        "detailedLines": [
          {
            "text": "try:",
            "lineNumber": 130
          },
          {
            "text": "    ollama_config = st.secrets.get(\"ollama\", {})",
            "lineNumber": 131
          },
          {
            "text": "    base_url = ollama_config.get(\"base_url\", \"http://localhost:11434\")",
            "lineNumber": 132
          },
          {
            "text": "    model = ollama_config.get(\"model\", \"llama3.2\")",
            "lineNumber": 133
          },
          {
            "text": "    config_source = \"secrets.toml\"",
            "lineNumber": 134
          },
          {
            "text": "except (AttributeError, FileNotFoundError, ImportError, RuntimeError):",
            "lineNumber": 135
          },
          {
            "text": "    import os",
            "lineNumber": 136
          },
          {
            "text": "    base_url = os.getenv(\"OLLAMA_BASE_URL\", \"http://localhost:11434\")",
            "lineNumber": 137
          },
          {
            "text": "    model = os.getenv(\"OLLAMA_MODEL\", \"llama3.2\")",
            "lineNumber": 138
          },
          {
            "text": "    config_source = \"ç’°å¢ƒå¤‰æ•°\"",
            "lineNumber": 139
          },
          {
            "lineNumber": 140
          },
          {
            "text": "st.sidebar.text(f\"è¨­å®šå…ƒ: {config_source}\")",
            "lineNumber": 141
          },
          {
            "text": "st.sidebar.text(f\"ãƒ™ãƒ¼ã‚¹URL: {base_url}\")",
            "lineNumber": 142
          },
          {
            "text": "st.sidebar.text(f\"ãƒ¢ãƒ‡ãƒ«: {model}\")",
            "lineNumber": 143
          },
          {
            "lineNumber": 144
          },
          {
            "text": "# --- æç”»ã¨å±¥æ­´ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ ---",
            "lineNumber": 145
          },
          {
            "text": "st.divider()",
            "lineNumber": 146
          },
          {
            "lineNumber": 147
          },
          {
            "text": "# å±¥æ­´ã‚’é¡ã‚‹ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼",
            "lineNumber": 148
          },
          {
            "text": "if len(st.session_state.history) &gt; 1:",
            "lineNumber": 149
          },
          {
            "text": "    history_index = st.sidebar.slider(",
            "lineNumber": 150
          },
          {
            "text": "        \"å±¥æ­´ã‚’é¡ã‚‹\", ",
            "lineNumber": 151
          },
          {
            "text": "        min_value=0, ",
            "lineNumber": 152
          },
          {
            "text": "        max_value=len(st.session_state.history) - 1, ",
            "lineNumber": 153
          },
          {
            "text": "        value=len(st.session_state.history) - 1",
            "lineNumber": 154
          },
          {
            "text": "    )",
            "lineNumber": 155
          },
          {
            "text": "else:",
            "lineNumber": 156
          },
          {
            "text": "    history_index = 0",
            "lineNumber": 157
          },
          {
            "text": "    st.sidebar.info(\"ç¾åœ¨ã¯åˆæœŸçŠ¶æ…‹ã§ã™ã€‚\")",
            "lineNumber": 158
          },
          {
            "lineNumber": 159
          },
          {
            "text": "current_flow = st.session_state.history[history_index]",
            "lineNumber": 160
          },
          {
            "lineNumber": 161
          },
          {
            "text": "# 3ãƒšã‚¤ãƒ³æ§‹æˆ: å·¦ï¼ˆChat/Inputï¼‰ã€ä¸­å¤®ï¼ˆFlowchartï¼‰ã€å³ï¼ˆSourceï¼‰",
            "lineNumber": 162
          },
          {
            "text": "col_chat, col_flow, col_source = st.columns([1, 2, 1])",
            "lineNumber": 163
          },
          {
            "lineNumber": 164
          },
          {
            "text": "with col_chat:",
            "lineNumber": 165
          },
          {
            "text": "    st.subheader(\"ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ\")",
            "lineNumber": 166
          }
        ]
      },
      "score": 0.1674834042787552
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 419,
            "column": 186
          },
          "endPosition": {
            "line": 454,
            "column": 22
          }
        },
        "contents": "                            st.rerun()\n                    else:\n                        # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼\n                        is_valid, validation_message = client.validate_output_size(raw_toon_text)\n                        if not is_valid:\n                            st.warning(validation_message)\n                            st.info(\"ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã‹ã€ãƒ•ãƒ­ãƒ¼ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\")\n                        \n                        # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹\n                        new_flow = TOONParser.parse(raw_toon_text)\n                        \n                        # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨\n                        new_flow = new_flow.apply_logic_gap_detection()\n                        \n                        # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ\n                        if append_mode:\n                            merged_flow = history_mgr.append_toon_log(session_name, new_flow)\n                            st.session_state.history.append(merged_flow)\n                            st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")\n                        else:\n                            # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ \n                            st.session_state.history.append(new_flow)\n                        \n                        # æˆåŠŸæ™‚ã®ã¿è³ªå•å›æ•°ã‚’ãƒªã‚»ãƒƒãƒˆ\n                        st.session_state.question_count = 0\n                        st.rerun()\n                except LLMAPIError as e:\n                    # LLM APIã‚¨ãƒ©ãƒ¼\n                    st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {e}\")\n                    st.info(\"OllamaãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ã€ãƒ¢ãƒ‡ãƒ«ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚\")\n                    # ã‚¨ãƒ©ãƒ¼æ™‚ã¯st.rerun()ã‚’å‘¼ã°ãªã„ï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼‰\n                except TOONParseError as e:\n                    # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼\n                    # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯\n                    if",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                            st.rerun()",
            "lineNumber": 421
          },
          {
            "text": "                    else:",
            "lineNumber": 422
          },
          {
            "text": "                        # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼",
            "lineNumber": 423
          },
          {
            "text": "                        is_valid, validation_message = client.validate_output_size(raw_toon_text)",
            "lineNumber": 424
          },
          {
            "text": "                        if not is_valid:",
            "lineNumber": 425
          },
          {
            "text": "                            st.warning(validation_message)",
            "lineNumber": 426
          },
          {
            "text": "                            st.info(\"ä¸»è¦ãªãƒ«ãƒ¼ãƒˆã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã‹ã€ãƒ•ãƒ­ãƒ¼ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 427
          },
          {
            "text": "                        ",
            "lineNumber": 428
          },
          {
            "text": "                        # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹",
            "lineNumber": 429
          },
          {
            "text": "                        new_flow = TOONParser.parse(raw_toon_text)",
            "lineNumber": 430
          },
          {
            "text": "                        ",
            "lineNumber": 431
          },
          {
            "text": "                        # è«–ç†ã®ç©´æ¤œçŸ¥ã‚’é©ç”¨",
            "lineNumber": 432
          },
          {
            "text": "                        new_flow = new_flow.apply_logic_gap_detection()",
            "lineNumber": 433
          },
          {
            "text": "                        ",
            "lineNumber": 434
          },
          {
            "text": "                        # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ",
            "lineNumber": 435
          },
          {
            "text": "                        if append_mode:",
            "lineNumber": 436
          },
          {
            "text": "                            merged_flow = history_mgr.append_toon_log(session_name, new_flow)",
            "lineNumber": 437
          },
          {
            "text": "                            st.session_state.history.append(merged_flow)",
            "lineNumber": 438
          },
          {
            "text": "                            st.success(f\"'{session_name}' ã®TOONãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ã‚’è¿½è¨˜ã—ã¾ã—ãŸ\")",
            "lineNumber": 439
          },
          {
            "text": "                        else:",
            "lineNumber": 440
          },
          {
            "text": "                            # é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šå±¥æ­´ã«è¿½åŠ ",
            "lineNumber": 441
          },
          {
            "text": "                            st.session_state.history.append(new_flow)",
            "lineNumber": 442
          },
          {
            "text": "                        ",
            "lineNumber": 443
          },
          {
            "text": "                        # æˆåŠŸæ™‚ã®ã¿è³ªå•å›æ•°ã‚’ãƒªã‚»ãƒƒãƒˆ",
            "lineNumber": 444
          },
          {
            "text": "                        st.session_state.question_count = 0",
            "lineNumber": 445
          },
          {
            "text": "                        st.rerun()",
            "lineNumber": 446
          },
          {
            "text": "                except LLMAPIError as e:",
            "lineNumber": 447
          },
          {
            "text": "                    # LLM APIã‚¨ãƒ©ãƒ¼",
            "lineNumber": 448
          },
          {
            "text": "                    st.error(f\"LLM APIã‚¨ãƒ©ãƒ¼: {e}\")",
            "lineNumber": 449
          },
          {
            "text": "                    st.info(\"OllamaãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ã€ãƒ¢ãƒ‡ãƒ«ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 450
          },
          {
            "text": "                    # ã‚¨ãƒ©ãƒ¼æ™‚ã¯st.rerun()ã‚’å‘¼ã°ãªã„ï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼‰",
            "lineNumber": 451
          },
          {
            "text": "                except TOONParseError as e:",
            "lineNumber": 452
          },
          {
            "text": "                    # TOONå½¢å¼ã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼",
            "lineNumber": 453
          },
          {
            "text": "                    # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 454
          },
          {
            "text": "                    if",
            "lineNumber": 455
          }
        ]
      },
      "score": 0.16004660725593567
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 194,
            "column": 51
          },
          "endPosition": {
            "line": 224,
            "column": 20
          }
        },
        "contents": "        with col_answer:\n            if st.button(\"å›ç­”ã‚’é€ä¿¡\", type=\"primary\", use_container_width=True):\n                if user_answer:\n                    # å›ç­”ã‚’åé›†\n                    st.session_state.question_responses.append(user_answer)\n                    \n                    # å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€è³ªå•ã€å›ç­”ã‚’çµ„ã¿åˆã‚ã›ã¦å†é€ä¿¡\n                    combined_prompt = st.session_state.conversation_context\n                    if st.session_state.pending_questions:\n                        combined_prompt += f\"\\n\\nè³ªå•:\\n{st.session_state.pending_questions}\\n\"\n                    if st.session_state.question_responses:\n                        combined_prompt += \"\\n\\nå›ç­”:\\n\"\n                        for i, response in enumerate(st.session_state.question_responses, 1):\n                            combined_prompt += f\"{i}. {response}\\n\"\n                    \n                    # è³ªå•æ™‚ã®å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜\n                    append_mode_flag = st.session_state.append_mode_for_question\n                    \n                    # ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ä¸€æ™‚çš„ã«ä¿å­˜ï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ã«å¾©å…ƒã™ã‚‹ãŸã‚ï¼‰\n                    temp_context = st.session_state.conversation_context\n                    temp_questions = st.session_state.pending_questions\n                    temp_responses = st.session_state.question_responses.copy()\n                    \n                    # å†é€ä¿¡å‡¦ç†\n                    progress_bar = st.progress(0)\n                    status_text = st.empty()\n                    status_text.info(\"LLMãŒãƒ•ãƒ­ãƒ¼ã‚’è¨­è¨ˆä¸­...ï¼ˆæœ€å¤§2åˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼‰\")\n                    progress_bar.progress(10)\n                    \n                    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "        with col_answer:",
            "lineNumber": 196
          },
          {
            "text": "            if st.button(\"å›ç­”ã‚’é€ä¿¡\", type=\"primary\", use_container_width=True):",
            "lineNumber": 197
          },
          {
            "text": "                if user_answer:",
            "lineNumber": 198
          },
          {
            "text": "                    # å›ç­”ã‚’åé›†",
            "lineNumber": 199
          },
          {
            "text": "                    st.session_state.question_responses.append(user_answer)",
            "lineNumber": 200
          },
          {
            "text": "                    ",
            "lineNumber": 201
          },
          {
            "text": "                    # å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€è³ªå•ã€å›ç­”ã‚’çµ„ã¿åˆã‚ã›ã¦å†é€ä¿¡",
            "lineNumber": 202
          },
          {
            "text": "                    combined_prompt = st.session_state.conversation_context",
            "lineNumber": 203
          },
          {
            "text": "                    if st.session_state.pending_questions:",
            "lineNumber": 204
          },
          {
            "text": "                        combined_prompt += f\"\\n\\nè³ªå•:\\n{st.session_state.pending_questions}\\n\"",
            "lineNumber": 205
          },
          {
            "text": "                    if st.session_state.question_responses:",
            "lineNumber": 206
          },
          {
            "text": "                        combined_prompt += \"\\n\\nå›ç­”:\\n\"",
            "lineNumber": 207
          },
          {
            "text": "                        for i, response in enumerate(st.session_state.question_responses, 1):",
            "lineNumber": 208
          },
          {
            "text": "                            combined_prompt += f\"{i}. {response}\\n\"",
            "lineNumber": 209
          },
          {
            "text": "                    ",
            "lineNumber": 210
          },
          {
            "text": "                    # è³ªå•æ™‚ã®å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜",
            "lineNumber": 211
          },
          {
            "text": "                    append_mode_flag = st.session_state.append_mode_for_question",
            "lineNumber": 212
          },
          {
            "text": "                    ",
            "lineNumber": 213
          },
          {
            "text": "                    # ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ä¸€æ™‚çš„ã«ä¿å­˜ï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ã«å¾©å…ƒã™ã‚‹ãŸã‚ï¼‰",
            "lineNumber": 214
          },
          {
            "text": "                    temp_context = st.session_state.conversation_context",
            "lineNumber": 215
          },
          {
            "text": "                    temp_questions = st.session_state.pending_questions",
            "lineNumber": 216
          },
          {
            "text": "                    temp_responses = st.session_state.question_responses.copy()",
            "lineNumber": 217
          },
          {
            "text": "                    ",
            "lineNumber": 218
          },
          {
            "text": "                    # å†é€ä¿¡å‡¦ç†",
            "lineNumber": 219
          },
          {
            "text": "                    progress_bar = st.progress(0)",
            "lineNumber": 220
          },
          {
            "text": "                    status_text = st.empty()",
            "lineNumber": 221
          },
          {
            "text": "                    status_text.info(\"LLMãŒãƒ•ãƒ­ãƒ¼ã‚’è¨­è¨ˆä¸­...ï¼ˆæœ€å¤§2åˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼‰\")",
            "lineNumber": 222
          },
          {
            "text": "                    progress_bar.progress(10)",
            "lineNumber": 223
          },
          {
            "text": "                    ",
            "lineNumber": 224
          },
          {
            "text": "                    ",
            "lineNumber": 225
          }
        ]
      },
      "score": 0.1363365650177002
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 320,
            "column": 65
          },
          "endPosition": {
            "line": 350,
            "column": 14
          }
        },
        "contents": " temp_responses\n                            \n                            # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯\n                            if 'raw_toon_text' in locals() and raw_toon_text:\n                                try:\n                                    client = LLMClient()\n                                    if client.is_question_response(raw_toon_text):\n                                        # è³ªå•å›æ•°ã®ä¸Šé™ãƒã‚§ãƒƒã‚¯\n                                        st.session_state.question_count += 1\n                                        if st.session_state.question_count &gt;= MAX_QUESTION_COUNT:\n                                            st.error(f\"è³ªå•å›æ•°ãŒä¸Šé™ï¼ˆ{MAX_QUESTION_COUNT}å›ï¼‰ã«é”ã—ã¾ã—ãŸã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ãã ã•ã„ã€‚\")\n                                            st.session_state.conversation_context = None\n                                            st.session_state.pending_questions = None\n                                            st.session_state.question_responses = []\n                                            st.session_state.question_count = 0\n                                        else:\n                                            st.session_state.conversation_context = combined_prompt\n                                            st.session_state.pending_questions = raw_toon_text\n                                            st.session_state.question_responses = []\n                                            st.info(f\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ï¼ˆè³ªå•å›æ•°: {st.session_state.question_count}/{MAX_QUESTION_COUNT}ï¼‰\")\n                                            st.rerun()\n                                except:\n                                    pass\n                            \n                            st.error(f\"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}\")\n                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯st.rerun()ã‚’å‘¼ã°ãªã„ï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼‰\n                else:\n                    st.warning(\"å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n        \n        with col_cancel:\n            if",
        "signatures": {},
        "detailedLines": [
          {
            "text": " temp_responses",
            "lineNumber": 321
          },
          {
            "text": "                            ",
            "lineNumber": 322
          },
          {
            "text": "                            # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 323
          },
          {
            "text": "                            if 'raw_toon_text' in locals() and raw_toon_text:",
            "lineNumber": 324
          },
          {
            "text": "                                try:",
            "lineNumber": 325
          },
          {
            "text": "                                    client = LLMClient()",
            "lineNumber": 326
          },
          {
            "text": "                                    if client.is_question_response(raw_toon_text):",
            "lineNumber": 327
          },
          {
            "text": "                                        # è³ªå•å›æ•°ã®ä¸Šé™ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 328
          },
          {
            "text": "                                        st.session_state.question_count += 1",
            "lineNumber": 329
          },
          {
            "text": "                                        if st.session_state.question_count &gt;= MAX_QUESTION_COUNT:",
            "lineNumber": 330
          },
          {
            "text": "                                            st.error(f\"è³ªå•å›æ•°ãŒä¸Šé™ï¼ˆ{MAX_QUESTION_COUNT}å›ï¼‰ã«é”ã—ã¾ã—ãŸã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 331
          },
          {
            "text": "                                            st.session_state.conversation_context = None",
            "lineNumber": 332
          },
          {
            "text": "                                            st.session_state.pending_questions = None",
            "lineNumber": 333
          },
          {
            "text": "                                            st.session_state.question_responses = []",
            "lineNumber": 334
          },
          {
            "text": "                                            st.session_state.question_count = 0",
            "lineNumber": 335
          },
          {
            "text": "                                        else:",
            "lineNumber": 336
          },
          {
            "text": "                                            st.session_state.conversation_context = combined_prompt",
            "lineNumber": 337
          },
          {
            "text": "                                            st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 338
          },
          {
            "text": "                                            st.session_state.question_responses = []",
            "lineNumber": 339
          },
          {
            "text": "                                            st.info(f\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ï¼ˆè³ªå•å›æ•°: {st.session_state.question_count}/{MAX_QUESTION_COUNT}ï¼‰\")",
            "lineNumber": 340
          },
          {
            "text": "                                            st.rerun()",
            "lineNumber": 341
          },
          {
            "text": "                                except:",
            "lineNumber": 342
          },
          {
            "text": "                                    pass",
            "lineNumber": 343
          },
          {
            "text": "                            ",
            "lineNumber": 344
          },
          {
            "text": "                            st.error(f\"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}\")",
            "lineNumber": 345
          },
          {
            "text": "                            # ã‚¨ãƒ©ãƒ¼æ™‚ã¯st.rerun()ã‚’å‘¼ã°ãªã„ï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼‰",
            "lineNumber": 346
          },
          {
            "text": "                else:",
            "lineNumber": 347
          },
          {
            "text": "                    st.warning(\"å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 348
          },
          {
            "text": "        ",
            "lineNumber": 349
          },
          {
            "text": "        with col_cancel:",
            "lineNumber": 350
          },
          {
            "text": "            if",
            "lineNumber": 351
          }
        ]
      },
      "score": 0.13592064380645752
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\llm_client.py",
        "range": {
          "startPosition": {
            "line": 8
          },
          "endPosition": {
            "line": 395
          }
        },
        "contents": "class LLMClient:\ndef generate_flow(self, user_input: str, current_flowchart: Optional[Flowchart] = None) -&gt; str:\n\n            \n            # Ollama HTTP APIã‚’ç›´æ¥å‘¼ã³å‡ºã—\n            payload = {\n                \"model\": self.model,\n                \"messages\": [\n                    {\"role\": \"system\", \"content\": system_prompt},\n                    {\"role\": \"user\", \"content\": enhanced_input}\n                ],\n                \"options\": {\n                    \"temperature\": 0.7\n                },\n                \"stream\": False\n            }\n            \n            # localhostã¸ã®æ¥ç¶šã§ã¯ãƒ—ãƒ­ã‚­ã‚·ã‚’ä½¿ç”¨ã—ãªã„\n            proxies = {\"http\": None, \"https\": None} if \"localhost\" in self.base_url or \"127.0.0.1\" in self.base_url else None\n            \n            response = requests.post(\n                self.api_url,\n                json=payload,\n                timeout=120,  # 2åˆ†ã«çŸ­ç¸®ï¼ˆ300ç§’â†’120ç§’ï¼‰\n                proxies=proxies\n            )\n            \n            # HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯\n            response.raise_for_status()\n            \n            # JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è§£æ\n            result = response.json()\n            \n            if result and 'message' in result and 'content' in result['message']:\n                toon_text = result['message']['content']\n                \n                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼ï¼ˆè³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰\n                if not self.is_question_response(toon_text):\n                    is_valid, validation_message = self.validate_output_size(toon_text)\n                    if not is_valid:\n                        # è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’TOONå½¢å¼ã®å‰ã«è¿½åŠ ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆå½¢å¼ï¼‰\n                        warning_comment = f\"&lt;!-- {validation_message} --&gt;\\n\"\n                        toon_text = warning_comment + toon_text\n                \n                return toon_text\n            else:\n                raise ValueError(\"ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰æœ‰åŠ¹ãªå¿œç­”ãŒå¾—ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚\")\n                \n        except ValueError:\n            # å†ç™ºç”Ÿã•ã›ã‚‹\n            raise",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 9,
                "column": 1
              },
              "endPosition": {
                "line": 10,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 272,
                "column": 5
              },
              "endPosition": {
                "line": 273,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class LLMClient:",
            "lineNumber": 9,
            "isSignature": true
          },
          {
            "text": "def generate_flow(self, user_input: str, current_flowchart: Optional[Flowchart] = None) -&gt; str:",
            "lineNumber": 272
          },
          {
            "lineNumber": 301
          },
          {
            "text": "            ",
            "lineNumber": 302
          },
          {
            "text": "            # Ollama HTTP APIã‚’ç›´æ¥å‘¼ã³å‡ºã—",
            "lineNumber": 303
          },
          {
            "text": "            payload = {",
            "lineNumber": 304
          },
          {
            "text": "                \"model\": self.model,",
            "lineNumber": 305
          },
          {
            "text": "                \"messages\": [",
            "lineNumber": 306
          },
          {
            "text": "                    {\"role\": \"system\", \"content\": system_prompt},",
            "lineNumber": 307
          },
          {
            "text": "                    {\"role\": \"user\", \"content\": enhanced_input}",
            "lineNumber": 308
          },
          {
            "text": "                ],",
            "lineNumber": 309
          },
          {
            "text": "                \"options\": {",
            "lineNumber": 310
          },
          {
            "text": "                    \"temperature\": 0.7",
            "lineNumber": 311
          },
          {
            "text": "                },",
            "lineNumber": 312
          },
          {
            "text": "                \"stream\": False",
            "lineNumber": 313
          },
          {
            "text": "            }",
            "lineNumber": 314
          },
          {
            "text": "            ",
            "lineNumber": 315
          },
          {
            "text": "            # localhostã¸ã®æ¥ç¶šã§ã¯ãƒ—ãƒ­ã‚­ã‚·ã‚’ä½¿ç”¨ã—ãªã„",
            "lineNumber": 316
          },
          {
            "text": "            proxies = {\"http\": None, \"https\": None} if \"localhost\" in self.base_url or \"127.0.0.1\" in self.base_url else None",
            "lineNumber": 317
          },
          {
            "text": "            ",
            "lineNumber": 318
          },
          {
            "text": "            response = requests.post(",
            "lineNumber": 319
          },
          {
            "text": "                self.api_url,",
            "lineNumber": 320
          },
          {
            "text": "                json=payload,",
            "lineNumber": 321
          },
          {
            "text": "                timeout=120,  # 2åˆ†ã«çŸ­ç¸®ï¼ˆ300ç§’â†’120ç§’ï¼‰",
            "lineNumber": 322
          },
          {
            "text": "                proxies=proxies",
            "lineNumber": 323
          },
          {
            "text": "            )",
            "lineNumber": 324
          },
          {
            "text": "            ",
            "lineNumber": 325
          },
          {
            "text": "            # HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 326
          },
          {
            "text": "            response.raise_for_status()",
            "lineNumber": 327
          },
          {
            "text": "            ",
            "lineNumber": 328
          },
          {
            "text": "            # JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è§£æ",
            "lineNumber": 329
          },
          {
            "text": "            result = response.json()",
            "lineNumber": 330
          },
          {
            "text": "            ",
            "lineNumber": 331
          },
          {
            "text": "            if result and 'message' in result and 'content' in result['message']:",
            "lineNumber": 332
          },
          {
            "text": "                toon_text = result['message']['content']",
            "lineNumber": 333
          },
          {
            "text": "                ",
            "lineNumber": 334
          },
          {
            "text": "                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼ï¼ˆè³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰",
            "lineNumber": 335
          },
          {
            "text": "                if not self.is_question_response(toon_text):",
            "lineNumber": 336
          },
          {
            "text": "                    is_valid, validation_message = self.validate_output_size(toon_text)",
            "lineNumber": 337
          },
          {
            "text": "                    if not is_valid:",
            "lineNumber": 338
          },
          {
            "text": "                        # è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’TOONå½¢å¼ã®å‰ã«è¿½åŠ ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆå½¢å¼ï¼‰",
            "lineNumber": 339
          },
          {
            "text": "                        warning_comment = f\"&lt;!-- {validation_message} --&gt;\\n\"",
            "lineNumber": 340
          },
          {
            "text": "                        toon_text = warning_comment + toon_text",
            "lineNumber": 341
          },
          {
            "text": "                ",
            "lineNumber": 342
          },
          {
            "text": "                return toon_text",
            "lineNumber": 343
          },
          {
            "text": "            else:",
            "lineNumber": 344
          },
          {
            "text": "                raise ValueError(\"ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰æœ‰åŠ¹ãªå¿œç­”ãŒå¾—ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚\")",
            "lineNumber": 345
          },
          {
            "text": "                ",
            "lineNumber": 346
          },
          {
            "text": "        except ValueError:",
            "lineNumber": 347
          },
          {
            "text": "            # å†ç™ºç”Ÿã•ã›ã‚‹",
            "lineNumber": 348
          },
          {
            "text": "            raise",
            "lineNumber": 349
          }
        ]
      },
      "score": 0.13037550449371338
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 222,
            "column": 45
          },
          "endPosition": {
            "line": 249,
            "column": 60
          }
        },
        "contents": "                    \n                    try:\n                        client = LLMClient()\n                        raw_toon_text = client.generate_flow(combined_prompt, current_flow if append_mode_flag else None)\n                        progress_bar.progress(100)\n                        status_text.empty()\n                            \n                            # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯\n                            if client.is_question_response(raw_toon_text):\n                                # è³ªå•å›æ•°ã®ä¸Šé™ãƒã‚§ãƒƒã‚¯\n                                st.session_state.question_count += 1\n                                if st.session_state.question_count &gt;= MAX_QUESTION_COUNT:\n                                    st.error(f\"è³ªå•å›æ•°ãŒä¸Šé™ï¼ˆ{MAX_QUESTION_COUNT}å›ï¼‰ã«é”ã—ã¾ã—ãŸã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ãã ã•ã„ã€‚\")\n                                    st.session_state.conversation_context = None\n                                    st.session_state.pending_questions = None\n                                    st.session_state.question_responses = []\n                                    st.session_state.question_count = 0\n                                else:\n                                    # å†åº¦è³ªå•ãŒæ¥ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°\n                                    st.session_state.conversation_context = combined_prompt\n                                    st.session_state.pending_questions = raw_toon_text\n                                    st.session_state.question_responses = []  # æ–°ã—ã„è³ªå•ãªã®ã§å›ç­”ã‚’ãƒªã‚»ãƒƒãƒˆ\n                                    st.info(f\"LLMã‹ã‚‰è¿½åŠ ã®è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ï¼ˆè³ªå•å›æ•°: {st.session_state.question_count}/{MAX_QUESTION_COUNT}ï¼‰\")\n                                    st.rerun()\n                            else:\n                                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼\n                                is_valid, validation_message",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                    ",
            "lineNumber": 224
          },
          {
            "text": "                    try:",
            "lineNumber": 225
          },
          {
            "text": "                        client = LLMClient()",
            "lineNumber": 226
          },
          {
            "text": "                        raw_toon_text = client.generate_flow(combined_prompt, current_flow if append_mode_flag else None)",
            "lineNumber": 227
          },
          {
            "text": "                        progress_bar.progress(100)",
            "lineNumber": 228
          },
          {
            "text": "                        status_text.empty()",
            "lineNumber": 229
          },
          {
            "text": "                            ",
            "lineNumber": 230
          },
          {
            "text": "                            # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 231
          },
          {
            "text": "                            if client.is_question_response(raw_toon_text):",
            "lineNumber": 232
          },
          {
            "text": "                                # è³ªå•å›æ•°ã®ä¸Šé™ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 233
          },
          {
            "text": "                                st.session_state.question_count += 1",
            "lineNumber": 234
          },
          {
            "text": "                                if st.session_state.question_count &gt;= MAX_QUESTION_COUNT:",
            "lineNumber": 235
          },
          {
            "text": "                                    st.error(f\"è³ªå•å›æ•°ãŒä¸Šé™ï¼ˆ{MAX_QUESTION_COUNT}å›ï¼‰ã«é”ã—ã¾ã—ãŸã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 236
          },
          {
            "text": "                                    st.session_state.conversation_context = None",
            "lineNumber": 237
          },
          {
            "text": "                                    st.session_state.pending_questions = None",
            "lineNumber": 238
          },
          {
            "text": "                                    st.session_state.question_responses = []",
            "lineNumber": 239
          },
          {
            "text": "                                    st.session_state.question_count = 0",
            "lineNumber": 240
          },
          {
            "text": "                                else:",
            "lineNumber": 241
          },
          {
            "text": "                                    # å†åº¦è³ªå•ãŒæ¥ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°",
            "lineNumber": 242
          },
          {
            "text": "                                    st.session_state.conversation_context = combined_prompt",
            "lineNumber": 243
          },
          {
            "text": "                                    st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 244
          },
          {
            "text": "                                    st.session_state.question_responses = []  # æ–°ã—ã„è³ªå•ãªã®ã§å›ç­”ã‚’ãƒªã‚»ãƒƒãƒˆ",
            "lineNumber": 245
          },
          {
            "text": "                                    st.info(f\"LLMã‹ã‚‰è¿½åŠ ã®è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ï¼ˆè³ªå•å›æ•°: {st.session_state.question_count}/{MAX_QUESTION_COUNT}ï¼‰\")",
            "lineNumber": 246
          },
          {
            "text": "                                    st.rerun()",
            "lineNumber": 247
          },
          {
            "text": "                            else:",
            "lineNumber": 248
          },
          {
            "text": "                                # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼",
            "lineNumber": 249
          },
          {
            "text": "                                is_valid, validation_message",
            "lineNumber": 250
          }
        ]
      },
      "score": 0.12867939472198486
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 288,
            "column": 65
          },
          "endPosition": {
            "line": 309,
            "column": 44
          }
        },
        "contents": " temp_responses\n                            \n                            # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯\n                            if 'raw_toon_text' in locals() and raw_toon_text:\n                                if client.is_question_response(raw_toon_text):\n                                    # è³ªå•å›æ•°ã®ä¸Šé™ãƒã‚§ãƒƒã‚¯\n                                    st.session_state.question_count += 1\n                                    if st.session_state.question_count &gt;= MAX_QUESTION_COUNT:\n                                        st.error(f\"è³ªå•å›æ•°ãŒä¸Šé™ï¼ˆ{MAX_QUESTION_COUNT}å›ï¼‰ã«é”ã—ã¾ã—ãŸã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ãã ã•ã„ã€‚\")\n                                        st.session_state.conversation_context = None\n                                        st.session_state.pending_questions = None\n                                        st.session_state.question_responses = []\n                                        st.session_state.question_count = 0\n                                    else:\n                                        # è³ªå•å½¢å¼ã®å¿œç­”ã ã£ãŸå ´åˆ\n                                        st.session_state.conversation_context = combined_prompt\n                                        st.session_state.pending_questions = raw_toon_text\n                                        st.session_state.question_responses = []\n                                        st.info(f\"LLMã‹ã‚‰è¿½åŠ ã®è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ï¼ˆè³ªå•å›æ•°: {st.session_state.question_count}/{MAX_QUESTION_COUNT}ï¼‰\")\n                                        st.rerun()\n                                else:\n                                    st.error",
        "signatures": {},
        "detailedLines": [
          {
            "text": " temp_responses",
            "lineNumber": 289
          },
          {
            "text": "                            ",
            "lineNumber": 290
          },
          {
            "text": "                            # è³ªå•å½¢å¼ã®å¿œç­”ã®å¯èƒ½æ€§ã‚’ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 291
          },
          {
            "text": "                            if 'raw_toon_text' in locals() and raw_toon_text:",
            "lineNumber": 292
          },
          {
            "text": "                                if client.is_question_response(raw_toon_text):",
            "lineNumber": 293
          },
          {
            "text": "                                    # è³ªå•å›æ•°ã®ä¸Šé™ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 294
          },
          {
            "text": "                                    st.session_state.question_count += 1",
            "lineNumber": 295
          },
          {
            "text": "                                    if st.session_state.question_count &gt;= MAX_QUESTION_COUNT:",
            "lineNumber": 296
          },
          {
            "text": "                                        st.error(f\"è³ªå•å›æ•°ãŒä¸Šé™ï¼ˆ{MAX_QUESTION_COUNT}å›ï¼‰ã«é”ã—ã¾ã—ãŸã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 297
          },
          {
            "text": "                                        st.session_state.conversation_context = None",
            "lineNumber": 298
          },
          {
            "text": "                                        st.session_state.pending_questions = None",
            "lineNumber": 299
          },
          {
            "text": "                                        st.session_state.question_responses = []",
            "lineNumber": 300
          },
          {
            "text": "                                        st.session_state.question_count = 0",
            "lineNumber": 301
          },
          {
            "text": "                                    else:",
            "lineNumber": 302
          },
          {
            "text": "                                        # è³ªå•å½¢å¼ã®å¿œç­”ã ã£ãŸå ´åˆ",
            "lineNumber": 303
          },
          {
            "text": "                                        st.session_state.conversation_context = combined_prompt",
            "lineNumber": 304
          },
          {
            "text": "                                        st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 305
          },
          {
            "text": "                                        st.session_state.question_responses = []",
            "lineNumber": 306
          },
          {
            "text": "                                        st.info(f\"LLMã‹ã‚‰è¿½åŠ ã®è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ï¼ˆè³ªå•å›æ•°: {st.session_state.question_count}/{MAX_QUESTION_COUNT}ï¼‰\")",
            "lineNumber": 307
          },
          {
            "text": "                                        st.rerun()",
            "lineNumber": 308
          },
          {
            "text": "                                else:",
            "lineNumber": 309
          },
          {
            "text": "                                    st.error",
            "lineNumber": 310
          }
        ]
      },
      "score": 0.12815670669078827
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\core\\llm_client.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 395
          }
        },
        "contents": "import os\nimport requests\nimport re\nfrom pathlib import Path\nfrom typing import Optional\nfrom core.exceptions import LLMAPIError\nfrom core.schemas import Flowchart\n\nclass LLMClient:\n    def __init__(self):\n        # Streamlitã®secretsã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã‚€ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ä»˜ãï¼‰\n        try:\n            import streamlit as st\n            # st.secretsãŒåˆ©ç”¨å¯èƒ½ãªå ´åˆï¼ˆStreamlitå®Ÿè¡Œç’°å¢ƒï¼‰\n            ollama_config = st.secrets.get(\"ollama\", {})\n            self.base_url = ollama_config.get(\"base_url\", \"http://localhost:11434\")\n            self.model = ollama_config.get(\"model\", \"llama3.2\")\n        except (AttributeError, FileNotFoundError, ImportError, RuntimeError):\n            # secrets.tomlãŒå­˜åœ¨ã—ãªã„å ´åˆã€ã¾ãŸã¯Streamlitå¤–ã§å®Ÿè¡Œã•ã‚Œã‚‹å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯\n            # ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã‚€ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒãªã©ï¼‰\n            self.base_url = os.getenv(\"OLLAMA_BASE_URL\", \"http://localhost:11434\")\n            self.model = os.getenv(\"OLLAMA_MODEL\", \"llama3.2\")\n        \n        # APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ\n        self.api_url = f\"{self.base_url}/api/chat\"\n\n        # rules.md (Skills) ã¨ TOON_BASE.md (Format) ã‚’èª­ã¿è¾¼ã‚€\n        # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‚’æ˜ç¤ºçš„ã«æŒ‡å®šï¼ˆStreamlitã®å®Ÿè¡Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¾å­˜ã—ãªã„ï¼‰\n        base_dir = Path(__file__).parent.parent\n        rules_path = base_dir / \"rules.md\"\n        base_path = base_dir / \"TOON_BASE.md\"\n        \n        rules_text = self._load_file(rules_path, \"Skills: Standard Flow Logic\")\n        base_text = self._load_file(base_path, \"Format: TOON Output\")\n        \n        # æƒ…å ±åé›†ã®æŒ‡ç¤ºã‚’è¿½åŠ \n        information_gathering_instruction",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import os",
            "lineNumber": 1
          },
          {
            "text": "import requests",
            "lineNumber": 2
          },
          {
            "text": "import re",
            "lineNumber": 3
          },
          {
            "text": "from pathlib import Path",
            "lineNumber": 4
          },
          {
            "text": "from typing import Optional",
            "lineNumber": 5
          },
          {
            "text": "from core.exceptions import LLMAPIError",
            "lineNumber": 6
          },
          {
            "text": "from core.schemas import Flowchart",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "class LLMClient:",
            "lineNumber": 9,
            "isSignature": true
          },
          {
            "text": "    def __init__(self):",
            "lineNumber": 10
          },
          {
            "text": "        # Streamlitã®secretsã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã‚€ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ä»˜ãï¼‰",
            "lineNumber": 11
          },
          {
            "text": "        try:",
            "lineNumber": 12
          },
          {
            "text": "            import streamlit as st",
            "lineNumber": 13
          },
          {
            "text": "            # st.secretsãŒåˆ©ç”¨å¯èƒ½ãªå ´åˆï¼ˆStreamlitå®Ÿè¡Œç’°å¢ƒï¼‰",
            "lineNumber": 14
          },
          {
            "text": "            ollama_config = st.secrets.get(\"ollama\", {})",
            "lineNumber": 15
          },
          {
            "text": "            self.base_url = ollama_config.get(\"base_url\", \"http://localhost:11434\")",
            "lineNumber": 16
          },
          {
            "text": "            self.model = ollama_config.get(\"model\", \"llama3.2\")",
            "lineNumber": 17
          },
          {
            "text": "        except (AttributeError, FileNotFoundError, ImportError, RuntimeError):",
            "lineNumber": 18
          },
          {
            "text": "            # secrets.tomlãŒå­˜åœ¨ã—ãªã„å ´åˆã€ã¾ãŸã¯Streamlitå¤–ã§å®Ÿè¡Œã•ã‚Œã‚‹å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯",
            "lineNumber": 19
          },
          {
            "text": "            # ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã‚€ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒãªã©ï¼‰",
            "lineNumber": 20
          },
          {
            "text": "            self.base_url = os.getenv(\"OLLAMA_BASE_URL\", \"http://localhost:11434\")",
            "lineNumber": 21
          },
          {
            "text": "            self.model = os.getenv(\"OLLAMA_MODEL\", \"llama3.2\")",
            "lineNumber": 22
          },
          {
            "text": "        ",
            "lineNumber": 23
          },
          {
            "text": "        # APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ",
            "lineNumber": 24
          },
          {
            "text": "        self.api_url = f\"{self.base_url}/api/chat\"",
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "text": "        # rules.md (Skills) ã¨ TOON_BASE.md (Format) ã‚’èª­ã¿è¾¼ã‚€",
            "lineNumber": 27
          },
          {
            "text": "        # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‚’æ˜ç¤ºçš„ã«æŒ‡å®šï¼ˆStreamlitã®å®Ÿè¡Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¾å­˜ã—ãªã„ï¼‰",
            "lineNumber": 28
          },
          {
            "text": "        base_dir = Path(__file__).parent.parent",
            "lineNumber": 29
          },
          {
            "text": "        rules_path = base_dir / \"rules.md\"",
            "lineNumber": 30
          },
          {
            "text": "        base_path = base_dir / \"TOON_BASE.md\"",
            "lineNumber": 31
          },
          {
            "text": "        ",
            "lineNumber": 32
          },
          {
            "text": "        rules_text = self._load_file(rules_path, \"Skills: Standard Flow Logic\")",
            "lineNumber": 33
          },
          {
            "text": "        base_text = self._load_file(base_path, \"Format: TOON Output\")",
            "lineNumber": 34
          },
          {
            "text": "        ",
            "lineNumber": 35
          },
          {
            "text": "        # æƒ…å ±åé›†ã®æŒ‡ç¤ºã‚’è¿½åŠ ",
            "lineNumber": 36
          },
          {
            "text": "        information_gathering_instruction",
            "lineNumber": 37
          }
        ]
      },
      "score": 0.12566040456295013
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 401,
            "column": 35
          },
          "endPosition": {
            "line": 423,
            "column": 52
          }
        },
        "contents": "                    \n                    # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯\n                    if client.is_question_response(raw_toon_text):\n                        # è³ªå•å›æ•°ã®ä¸Šé™ãƒã‚§ãƒƒã‚¯\n                        st.session_state.question_count += 1\n                        if st.session_state.question_count &gt;= MAX_QUESTION_COUNT:\n                            st.error(f\"è³ªå•å›æ•°ãŒä¸Šé™ï¼ˆ{MAX_QUESTION_COUNT}å›ï¼‰ã«é”ã—ã¾ã—ãŸã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ãã ã•ã„ã€‚\")\n                            st.session_state.conversation_context = None\n                            st.session_state.pending_questions = None\n                            st.session_state.question_responses = []\n                            st.session_state.question_count = 0\n                        else:\n                            # è³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜\n                            st.session_state.conversation_context = user_prompt\n                            st.session_state.pending_questions = raw_toon_text\n                            st.session_state.question_responses = []\n                            st.session_state.append_mode_for_question = append_mode  # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜\n                            st.info(f\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ï¼ˆè³ªå•å›æ•°: {st.session_state.question_count}/{MAX_QUESTION_COUNT}ï¼‰\")\n                            st.rerun()\n                    else:\n                        # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼\n                        is_valid, validation_message",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                    ",
            "lineNumber": 403
          },
          {
            "text": "                    # è³ªå•å½¢å¼ã®å¿œç­”ã‹ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 404
          },
          {
            "text": "                    if client.is_question_response(raw_toon_text):",
            "lineNumber": 405
          },
          {
            "text": "                        # è³ªå•å›æ•°ã®ä¸Šé™ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 406
          },
          {
            "text": "                        st.session_state.question_count += 1",
            "lineNumber": 407
          },
          {
            "text": "                        if st.session_state.question_count &gt;= MAX_QUESTION_COUNT:",
            "lineNumber": 408
          },
          {
            "text": "                            st.error(f\"è³ªå•å›æ•°ãŒä¸Šé™ï¼ˆ{MAX_QUESTION_COUNT}å›ï¼‰ã«é”ã—ã¾ã—ãŸã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 409
          },
          {
            "text": "                            st.session_state.conversation_context = None",
            "lineNumber": 410
          },
          {
            "text": "                            st.session_state.pending_questions = None",
            "lineNumber": 411
          },
          {
            "text": "                            st.session_state.question_responses = []",
            "lineNumber": 412
          },
          {
            "text": "                            st.session_state.question_count = 0",
            "lineNumber": 413
          },
          {
            "text": "                        else:",
            "lineNumber": 414
          },
          {
            "text": "                            # è³ªå•å½¢å¼ã®å¿œç­”ã®å ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜",
            "lineNumber": 415
          },
          {
            "text": "                            st.session_state.conversation_context = user_prompt",
            "lineNumber": 416
          },
          {
            "text": "                            st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 417
          },
          {
            "text": "                            st.session_state.question_responses = []",
            "lineNumber": 418
          },
          {
            "text": "                            st.session_state.append_mode_for_question = append_mode  # å·®åˆ†è¿½è¨˜ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜",
            "lineNumber": 419
          },
          {
            "text": "                            st.info(f\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ï¼ˆè³ªå•å›æ•°: {st.session_state.question_count}/{MAX_QUESTION_COUNT}ï¼‰\")",
            "lineNumber": 420
          },
          {
            "text": "                            st.rerun()",
            "lineNumber": 421
          },
          {
            "text": "                    else:",
            "lineNumber": 422
          },
          {
            "text": "                        # å‡ºåŠ›ã‚µã‚¤ã‚ºã®æ¤œè¨¼",
            "lineNumber": 423
          },
          {
            "text": "                        is_valid, validation_message",
            "lineNumber": 424
          }
        ]
      },
      "score": 0.12379039824008942
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 508,
            "column": 74
          },
          "endPosition": {
            "line": 537,
            "column": 44
          }
        },
        "contents": "                                # è³ªå•å›æ•°ã®ä¸Šé™ãƒã‚§ãƒƒã‚¯\n                                st.session_state.question_count += 1\n                                if st.session_state.question_count &gt;= MAX_QUESTION_COUNT:\n                                    st.error(f\"è³ªå•å›æ•°ãŒä¸Šé™ï¼ˆ{MAX_QUESTION_COUNT}å›ï¼‰ã«é”ã—ã¾ã—ãŸã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ãã ã•ã„ã€‚\")\n                                    st.session_state.conversation_context = None\n                                    st.session_state.pending_questions = None\n                                    st.session_state.question_responses = []\n                                    st.session_state.question_count = 0\n                                else:\n                                    # è³ªå•å½¢å¼ã®å¿œç­”ã ã£ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜\n                                    st.session_state.conversation_context = user_prompt\n                                    st.session_state.pending_questions = raw_toon_text\n                                    st.session_state.question_responses = []\n                                    st.info(f\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ï¼ˆè³ªå•å›æ•°: {st.session_state.question_count}/{MAX_QUESTION_COUNT}ï¼‰\")\n                                    st.rerun()\n                        except:\n                            pass\n                        \n                        with st.expander(\"ğŸ” LLMã®ç”Ÿå‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰\", expanded=True):\n                            st.info(\"ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’TOONå½¢å¼ã¨ã—ã¦è§£é‡ˆã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€å¤±æ•—ã—ã¾ã—ãŸã€‚\")\n                            st.code(raw_toon_text)\n                    # ã‚¨ãƒ©ãƒ¼æ™‚ã¯st.rerun()ã‚’å‘¼ã°ãªã„ï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼‰\n        else:\n            st.warning(\"æŒ‡ç¤ºã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")\n\nwith col_flow:\n    st.subheader(\"ğŸ“Š ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ\")\n    # Mermaidæç”»å‡¦ç†\n    mermaid_code = current_flow.to_mermaid()",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                                # è³ªå•å›æ•°ã®ä¸Šé™ãƒã‚§ãƒƒã‚¯",
            "lineNumber": 510
          },
          {
            "text": "                                st.session_state.question_count += 1",
            "lineNumber": 511
          },
          {
            "text": "                                if st.session_state.question_count &gt;= MAX_QUESTION_COUNT:",
            "lineNumber": 512
          },
          {
            "text": "                                    st.error(f\"è³ªå•å›æ•°ãŒä¸Šé™ï¼ˆ{MAX_QUESTION_COUNT}å›ï¼‰ã«é”ã—ã¾ã—ãŸã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 513
          },
          {
            "text": "                                    st.session_state.conversation_context = None",
            "lineNumber": 514
          },
          {
            "text": "                                    st.session_state.pending_questions = None",
            "lineNumber": 515
          },
          {
            "text": "                                    st.session_state.question_responses = []",
            "lineNumber": 516
          },
          {
            "text": "                                    st.session_state.question_count = 0",
            "lineNumber": 517
          },
          {
            "text": "                                else:",
            "lineNumber": 518
          },
          {
            "text": "                                    # è³ªå•å½¢å¼ã®å¿œç­”ã ã£ãŸå ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«ä¿å­˜",
            "lineNumber": 519
          },
          {
            "text": "                                    st.session_state.conversation_context = user_prompt",
            "lineNumber": 520
          },
          {
            "text": "                                    st.session_state.pending_questions = raw_toon_text",
            "lineNumber": 521
          },
          {
            "text": "                                    st.session_state.question_responses = []",
            "lineNumber": 522
          },
          {
            "text": "                                    st.info(f\"LLMã‹ã‚‰è³ªå•ãŒã‚ã‚Šã¾ã—ãŸã€‚å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ï¼ˆè³ªå•å›æ•°: {st.session_state.question_count}/{MAX_QUESTION_COUNT}ï¼‰\")",
            "lineNumber": 523
          },
          {
            "text": "                                    st.rerun()",
            "lineNumber": 524
          },
          {
            "text": "                        except:",
            "lineNumber": 525
          },
          {
            "text": "                            pass",
            "lineNumber": 526
          },
          {
            "text": "                        ",
            "lineNumber": 527
          },
          {
            "text": "                        with st.expander(\"ğŸ” LLMã®ç”Ÿå‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰\", expanded=True):",
            "lineNumber": 528
          },
          {
            "text": "                            st.info(\"ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’TOONå½¢å¼ã¨ã—ã¦è§£é‡ˆã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€å¤±æ•—ã—ã¾ã—ãŸã€‚\")",
            "lineNumber": 529
          },
          {
            "text": "                            st.code(raw_toon_text)",
            "lineNumber": 530
          },
          {
            "text": "                    # ã‚¨ãƒ©ãƒ¼æ™‚ã¯st.rerun()ã‚’å‘¼ã°ãªã„ï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼‰",
            "lineNumber": 531
          },
          {
            "text": "        else:",
            "lineNumber": 532
          },
          {
            "text": "            st.warning(\"æŒ‡ç¤ºã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\")",
            "lineNumber": 533
          },
          {
            "lineNumber": 534
          },
          {
            "text": "with col_flow:",
            "lineNumber": 535
          },
          {
            "text": "    st.subheader(\"ğŸ“Š ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ\")",
            "lineNumber": 536
          },
          {
            "text": "    # Mermaidæç”»å‡¦ç†",
            "lineNumber": 537
          },
          {
            "text": "    mermaid_code = current_flow.to_mermaid()",
            "lineNumber": 538
          }
        ]
      },
      "score": 0.11889815330505371
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 162,
            "column": 54
          },
          "endPosition": {
            "line": 196,
            "column": 24
          }
        },
        "contents": "with col_chat:\n    st.subheader(\"ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ\")\n    \n    # è³ªå•ãŒä¿ç•™ä¸­ã®å ´åˆã¯è³ªå•ã‚’è¡¨ç¤ºã—ã€å›ç­”å…¥åŠ›æ¬„ã‚’è¡¨ç¤º\n    if st.session_state.pending_questions:\n        # è³ªå•ã¨å›ç­”ã®å±¥æ­´ã‚’è¡¨ç¤º\n        if st.session_state.conversation_context:\n            with st.expander(\"ğŸ“ ä¼šè©±å±¥æ­´\", expanded=False):\n                st.markdown(\"**å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:**\")\n                st.text(st.session_state.conversation_context)\n                \n                if st.session_state.question_responses:\n                    st.markdown(\"**ã“ã‚Œã¾ã§ã®å›ç­”:**\")\n                    for i, response in enumerate(st.session_state.question_responses, 1):\n                        st.markdown(f\"{i}. {response}\")\n        \n        st.info(\"ğŸ“‹ LLMã‹ã‚‰ã®è³ªå•:\")\n        st.markdown(st.session_state.pending_questions)\n        \n        st.divider()\n        st.subheader(\"ğŸ’­ å›ç­”ã‚’å…¥åŠ›\")\n        \n        # å›ç­”å…¥åŠ›æ¬„\n        user_answer = st.text_area(\n            \"è³ªå•ã«å¯¾ã™ã‚‹å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\",\n            placeholder=\"å›ç­”ã‚’å…¥åŠ›...\",\n            height=100,\n            key=\"answer_input\"\n        )\n        \n        col_answer, col_cancel = st.columns([2, 1])\n        with col_answer:\n            if st.button",
        "signatures": {},
        "detailedLines": [
          {
            "text": "with col_chat:",
            "lineNumber": 165
          },
          {
            "text": "    st.subheader(\"ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ\")",
            "lineNumber": 166
          },
          {
            "text": "    ",
            "lineNumber": 167
          },
          {
            "text": "    # è³ªå•ãŒä¿ç•™ä¸­ã®å ´åˆã¯è³ªå•ã‚’è¡¨ç¤ºã—ã€å›ç­”å…¥åŠ›æ¬„ã‚’è¡¨ç¤º",
            "lineNumber": 168
          },
          {
            "text": "    if st.session_state.pending_questions:",
            "lineNumber": 169
          },
          {
            "text": "        # è³ªå•ã¨å›ç­”ã®å±¥æ­´ã‚’è¡¨ç¤º",
            "lineNumber": 170
          },
          {
            "text": "        if st.session_state.conversation_context:",
            "lineNumber": 171
          },
          {
            "text": "            with st.expander(\"ğŸ“ ä¼šè©±å±¥æ­´\", expanded=False):",
            "lineNumber": 172
          },
          {
            "text": "                st.markdown(\"**å…ƒã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:**\")",
            "lineNumber": 173
          },
          {
            "text": "                st.text(st.session_state.conversation_context)",
            "lineNumber": 174
          },
          {
            "text": "                ",
            "lineNumber": 175
          },
          {
            "text": "                if st.session_state.question_responses:",
            "lineNumber": 176
          },
          {
            "text": "                    st.markdown(\"**ã“ã‚Œã¾ã§ã®å›ç­”:**\")",
            "lineNumber": 177
          },
          {
            "text": "                    for i, response in enumerate(st.session_state.question_responses, 1):",
            "lineNumber": 178
          },
          {
            "text": "                        st.markdown(f\"{i}. {response}\")",
            "lineNumber": 179
          },
          {
            "text": "        ",
            "lineNumber": 180
          },
          {
            "text": "        st.info(\"ğŸ“‹ LLMã‹ã‚‰ã®è³ªå•:\")",
            "lineNumber": 181
          },
          {
            "text": "        st.markdown(st.session_state.pending_questions)",
            "lineNumber": 182
          },
          {
            "text": "        ",
            "lineNumber": 183
          },
          {
            "text": "        st.divider()",
            "lineNumber": 184
          },
          {
            "text": "        st.subheader(\"ğŸ’­ å›ç­”ã‚’å…¥åŠ›\")",
            "lineNumber": 185
          },
          {
            "text": "        ",
            "lineNumber": 186
          },
          {
            "text": "        # å›ç­”å…¥åŠ›æ¬„",
            "lineNumber": 187
          },
          {
            "text": "        user_answer = st.text_area(",
            "lineNumber": 188
          },
          {
            "text": "            \"è³ªå•ã«å¯¾ã™ã‚‹å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\",",
            "lineNumber": 189
          },
          {
            "text": "            placeholder=\"å›ç­”ã‚’å…¥åŠ›...\",",
            "lineNumber": 190
          },
          {
            "text": "            height=100,",
            "lineNumber": 191
          },
          {
            "text": "            key=\"answer_input\"",
            "lineNumber": 192
          },
          {
            "text": "        )",
            "lineNumber": 193
          },
          {
            "text": "        ",
            "lineNumber": 194
          },
          {
            "text": "        col_answer, col_cancel = st.columns([2, 1])",
            "lineNumber": 195
          },
          {
            "text": "        with col_answer:",
            "lineNumber": 196
          },
          {
            "text": "            if st.button",
            "lineNumber": 197
          }
        ]
      },
      "score": 0.11627259850502014
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app.py",
        "range": {
          "startPosition": {
            "line": 670,
            "column": 45
          },
          "endPosition": {
            "line": 713,
            "column": 50
          }
        },
        "contents": "                    \n                    if not partial_flowchart.nodes:\n                        st.error(\"é¸æŠã•ã‚ŒãŸãƒãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚\")\n                        progress_bar.empty()\n                        status_text.empty()\n                    else:\n                        # 2. LLMã«éƒ¨åˆ†å¤‰æ›´ã‚’ä¾é ¼\n                        client = LLMClient()\n                        status_text.info(\"LLMãŒå¤‰æ›´ã‚’ç”Ÿæˆä¸­...\")\n                        progress_bar.progress(50)\n                        changed_toon = client.generate_partial_change(\n                            change_instruction,\n                            partial_flowchart,\n                            current_flow\n                        )\n                        progress_bar.progress(70)\n                        \n                        # 3. å¤‰æ›´çµæœã‚’ãƒ‘ãƒ¼ã‚¹\n                        status_text.info(\"å¤‰æ›´çµæœã‚’è§£æä¸­...\")\n                        parser = TOONParser()\n                        changed_partial = parser.parse(changed_toon)\n                        progress_bar.progress(85)\n                        \n                        # 4. å…¨ä½“ãƒ•ãƒ­ãƒ¼ã«ãƒãƒ¼ã‚¸\n                        status_text.info(\"ãƒ•ãƒ­ãƒ¼ã‚’ãƒãƒ¼ã‚¸ä¸­...\")\n                        merged_flowchart = FlowMerger.merge_partial_change(\n                            current_flow,\n                            changed_partial,\n                            selected_node_ids\n                        )\n                        progress_bar.progress(95)\n                        \n                        # 5. å±¥æ­´ã«è¿½åŠ \n                        history_mgr.append_toon_log(\n                            session_name,\n                            merged_flowchart\n                        )\n                        \n                        # 6. ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°\n                        st.session_state.history = history_mgr.load_history(session_name)\n                        st.session_state.selected_node_ids = []  # é¸æŠã‚’ã‚¯ãƒªã‚¢\n                        \n                        progress_bar.progress(100)",
        "signatures": {},
        "detailedLines": [
          {
            "text": "                    ",
            "lineNumber": 672
          },
          {
            "text": "                    if not partial_flowchart.nodes:",
            "lineNumber": 673
          },
          {
            "text": "                        st.error(\"é¸æŠã•ã‚ŒãŸãƒãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚\")",
            "lineNumber": 674
          },
          {
            "text": "                        progress_bar.empty()",
            "lineNumber": 675
          },
          {
            "text": "                        status_text.empty()",
            "lineNumber": 676
          },
          {
            "text": "                    else:",
            "lineNumber": 677
          },
          {
            "text": "                        # 2. LLMã«éƒ¨åˆ†å¤‰æ›´ã‚’ä¾é ¼",
            "lineNumber": 678
          },
          {
            "text": "                        client = LLMClient()",
            "lineNumber": 679
          },
          {
            "text": "                        status_text.info(\"LLMãŒå¤‰æ›´ã‚’ç”Ÿæˆä¸­...\")",
            "lineNumber": 680
          },
          {
            "text": "                        progress_bar.progress(50)",
            "lineNumber": 681
          },
          {
            "text": "                        changed_toon = client.generate_partial_change(",
            "lineNumber": 682
          },
          {
            "text": "                            change_instruction,",
            "lineNumber": 683
          },
          {
            "text": "                            partial_flowchart,",
            "lineNumber": 684
          },
          {
            "text": "                            current_flow",
            "lineNumber": 685
          },
          {
            "text": "                        )",
            "lineNumber": 686
          },
          {
            "text": "                        progress_bar.progress(70)",
            "lineNumber": 687
          },
          {
            "text": "                        ",
            "lineNumber": 688
          },
          {
            "text": "                        # 3. å¤‰æ›´çµæœã‚’ãƒ‘ãƒ¼ã‚¹",
            "lineNumber": 689
          },
          {
            "text": "                        status_text.info(\"å¤‰æ›´çµæœã‚’è§£æä¸­...\")",
            "lineNumber": 690
          },
          {
            "text": "                        parser = TOONParser()",
            "lineNumber": 691
          },
          {
            "text": "                        changed_partial = parser.parse(changed_toon)",
            "lineNumber": 692
          },
          {
            "text": "                        progress_bar.progress(85)",
            "lineNumber": 693
          },
          {
            "text": "                        ",
            "lineNumber": 694
          },
          {
            "text": "                        # 4. å…¨ä½“ãƒ•ãƒ­ãƒ¼ã«ãƒãƒ¼ã‚¸",
            "lineNumber": 695
          },
          {
            "text": "                        status_text.info(\"ãƒ•ãƒ­ãƒ¼ã‚’ãƒãƒ¼ã‚¸ä¸­...\")",
            "lineNumber": 696
          },
          {
            "text": "                        merged_flowchart = FlowMerger.merge_partial_change(",
            "lineNumber": 697
          },
          {
            "text": "                            current_flow,",
            "lineNumber": 698
          },
          {
            "text": "                            changed_partial,",
            "lineNumber": 699
          },
          {
            "text": "                            selected_node_ids",
            "lineNumber": 700
          },
          {
            "text": "                        )",
            "lineNumber": 701
          },
          {
            "text": "                        progress_bar.progress(95)",
            "lineNumber": 702
          },
          {
            "text": "                        ",
            "lineNumber": 703
          },
          {
            "text": "                        # 5. å±¥æ­´ã«è¿½åŠ ",
            "lineNumber": 704
          },
          {
            "text": "                        history_mgr.append_toon_log(",
            "lineNumber": 705
          },
          {
            "text": "                            session_name,",
            "lineNumber": 706
          },
          {
            "text": "                            merged_flowchart",
            "lineNumber": 707
          },
          {
            "text": "                        )",
            "lineNumber": 708
          },
          {
            "text": "                        ",
            "lineNumber": 709
          },
          {
            "text": "                        # 6. ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°",
            "lineNumber": 710
          },
          {
            "text": "                        st.session_state.history = history_mgr.load_history(session_name)",
            "lineNumber": 711
          },
          {
            "text": "                        st.session_state.selected_node_ids = []  # é¸æŠã‚’ã‚¯ãƒªã‚¢",
            "lineNumber": 712
          },
          {
            "text": "                        ",
            "lineNumber": 713
          },
          {
            "text": "                        progress_bar.progress(100)",
            "lineNumber": 714
          }
        ]
      },
      "score": 0.11547303199768066
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---


UIé¸æŠï¼ˆã‚¯ãƒªãƒƒã‚¯ï¼‰ã®Streamlité€£æºã‚’ä¿®æ­£ä¸­ã€‚JavaScriptã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’Streamlitå´ã§å—ä¿¡ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: frontend/index.html</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: frontend/index.html</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="read_lints">
<details>
<summary>Tool use: **read_lints**</summary>


Parameters:

```json
{
  "paths": [
    "app.py",
    "frontend/index.html"
  ]
}
```
Result:

```json
{
  "linterErrorsByFile": [
    {
      "relativeWorkspacePath": "app.py"
    },
    {
      "relativeWorkspacePath": "frontend/index.html"
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---


ãƒãƒ¼ãƒ‰é¸æŠæ©Ÿèƒ½ã‚’ç¢ºèªãƒ»æ”¹å–„ä¸­ã€‚ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã¯å‹•ä½œã—ã¾ã™ãŒã€UIé¸æŠï¼ˆã‚¯ãƒªãƒƒã‚¯ï¼‰ã®é€£æºã‚’æ”¹å–„ã—ã¾ã™ã€‚


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: app.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** â€¢ Read file: core/flow_extractor.py</summary>

</details>
</tool-use>

---


ãƒãƒ¼ãƒ‰é¸æŠæ©Ÿèƒ½ã®å®Ÿè£…çŠ¶æ³ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã¯å‹•ä½œã—ã¾ã™ãŒã€UIé¸æŠï¼ˆã‚¯ãƒªãƒƒã‚¯ï¼‰ã®é€£æºã‚’æ”¹å–„ã—ã¾ã™ã€‚ã‚ˆã‚Šç¢ºå®Ÿãªæ–¹æ³•ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** â€¢ Edit file: app.py</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="read_lints">
<details>
<summary>Tool use: **read_lints**</summary>


Parameters:

```json
{
  "paths": [
    "app.py"
  ]
}
```
Result:

```json
{
  "linterErrorsByFile": [
    {
      "relativeWorkspacePath": "app.py"
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---


ãƒãƒ¼ãƒ‰é¸æŠæ©Ÿèƒ½ã‚’æ”¹å–„ã—ã¾ã—ãŸã€‚ä»¥ä¸‹ã®3ã¤ã®æ–¹æ³•ã§ãƒãƒ¼ãƒ‰ã‚’æŒ‡å®šã§ãã¾ã™ã€‚

## å®Ÿè£…æ¸ˆã¿ã®ãƒãƒ¼ãƒ‰é¸æŠæ©Ÿèƒ½

### 1. **ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã§ã®é¸æŠ**ï¼ˆå‹•ä½œç¢ºèªæ¸ˆã¿ï¼‰
- ãƒãƒ¼ãƒ‰IDã‚’ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§å…¥åŠ›
- ä¾‹: `task1, task2, decision1`
- startã¨endã¯è‡ªå‹•ã§é™¤å¤–
- å­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰IDã¯è­¦å‘Šè¡¨ç¤º

### 2. **ãƒãƒ¼ãƒ‰ä¸€è¦§ã‹ã‚‰ã®é¸æŠ**ï¼ˆæ–°è¦è¿½åŠ ï¼‰
- ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆå†…ã®å…¨ãƒãƒ¼ãƒ‰ã‚’ä¸€è¦§è¡¨ç¤º
- ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§è¤‡æ•°é¸æŠå¯èƒ½
- ãƒãƒ¼ãƒ‰IDã¨ãƒ©ãƒ™ãƒ«ã‚’è¡¨ç¤ºï¼ˆä¾‹: `task1 (ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’äº¤æ›)`ï¼‰
- ã‚ˆã‚Šç¢ºå®Ÿã«ãƒãƒ¼ãƒ‰ã‚’é¸æŠå¯èƒ½

### 3. **ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆä¸Šã§ã®ã‚¯ãƒªãƒƒã‚¯é¸æŠ**ï¼ˆå®Ÿè£…æ¸ˆã¿ã€æ”¹å–„ä¸­ï¼‰
- ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆä¸Šã®ãƒãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ
- URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿çµŒç”±ã§Streamlitã«é€šçŸ¥
- ã‚¯ãƒªãƒƒã‚¯æ™‚ã«ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º

## ä½¿ç”¨æ–¹æ³•

1. å³å´ã®ã€Œãƒãƒ¼ãƒ‰é¸æŠï¼ˆéƒ¨åˆ†å¤‰æ›´ç”¨ï¼‰ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§é¸æŠæ–¹æ³•ã‚’é¸æŠ
2. ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›: ãƒãƒ¼ãƒ‰IDã‚’ç›´æ¥å…¥åŠ›
3. ãƒãƒ¼ãƒ‰ä¸€è¦§: ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§é¸æŠ
4. é¸æŠå¾Œã€ã€Œå¤‰æ›´æŒ‡ç¤ºã€ã‚’å…¥åŠ›ã—ã¦ã€Œé¸æŠç¯„å›²ã‚’å¤‰æ›´ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

## æ³¨æ„äº‹é …

- startã¨endãƒãƒ¼ãƒ‰ã¯é¸æŠä¸å¯ï¼ˆè‡ªå‹•ã§é™¤å¤–ï¼‰
- è¤‡æ•°ã®ãƒãƒ¼ãƒ‰ã‚’åŒæ™‚ã«é¸æŠå¯èƒ½
- é¸æŠã—ãŸãƒãƒ¼ãƒ‰ã¯ã€Œé¸æŠã•ã‚ŒãŸãƒãƒ¼ãƒ‰: task1, task2, ...ã€ã¨ã—ã¦è¡¨ç¤º
- ã€Œé¸æŠã‚’ã‚¯ãƒªã‚¢ã€ãƒœã‚¿ãƒ³ã§å…¨é¸æŠã‚’è§£é™¤å¯èƒ½

ã“ã‚Œã§ã€ãƒãƒ¼ãƒ‰ã‚’ç¢ºå®Ÿã«æŒ‡å®šã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

---

_**User**_

ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ãªã„ã‹ç¢ºèªã—ã¦ã€gitã§ãƒ—ãƒƒã‚·ãƒ¥ã—ã¦ãã ã•ã„ã€‚

---

_**Agent (model default, mode Agent)**_



---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>

Status: **loading**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="read_file_v2">
<details>
<summary>Tool use: **read_file_v2**</summary>

Status: **loading**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="glob_file_search">
<details>
<summary>Tool use: **glob_file_search**</summary>

Status: **loading**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="glob_file_search">
<details>
<summary>Tool use: **glob_file_search**</summary>

Status: **loading**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="glob_file_search">
<details>
<summary>Tool use: **glob_file_search**</summary>

Status: **loading**


</details>
</tool-use>

---

<tool-use data-tool-type="shell" data-tool-name="run_terminal_command_v2">
<details><summary>Tool use: **run_terminal_command_v2**</summary>

</details>
</tool-use>

---

